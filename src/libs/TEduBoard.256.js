/*eslint-disable*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TEduBoard=e():t.TEduBoard=e()}(window,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=137)}([function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e,i){var r=i(42)("wks"),o=i(17),n=i(0).Symbol,s="function"==typeof n;(t.exports=function(t){return r[t]||(r[t]=s&&n[t]||(s?n:o)("Symbol."+t))}).store=r},function(t,e,i){var r=i(0),o=i(16),n=i(10),s=i(9),a=i(15),l=function(t,e,i){var h,d,c,u,p=t&l.F,f=t&l.G,g=t&l.S,_=t&l.P,m=t&l.B,y=f?r:g?r[e]||(r[e]={}):(r[e]||{}).prototype,T=f?o:o[e]||(o[e]={}),v=T.prototype||(T.prototype={});for(h in f&&(i=e),i)c=((d=!p&&y&&void 0!==y[h])?y:i)[h],u=m&&d?a(c,r):_&&"function"==typeof c?a(Function.call,c):c,y&&s(y,h,c,t&l.U),T[h]!=c&&n(T,h,u),_&&v[h]!=c&&(v[h]=c)};r.core=o,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){t.exports=!i(3)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var r=i(5);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e,i){var r=i(6),o=i(72),n=i(30),s=Object.defineProperty;e.f=i(4)?Object.defineProperty:function(t,e,i){if(r(t),e=n(e,!0),r(i),o)try{return s(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var r=i(23),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e,i){var r=i(0),o=i(10),n=i(12),s=i(17)("src"),a=i(102),l=(""+a).split("toString");i(16).inspectSource=function(t){return a.call(t)},(t.exports=function(t,e,i,a){var h="function"==typeof i;h&&(n(i,"name")||o(i,"name",e)),t[e]!==i&&(h&&(n(i,s)||o(i,s,t[e]?""+t[e]:l.join(String(e)))),t===r?t[e]=i:a?t[e]?t[e]=i:o(t,e,i):(delete t[e],o(t,e,i)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[s]||a.call(this)}))},function(t,e,i){var r=i(7),o=i(31);t.exports=i(4)?function(t,e,i){return r.f(t,e,o(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var r=i(25);t.exports=function(t){return Object(r(t))}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){"use strict";var r=i(34),o={};o[i(1)("toStringTag")]="z",o+""!="[object z]"&&i(9)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},function(t,e,i){var r=i(2);r(r.S+r.F,"Object",{assign:i(103)})},function(t,e,i){var r=i(19);t.exports=function(t,e,i){if(r(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,o){return t.call(e,i,r,o)}}return function(){return t.apply(e,arguments)}}},function(t,e){var i=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=i)},function(t,e){var i=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+r).toString(36))}},function(t,e){t.exports=!1},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){var r=i(73),o=i(55);t.exports=Object.keys||function(t){return r(t,o)}},function(t,e,i){var r=i(52),o=i(25);t.exports=function(t){return r(o(t))}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e){var i=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:i)(t)}},function(t,e,i){"use strict";var r=i(0),o=i(12),n=i(22),s=i(65),a=i(30),l=i(3),h=i(26).f,d=i(45).f,c=i(7).f,u=i(106).trim,p=r.Number,f=p,g=p.prototype,_="Number"==n(i(27)(g)),m="trim"in String.prototype,y=function(t){var e=a(t,!1);if("string"==typeof e&&e.length>2){var i,r,o,n=(e=m?e.trim():u(e,3)).charCodeAt(0);if(43===n||45===n){if(88===(i=e.charCodeAt(2))||120===i)return NaN}else if(48===n){switch(e.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+e}for(var s,l=e.slice(2),h=0,d=l.length;h<d;h++)if((s=l.charCodeAt(h))<48||s>o)return NaN;return parseInt(l,r)}}return+e};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof p&&(_?l((function(){g.valueOf.call(i)})):"Number"!=n(i))?s(new f(y(e)),i,p):y(e)};for(var T,v=i(4)?h(f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),E=0;v.length>E;E++)o(f,T=v[E])&&!o(p,T)&&c(p,T,d(f,T));p.prototype=g,g.constructor=p,i(9)(r,"Number",p)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){var r=i(73),o=i(55).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,e,i){var r=i(6),o=i(108),n=i(55),s=i(54)("IE_PROTO"),a=function(){},l=function(){var t,e=i(51)("iframe"),r=n.length;for(e.style.display="none",i(76).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;r--;)delete l.prototype[n[r]];return l()};t.exports=Object.create||function(t,e){var i;return null!==t?(a.prototype=r(t),i=new a,a.prototype=null,i[s]=t):i=l(),void 0===e?i:o(i,e)}},function(t,e){t.exports={}},function(t,e,i){var r=i(7).f,o=i(12),n=i(1)("toStringTag");t.exports=function(t,e,i){t&&!o(t=i?t:t.prototype,n)&&r(t,n,{configurable:!0,value:e})}},function(t,e,i){var r=i(5);t.exports=function(t,e){if(!r(t))return t;var i,o;if(e&&"function"==typeof(i=t.toString)&&!r(o=i.call(t)))return o;if("function"==typeof(i=t.valueOf)&&!r(o=i.call(t)))return o;if(!e&&"function"==typeof(i=t.toString)&&!r(o=i.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){"use strict";var r=i(6),o=i(8),n=i(61),s=i(62);i(63)("match",1,(function(t,e,i,a){return[function(i){var r=t(this),o=null==i?void 0:i[e];return void 0!==o?o.call(i,r):new RegExp(i)[e](String(r))},function(t){var e=a(i,t,this);if(e.done)return e.value;var l=r(t),h=String(this);if(!l.global)return s(l,h);var d=l.unicode;l.lastIndex=0;for(var c,u=[],p=0;null!==(c=s(l,h));){var f=String(c[0]);u[p]=f,""===f&&(l.lastIndex=n(h,o(l.lastIndex),d)),p++}return 0===p?null:u}]}))},function(t,e,i){var r=i(22),o=i(1)("toStringTag"),n="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?i:n?r(e):"Object"==(s=r(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,i){"use strict";var r=i(59),o=i(6),n=i(66),s=i(61),a=i(8),l=i(62),h=i(64),d=i(3),c=Math.min,u=[].push,p=!d((function(){RegExp(4294967295,"y")}));i(63)("split",2,(function(t,e,i,d){var f;return f="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var o=String(this);if(void 0===t&&0===e)return[];if(!r(t))return i.call(o,t,e);for(var n,s,a,l=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),c=0,p=void 0===e?4294967295:e>>>0,f=new RegExp(t.source,d+"g");(n=h.call(f,o))&&!((s=f.lastIndex)>c&&(l.push(o.slice(c,n.index)),n.length>1&&n.index<o.length&&u.apply(l,n.slice(1)),a=n[0].length,c=s,l.length>=p));)f.lastIndex===n.index&&f.lastIndex++;return c===o.length?!a&&f.test("")||l.push(""):l.push(o.slice(c)),l.length>p?l.slice(0,p):l}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:i.call(this,t,e)}:i,[function(i,r){var o=t(this),n=null==i?void 0:i[e];return void 0!==n?n.call(i,o,r):f.call(String(o),i,r)},function(t,e){var r=d(f,t,this,e,f!==i);if(r.done)return r.value;var h=o(t),u=String(this),g=n(h,RegExp),_=h.unicode,m=(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(p?"y":"g"),y=new g(p?h:"^(?:"+h.source+")",m),T=void 0===e?4294967295:e>>>0;if(0===T)return[];if(0===u.length)return null===l(y,u)?[u]:[];for(var v=0,E=0,S=[];E<u.length;){y.lastIndex=p?E:0;var b,O=l(y,p?u:u.slice(E));if(null===O||(b=c(a(y.lastIndex+(p?0:E)),u.length))===v)E=s(u,E,_);else{if(S.push(u.slice(v,E)),S.length===T)return S;for(var D=1;D<=O.length-1;D++)if(S.push(O[D]),S.length===T)return S;E=v=b}}return S.push(u.slice(v)),S}]}))},function(t,e,i){"use strict";var r=i(6),o=i(11),n=i(8),s=i(23),a=i(61),l=i(62),h=Math.max,d=Math.min,c=Math.floor,u=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;i(63)("replace",2,(function(t,e,i,f){return[function(r,o){var n=t(this),s=null==r?void 0:r[e];return void 0!==s?s.call(r,n,o):i.call(String(n),r,o)},function(t,e){var o=f(i,t,this,e);if(o.done)return o.value;var c=r(t),u=String(this),p="function"==typeof e;p||(e=String(e));var _=c.global;if(_){var m=c.unicode;c.lastIndex=0}for(var y=[];;){var T=l(c,u);if(null===T)break;if(y.push(T),!_)break;""===String(T[0])&&(c.lastIndex=a(u,n(c.lastIndex),m))}for(var v,E="",S=0,b=0;b<y.length;b++){T=y[b];for(var O=String(T[0]),D=h(d(s(T.index),u.length),0),A=[],I=1;I<T.length;I++)A.push(void 0===(v=T[I])?v:String(v));var x=T.groups;if(p){var w=[O].concat(A,D,u);void 0!==x&&w.push(x);var R=String(e.apply(void 0,w))}else R=g(O,u,D,A,x,e);D>=S&&(E+=u.slice(S,D)+R,S=D+O.length)}return E+u.slice(S)}];function g(t,e,r,n,s,a){var l=r+t.length,h=n.length,d=p;return void 0!==s&&(s=o(s),d=u),i.call(a,d,(function(i,o){var a;switch(o.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(l);case"<":a=s[o.slice(1,-1)];break;default:var d=+o;if(0===d)return i;if(d>h){var u=c(d/10);return 0===u?i:u<=h?void 0===n[u-1]?o.charAt(1):n[u-1]+o.charAt(1):i}a=n[d-1]}return void 0===a?"":a}))}}))},function(t,e,i){"use strict";i(110);var r=i(6),o=i(44),n=i(4),s=/./.toString,a=function(t){i(9)(RegExp.prototype,"toString",t,!0)};i(3)((function(){return"/a/b"!=s.call({source:"a",flags:"b"})}))?a((function(){var t=r(this);return"/".concat(t.source,"/","flags"in t?t.flags:!n&&t instanceof RegExp?o.call(t):void 0)})):"toString"!=s.name&&a((function(){return s.call(this)}))},function(t,e,i){var r=Date.prototype,o=r.toString,n=r.getTime;new Date(NaN)+""!="Invalid Date"&&i(9)(r,"toString",(function(){var t=n.call(this);return t==t?o.call(this):"Invalid Date"}))},function(t,e,i){"use strict";var r,o,n,s,a=i(18),l=i(0),h=i(15),d=i(34),c=i(2),u=i(5),p=i(19),f=i(40),g=i(67),_=i(66),m=i(80).set,y=i(112)(),T=i(82),v=i(113),E=i(114),S=i(115),b=l.TypeError,O=l.process,D=O&&O.versions,A=D&&D.v8||"",I=l.Promise,x="process"==d(O),w=function(){},R=o=T.f,C=!!function(){try{var t=I.resolve(1),e=(t.constructor={})[i(1)("species")]=function(t){t(w,w)};return(x||"function"==typeof PromiseRejectionEvent)&&t.then(w)instanceof e&&0!==A.indexOf("6.6")&&-1===E.indexOf("Chrome/66")}catch(t){}}(),B=function(t){var e;return!(!u(t)||"function"!=typeof(e=t.then))&&e},L=function(t,e){if(!t._n){t._n=!0;var i=t._c;y((function(){for(var r=t._v,o=1==t._s,n=0,s=function(e){var i,n,s,a=o?e.ok:e.fail,l=e.resolve,h=e.reject,d=e.domain;try{a?(o||(2==t._h&&M(t),t._h=1),!0===a?i=r:(d&&d.enter(),i=a(r),d&&(d.exit(),s=!0)),i===e.promise?h(b("Promise-chain cycle")):(n=B(i))?n.call(i,l,h):l(i)):h(r)}catch(t){d&&!s&&d.exit(),h(t)}};i.length>n;)s(i[n++]);t._c=[],t._n=!1,e&&!t._h&&P(t)}))}},P=function(t){m.call(l,(function(){var e,i,r,o=t._v,n=N(t);if(n&&(e=v((function(){x?O.emit("unhandledRejection",o,t):(i=l.onunhandledrejection)?i({promise:t,reason:o}):(r=l.console)&&r.error&&r.error("Unhandled promise rejection",o)})),t._h=x||N(t)?2:1),t._a=void 0,n&&e.e)throw e.v}))},N=function(t){return 1!==t._h&&0===(t._a||t._c).length},M=function(t){m.call(l,(function(){var e;x?O.emit("rejectionHandled",t):(e=l.onrejectionhandled)&&e({promise:t,reason:t._v})}))},k=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),L(e,!0))},q=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw b("Promise can't be resolved itself");(e=B(t))?y((function(){var r={_w:i,_d:!1};try{e.call(t,h(q,r,1),h(k,r,1))}catch(t){k.call(r,t)}})):(i._v=t,i._s=1,L(i,!1))}catch(t){k.call({_w:i,_d:!1},t)}}};C||(I=function(t){f(this,I,"Promise","_h"),p(t),r.call(this);try{t(h(q,this,1),h(k,this,1))}catch(t){k.call(this,t)}},(r=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(41)(I.prototype,{then:function(t,e){var i=R(_(this,I));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=x?O.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&L(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),n=function(){var t=new r;this.promise=t,this.resolve=h(q,t,1),this.reject=h(k,t,1)},T.f=R=function(t){return t===I||t===s?new n(t):o(t)}),c(c.G+c.W+c.F*!C,{Promise:I}),i(29)(I,"Promise"),i(46)("Promise"),s=i(16).Promise,c(c.S+c.F*!C,"Promise",{reject:function(t){var e=R(this);return(0,e.reject)(t),e.promise}}),c(c.S+c.F*(a||!C),"Promise",{resolve:function(t){return S(a&&this===s?I:this,t)}}),c(c.S+c.F*!(C&&i(68)((function(t){I.all(t).catch(w)}))),"Promise",{all:function(t){var e=this,i=R(e),r=i.resolve,o=i.reject,n=v((function(){var i=[],n=0,s=1;g(t,!1,(function(t){var a=n++,l=!1;i.push(void 0),s++,e.resolve(t).then((function(t){l||(l=!0,i[a]=t,--s||r(i))}),o)})),--s||r(i)}));return n.e&&o(n.v),i.promise},race:function(t){var e=this,i=R(e),r=i.reject,o=v((function(){g(t,!1,(function(t){e.resolve(t).then(i.resolve,r)}))}));return o.e&&r(o.v),i.promise}})},function(t,e){t.exports=function(t,e,i,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var r=i(9);t.exports=function(t,e,i){for(var o in e)r(t,o,e[o],i);return t}},function(t,e,i){var r=i(16),o=i(0),n=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:r.version,mode:i(18)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,i){var r=i(23),o=Math.max,n=Math.min;t.exports=function(t,e){return(t=r(t))<0?o(t+e,0):n(t,e)}},function(t,e,i){"use strict";var r=i(6);t.exports=function(){var t=r(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,i){var r=i(32),o=i(31),n=i(21),s=i(30),a=i(12),l=i(72),h=Object.getOwnPropertyDescriptor;e.f=i(4)?h:function(t,e){if(t=n(t),e=s(e,!0),l)try{return h(t,e)}catch(t){}if(a(t,e))return o(!r.f.call(t,e),t[e])}},function(t,e,i){"use strict";var r=i(0),o=i(7),n=i(4),s=i(1)("species");t.exports=function(t){var e=r[t];n&&e&&!e[s]&&o.f(e,s,{configurable:!0,get:function(){return this}})}},function(t,e,i){var r=i(1)("unscopables"),o=Array.prototype;null==o[r]&&i(10)(o,r,{}),t.exports=function(t){o[r][t]=!0}},function(t,e,i){"use strict";var r=i(47),o=i(87),n=i(28),s=i(21);t.exports=i(70)(Array,"Array",(function(t,e){this._t=s(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,o(1)):o(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])}),"values"),n.Arguments=n.Array,r("keys"),r("values"),r("entries")},function(t,e,i){i(92)("asyncIterator")},function(t,e,i){"use strict";var r=i(0),o=i(12),n=i(4),s=i(2),a=i(9),l=i(71).KEY,h=i(3),d=i(42),c=i(29),u=i(17),p=i(1),f=i(93),g=i(92),_=i(124),m=i(85),y=i(6),T=i(5),v=i(11),E=i(21),S=i(30),b=i(31),O=i(27),D=i(125),A=i(45),I=i(56),x=i(7),w=i(20),R=A.f,C=x.f,B=D.f,L=r.Symbol,P=r.JSON,N=P&&P.stringify,M=p("_hidden"),k=p("toPrimitive"),q={}.propertyIsEnumerable,U=d("symbol-registry"),F=d("symbols"),H=d("op-symbols"),G=Object.prototype,W="function"==typeof L&&!!I.f,V=r.QObject,Y=!V||!V.prototype||!V.prototype.findChild,X=n&&h((function(){return 7!=O(C({},"a",{get:function(){return C(this,"a",{value:7}).a}})).a}))?function(t,e,i){var r=R(G,e);r&&delete G[e],C(t,e,i),r&&t!==G&&C(G,e,r)}:C,z=function(t){var e=F[t]=O(L.prototype);return e._k=t,e},j=W&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},J=function(t,e,i){return t===G&&J(H,e,i),y(t),e=S(e,!0),y(i),o(F,e)?(i.enumerable?(o(t,M)&&t[M][e]&&(t[M][e]=!1),i=O(i,{enumerable:b(0,!1)})):(o(t,M)||C(t,M,b(1,{})),t[M][e]=!0),X(t,e,i)):C(t,e,i)},K=function(t,e){y(t);for(var i,r=_(e=E(e)),o=0,n=r.length;n>o;)J(t,i=r[o++],e[i]);return t},Z=function(t){var e=q.call(this,t=S(t,!0));return!(this===G&&o(F,t)&&!o(H,t))&&(!(e||!o(this,t)||!o(F,t)||o(this,M)&&this[M][t])||e)},Q=function(t,e){if(t=E(t),e=S(e,!0),t!==G||!o(F,e)||o(H,e)){var i=R(t,e);return!i||!o(F,e)||o(t,M)&&t[M][e]||(i.enumerable=!0),i}},$=function(t){for(var e,i=B(E(t)),r=[],n=0;i.length>n;)o(F,e=i[n++])||e==M||e==l||r.push(e);return r},tt=function(t){for(var e,i=t===G,r=B(i?H:E(t)),n=[],s=0;r.length>s;)!o(F,e=r[s++])||i&&!o(G,e)||n.push(F[e]);return n};W||(a((L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=u(arguments.length>0?arguments[0]:void 0),e=function(i){this===G&&e.call(H,i),o(this,M)&&o(this[M],t)&&(this[M][t]=!1),X(this,t,b(1,i))};return n&&Y&&X(G,t,{configurable:!0,set:e}),z(t)}).prototype,"toString",(function(){return this._k})),A.f=Q,x.f=J,i(26).f=D.f=$,i(32).f=Z,I.f=tt,n&&!i(18)&&a(G,"propertyIsEnumerable",Z,!0),f.f=function(t){return z(p(t))}),s(s.G+s.W+s.F*!W,{Symbol:L});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;et.length>it;)p(et[it++]);for(var rt=w(p.store),ot=0;rt.length>ot;)g(rt[ot++]);s(s.S+s.F*!W,"Symbol",{for:function(t){return o(U,t+="")?U[t]:U[t]=L(t)},keyFor:function(t){if(!j(t))throw TypeError(t+" is not a symbol!");for(var e in U)if(U[e]===t)return e},useSetter:function(){Y=!0},useSimple:function(){Y=!1}}),s(s.S+s.F*!W,"Object",{create:function(t,e){return void 0===e?O(t):K(O(t),e)},defineProperty:J,defineProperties:K,getOwnPropertyDescriptor:Q,getOwnPropertyNames:$,getOwnPropertySymbols:tt});var nt=h((function(){I.f(1)}));s(s.S+s.F*nt,"Object",{getOwnPropertySymbols:function(t){return I.f(v(t))}}),P&&s(s.S+s.F*(!W||h((function(){var t=L();return"[null]"!=N([t])||"{}"!=N({a:t})||"{}"!=N(Object(t))}))),"JSON",{stringify:function(t){for(var e,i,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(i=e=r[1],(T(e)||void 0!==t)&&!j(t))return m(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!j(e))return e}),r[1]=e,N.apply(P,r)}}),L.prototype[k]||i(10)(L.prototype,k,L.prototype.valueOf),c(L,"Symbol"),c(Math,"Math",!0),c(r.JSON,"JSON",!0)},function(t,e,i){var r=i(5),o=i(0).document,n=r(o)&&r(o.createElement);t.exports=function(t){return n?o.createElement(t):{}}},function(t,e,i){var r=i(22);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,e,i){var r=i(21),o=i(8),n=i(43);t.exports=function(t){return function(e,i,s){var a,l=r(e),h=o(l.length),d=n(s,h);if(t&&i!=i){for(;h>d;)if((a=l[d++])!=a)return!0}else for(;h>d;d++)if((t||d in l)&&l[d]===i)return t||d||0;return!t&&-1}}},function(t,e,i){var r=i(42)("keys"),o=i(17);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){"use strict";var r=i(2),o=i(8),n=i(58),s="".endsWith;r(r.P+r.F*i(60)("endsWith"),"String",{endsWith:function(t){var e=n(this,t,"endsWith"),i=arguments.length>1?arguments[1]:void 0,r=o(e.length),a=void 0===i?r:Math.min(o(i),r),l=String(t);return s?s.call(e,l,a):e.slice(a-l.length,a)===l}})},function(t,e,i){var r=i(59),o=i(25);t.exports=function(t,e,i){if(r(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(o(t))}},function(t,e,i){var r=i(5),o=i(22),n=i(1)("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[n])?!!e:"RegExp"==o(t))}},function(t,e,i){var r=i(1)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[r]=!1,!"/./"[t](e)}catch(t){}}return!0}},function(t,e,i){"use strict";var r=i(74)(!0);t.exports=function(t,e,i){return e+(i?r(t,e).length:1)}},function(t,e,i){"use strict";var r=i(34),o=RegExp.prototype.exec;t.exports=function(t,e){var i=t.exec;if("function"==typeof i){var n=i.call(t,e);if("object"!=typeof n)throw new TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==r(t))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(t,e)}},function(t,e,i){"use strict";i(105);var r=i(9),o=i(10),n=i(3),s=i(25),a=i(1),l=i(64),h=a("species"),d=!n((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),c=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2===i.length&&"a"===i[0]&&"b"===i[1]}();t.exports=function(t,e,i){var u=a(t),p=!n((function(){var e={};return e[u]=function(){return 7},7!=""[t](e)})),f=p?!n((function(){var e=!1,i=/a/;return i.exec=function(){return e=!0,null},"split"===t&&(i.constructor={},i.constructor[h]=function(){return i}),i[u](""),!e})):void 0;if(!p||!f||"replace"===t&&!d||"split"===t&&!c){var g=/./[u],_=i(s,u,""[t],(function(t,e,i,r,o){return e.exec===l?p&&!o?{done:!0,value:g.call(e,i,r)}:{done:!0,value:t.call(i,e,r)}:{done:!1}})),m=_[0],y=_[1];r(String.prototype,t,m),o(RegExp.prototype,u,2==e?function(t,e){return y.call(t,this,e)}:function(t){return y.call(t,this)})}}},function(t,e,i){"use strict";var r,o,n=i(44),s=RegExp.prototype.exec,a=String.prototype.replace,l=s,h=(r=/a/,o=/b*/g,s.call(r,"a"),s.call(o,"a"),0!==r.lastIndex||0!==o.lastIndex),d=void 0!==/()??/.exec("")[1];(h||d)&&(l=function(t){var e,i,r,o,l=this;return d&&(i=new RegExp("^"+l.source+"$(?!\\s)",n.call(l))),h&&(e=l.lastIndex),r=s.call(l,t),h&&r&&(l.lastIndex=l.global?r.index+r[0].length:e),d&&r&&r.length>1&&a.call(r[0],i,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)})),r}),t.exports=l},function(t,e,i){var r=i(5),o=i(75).set;t.exports=function(t,e,i){var n,s=e.constructor;return s!==i&&"function"==typeof s&&(n=s.prototype)!==i.prototype&&r(n)&&o&&o(t,n),t}},function(t,e,i){var r=i(6),o=i(19),n=i(1)("species");t.exports=function(t,e){var i,s=r(t).constructor;return void 0===s||null==(i=r(s)[n])?e:o(i)}},function(t,e,i){var r=i(15),o=i(111),n=i(78),s=i(6),a=i(8),l=i(79),h={},d={};(e=t.exports=function(t,e,i,c,u){var p,f,g,_,m=u?function(){return t}:l(t),y=r(i,c,e?2:1),T=0;if("function"!=typeof m)throw TypeError(t+" is not iterable!");if(n(m)){for(p=a(t.length);p>T;T++)if((_=e?y(s(f=t[T])[0],f[1]):y(t[T]))===h||_===d)return _}else for(g=m.call(t);!(f=g.next()).done;)if((_=o(g,y,f.value,e))===h||_===d)return _}).BREAK=h,e.RETURN=d},function(t,e,i){var r=i(1)("iterator"),o=!1;try{var n=[7][r]();n.return=function(){o=!0},Array.from(n,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!o)return!1;var i=!1;try{var n=[7],s=n[r]();s.next=function(){return{done:i=!0}},n[r]=function(){return s},t(n)}catch(t){}return i}},function(t,e,i){"use strict";var r=i(11),o=i(43),n=i(8);t.exports=function(t){for(var e=r(this),i=n(e.length),s=arguments.length,a=o(s>1?arguments[1]:void 0,i),l=s>2?arguments[2]:void 0,h=void 0===l?i:o(l,i);h>a;)e[a++]=t;return e}},function(t,e,i){"use strict";var r=i(18),o=i(2),n=i(9),s=i(10),a=i(28),l=i(121),h=i(29),d=i(88),c=i(1)("iterator"),u=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,i,f,g,_,m){l(i,e,f);var y,T,v,E=function(t){if(!u&&t in D)return D[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},S=e+" Iterator",b="values"==g,O=!1,D=t.prototype,A=D[c]||D["@@iterator"]||g&&D[g],I=A||E(g),x=g?b?E("entries"):I:void 0,w="Array"==e&&D.entries||A;if(w&&(v=d(w.call(new t)))!==Object.prototype&&v.next&&(h(v,S,!0),r||"function"==typeof v[c]||s(v,c,p)),b&&A&&"values"!==A.name&&(O=!0,I=function(){return A.call(this)}),r&&!m||!u&&!O&&D[c]||s(D,c,I),a[e]=I,a[S]=p,g)if(y={values:b?I:E("values"),keys:_?I:E("keys"),entries:x},m)for(T in y)T in D||n(D,T,y[T]);else o(o.P+o.F*(u||O),e,y);return y}},function(t,e,i){var r=i(17)("meta"),o=i(5),n=i(12),s=i(7).f,a=0,l=Object.isExtensible||function(){return!0},h=!i(3)((function(){return l(Object.preventExtensions({}))})),d=function(t){s(t,r,{value:{i:"O"+ ++a,w:{}}})},c=t.exports={KEY:r,NEED:!1,fastKey:function(t,e){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!n(t,r)){if(!l(t))return"F";if(!e)return"E";d(t)}return t[r].i},getWeak:function(t,e){if(!n(t,r)){if(!l(t))return!0;if(!e)return!1;d(t)}return t[r].w},onFreeze:function(t){return h&&c.NEED&&l(t)&&!n(t,r)&&d(t),t}}},function(t,e,i){t.exports=!i(4)&&!i(3)((function(){return 7!=Object.defineProperty(i(51)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,i){var r=i(12),o=i(21),n=i(53)(!1),s=i(54)("IE_PROTO");t.exports=function(t,e){var i,a=o(t),l=0,h=[];for(i in a)i!=s&&r(a,i)&&h.push(i);for(;e.length>l;)r(a,i=e[l++])&&(~n(h,i)||h.push(i));return h}},function(t,e,i){var r=i(23),o=i(25);t.exports=function(t){return function(e,i){var n,s,a=String(o(e)),l=r(i),h=a.length;return l<0||l>=h?t?"":void 0:(n=a.charCodeAt(l))<55296||n>56319||l+1===h||(s=a.charCodeAt(l+1))<56320||s>57343?t?a.charAt(l):n:t?a.slice(l,l+2):s-56320+(n-55296<<10)+65536}}},function(t,e,i){var r=i(5),o=i(6),n=function(t,e){if(o(t),!r(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{(r=i(15)(Function.call,i(45).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return n(t,i),e?t.__proto__=i:r(t,i),t}}({},!1):void 0),check:n}},function(t,e,i){var r=i(0).document;t.exports=r&&r.documentElement},function(t,e,i){var r,o=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(t,e){if(!r[t]){r[t]={};for(var i=0;i<t.length;i++)r[t][t.charAt(i)]=i}return r[t][e]}var n={compressToBase64:function(t){if(null==t)return"";var i=n._compress(t,6,(function(t){return e.charAt(t)}));switch(i.length%4){default:case 0:return i;case 1:return i+"===";case 2:return i+"==";case 3:return i+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,(function(i){return o(e,t.charAt(i))}))},compressToUTF16:function(e){return null==e?"":n._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:n._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},compressToUint8Array:function(t){for(var e=n.compress(t),i=new Uint8Array(2*e.length),r=0,o=e.length;r<o;r++){var s=e.charCodeAt(r);i[2*r]=s>>>8,i[2*r+1]=s%256}return i},decompressFromUint8Array:function(e){if(null==e)return n.decompress(e);for(var i=new Array(e.length/2),r=0,o=i.length;r<o;r++)i[r]=256*e[2*r]+e[2*r+1];var s=[];return i.forEach((function(e){s.push(t(e))})),n.decompress(s.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":n._compress(t,6,(function(t){return i.charAt(t)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,(function(e){return o(i,t.charAt(e))})))},compress:function(e){return n._compress(e,16,(function(e){return t(e)}))},_compress:function(t,e,i){if(null==t)return"";var r,o,n,s={},a={},l="",h="",d="",c=2,u=3,p=2,f=[],g=0,_=0;for(n=0;n<t.length;n+=1)if(l=t.charAt(n),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=u++,a[l]=!0),h=d+l,Object.prototype.hasOwnProperty.call(s,h))d=h;else{if(Object.prototype.hasOwnProperty.call(a,d)){if(d.charCodeAt(0)<256){for(r=0;r<p;r++)g<<=1,_==e-1?(_=0,f.push(i(g)),g=0):_++;for(o=d.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o>>=1}else{for(o=1,r=0;r<p;r++)g=g<<1|o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o=0;for(o=d.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o>>=1}0==--c&&(c=Math.pow(2,p),p++),delete a[d]}else for(o=s[d],r=0;r<p;r++)g=g<<1|1&o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o>>=1;0==--c&&(c=Math.pow(2,p),p++),s[h]=u++,d=String(l)}if(""!==d){if(Object.prototype.hasOwnProperty.call(a,d)){if(d.charCodeAt(0)<256){for(r=0;r<p;r++)g<<=1,_==e-1?(_=0,f.push(i(g)),g=0):_++;for(o=d.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o>>=1}else{for(o=1,r=0;r<p;r++)g=g<<1|o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o=0;for(o=d.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o>>=1}0==--c&&(c=Math.pow(2,p),p++),delete a[d]}else for(o=s[d],r=0;r<p;r++)g=g<<1|1&o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o>>=1;0==--c&&(c=Math.pow(2,p),p++)}for(o=2,r=0;r<p;r++)g=g<<1|1&o,_==e-1?(_=0,f.push(i(g)),g=0):_++,o>>=1;for(;;){if(g<<=1,_==e-1){f.push(i(g));break}_++}return f.join("")},decompress:function(t){return null==t?"":""==t?null:n._decompress(t.length,32768,(function(e){return t.charCodeAt(e)}))},_decompress:function(e,i,r){var o,n,s,a,l,h,d,c=[],u=4,p=4,f=3,g="",_=[],m={val:r(0),position:i,index:1};for(o=0;o<3;o+=1)c[o]=o;for(s=0,l=Math.pow(2,2),h=1;h!=l;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=r(m.index++)),s|=(a>0?1:0)*h,h<<=1;switch(s){case 0:for(s=0,l=Math.pow(2,8),h=1;h!=l;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=r(m.index++)),s|=(a>0?1:0)*h,h<<=1;d=t(s);break;case 1:for(s=0,l=Math.pow(2,16),h=1;h!=l;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=r(m.index++)),s|=(a>0?1:0)*h,h<<=1;d=t(s);break;case 2:return""}for(c[3]=d,n=d,_.push(d);;){if(m.index>e)return"";for(s=0,l=Math.pow(2,f),h=1;h!=l;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=r(m.index++)),s|=(a>0?1:0)*h,h<<=1;switch(d=s){case 0:for(s=0,l=Math.pow(2,8),h=1;h!=l;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=r(m.index++)),s|=(a>0?1:0)*h,h<<=1;c[p++]=t(s),d=p-1,u--;break;case 1:for(s=0,l=Math.pow(2,16),h=1;h!=l;)a=m.val&m.position,m.position>>=1,0==m.position&&(m.position=i,m.val=r(m.index++)),s|=(a>0?1:0)*h,h<<=1;c[p++]=t(s),d=p-1,u--;break;case 2:return _.join("")}if(0==u&&(u=Math.pow(2,f),f++),c[d])g=c[d];else{if(d!==p)return null;g=n+n.charAt(0)}_.push(g),c[p++]=n+g.charAt(0),n=g,0==--u&&(u=Math.pow(2,f),f++)}}};return n}();void 0===(r=function(){return o}.call(e,i,e,t))||(t.exports=r)},function(t,e,i){var r=i(28),o=i(1)("iterator"),n=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||n[o]===t)}},function(t,e,i){var r=i(34),o=i(1)("iterator"),n=i(28);t.exports=i(16).getIteratorMethod=function(t){if(null!=t)return t[o]||t["@@iterator"]||n[r(t)]}},function(t,e,i){var r,o,n,s=i(15),a=i(81),l=i(76),h=i(51),d=i(0),c=d.process,u=d.setImmediate,p=d.clearImmediate,f=d.MessageChannel,g=d.Dispatch,_=0,m={},y=function(){var t=+this;if(m.hasOwnProperty(t)){var e=m[t];delete m[t],e()}},T=function(t){y.call(t.data)};u&&p||(u=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return m[++_]=function(){a("function"==typeof t?t:Function(t),e)},r(_),_},p=function(t){delete m[t]},"process"==i(22)(c)?r=function(t){c.nextTick(s(y,t,1))}:g&&g.now?r=function(t){g.now(s(y,t,1))}:f?(n=(o=new f).port2,o.port1.onmessage=T,r=s(n.postMessage,n,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(r=function(t){d.postMessage(t+"","*")},d.addEventListener("message",T,!1)):r="onreadystatechange"in h("script")?function(t){l.appendChild(h("script")).onreadystatechange=function(){l.removeChild(this),y.call(t)}}:function(t){setTimeout(s(y,t,1),0)}),t.exports={set:u,clear:p}},function(t,e){t.exports=function(t,e,i){var r=void 0===i;switch(e.length){case 0:return r?t():t.call(i);case 1:return r?t(e[0]):t.call(i,e[0]);case 2:return r?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){"use strict";var r=i(19);t.exports.f=function(t){return new function(t){var e,i;this.promise=new t((function(t,r){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=r})),this.resolve=r(e),this.reject=r(i)}(t)}},function(t,e,i){var r=i(11),o=i(20);i(116)("keys",(function(){return function(t){return o(r(t))}}))},function(t,e,i){var r=i(15),o=i(52),n=i(11),s=i(8),a=i(118);t.exports=function(t,e){var i=1==t,l=2==t,h=3==t,d=4==t,c=6==t,u=5==t||c,p=e||a;return function(e,a,f){for(var g,_,m=n(e),y=o(m),T=r(a,f,3),v=s(y.length),E=0,S=i?p(e,v):l?p(e,0):void 0;v>E;E++)if((u||E in y)&&(_=T(g=y[E],E,m),t))if(i)S[E]=_;else if(_)switch(t){case 3:return!0;case 5:return g;case 6:return E;case 2:S.push(g)}else if(d)return!1;return c?-1:h||d?d:S}}},function(t,e,i){var r=i(22);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,e,i){for(var r=i(48),o=i(20),n=i(9),s=i(0),a=i(10),l=i(28),h=i(1),d=h("iterator"),c=h("toStringTag"),u=l.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=o(p),g=0;g<f.length;g++){var _,m=f[g],y=p[m],T=s[m],v=T&&T.prototype;if(v&&(v[d]||a(v,d,u),v[c]||a(v,c,m),l[m]=u,y))for(_ in r)v[_]||n(v,_,r[_],!0)}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){var r=i(12),o=i(11),n=i(54)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,n)?t[n]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e,i){"use strict";var r=i(74)(!0);i(70)(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=r(e,i),this._i+=t.length,{value:t,done:!1})}))},function(t,e,i){"use strict";var r=i(122),o=i(91);t.exports=i(123)("Map",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var e=r.getEntry(o(this,"Map"),t);return e&&e.v},set:function(t,e){return r.def(o(this,"Map"),0===t?0:t,e)}},r,!0)},function(t,e,i){var r=i(5);t.exports=function(t,e){if(!r(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,i){var r=i(0),o=i(16),n=i(18),s=i(93),a=i(7).f;t.exports=function(t){var e=o.Symbol||(o.Symbol=n?{}:r.Symbol||{});"_"==t.charAt(0)||t in e||a(e,t,{value:s.f(t)})}},function(t,e,i){e.f=i(1)},function(t,e,i){var r=i(7).f,o=Function.prototype,n=/^\s*function ([^ (]*)/;"name"in o||i(4)&&r(o,"name",{configurable:!0,get:function(){try{return(""+this).match(n)[1]}catch(t){return""}}})},function(t,e,i){"use strict";var r=i(2),o=i(19),n=i(11),s=i(3),a=[].sort,l=[1,2,3];r(r.P+r.F*(s((function(){l.sort(void 0)}))||!s((function(){l.sort(null)}))||!i(126)(a)),"Array",{sort:function(t){return void 0===t?a.call(n(this)):a.call(n(this),o(t))}})},function(t,e,i){var r=i(2),o=i(27),n=i(19),s=i(6),a=i(5),l=i(3),h=i(131),d=(i(0).Reflect||{}).construct,c=l((function(){function t(){}return!(d((function(){}),[],t)instanceof t)})),u=!l((function(){d((function(){}))}));r(r.S+r.F*(c||u),"Reflect",{construct:function(t,e){n(t),s(e);var i=arguments.length<3?t:n(arguments[2]);if(u&&!c)return d(t,e,i);if(t==i){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var r=[null];return r.push.apply(r,e),new(h.apply(t,r))}var l=i.prototype,p=o(a(l)?l:Object.prototype),f=Function.apply.call(t,p,e);return a(f)?f:p}})},function(t,e,i){var r=i(2);r(r.S,"Object",{setPrototypeOf:i(75).set})},function(t,e,i){for(var r,o=i(0),n=i(10),s=i(17),a=s("typed_array"),l=s("view"),h=!(!o.ArrayBuffer||!o.DataView),d=h,c=0,u="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");c<9;)(r=o[u[c++]])?(n(r.prototype,a,!0),n(r.prototype,l,!0)):d=!1;t.exports={ABV:h,CONSTR:d,TYPED:a,VIEW:l}},function(t,e,i){var r=i(23),o=i(8);t.exports=function(t){if(void 0===t)return 0;var e=r(t),i=o(e);if(e!==i)throw RangeError("Wrong length!");return i}},function(t,e){t.exports=r;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function r(t,e,i){this.low=0|t,this.high=0|e,this.unsigned=!!i}function o(t){return!0===(t&&t.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=o;var n={},s={};function a(t,e){var i,r,o;return e?(o=0<=(t>>>=0)&&t<256)&&(r=s[t])?r:(i=h(t,(0|t)<0?-1:0,!0),o&&(s[t]=i),i):(o=-128<=(t|=0)&&t<128)&&(r=n[t])?r:(i=h(t,t<0?-1:0,!1),o&&(n[t]=i),i)}function l(t,e){if(isNaN(t))return e?y:m;if(e){if(t<0)return y;if(t>=f)return b}else{if(t<=-g)return O;if(t+1>=g)return S}return t<0?l(-t,e).neg():h(t%p|0,t/p|0,e)}function h(t,e,i){return new r(t,e,i)}r.fromInt=a,r.fromNumber=l,r.fromBits=h;var d=Math.pow;function c(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return m;if("number"==typeof e?(i=e,e=!1):e=!!e,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(t.substring(1),e,i).neg();for(var o=l(d(i,8)),n=m,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),h=parseInt(t.substring(s,s+a),i);if(a<8){var u=l(d(i,a));n=n.mul(u).add(l(h))}else n=(n=n.mul(o)).add(l(h))}return n.unsigned=e,n}function u(t,e){return"number"==typeof t?l(t,e):"string"==typeof t?c(t,e):h(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}r.fromString=c,r.fromValue=u;var p=4294967296,f=p*p,g=f/2,_=a(1<<24),m=a(0);r.ZERO=m;var y=a(0,!0);r.UZERO=y;var T=a(1);r.ONE=T;var v=a(1,!0);r.UONE=v;var E=a(-1);r.NEG_ONE=E;var S=h(-1,2147483647,!1);r.MAX_VALUE=S;var b=h(-1,-1,!0);r.MAX_UNSIGNED_VALUE=b;var O=h(0,-2147483648,!1);r.MIN_VALUE=O;var D=r.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},D.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(O)){var e=l(t),i=this.div(e),r=i.mul(e).sub(this);return i.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=l(d(t,6),this.unsigned),n=this,s="";;){var a=n.div(o),h=(n.sub(a.mul(o)).toInt()>>>0).toString(t);if((n=a).isZero())return h+s;for(;h.length<6;)h="0"+h;s=""+h+s}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},D.isZero=function(){return 0===this.high&&0===this.low},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&this.high<0},D.isPositive=function(){return this.unsigned||this.high>=0},D.isOdd=function(){return 1==(1&this.low)},D.isEven=function(){return 0==(1&this.low)},D.equals=function(t){return o(t)||(t=u(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},D.eq=D.equals,D.notEquals=function(t){return!this.eq(t)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(t){return this.comp(t)<0},D.lt=D.lessThan,D.lessThanOrEqual=function(t){return this.comp(t)<=0},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(t){return this.comp(t)>0},D.gt=D.greaterThan,D.greaterThanOrEqual=function(t){return this.comp(t)>=0},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(t){if(o(t)||(t=u(t)),this.eq(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(T)},D.neg=D.negate,D.add=function(t){o(t)||(t=u(t));var e=this.high>>>16,i=65535&this.high,r=this.low>>>16,n=65535&this.low,s=t.high>>>16,a=65535&t.high,l=t.low>>>16,d=0,c=0,p=0,f=0;return p+=(f+=n+(65535&t.low))>>>16,c+=(p+=r+l)>>>16,d+=(c+=i+a)>>>16,d+=e+s,h((p&=65535)<<16|(f&=65535),(d&=65535)<<16|(c&=65535),this.unsigned)},D.subtract=function(t){return o(t)||(t=u(t)),this.add(t.neg())},D.sub=D.subtract,D.multiply=function(t){if(this.isZero())return m;if(o(t)||(t=u(t)),i)return h(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return m;if(this.eq(O))return t.isOdd()?O:m;if(t.eq(O))return this.isOdd()?O:m;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(_)&&t.lt(_))return l(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,s=65535&this.low,a=t.high>>>16,d=65535&t.high,c=t.low>>>16,p=65535&t.low,f=0,g=0,y=0,T=0;return y+=(T+=s*p)>>>16,g+=(y+=n*p)>>>16,y&=65535,g+=(y+=s*c)>>>16,f+=(g+=r*p)>>>16,g&=65535,f+=(g+=n*c)>>>16,g&=65535,f+=(g+=s*d)>>>16,f+=e*p+r*c+n*d+s*a,h((y&=65535)<<16|(T&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},D.mul=D.multiply,D.divide=function(t){if(o(t)||(t=u(t)),t.isZero())throw Error("division by zero");var e,r,n;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?h((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return v;n=y}else{if(this.eq(O))return t.eq(T)||t.eq(E)?O:t.eq(O)?T:(e=this.shr(1).div(t).shl(1)).eq(m)?t.isNegative()?T:E:(r=this.sub(t.mul(e)),n=e.add(r.div(t)));if(t.eq(O))return this.unsigned?y:m;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=m}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),a=s<=48?1:d(2,s-48),c=l(e),p=c.mul(t);p.isNegative()||p.gt(r);)p=(c=l(e-=a,this.unsigned)).mul(t);c.isZero()&&(c=T),n=n.add(c),r=r.sub(p)}return n},D.div=D.divide,D.modulo=function(t){return o(t)||(t=u(t)),i?h((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return h(~this.low,~this.high,this.unsigned)},D.and=function(t){return o(t)||(t=u(t)),h(this.low&t.low,this.high&t.high,this.unsigned)},D.or=function(t){return o(t)||(t=u(t)),h(this.low|t.low,this.high|t.high,this.unsigned)},D.xor=function(t){return o(t)||(t=u(t)),h(this.low^t.low,this.high^t.high,this.unsigned)},D.shiftLeft=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):h(0,this.low<<t-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):h(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(t){if(o(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?h(this.low>>>t|e<<32-t,e>>>t,this.unsigned):h(32===t?e:e>>>t-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},D.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},D.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},r.fromBytes=function(t,e,i){return i?r.fromBytesLE(t,e):r.fromBytesBE(t,e)},r.fromBytesLE=function(t,e){return new r(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},r.fromBytesBE=function(t,e){return new r(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},function(t,e,i){!function(){function e(t){return Math.sqrt(t.x*t.x+t.y*t.y)}var i=function(t){this.handlers=[],this.el=t};function r(t,e){var r=new i(t);return r.add(e),r}i.prototype.add=function(t){this.handlers.push(t)},i.prototype.del=function(t){t||(this.handlers=[]);for(var e=this.handlers.length;e>=0;e--)this.handlers[e]===t&&this.handlers.splice(e,1)},i.prototype.dispatch=function(){for(var t=0,e=this.handlers.length;t<e;t++){var i=this.handlers[t];"function"==typeof i&&i.apply(this.el,arguments)}};var o=function(t,e){this.element="string"==typeof t?document.querySelector(t):t,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1),this.preV={x:null,y:null},this.pinchStartLen=null,this.zoom=1,this.isDoubleTap=!1;var i=function(){};this.rotate=r(this.element,e.rotate||i),this.touchStart=r(this.element,e.touchStart||i),this.multipointStart=r(this.element,e.multipointStart||i),this.multipointEnd=r(this.element,e.multipointEnd||i),this.pinch=r(this.element,e.pinch||i),this.swipe=r(this.element,e.swipe||i),this.tap=r(this.element,e.tap||i),this.doubleTap=r(this.element,e.doubleTap||i),this.longTap=r(this.element,e.longTap||i),this.singleTap=r(this.element,e.singleTap||i),this.pressMove=r(this.element,e.pressMove||i),this.twoFingerPressMove=r(this.element,e.twoFingerPressMove||i),this.touchMove=r(this.element,e.touchMove||i),this.touchEnd=r(this.element,e.touchEnd||i),this.touchCancel=r(this.element,e.touchCancel||i),this._cancelAllHandler=this.cancelAll.bind(this),window.addEventListener("scroll",this._cancelAllHandler),this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null}};o.prototype={start:function(t){if(t.touches){this.now=Date.now(),this.x1=t.touches[0].pageX,this.y1=t.touches[0].pageY,this.delta=this.now-(this.last||this.now),this.touchStart.dispatch(t,this.element),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30,this.isDoubleTap&&clearTimeout(this.singleTapTimeout)),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;var i=this.preV;if(t.touches.length>1){this._cancelLongTap(),this._cancelSingleTap();var r={x:t.touches[1].pageX-this.x1,y:t.touches[1].pageY-this.y1};i.x=r.x,i.y=r.y,this.pinchStartLen=e(i),this.multipointStart.dispatch(t,this.element)}this._preventTap=!1,this.longTapTimeout=setTimeout(function(){this.longTap.dispatch(t,this.element),this._preventTap=!0}.bind(this),750)}},move:function(t){if(t.touches){var i=this.preV,r=t.touches.length,o=t.touches[0].pageX,n=t.touches[0].pageY;if(this.isDoubleTap=!1,r>1){var s=t.touches[1].pageX,a=t.touches[1].pageY,l={x:t.touches[1].pageX-o,y:t.touches[1].pageY-n};null!==i.x&&(this.pinchStartLen>0&&(t.zoom=e(l)/this.pinchStartLen,this.pinch.dispatch(t,this.element)),t.angle=function(t,i){var r=function(t,i){var r=e(t)*e(i);if(0===r)return 0;var o=function(t,e){return t.x*e.x+t.y*e.y}(t,i)/r;return o>1&&(o=1),Math.acos(o)}(t,i);return function(t,e){return t.x*e.y-e.x*t.y}(t,i)>0&&(r*=-1),180*r/Math.PI}(l,i),this.rotate.dispatch(t,this.element)),i.x=l.x,i.y=l.y,null!==this.x2&&null!==this.sx2?(t.deltaX=(o-this.x2+s-this.sx2)/2,t.deltaY=(n-this.y2+a-this.sy2)/2):(t.deltaX=0,t.deltaY=0),this.twoFingerPressMove.dispatch(t,this.element),this.sx2=s,this.sy2=a}else{if(null!==this.x2){t.deltaX=o-this.x2,t.deltaY=n-this.y2;var h=Math.abs(this.x1-this.x2),d=Math.abs(this.y1-this.y2);(h>10||d>10)&&(this._preventTap=!0)}else t.deltaX=0,t.deltaY=0;this.pressMove.dispatch(t,this.element)}this.touchMove.dispatch(t,this.element),this._cancelLongTap(),this.x2=o,this.y2=n,r>1&&t.preventDefault()}},end:function(t){if(t.changedTouches){this._cancelLongTap();var e=this;t.touches.length<2&&(this.multipointEnd.dispatch(t,this.element),this.sx2=this.sy2=null),this.x2&&Math.abs(this.x1-this.x2)>30||this.y2&&Math.abs(this.y1-this.y2)>30?(t.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout((function(){e.swipe.dispatch(t,e.element)}),0)):(this.tapTimeout=setTimeout((function(){e._preventTap||e.tap.dispatch(t,e.element),e.isDoubleTap&&(e.doubleTap.dispatch(t,e.element),e.isDoubleTap=!1)}),0),e.isDoubleTap||(e.singleTapTimeout=setTimeout((function(){e.singleTap.dispatch(t,e.element)}),250))),this.touchEnd.dispatch(t,this.element),this.preV.x=0,this.preV.y=0,this.zoom=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=null}},cancelAll:function(){this._preventTap=!0,clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout)},cancel:function(t){this.cancelAll(),this.touchCancel.dispatch(t,this.element)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_cancelSingleTap:function(){clearTimeout(this.singleTapTimeout)},_swipeDirection:function(t,e,i,r){return Math.abs(t-e)>=Math.abs(i-r)?t-e>0?"Left":"Right":i-r>0?"Up":"Down"},on:function(t,e){this[t]&&this[t].add(e)},off:function(t,e){this[t]&&this[t].del(e)},destroy:function(){return this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel),this.rotate.del(),this.touchStart.del(),this.multipointStart.del(),this.multipointEnd.del(),this.pinch.del(),this.swipe.del(),this.tap.del(),this.doubleTap.del(),this.longTap.del(),this.singleTap.del(),this.pressMove.del(),this.twoFingerPressMove.del(),this.touchMove.del(),this.touchEnd.del(),this.touchCancel.del(),this.preV=this.pinchStartLen=this.zoom=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=this.rotate=this.touchStart=this.multipointStart=this.multipointEnd=this.pinch=this.swipe=this.tap=this.doubleTap=this.longTap=this.singleTap=this.pressMove=this.touchMove=this.touchEnd=this.touchCancel=this.twoFingerPressMove=null,window.removeEventListener("scroll",this._cancelAllHandler),null}},t.exports=o}()},function(t,e,i){t.exports=i(42)("native-function-to-string",Function.toString)},function(t,e,i){"use strict";var r=i(4),o=i(20),n=i(56),s=i(32),a=i(11),l=i(52),h=Object.assign;t.exports=!h||i(3)((function(){var t={},e={},i=Symbol(),r="abcdefghijklmnopqrst";return t[i]=7,r.split("").forEach((function(t){e[t]=t})),7!=h({},t)[i]||Object.keys(h({},e)).join("")!=r}))?function(t,e){for(var i=a(t),h=arguments.length,d=1,c=n.f,u=s.f;h>d;)for(var p,f=l(arguments[d++]),g=c?o(f).concat(c(f)):o(f),_=g.length,m=0;_>m;)p=g[m++],r&&!u.call(f,p)||(i[p]=f[p]);return i}:h},function(t,e){[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild&&this.parentNode.removeChild(this)}})})),window.scrollTo||(window.scrollTo=function(t,e){window.pageXOffset=t,window.pageYOffset=e}),window.scrollBy||(window.scrollBy=function(t,e){window.pageXOffset+=t,window.pageYOffset+=e}),Element.prototype.scrollTo||(Element.prototype.scrollTo=function(t,e){this.scrollLeft=t,this.scrollTop=e}),Element.prototype.scrollBy||(Element.prototype.scrollBy=function(t,e){this.scrollLeft+=t,this.scrollTop+=e})},function(t,e,i){"use strict";var r=i(64);i(2)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(t,e,i){var r=i(2),o=i(25),n=i(3),s=i(107),a="["+s+"]",l=RegExp("^"+a+a+"*"),h=RegExp(a+a+"*$"),d=function(t,e,i){var o={},a=n((function(){return!!s[t]()||"​"!="​"[t]()})),l=o[t]=a?e(c):s[t];i&&(o[i]=l),r(r.P+r.F*a,"String",o)},c=d.trim=function(t,e){return t=String(o(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(h,"")),t};t.exports=d},function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,e,i){var r=i(7),o=i(6),n=i(20);t.exports=i(4)?Object.defineProperties:function(t,e){o(t);for(var i,s=n(e),a=s.length,l=0;a>l;)r.f(t,i=s[l++],e[i]);return t}},function(t,e,i){"use strict";var r=i(2),o=i(8),n=i(58),s="".startsWith;r(r.P+r.F*i(60)("startsWith"),"String",{startsWith:function(t){var e=n(this,t,"startsWith"),i=o(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return s?s.call(e,r,i):e.slice(i,i+r.length)===r}})},function(t,e,i){i(4)&&"g"!=/./g.flags&&i(7).f(RegExp.prototype,"flags",{configurable:!0,get:i(44)})},function(t,e,i){var r=i(6);t.exports=function(t,e,i,o){try{return o?e(r(i)[0],i[1]):e(i)}catch(e){var n=t.return;throw void 0!==n&&r(n.call(t)),e}}},function(t,e,i){var r=i(0),o=i(80).set,n=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,l="process"==i(22)(s);t.exports=function(){var t,e,i,h=function(){var r,o;for(l&&(r=s.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?i():e=void 0,r}}e=void 0,r&&r.enter()};if(l)i=function(){s.nextTick(h)};else if(!n||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var d=a.resolve(void 0);i=function(){d.then(h)}}else i=function(){o.call(r,h)};else{var c=!0,u=document.createTextNode("");new n(h).observe(u,{characterData:!0}),i=function(){u.data=c=!c}}return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,i()),e=o}}},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,i){var r=i(0).navigator;t.exports=r&&r.userAgent||""},function(t,e,i){var r=i(6),o=i(5),n=i(82);t.exports=function(t,e){if(r(t),o(e)&&e.constructor===t)return e;var i=n.f(t);return(0,i.resolve)(e),i.promise}},function(t,e,i){var r=i(2),o=i(16),n=i(3);t.exports=function(t,e){var i=(o.Object||{})[t]||Object[t],s={};s[t]=e(i),r(r.S+r.F*n((function(){i(1)})),"Object",s)}},function(t,e,i){"use strict";var r=i(2),o=i(84)(5),n=!0;"find"in[]&&Array(1).find((function(){n=!1})),r(r.P+r.F*n,"Array",{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),i(47)("find")},function(t,e,i){var r=i(119);t.exports=function(t,e){return new(r(t))(e)}},function(t,e,i){var r=i(5),o=i(85),n=i(1)("species");t.exports=function(t){var e;return o(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!o(e.prototype)||(e=void 0),r(e)&&null===(e=e[n])&&(e=void 0)),void 0===e?Array:e}},function(t,e,i){var r=i(2);r(r.P,"Array",{fill:i(69)}),i(47)("fill")},function(t,e,i){"use strict";var r=i(27),o=i(31),n=i(29),s={};i(10)(s,i(1)("iterator"),(function(){return this})),t.exports=function(t,e,i){t.prototype=r(s,{next:o(1,i)}),n(t,e+" Iterator")}},function(t,e,i){"use strict";var r=i(7).f,o=i(27),n=i(41),s=i(15),a=i(40),l=i(67),h=i(70),d=i(87),c=i(46),u=i(4),p=i(71).fastKey,f=i(91),g=u?"_s":"size",_=function(t,e){var i,r=p(e);if("F"!==r)return t._i[r];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,h){var d=t((function(t,r){a(t,d,e,"_i"),t._t=e,t._i=o(null),t._f=void 0,t._l=void 0,t[g]=0,null!=r&&l(r,i,t[h],t)}));return n(d.prototype,{clear:function(){for(var t=f(this,e),i=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete i[r.i];t._f=t._l=void 0,t[g]=0},delete:function(t){var i=f(this,e),r=_(i,t);if(r){var o=r.n,n=r.p;delete i._i[r.i],r.r=!0,n&&(n.n=o),o&&(o.p=n),i._f==r&&(i._f=o),i._l==r&&(i._l=n),i[g]--}return!!r},forEach:function(t){f(this,e);for(var i,r=s(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(r(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!_(f(this,e),t)}}),u&&r(d.prototype,"size",{get:function(){return f(this,e)[g]}}),d},def:function(t,e,i){var r,o,n=_(t,e);return n?n.v=i:(t._l=n={i:o=p(e,!0),k:e,v:i,p:r=t._l,n:void 0,r:!1},t._f||(t._f=n),r&&(r.n=n),t[g]++,"F"!==o&&(t._i[o]=n)),t},getEntry:_,setStrong:function(t,e,i){h(t,e,(function(t,i){this._t=f(t,e),this._k=i,this._l=void 0}),(function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?d(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,d(1))}),i?"entries":"values",!i,!0),c(e)}}},function(t,e,i){"use strict";var r=i(0),o=i(2),n=i(9),s=i(41),a=i(71),l=i(67),h=i(40),d=i(5),c=i(3),u=i(68),p=i(29),f=i(65);t.exports=function(t,e,i,g,_,m){var y=r[t],T=y,v=_?"set":"add",E=T&&T.prototype,S={},b=function(t){var e=E[t];n(E,t,"delete"==t||"has"==t?function(t){return!(m&&!d(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return m&&!d(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,i){return e.call(this,0===t?0:t,i),this})};if("function"==typeof T&&(m||E.forEach&&!c((function(){(new T).entries().next()})))){var O=new T,D=O[v](m?{}:-0,1)!=O,A=c((function(){O.has(1)})),I=u((function(t){new T(t)})),x=!m&&c((function(){for(var t=new T,e=5;e--;)t[v](e,e);return!t.has(-0)}));I||((T=e((function(e,i){h(e,T,t);var r=f(new y,e,T);return null!=i&&l(i,_,r[v],r),r}))).prototype=E,E.constructor=T),(A||x)&&(b("delete"),b("has"),_&&b("get")),(x||D)&&b(v),m&&E.clear&&delete E.clear}else T=g.getConstructor(e,t,_,v),s(T.prototype,i),a.NEED=!0;return p(T,t),S[t]=T,o(o.G+o.W+o.F*(T!=y),S),m||g.setStrong(T,t,_),T}},function(t,e,i){var r=i(20),o=i(56),n=i(32);t.exports=function(t){var e=r(t),i=o.f;if(i)for(var s,a=i(t),l=n.f,h=0;a.length>h;)l.call(t,s=a[h++])&&e.push(s);return e}},function(t,e,i){var r=i(21),o=i(26).f,n={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return s&&"[object Window]"==n.call(t)?function(t){try{return o(t)}catch(t){return s.slice()}}(t):o(r(t))}},function(t,e,i){"use strict";var r=i(3);t.exports=function(t,e){return!!t&&r((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},function(t,e,i){"use strict";var r=i(2),o=i(53)(!0);r(r.P,"Array",{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),i(47)("includes")},function(t,e,i){"use strict";var r=i(2),o=i(58);r(r.P+r.F*i(60)("includes"),"String",{includes:function(t){return!!~o(this,t,"includes").indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){var r=i(2),o=i(130)(!1);r(r.S,"Object",{values:function(t){return o(t)}})},function(t,e,i){var r=i(4),o=i(20),n=i(21),s=i(32).f;t.exports=function(t){return function(e){for(var i,a=n(e),l=o(a),h=l.length,d=0,c=[];h>d;)i=l[d++],r&&!s.call(a,i)||c.push(t?[i,a[i]]:a[i]);return c}}},function(t,e,i){"use strict";var r=i(19),o=i(5),n=i(81),s=[].slice,a={};t.exports=Function.bind||function(t){var e=r(this),i=s.call(arguments,1),l=function(){var r=i.concat(s.call(arguments));return this instanceof l?function(t,e,i){if(!(e in a)){for(var r=[],o=0;o<e;o++)r[o]="a["+o+"]";a[e]=Function("F,a","return new F("+r.join(",")+")")}return a[e](t,i)}(e,r.length,r):n(e,r,t)};return o(e.prototype)&&(l.prototype=e.prototype),l}},function(t,e,i){i(133)("Uint8",1,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},function(t,e,i){"use strict";if(i(4)){var r=i(18),o=i(0),n=i(3),s=i(2),a=i(98),l=i(134),h=i(15),d=i(40),c=i(31),u=i(10),p=i(41),f=i(23),g=i(8),_=i(99),m=i(43),y=i(30),T=i(12),v=i(34),E=i(5),S=i(11),b=i(78),O=i(27),D=i(88),A=i(26).f,I=i(79),x=i(17),w=i(1),R=i(84),C=i(53),B=i(66),L=i(48),P=i(28),N=i(68),M=i(46),k=i(69),q=i(135),U=i(7),F=i(45),H=U.f,G=F.f,W=o.RangeError,V=o.TypeError,Y=o.Uint8Array,X=Array.prototype,z=l.ArrayBuffer,j=l.DataView,J=R(0),K=R(2),Z=R(3),Q=R(4),$=R(5),tt=R(6),et=C(!0),it=C(!1),rt=L.values,ot=L.keys,nt=L.entries,st=X.lastIndexOf,at=X.reduce,lt=X.reduceRight,ht=X.join,dt=X.sort,ct=X.slice,ut=X.toString,pt=X.toLocaleString,ft=w("iterator"),gt=w("toStringTag"),_t=x("typed_constructor"),mt=x("def_constructor"),yt=a.CONSTR,Tt=a.TYPED,vt=a.VIEW,Et=R(1,(function(t,e){return At(B(t,t[mt]),e)})),St=n((function(){return 1===new Y(new Uint16Array([1]).buffer)[0]})),bt=!!Y&&!!Y.prototype.set&&n((function(){new Y(1).set({})})),Ot=function(t,e){var i=f(t);if(i<0||i%e)throw W("Wrong offset!");return i},Dt=function(t){if(E(t)&&Tt in t)return t;throw V(t+" is not a typed array!")},At=function(t,e){if(!E(t)||!(_t in t))throw V("It is not a typed array constructor!");return new t(e)},It=function(t,e){return xt(B(t,t[mt]),e)},xt=function(t,e){for(var i=0,r=e.length,o=At(t,r);r>i;)o[i]=e[i++];return o},wt=function(t,e,i){H(t,e,{get:function(){return this._d[i]}})},Rt=function(t){var e,i,r,o,n,s,a=S(t),l=arguments.length,d=l>1?arguments[1]:void 0,c=void 0!==d,u=I(a);if(null!=u&&!b(u)){for(s=u.call(a),r=[],e=0;!(n=s.next()).done;e++)r.push(n.value);a=r}for(c&&l>2&&(d=h(d,arguments[2],2)),e=0,i=g(a.length),o=At(this,i);i>e;e++)o[e]=c?d(a[e],e):a[e];return o},Ct=function(){for(var t=0,e=arguments.length,i=At(this,e);e>t;)i[t]=arguments[t++];return i},Bt=!!Y&&n((function(){pt.call(new Y(1))})),Lt=function(){return pt.apply(Bt?ct.call(Dt(this)):Dt(this),arguments)},Pt={copyWithin:function(t,e){return q.call(Dt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return Q(Dt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return k.apply(Dt(this),arguments)},filter:function(t){return It(this,K(Dt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return $(Dt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(Dt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){J(Dt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return it(Dt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return et(Dt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ht.apply(Dt(this),arguments)},lastIndexOf:function(t){return st.apply(Dt(this),arguments)},map:function(t){return Et(Dt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return at.apply(Dt(this),arguments)},reduceRight:function(t){return lt.apply(Dt(this),arguments)},reverse:function(){for(var t,e=Dt(this).length,i=Math.floor(e/2),r=0;r<i;)t=this[r],this[r++]=this[--e],this[e]=t;return this},some:function(t){return Z(Dt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return dt.call(Dt(this),t)},subarray:function(t,e){var i=Dt(this),r=i.length,o=m(t,r);return new(B(i,i[mt]))(i.buffer,i.byteOffset+o*i.BYTES_PER_ELEMENT,g((void 0===e?r:m(e,r))-o))}},Nt=function(t,e){return It(this,ct.call(Dt(this),t,e))},Mt=function(t){Dt(this);var e=Ot(arguments[1],1),i=this.length,r=S(t),o=g(r.length),n=0;if(o+e>i)throw W("Wrong length!");for(;n<o;)this[e+n]=r[n++]},kt={entries:function(){return nt.call(Dt(this))},keys:function(){return ot.call(Dt(this))},values:function(){return rt.call(Dt(this))}},qt=function(t,e){return E(t)&&t[Tt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Ut=function(t,e){return qt(t,e=y(e,!0))?c(2,t[e]):G(t,e)},Ft=function(t,e,i){return!(qt(t,e=y(e,!0))&&E(i)&&T(i,"value"))||T(i,"get")||T(i,"set")||i.configurable||T(i,"writable")&&!i.writable||T(i,"enumerable")&&!i.enumerable?H(t,e,i):(t[e]=i.value,t)};yt||(F.f=Ut,U.f=Ft),s(s.S+s.F*!yt,"Object",{getOwnPropertyDescriptor:Ut,defineProperty:Ft}),n((function(){ut.call({})}))&&(ut=pt=function(){return ht.call(this)});var Ht=p({},Pt);p(Ht,kt),u(Ht,ft,kt.values),p(Ht,{slice:Nt,set:Mt,constructor:function(){},toString:ut,toLocaleString:Lt}),wt(Ht,"buffer","b"),wt(Ht,"byteOffset","o"),wt(Ht,"byteLength","l"),wt(Ht,"length","e"),H(Ht,gt,{get:function(){return this[Tt]}}),t.exports=function(t,e,i,l){var h=t+((l=!!l)?"Clamped":"")+"Array",c="get"+t,p="set"+t,f=o[h],m=f||{},y=f&&D(f),T=!f||!a.ABV,S={},b=f&&f.prototype,I=function(t,i){H(t,i,{get:function(){return function(t,i){var r=t._d;return r.v[c](i*e+r.o,St)}(this,i)},set:function(t){return function(t,i,r){var o=t._d;l&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),o.v[p](i*e+o.o,r,St)}(this,i,t)},enumerable:!0})};T?(f=i((function(t,i,r,o){d(t,f,h,"_d");var n,s,a,l,c=0,p=0;if(E(i)){if(!(i instanceof z||"ArrayBuffer"==(l=v(i))||"SharedArrayBuffer"==l))return Tt in i?xt(f,i):Rt.call(f,i);n=i,p=Ot(r,e);var m=i.byteLength;if(void 0===o){if(m%e)throw W("Wrong length!");if((s=m-p)<0)throw W("Wrong length!")}else if((s=g(o)*e)+p>m)throw W("Wrong length!");a=s/e}else a=_(i),n=new z(s=a*e);for(u(t,"_d",{b:n,o:p,l:s,e:a,v:new j(n)});c<a;)I(t,c++)})),b=f.prototype=O(Ht),u(b,"constructor",f)):n((function(){f(1)}))&&n((function(){new f(-1)}))&&N((function(t){new f,new f(null),new f(1.5),new f(t)}),!0)||(f=i((function(t,i,r,o){var n;return d(t,f,h),E(i)?i instanceof z||"ArrayBuffer"==(n=v(i))||"SharedArrayBuffer"==n?void 0!==o?new m(i,Ot(r,e),o):void 0!==r?new m(i,Ot(r,e)):new m(i):Tt in i?xt(f,i):Rt.call(f,i):new m(_(i))})),J(y!==Function.prototype?A(m).concat(A(y)):A(m),(function(t){t in f||u(f,t,m[t])})),f.prototype=b,r||(b.constructor=f));var x=b[ft],w=!!x&&("values"==x.name||null==x.name),R=kt.values;u(f,_t,!0),u(b,Tt,h),u(b,vt,!0),u(b,mt,f),(l?new f(1)[gt]==h:gt in b)||H(b,gt,{get:function(){return h}}),S[h]=f,s(s.G+s.W+s.F*(f!=m),S),s(s.S,h,{BYTES_PER_ELEMENT:e}),s(s.S+s.F*n((function(){m.of.call(f,1)})),h,{from:Rt,of:Ct}),"BYTES_PER_ELEMENT"in b||u(b,"BYTES_PER_ELEMENT",e),s(s.P,h,Pt),M(h),s(s.P+s.F*bt,h,{set:Mt}),s(s.P+s.F*!w,h,kt),r||b.toString==ut||(b.toString=ut),s(s.P+s.F*n((function(){new f(1).slice()})),h,{slice:Nt}),s(s.P+s.F*(n((function(){return[1,2].toLocaleString()!=new f([1,2]).toLocaleString()}))||!n((function(){b.toLocaleString.call([1,2])}))),h,{toLocaleString:Lt}),P[h]=w?x:R,r||w||u(b,ft,R)}}else t.exports=function(){}},function(t,e,i){"use strict";var r=i(0),o=i(4),n=i(18),s=i(98),a=i(10),l=i(41),h=i(3),d=i(40),c=i(23),u=i(8),p=i(99),f=i(26).f,g=i(7).f,_=i(69),m=i(29),y="prototype",T="Wrong index!",v=r.ArrayBuffer,E=r.DataView,S=r.Math,b=r.RangeError,O=r.Infinity,D=v,A=S.abs,I=S.pow,x=S.floor,w=S.log,R=S.LN2,C=o?"_b":"buffer",B=o?"_l":"byteLength",L=o?"_o":"byteOffset";function P(t,e,i){var r,o,n,s=new Array(i),a=8*i-e-1,l=(1<<a)-1,h=l>>1,d=23===e?I(2,-24)-I(2,-77):0,c=0,u=t<0||0===t&&1/t<0?1:0;for((t=A(t))!=t||t===O?(o=t!=t?1:0,r=l):(r=x(w(t)/R),t*(n=I(2,-r))<1&&(r--,n*=2),(t+=r+h>=1?d/n:d*I(2,1-h))*n>=2&&(r++,n/=2),r+h>=l?(o=0,r=l):r+h>=1?(o=(t*n-1)*I(2,e),r+=h):(o=t*I(2,h-1)*I(2,e),r=0));e>=8;s[c++]=255&o,o/=256,e-=8);for(r=r<<e|o,a+=e;a>0;s[c++]=255&r,r/=256,a-=8);return s[--c]|=128*u,s}function N(t,e,i){var r,o=8*i-e-1,n=(1<<o)-1,s=n>>1,a=o-7,l=i-1,h=t[l--],d=127&h;for(h>>=7;a>0;d=256*d+t[l],l--,a-=8);for(r=d&(1<<-a)-1,d>>=-a,a+=e;a>0;r=256*r+t[l],l--,a-=8);if(0===d)d=1-s;else{if(d===n)return r?NaN:h?-O:O;r+=I(2,e),d-=s}return(h?-1:1)*r*I(2,d-e)}function M(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function k(t){return[255&t]}function q(t){return[255&t,t>>8&255]}function U(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function F(t){return P(t,52,8)}function H(t){return P(t,23,4)}function G(t,e,i){g(t[y],e,{get:function(){return this[i]}})}function W(t,e,i,r){var o=p(+i);if(o+e>t[B])throw b(T);var n=t[C]._b,s=o+t[L],a=n.slice(s,s+e);return r?a:a.reverse()}function V(t,e,i,r,o,n){var s=p(+i);if(s+e>t[B])throw b(T);for(var a=t[C]._b,l=s+t[L],h=r(+o),d=0;d<e;d++)a[l+d]=h[n?d:e-d-1]}if(s.ABV){if(!h((function(){v(1)}))||!h((function(){new v(-1)}))||h((function(){return new v,new v(1.5),new v(NaN),"ArrayBuffer"!=v.name}))){for(var Y,X=(v=function(t){return d(this,v),new D(p(t))})[y]=D[y],z=f(D),j=0;z.length>j;)(Y=z[j++])in v||a(v,Y,D[Y]);n||(X.constructor=v)}var J=new E(new v(2)),K=E[y].setInt8;J.setInt8(0,2147483648),J.setInt8(1,2147483649),!J.getInt8(0)&&J.getInt8(1)||l(E[y],{setInt8:function(t,e){K.call(this,t,e<<24>>24)},setUint8:function(t,e){K.call(this,t,e<<24>>24)}},!0)}else v=function(t){d(this,v,"ArrayBuffer");var e=p(t);this._b=_.call(new Array(e),0),this[B]=e},E=function(t,e,i){d(this,E,"DataView"),d(t,v,"DataView");var r=t[B],o=c(e);if(o<0||o>r)throw b("Wrong offset!");if(o+(i=void 0===i?r-o:u(i))>r)throw b("Wrong length!");this[C]=t,this[L]=o,this[B]=i},o&&(G(v,"byteLength","_l"),G(E,"buffer","_b"),G(E,"byteLength","_l"),G(E,"byteOffset","_o")),l(E[y],{getInt8:function(t){return W(this,1,t)[0]<<24>>24},getUint8:function(t){return W(this,1,t)[0]},getInt16:function(t){var e=W(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=W(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return M(W(this,4,t,arguments[1]))},getUint32:function(t){return M(W(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return N(W(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return N(W(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){V(this,1,t,k,e)},setUint8:function(t,e){V(this,1,t,k,e)},setInt16:function(t,e){V(this,2,t,q,e,arguments[2])},setUint16:function(t,e){V(this,2,t,q,e,arguments[2])},setInt32:function(t,e){V(this,4,t,U,e,arguments[2])},setUint32:function(t,e){V(this,4,t,U,e,arguments[2])},setFloat32:function(t,e){V(this,4,t,H,e,arguments[2])},setFloat64:function(t,e){V(this,8,t,F,e,arguments[2])}});m(v,"ArrayBuffer"),m(E,"DataView"),a(E[y],s.VIEW,!0),e.ArrayBuffer=v,e.DataView=E},function(t,e,i){"use strict";var r=i(11),o=i(43),n=i(8);t.exports=[].copyWithin||function(t,e){var i=r(this),s=n(i.length),a=o(t,s),l=o(e,s),h=arguments.length>2?arguments[2]:void 0,d=Math.min((void 0===h?s:o(h,s))-l,s-a),c=1;for(l<a&&a<l+d&&(c=-1,l+=d-1,a+=d-1);d-- >0;)l in i?i[a]=i[l]:delete i[a],a+=c,l+=c;return i}},function(t,e,i){var r=i(0),o=i(65),n=i(7).f,s=i(26).f,a=i(59),l=i(44),h=r.RegExp,d=h,c=h.prototype,u=/a/g,p=/a/g,f=new h(u)!==u;if(i(4)&&(!f||i(3)((function(){return p[i(1)("match")]=!1,h(u)!=u||h(p)==p||"/a/i"!=h(u,"i")})))){h=function(t,e){var i=this instanceof h,r=a(t),n=void 0===e;return!i&&r&&t.constructor===h&&n?t:o(f?new d(r&&!n?t.source:t,e):d((r=t instanceof h)?t.source:t,r&&n?l.call(t):e),i?this:c,h)};for(var g=function(t){t in h||n(h,t,{configurable:!0,get:function(){return d[t]},set:function(e){d[t]=e}})},_=s(d),m=0;_.length>m;)g(_[m++]);c.constructor=h,h.prototype=c,i(9)(r,"RegExp",h)}i(46)("RegExp")},function(t,e,i){"use strict";function r(){this.VERSION="2.5.6",this.REPORT_VERSION=this.VERSION+"_20210104_2158",this.MINIPROGRAM_REPORT_VERSION=this.VERSION+"_20200723_2111",this.NATIVEVERSION="web",this.PLATFORM="web",this.SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whiteboard?sdkappid=",this.TEST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/whiteboard?sdkappid=",this.COS_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/cos",this.TEST_COS_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/cos",this.WHITELIST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whitelist?sdkappid=",this.TEST_WHITELIST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/whitelist?sdkappid=",this.TRANSCODE_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/transcode?sdkappid=",this.TEST_TRANSCODE_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/transcode?sdkappid=",this.TEST_HEARTBEAT_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/report_heartbeat?sdkappid=",this.HEARTBEAT_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_heartbeat/report_heartbeat?sdkappid=",this.NOTIFY_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/notify?sdkappid=",this.TEST_NOTIFY_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/notify?sdkappid=",this.fontUrl="https://res.qcloudtiw.com/board/fonts/simhei-Regular.ttf",this.SUB_CMD={GET_BOARD_DATA:"get_board_data",REPORT_BOARD_DATA:"report_board_data"},this.CDN_DOMAIN="qcloudtiw.com",this.PROGRESS_ENABLE=!1,this.PROGRESS_SHOW_DELAY=100,this.SYNC_VIDEO_STATUS_INTERVAL=3e3,this.SYNC_VIDEO_STATUS_PRECISION=3e3,this.VIDEO_ACTION_TRYTIMES=5,this.COMMON_GROUP="#DEFAULT",this.COMMON_DEFAULT_BOARD="#DEFAULT",this.SCALE=100,this.MAX_SCALE=1600,this.MIN_SCALE=100,this.RATIO="16:9",this.TOP=50,this.LEFT=50,this.THIN=100,this.SMOOTH_LEVEL=0,this.MIN_LINE_WIDTH=1,this.MIN_FONT_SIZE=1,this.TEXT_MAX_LENGTH=2e3,this.TEXT_SIZE=320,this.TEXT_COLOR="#000000",this.TEXT_FONT_FAMILY="customFontFamily,sans-serif,serif,monospace",this.DATA_SYNC_ENABLE=!0,this.PRELOAD_DEPTH=5,this.IMAGESFILE_MAX_URL_LENGTH=5e3,this.REALTIMEDATA_MAX_LENGTH=7e3,this.RENDER_INTERVAL=20,this.IMAGE_TIMEOUT=10,this.H5PPT_TIMEOUT=15,this.TEXT_FONT_STYLE={NORMAL:0,BOLD:1,ITALIC:2,BOLD_ITALIC:3},this.FILE_TYPE={IMG:0,H5PPT:1,VOD:2,LIVE:3,H5FILE:4,VODFILE:5,IMAGESFILE:6},this.VIDEO_STATUS={STOP:0,PLAY:1,PAUSE:2},this.VIDEO_ACTION={PASSIVE:1,API:2,EXCEPTIOIN:3},this.VIDEO_FORMAT={NONE:"",MP4:"mp4",M3U8:"m3u8",FLV:"flv",RTMP:"rtmp"},this.ABOUTBLANK="about:blank",this.penCursorIcon="https://res.qcloudtiw.com/board/icons/pen2.png",this.laserCursorIcon="https://res.qcloudtiw.com/board/icons/laserpen.png",this.defaultLoadingImage="https://res.qcloudtiw.com/board/icons/default-loading-96px.png",this.zoomInIcon="https://res.qcloudtiw.com/board/icons/zoomin.svg",this.zoomOutIcon="https://res.qcloudtiw.com/board/icons/zoomout.svg",this.audioIcons={startIcon:"https://res.qcloudtiw.com/board/icons/start.svg",pauseIcon:"https://res.qcloudtiw.com/board/icons/pause.svg",mutedIcon:"https://res.qcloudtiw.com/board/icons/muted.svg",unmutedIcon:"https://res.qcloudtiw.com/board/icons/unmuted.svg",closeIcon:"https://res.qcloudtiw.com/board/icons/close.svg",disableStartIcon:"https://res.qcloudtiw.com/board/icons/start-disable.svg",disablePauseIcon:"https://res.qcloudtiw.com/board/icons/pause-disable.svg",disableMutedIcon:"https://res.qcloudtiw.com/board/icons/muted-disable.svg",disableUnmutedIcon:"https://res.qcloudtiw.com/board/icons/unmuted-disable.svg",disableCloseIcon:"https://res.qcloudtiw.com/board/icons/close-disable.svg"},this.ICONS={0:{cursor:"auto"},1:{cursor:"url",url:this.penCursorIcon,offsetX:0,offsetY:0},2:{cursor:"auto"},3:{cursor:"url",url:this.laserCursorIcon,offsetX:32,offsetY:32},4:{cursor:"crosshair"},5:{cursor:"crosshair"},6:{cursor:"crosshair"},7:{cursor:"crosshair"},8:{cursor:"crosshair"},9:{cursor:"auto"},10:{cursor:"crosshair"},11:{cursor:"text"},12:{cursor:"url",url:this.zoomInIcon},13:{cursor:"crosshair"},14:{cursor:"crosshair"},15:{cursor:"crosshair"},16:{cursor:"crosshair"},18:{cursor:"crosshair"}},this.PROTOCOL_ACTION={LINE_START_ACTION:1,LINE_MOVE_ACTION:2,LINE_END_ACTION:3,RASER_SHOW_ACTION:6,RASER_HIDE_ACTION:7,ERASER_ACTION:8,MOVE_LINE_GRAPH_ACTION:9,GRAPH_LINE_ACTION:10,GRAPH_CIRCLE_ACTION:11,GRAPH_RECT_ACTION:12,INPUT_TEXT_ACTION:13,IMAGE_ELEMENT:20,H5Web_ELEMENT:21,CUSTOM_GRAPH_ELEMENT:22,AUDIO_ELEMENT:23,GLOBAL_AUDIO_ELEMENT:24,FILE_MESSAGE_ACTION:40,GRAPH_CLEAR_ALL_ACTION:101,GRAPH_CLEAR_ACTION:102,FILE_CLEAR_ACTION:103,RESET_DATA_ACTION:104,SET_BOARD_RATIO_ACTION:105,SET_BOARD_FIT_MODE_ACTION:106,UPDATE_BG_IMG_ACTION:201,DELETE_BG_IMG_ACTION:202,UPDATE_BG_COLOR_ACTION:203,BOARD_MOVE_SCALE_ACTION:301,FILE_SCALE_ACTION:302,SWITCH_ACTION:401,ADD_FILE_ACTION:501,PPT_EVENT_ACTION:601,VIDEO_EVENT_ACTION:701,H5WEB_EVENT_ACTION:801}}i.r(e),i(14),r.prototype.setPlatform=function(t){this.PLATFORM=t},r.prototype.setNativeVersion=function(t){this.NATIVEVERSION=t};var o=new r,n=(i(104),i(57),i(33),i(24),i(35),i(36),i(109),i(37),i(38),i(13),i(100)),s=i.n(n),a={performanceNow:0,serverTime:0,localTime:0,localServerTimeDiff:0,seq:0,getCurrentTimeStamp:function(){var t=0;return window&&window.performance&&window.performance.now&&!h.isMobile()?t=0===this.serverTime?Date.now():this.serverTime+parseInt(window.performance.now()-this.performanceNow):(isNaN(this.localServerTimeDiff)&&(this.localServerTimeDiff=0),t=Date.now()-this.localServerTimeDiff),t},getSeq:function(){var t=parseInt(this.getCurrentTimeStamp()/1e3);return 1*new s.a(t>>>0<<15|32767&this.seq++,t>>>0>>17).toString()}},l={TEDU_BOARD_ARROW_TYPE_NONE:1,TEDU_BOARD_ARROW_TYPE_NORMAL:2,TEDU_BOARD_ARROW_TYPE_SOLID:3},h={isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"==Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"==Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"==Object.prototype.toString.call(t)},isFile:function(t){return"[object File]"==Object.prototype.toString.call(t)},isUndefined:function(t){return"[object Undefined]"==Object.prototype.toString.call(t)},isNull:function(t){return"[object Null]"==Object.prototype.toString.call(t)},isNumber:function(t){return"[object Number]"==Object.prototype.toString.call(t)},isPromise:function(t){return"[object Promise]"==Object.prototype.toString.call(t)},color2RgbaColor:function(t){var e="";return this.isNumber(t)?e=this._decimalColor2RgbaColor(t):this.isString(t)&&0==t.indexOf("#")&&(4===t.length||t.length>=7)?e=this._hexColor2RgbaColor(t):this.isString(t)&&t.startsWith("rgb(")?e=t.replace("rgb(","rgba(").replace(")",", 1)"):this.isString(t)&&t.startsWith("rgba(")&&(e=t),e},rgbaColor2DecimalColor:function(t){var e="";return t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(",").forEach((function(t,i){var r="";i<3?r=Number(t).toString(16):3===i&&(r=(r=Math.min(255,Math.floor(255*t))).toString(16)),1==r.length&&(r="0"+r),e+=r})),parseInt(e,16)},_decimalColor2RgbaColor:function(t){var e,i=t>>24&255,r=t>>16&255,o=t>>8&255;return e=t<0?1:((255&t)/255).toFixed(2),"rgba(".concat(i,", ").concat(r,", ").concat(o,", ").concat(e,")")},_hexColor2RgbaColor:function(t){if(3==(t=t.replace("#","")).length){var e=t.substring(0,1),i=t.substring(1,2),r=t.substring(2,3);t=e+e+i+i+r+r+"ff"}else t.length>=6&&(t=t.substring(0,6)+"ff");var o=parseInt(t,16);return this._decimalColor2RgbaColor(o)},validateRatio:function(t){var e=!0;try{var i=t.split(":");2!=i.length?e=!1:0!=Number(i[0])&&0!=Number(i[1])||(e=!1)}catch(t){e=!1}return e},getEffectivePoint:function(t,e){return t<=0?t=Math.floor(e/2):t>=1e4&&(t=1e4-Math.floor(e/2)),t},isInPolygon:function(t,e){var i,r,o,n,s=0,a=e.length;for(o=e[0],i=1;i<=a;i++)n=e[i%a],t[0]>Math.min(o[0],n[0])&&t[0]<=Math.max(o[0],n[0])&&t[1]<=Math.max(o[1],n[1])&&o[0]!=n[0]&&(r=(t[0]-o[0])*(n[1]-o[1])/(n[0]-o[0])+o[1],(o[1]==n[1]||t[1]<=r)&&s++),o=n;return s%2!=0},getAVSdkTimestamp:function(){var t=this.getTimeStamp()+"",e=t.substring(0,5)+"00000000",i=t.substr(5),r=parseInt(e,10).toString(2).substr(-32);return parseInt(r,2)+(4294967295&i)},getTimeStamp:function(){return a.getCurrentTimeStamp()},getSecondTime:function(){return parseInt(this.getTimeStamp()/1e3)},getTimeDiff:function(t){return this.getTimeStamp()-t},formatDateTime:function(t){var e=t?new Date(t):new Date,i=e.getFullYear(),r=e.getMonth()+1;r=r<10?"0"+r:r;var o=e.getDate();o=o<10?"0"+o:o;var n=e.getHours();n=n<10?"0"+n:n;var s=e.getMinutes(),a=e.getSeconds();return s=s<10?"0"+s:s,a=a<10?"0"+a:a,String(i)+String(r)+String(o)+String(n)+String(s)+String(a)},boardId2Fid:function(t){return t.substring(t.indexOf("#"))},boardId2Uid:function(t){if(t===o.COMMON_DEFAULT_BOARD)return"";var e="";try{e=(e=t.substring(0,t.match(/_\d+_\d+_#\w+$/).index)).substring(e.indexOf("_")+1)}catch(t){}return e},boardIdGetSeq:function(t){return t.match(/\d+_#/)[0].replace(/\D/gi,"")},isCosUrl:function(t){return t.indexOf("myqcloud.com")>-1&&t.indexOf("cos")>-1},cosUrlExtractFileName:function(t){t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e=t.substring(t.lastIndexOf("/")+1);return t.indexOf("-1257240443")>-1&&e.match(/\d+_/)&&(e=e.substr(e.match(/^\d+_/)[0].length)),decodeURIComponent(e)},fileDownLoadUrlToPreviewUrl:function(t){if(t.startsWith("https")||(t=t.startsWith("http")?t.replace("http","https"):"https://"+t),t.endsWith("/"))return t;t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e="//";t.indexOf(e)>-1&&(t=t.substring(t.indexOf(e)+e.length)),e=".";var i=t.indexOf(e);return e=".com","https://"+t.substr(0,i)+".preview.myqcloud.com"+t.substring(t.indexOf(e)+e.length)+"?cmd=doc_preview&of=pic&page="},fontStyle2CanvasFontStyle:function(t){var e="";return 0===t?e="":1===t?e="bold":2===t?e="italic":3===t&&(e="italic bold"),e+" "},maxCommonDivisor:function(t,e){return 0!=e?this.maxCommonDivisor(e,t%e):t},calcRatioWidthHeight:function(t,e){var i,r;try{var o=t.split(":");i=1*o[0],i=isNaN(i)?e.split(":")[0]:i,r=1*o[1],r=isNaN(r)?e.split(":")[1]:r}catch(t){return this.calcRatioWidthHeight(e)}return{ratioWidth:i,ratioHeight:r}},isMobile:function(){var t=navigator.userAgent.toLowerCase();if(!(t.indexOf("macintosh")>-1))return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t);try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}},isIOS:function(){var t=navigator.userAgent.toLowerCase();if(!(t.indexOf("macintosh")>-1))return/iphone|ipad|ipod/i.test(t);try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}},isIOS8910:function(){return!!this.isIOS()&&!!navigator.userAgent.toLowerCase().match(/OS (8|9|10)[_\d]* like Mac OS X/i)},isAndroid:function(){var t=navigator.userAgent.toLowerCase();return/android/i.test(t)},isTBS:function(){var t=navigator.userAgent.toLowerCase();return/tbs/i.test(t)},parseQueryString:function(t){for(var e={},i=[],r="",o="",n=t.substring(t.indexOf("?")+1,t.length).split("&"),s=0,a=n.length;s<a;s++)r=(i=n[s].split("="))[0],o=i[1],e[r]=o;return e},extractTouch:function(t){return t&&t.changedTouches&&t.changedTouches[0]?{clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,force:t.changedTouches[0].force,identifier:t.changedTouches[0].identifier,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY,radiusX:t.changedTouches[0].radiusX,radiusY:t.changedTouches[0].radiusY,rotationAngle:t.changedTouches[0].rotationAngle,screenX:t.changedTouches[0].screenX,screenY:t.changedTouches[0].screenY}:{}},extractTaskId:function(t){var e=t.match(".*/([0-9a-zA-Z-]+)_tiw/h5/.*");return e&&e.length>1?e[1]:t.substring(t.indexOf(".com/")+5,t.indexOf("/index.html"))},camelCase2CamelCase:function(t){if(this.isString(t))return t.replace(/(.)(.*)/,t.charAt(0).toUpperCase()+"$2");if(this.isObject(t)){var e={};for(var i in t)e[this.camelCase2CamelCase(i)]=t[i];return e}},CamelCase2camelCase:function(t){if(this.isString(t))return t.replace(/(.)(.*)/,t.charAt(0).toLowerCase()+"$2");if(this.isObject(t)){var e={};for(var i in t)e[this.CamelCase2camelCase(i)]=t[i];return e}},debounce:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,i=null;return function(){var r=arguments,o=this;clearTimeout(i),i=setTimeout((function(){t.apply(o,r)}),e)}},calcPointAndBoardRightBorderDistance:function(t,e,i,r,o,n){return{distanceX:t-o/1e4*t,distanceY:i-n/1e4*i}},calcPointAndContainerRightBorderDistance:function(t,e,i,r,o,n,s,a){var l=0,h=0;return t<e?(l=t-s/1e4*t,h=i-a/1e4*i):(l=(t-e)/2+(50-o)*t/100+e-s/1e4*t,h=(i-r)/2+(50-n)*i/100+r-a/1e4*i),{distanceX:l,distanceY:h}},calcPointAndContainerLeftBorderDistance:function(t,e,i,r,o,n,s,a){var l=0,h=0;return t<e?(l=s/1e4*t,h=a/1e4*i):(l=s/1e4*t-(t-e)/2-(50-o)*t/100,h=a/1e4*i-(i-r)/2-(50-n)*i/100),{distanceX:l,distanceY:h}},compress:function(t){return t?i(77).compressToBase64(t):""},decompress:function(t){return t?i(77).decompressFromBase64(t):""},canvasTextAutoLine:function(t,e,i,r,o,n,s){var a=0,l=0,h=e.split("\n"),d=0,c=0,u=s||o-i-10-2-1,p=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,f=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return h.forEach((function(e,o){if(o>0&&(r+=n),a=0,l=0,""==e)t.fillText(e,i,r),d+=n,a=0;else for(var s=0,h=0;h<e.length;h++)p.test(e[h])||f.test(e[h])?a+=2*t.measureText("M").width:a+=t.measureText("M").width,c=Math.max(c,a),a>u+t.measureText(e[h]).width/2&&(t.fillText(e.substring(l,h),i,r,u),c=Math.min(c,u),h>0&&(d+=n,r+=n),a=0,l=h,s<e.length&&(s++,--h)),h==e.length-1&&(t.fillText(e.substring(l,e.length),i,r,u),d+=n)})),[c,d]},renderTextAutoLine:function(t,e,i,r,o,n,s){var a=0,l=0,h=e.split("\n"),d=0,c=0,u=s||o-i-10-2-1,p=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,f=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return h.forEach((function(e,o){if(o>0&&(r+=n),a=0,l=0,""==e)t.fillText(e,i,r),d+=n,a=0;else for(var s=0;s<e.length&&(p.test(e[s])||f.test(e[s])?a+=2*t.measureText("M").width:a+=t.measureText("M").width,c=Math.max(c,a),!(a>u&&(t.fillText(e.substring(l,s),i,r,u),c=Math.min(c,u),d+=n,r+=n,a=0,l=s,--s<0)));s++)s==e.length-1&&(t.fillText(e.substring(l,e.length),i,r,u),d+=n)})),[c,d]},calcCanvasTextWidthAndHeight:function(t,e,i,r,o,n){for(var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4,a=arguments.length>7?arguments[7]:void 0,l=0,h=e.split("\n"),d=0,c=0,u=Math.min(Math.max(o-i-Math.floor(100*o/1e4),0),s),p=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,f=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/,g=t.measureText("M").width,_=0,m=0;m<h.length;m++){var y=h[m];if(l=0,(d+=n)>a)break;if(""==y)_+=1,l=0;else{0!=m&&(_+=1);for(var T=!1,v=0,E=0;E<y.length;E++)if(p.test(y[E])||f.test(y[E])?l+=2*g:l+=g,c=Math.max(c,l),l>u){if(T=!0,c=Math.min(c,u),d+=n,l=0,0==E){v=y.length-E;break}if(d>a){v=y.length-E;break}if(--E<0)break}_+=y.length,T&&(_-=v)}}return{textWidth:c,textHeight:d,limitIndex:_}},getTranslate:function(t,e){var i=document.defaultView.getComputedStyle(t,null).transform.substring(7),r=i.match(/\(([^)]*)\)/),o=r?r[1].split(","):i.split(",");return"x"==e||null==e?o.length>6?parseFloat(o[12]):parseFloat(o[4]):"y"==e?o.length>6?parseFloat(o[13]):parseFloat(o[5]):"z"==e?o.length>6?parseFloat(o[14]):0:"rotate"==e?o.length>6?this.getRotate([parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[4]),parseFloat(o[5])]):this.getRotate(o):void 0},getRotate:function(t){var e=Math.round(180*Math.asin(t[0])/Math.PI),i=Math.round(180*Math.acos(t[1])/Math.PI),r=Math.round(180*Math.asin(t[2])/Math.PI),o=Math.round(180*Math.acos(t[3])/Math.PI),n=0;return e==i||-e==i?n=o:-e+i==180?n=180+r:e+i==180&&(n=360-r||360-o),n>=360?0:n},imageCache:function(t){t&&((new Image).src=t)},getDistance:function(t,e,i,r,o,n){var s,a,l=o-i,h=n-r,d=l*l+h*h,c=-1;0!=d&&(c=((t-i)*l+(e-r)*h)/d),c<0?(s=i,a=r):c>1?(s=o,a=n):(s=i+c*l,a=r+c*h);var u=t-s,p=e-a;return u*u+p*p},getArrowDistance:function(t,e,i,r,o,n,s,a){var h=function(t,e){return t.x*e.x+t.y*e.y},d=function(t,e,i,r){var o={x:i.x-t.x,y:i.y-t.y},n={x:e.x-t.x,y:e.y-t.y},s={x:r.x-t.x,y:r.y-t.y},a=h(o,o)*h(n,n)-h(o,n)*h(n,o),l=(h(n,n)*h(s,o)-h(n,o)*h(s,n))/a,d=(h(o,o)*h(s,n)-h(o,n)*h(s,o))/a;return l>=0&&d>=0&&l+d<=1},c=s/2,u=Math.max(s,2),p=Math.max(a+c,6),f=p*p,g=r.x,_=r.y,m=o.x,y=o.y,T=u*(e/t)+200,v=u+t/e*200,E=T+c,S=v+c,b=180*Math.atan2(y/1e4*e-_/1e4*e,m/1e4*t-g/1e4*t)/Math.PI,O=(b-25)*Math.PI/180,D=(b+25)*Math.PI/180,A=b*Math.PI/180,I=(b-30)*Math.PI/180,x=(b+30)*Math.PI/180,w=T*Math.cos(O),R=v*Math.sin(O),C=T*Math.cos(D),B=v*Math.sin(D),L=E*Math.cos(I),P=S*Math.sin(I),N=E*Math.cos(x),M=S*Math.sin(x),k=u*Math.cos(A)/2,q=u*Math.sin(A)/2,U=!1,F=!1;if(n.endArrowType===l.TEDU_BOARD_ARROW_TYPE_NORMAL){var H={x:m-w,y:y-R},G={x:m,y:y},W={x:m-C,y:y-B},V=this.getDistance(i.x,i.y,H.x,H.y,G.x,G.y),Y=this.getDistance(i.x,i.y,W.x,W.y,G.x,G.y);F=V<=f||Y<=f}if(n.endArrowType===l.TEDU_BOARD_ARROW_TYPE_SOLID&&(F=d({x:m-L,y:y-P},{x:m+k,y:y+q},{x:m-N,y:y-M},i)),n.startArrowType===l.TEDU_BOARD_ARROW_TYPE_NORMAL){var X={x:g+w,y:_+R},z={x:g,y:_},j={x:g+C,y:_+B},J=this.getDistance(i.x,i.y,X.x,X.y,z.x,z.y),K=this.getDistance(i.x,i.y,j.x,j.y,z.x,z.y);U=J<=f||K<=f}return n.startArrowType===l.TEDU_BOARD_ARROW_TYPE_SOLID&&(U=d({x:g+L,y:_+P},{x:g-k,y:_-q},{x:g+N,y:_+M},i)),U||F},loadJS:function(t,e){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,e&&e())}:i.onload=function(){e&&e()},i.src=t,document.getElementsByTagName("head")[0].appendChild(i)},isDisableDrawFileType:function(t){return[o.FILE_TYPE.VOD,o.FILE_TYPE.LIVE,o.FILE_TYPE.H5FILE,o.FILE_TYPE.VODFILE].indexOf(t)>-1}};window,h.loadJS("https://log.qcloudtiw.com/sdk/web/1.0.0/tiwlogger-sdk.min.js"),function(){var t=o.audioIcons;for(var e in t){var i=t[e];h.imageCache(i)}}();var d="%c--------------------------------------------------------------------------------------------------------------------------------\n┊                                                                                                                              ┊\n┊                                                                                                                              ┊\n┊         CCCCCCCCCCCCCCCCCCCCCCC,                 8000                 L00001               f000.   tttttttttttttt            ┊\n┊        00000000000000000000000:   0000000000G   8000                :00001                f000.  .000000000000000            ┊\n┊             f000L                 ;iiiiiiiii;,ii0000iiiii;    000000000000000000000.   tffC000Lft.000G..........             ┊\n┊             0000Gfffffffff:                  100000000000G    000000000000000000000.   8000000008.000G                       ┊\n┊            i00000000000000:      C00000000000i;;0008;i000G    0000             0000.      0000.  .0000000000000f             ┊\n┊            C000i     ,0000       tLL8000GLLLL. .000L .000L    0000             0000.     L00000: .0000CCCCC0000,             ┊\n┊           ;0000      i000C         .000C :tC,  i0001 ,000f    000000000000000000000.    i0000000L:000000t ,000L              ┊\n┊           C00000000000000t         L000, t000  G000, ;000t    000000000000000000000.   i000000G00f000L00010000.              ┊\n┊         ;000088888880000:         ;000Lf80000L:000G  i000i    0000             0000.  1000L000.i C000 t000000:               ┊\n┊                     :0000        f0000000000000000,  f000:    0000             0000.   10.f000. i000t  L00001                ┊\n┊       8000000000000000000000000   000L;     i0000Lt1f0000     000000000000000000000.      f000.:0008.L00000000C;             ┊\n┊       8000000000000000000000000             ,800: 800000;     000000000000000000000.      f000,G000.t000G .8000L             ┊\n┊                                                                                                                              ┊\n┊                                                                                                                              ┊\n┊                                                                                                                              ┊\n┊       %c互动白板版本:%c ".concat(o.VERSION,"%c                                                                                                  ┊\n┊                                                                                                                              ┊\n┊       %c互动白板最新文档：https://doc.qcloudtiw.com/web/TEduBoard.html %c                                         ┊\n┊                                                                                                            ┊\n┊      %c互动白板技术支持QQ群:%c 1015970626 %c                                                                                  ┊\n┊                                                                                                                              ┊\n--------------------------------------------------------------------------------------------------------------------------------");window.console.log(d,"color:#d9534f;","color:#000;font-size:14px;font-family: consolas,Arial,x-locale-body,sans-serif;","color:#0072BB;font-size:14px;","color:#d9534f;","color:#000;font-size:14px;font-family: consolas,Arial,x-locale-body,sans-serif;","color:#d9534f;font-size:14px;","color:#000;font-size:14px;font-family: consolas,Arial,x-locale-body,sans-serif;","color:#0072BB;font-size:14px;","color:#d9534f;");var c={TEB_INIT:"TEB_INIT",TEB_ERROR:"TEB_ERROR",TEB_WARNING:"TEB_WARNING",TEB_SYNCDATA:"TEB_SYNCDATA",TEB_HISTROYDATA_SYNCCOMPLETED:"TEB_HISTROYDATA_SYNCCOMPLETED",TEB_OPERATE_CANUNDO_STATUS_CHANGED:"TEB_OPERATE_CANUNDO_STATUS_CHANGED",TEB_OPERATE_CANREDO_STATUS_CHANGED:"TEB_OPERATE_CANREDO_STATUS_CHANGED",TEB_IMAGE_STATUS_CHANGED:"TEB_IMAGE_STATUS_CHANGED",TEB_H5BACKGROUND_STATUS_CHANGED:"TEB_H5BACKGROUND_STATUS_CHANGED",TEB_H5FILE_STATUS_CHANGED:"TEB_H5FILE_STATUS_CHANGED",TEB_VIDEO_STATUS_CHANGED:"TEB_VIDEO_STATUS_CHANGED",TEB_AUDIO_STATUS_CHANGED:"TEB_AUDIO_STATUS_CHANGED",TEB_FILEUPLOADSTATUS:"TEB_FILEUPLOADSTATUS",TEB_H5PPT_STATUS_CHANGED:"TEB_H5PPT_STATUS_CHANGED",TEB_ADDBOARD:"TEB_ADDBOARD",TEB_DELETEBOARD:"TEB_DELETEBOARD",TEB_GOTOBOARD:"TEB_GOTOBOARD",TEB_ADDH5PPTFILE:"TEB_ADDH5PPTFILE",TEB_ADDFILE:"TEB_ADDFILE",TEB_DELETEFILE:"TEB_DELETEFILE",TEB_SWITCHFILE:"TEB_SWITCHFILE",TEB_SETBACKGROUNDIMAGE:"TEB_SETBACKGROUNDIMAGE",TEB_FILEUPLOADPROGRESS:"TEB_FILEUPLOADPROGRESS",TEB_ADDTRANSCODEFILE:"TEB_ADDTRANSCODEFILE",TEB_GOTOSTEP:"TEB_GOTOSTEP",TEB_TRANSCODEPROGRESS:"TEB_TRANSCODEPROGRESS",TEB_VODEXTPARAM:"TEB_VODEXTPARAM",TEB_ADDIMAGEELEMENT:"TEB_ADDIMAGEELEMENT",TEB_ADDIMAGESFILE:"TEB_ADDIMAGESFILE",TEB_RECTSELECTED:"TEB_RECTSELECTED",TEB_ADDELEMENT:"TEB_ADDELEMENT",TEB_REFRESH:"TEB_REFRESH",TEB_SNAPSHOT:"TEB_SNAPSHOT",TEB_REPORT_LOG:"TEB_REPORT_LOG",TEB_REMOVEELEMENT:"TEB_REMOVEELEMENT"};function u(){this.waterEvents=["addData","call_method","apply_video_permission","init_video_permission"],this.waterUrl="https://report-log-lv0.api.qcloud.com",this.keyUrl="https://report-log-lv1.api.qcloud.com",this.uniqBid=Math.floor(Math.random()*h.getTimeStamp())}u.prototype={method:"POST",send:function(t,e){var i=this;try{e.userAgent=navigator.userAgent,(e=this.fillDatas(e)).uniqBid=this.uniqBid;var r=this.getXHR();r.onreadystatechange=this.reporterHandel(r),r.open(this.method,t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded");var o=JSON.stringify(e);r.send(o),setTimeout((function(){try{i.event.fire(i,c.TEB_REPORT_LOG,o)}catch(t){}}),0)}catch(t){}},fillDatas:function(t){var e={};for(var i in this.defDatas)["sdkappid","classid","userid"].indexOf(i)>=0?e[i]=this.defDatas[i]:(e[i]=void 0!==t[i]?t[i]:this.defDatas[i],"boardid_list"===i&&(e[i]=JSON.stringify(this.defDatas[i])),"roomid"===i&&(e[i]=this.defDatas[i]+""));return e.device=o.PLATFORM,e.nativeVersion=o.NATIVEVERSION,e},datasParseToString:function(t){var e=[];for(var i in t)e.push(i+"="+encodeURIComponent(t[i]));return e.join("&")},getXHR:function(){var t=null,e=window.ActiveXObject;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(e)try{t=new e("Msxml2.XMLHTTP")}catch(i){try{t=new e("Microsoft.XMLHTTP")}catch(t){}}if(null!=t)return t},reporterHandel:function(t){return function(){t&&t.readyState&&t.readyState}},defDatas:{action:"",version:o.REPORT_VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:o.PLATFORM,log_time:0,business:"ticsdk",roomid:"",boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:"unknown",userAgent:null},setSdkAppid:function(t){null!=t&&null!=t&&(this.defDatas.sdkappid=t)},setRoomId:function(t){null!=t&&null!=t&&(this.defDatas.roomid=t)},setUserId:function(t){null!=t&&null!=t&&(this.defDatas.userid=t)},setEvent:function(t){this.event=t},boardAction:function(t,e){this.report(t,e)},report:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var i=null;i=this.waterEvents.indexOf(t)>-1?this.waterUrl:this.keyUrl,this.send(i,Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:h.getTimeStamp()}))}catch(t){}}};var p=u,f=(i(39),i(83),i(117),i(120),i(86),i(48),i(89),i(90),i(49),i(50),i(94),i(95),i(127),i(128),i(129),{BOARD_ACTION_TYPE:{LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",MOVE:"move","GRAPH-LINE":"graph-line","GRAPH-CIRCLE":"graph-circle","GRAPH-RECT":"graph-rect","GRAPH-OVAL":"graph-oval","GRAPH-CIRCLE-SOLID":"graph-circle-solid","GRAPH-RECT-SOLID":"graph-rect-solid","GRAPH-OVAL-SOLID":"graph-oval-solid",INPUTTEXT:"inputtext",MOUSE:"mouse",ZOOM:"zoom","GRAPH-SQUARE":"graph-square","GRAPH-SQUARE-SOLID":"graph-square-solid","CUSTOM-GRAPH":"custom-graph"},BOARD_MODE:{BOARD:0,FILE:1},BACKGROUND_TYPE:{IMAGE:0,H5:1},FILL_MODE:{DEFAULT:0,LEFT:4,TOP:5,RIGHT:6,BOTTOM:7},COLOR:{RED:4278190335,WHITE:4294967295},EVENT:{HISTROY_DATA_COMPLETE:"histroy_data_complete",ADD_BOARD:"add_board",RT_DATA:"real_time_data",REAL_TIME_DATA:"real_time_data",ADD_DATA_ERROR:"add_data_error",DELETE_BOARD:"delete_board",SWITCH_BOARD:"switch_board",ADD_FILE:"add_group",ADD_H5PPT_FILE:"add_h5ppt_file",DELETE_FILE:"delete_group",SWITCH_FILE:"switch_group",IMG_START_LOAD:"img_start_load",IMG_LOAD:"img_load",IMG_ERROR:"img_error",IMG_ABORT:"img_abort",PRELOAD:"preload",BOARD_CAN_UNDO:"board_can_undo",BOARD_CAN_REDO:"board_can_redo",VERIFY_SDK_SUCC:"verify_sdk_succ",VERIFY_SDK_ERROR:"verify_sdk_error",CANVAS_MOUSEDOWN:"canvas_mousedown",CANVAS_MOUSEMOVE:"canvas_mousemove",CANVAS_MOUSEUP:"canvas_mouseup",CANVAS_MOUSELEAVE:"canvas_mouseleave",CANVAS_TOUCHSTART:"canvas_touchstart",CANVAS_TOUCHMOVE:"canvas_touchmove",CANVAS_TOUCHEND:"CANVAS_touchend",CANVAS_TOUCHCANCEL:"canvas_touchcancel",UPDATE_BACKGROUND_IMAGE_SUCCESS:"update_background_image_success",UPDATE_BACKGROUND_IMAGE_ERROR:"update_background_image_error",COS:{GET_SIGN_ERROR:"get_sign_error",TASK_READY:"task_ready",HASH_PROGRESS:"hash_progress",PROGRESS:"progress",GET_SIGN_SUCCESS:"get_sign_success",DOES_NOT_SUPPORT_UPLOAD:"does_not_support_upload",UPLOAD_SUCCESS:"upload_success",UPLOAD_ERROR:"upload_error"}}}),g=function(t,e){this.user=t,this.type=e.type,this.seq=e.seq};function _(t,e){this.user=t,this.type="line",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.show=e.show,this.status="begin",this.select=!1,this.color=e.color,this.time=e.time||h.getTimeStamp(),this.thin=e.thin,this.writing=e.writing,this.startSeq=e.belongSeq,this.endSeq=0,this.drawIndex=0,this.lines=[{action:e.action,x:e.x,y:e.y,w:e.w,belongSeq:e.belongSeq,seq:e.seq,timestamp:e.timestamp}],this.fitCurve=[],this.border={maxX:e.x,maxY:e.y,minX:e.x,minY:e.y}}_.prototype.setBorder=function(t,e){t+this.thin>this.border.maxX&&(this.border.maxX=h.getEffectivePoint(t+this.thin,this.thin)),t-this.thin<this.border.minX&&(this.border.minX=h.getEffectivePoint(t-this.thin,this.thin)),e+this.thin>this.border.maxY&&(this.border.maxY=h.getEffectivePoint(e+this.thin,this.thin)),e-this.thin<this.border.minY&&(this.border.minY=h.getEffectivePoint(e-this.thin,this.thin))},_.prototype.sort=function(){this.lines.sort((function(t,e){return t.seq-e.seq}))},_.prototype.impactCheck=function(t,e,i){var r=this.thin/2,o=this.border.maxX+r,n=this.border.maxY+r,s=this.border.minX-r,a=this.border.minY-r;if(t+i<s||t-i>o||e+i<a||e-i>n)return!1;var l=!1;if(1===this.lines.length){var d=this.lines[0];h.getDistance(t,e,d.x,d.y,d.x,d.y)<=(i+r)*(i+r)&&(l=!0)}else for(var c=1;c<this.lines.length;c++){var u=this.lines[c-1],p=this.lines[c];if(h.getDistance(t,e,u.x,u.y,p.x,p.y)<=(i+r)*(i+r)){l=!0;break}}return!!l};var m=_;function y(t,e){this.user=t,this.type="inputtext",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.scale=1,this.color=0,this.typeFace="",this.textSize=0,this.fontStyle=0,this.time=h.getTimeStamp(),this.text="",this.show=!0,this.textWidth=0,this.textHeight=0,this.location={x:e.x,y:e.y}}y.prototype.getRectArea=function(){return{minX:this.location.x,minY:this.location.y,maxX:this.location.x+this.textWidth,maxY:this.location.y+this.textHeight}},y.prototype.impactCheck=function(t,e,i){var r=this.getRectArea(),o=r.minX,n=r.minY,s=r.maxX,a=r.maxY;return t>o&&e>n&&t<s&&e<a};var T=y;function v(t,e){this.user=t,this.type="graph",this.graph=e.graph,this.seq=e.seq,this.show=e.show,this.status="begin",this.select=!1,this.time=h.getTimeStamp(),this.color=e.color,this.thin=e.thin,this.solid=e.solid||!1,this.style=e.style,this.startPoint={x:e.beginPoint.x,y:e.beginPoint.y,seq:e.beginPoint.seq},this.endPoint={x:e.endPoint.x,y:e.endPoint.y,seq:e.endPoint.seq}}v.prototype.impactCheck=function(t,e,i,r,o){var n=this.thin/2,s=this.endPoint.x,a=this.endPoint.y,d=this.startPoint.x,c=this.startPoint.y;if(s<d&&(s+=d,s-=d=s-d),a<c&&(a+=c,a-=c=a-c),a+=this.thin/2,s+=this.thin/2,d-=this.thin/2,c-=this.thin/2,"line"==this.graph){var u=Math.max(o+n,6);return!(!this.style||!this.style.startArrowType||this.style.startArrowType===l.TEDU_BOARD_ARROW_TYPE_NONE&&this.style.endArrowType===l.TEDU_BOARD_ARROW_TYPE_NONE||!h.getArrowDistance(t,e,{x:i,y:r},this.startPoint,this.endPoint,this.style,this.thin,o))||h.getDistance(i,r,d,c,s,a)<=u*u}if("rect"==this.graph||"square"==this.graph){if(this.solid){if(i>d&&r>c&&i<s&&r<a)return!0}else{var p=h.getDistance(i,r,d,c,d,a),f=h.getDistance(i,r,d,c,s,c),g=h.getDistance(i,r,s,a,d,a),_=h.getDistance(i,r,s,a,s,c);if(Math.min(p,f,g,_)<=(o+n)*(o+n))return!0}return!1}if("oval"==this.graph||"circle"==this.graph){var m=(d+s)/2,y=(c+a)/2,T=Math.abs(d-s)/2,v=Math.abs(c-a)/2;if(T===v&&0===T)return;var E=Math.pow(i-m,2)/Math.pow(T,2)+Math.pow(r-y,2)/Math.pow(v,2),S=Math.pow(i-m+n,2)/Math.pow(T,2)+Math.pow(r-y+n,2)/Math.pow(v,2),b=Math.pow(i-m+n,2)/Math.pow(T,2)+Math.pow(r-y-n,2)/Math.pow(v,2),O=Math.pow(i-m-n,2)/Math.pow(T,2)+Math.pow(r-y+n,2)/Math.pow(v,2),D=Math.pow(i-m-n,2)/Math.pow(T,2)+Math.pow(r-y-n,2)/Math.pow(v,2);if(this.solid){if(E<=1.2||S<=1.2||b<=1.2||O<=1.2||D<=1.2)return!0}else if(E<=1.2&&E>=.8||S<=1.2&&S>=.8||b<=1.2&&b>=.8||O<=1.2&&O>=.8||D<=1.2&&D>=.8)return!0;return!1}};var E=v,S=function(t,e){this.user=t,this.type="select",this.seq=Math.floor(100*Math.random()),this.show=!0,this.color=e.color,this.startInfo={x:e.startx,y:e.starty},this.location={x:e.x,y:e.y}},b=function(t,e){this.action=e.action,this.user=t,this.type="raser",this.seq=e.seq,this.color=e.color,this.radius=e.radius,this.timestamp=e.timestamp,this.location={x:e.x,y:e.y},this.toolType=e.toolType||3,this.title=e.title||"",this.style=e.style||{}},O={getInstance:function(t){var e=this,i=window.axios.create({timeout:5e3});this.elkLog=t.elkLog,i.defaults.retry=3,i.defaults.retryDelay=1e3,i.interceptors.request.use((function(t){return t}),(function(t){return Promise.reject(t)}));var r=function(t){var e=t.config;if(e.data)try{var r=JSON.parse(e.data);!1===r.first_time&&(r.first_time=!0,e.data=JSON.stringify(r))}catch(t){}var o=Math.floor(1e8*Math.random());if(e.url.indexOf("random=")>-1){if(e.url.match(/random=\d*/))try{e.url=e.url.replace(/random=\d*/,"random="+o)}catch(t){}}else e.url.indexOf("?")>-1?e.url+="&random=".concat(o):e.url+="?random=".concat(o);return e&&e.retry?(e.__retryCount=e.__retryCount||0,e.__retryCount>=e.retry?Promise.reject(t):(e.__retryCount+=1,new Promise((function(t){setTimeout((function(){t()}),e.retryDelay||1e3)})).then((function(){return i(e)})))):Promise.reject(t)};return i.interceptors.response.use((function(t){if(200==t.status)try{if(60008===t.data.ErrorCode)return r(t)}catch(e){return t}return t}),r),new Promise((function(r,o){i(t).then((function(t){r(t)}),(function(t){try{var i;i=t.response?JSON.stringify({data:t.response.data,status:t.response.status,headers:t.response.headers,config:t.config,message:t.message}):t.request?JSON.stringify({request:t.request,config:t.config,message:t.message}):JSON.stringify({message:t.message,config:t.config}),e.elkLog.report("requestError",{action_result:-1,extra_info:i})}catch(t){e.elkLog.report("requestError",{action_result:-2,extra_info:{stack:t.stack,message:t.message}})}o(t)}))}))}};function D(t){if(this.permissions=!1,this.reportEnable=!1,this.option=Object.assign({},t),this.elkLog=t.elkLog,!this.option.tlsData)throw new Error("not found sdkAppId|userId|userSig");if(!this.option.tlsData.sdkAppId)throw new Error("not found sdkAppId");if(!this.option.tlsData.identifier)throw new Error("not found userId");if(!this.option.tlsData.userSig)throw new Error("not found userSig");this.BOARD_URL=(t.isTest?o.TEST_SERVER_URL:o.SERVER_URL)+this.option.tlsData.sdkAppId,this.COS_SERVER_URL=t.isTest?o.TEST_COS_SERVER_URL:o.COS_SERVER_URL,this.WHITELIST_SERVER_URL=(t.isTest?o.TEST_WHITELIST_SERVER_URL:o.WHITELIST_SERVER_URL)+this.option.tlsData.sdkAppId,this.TRANSCODE_SERVER_URL=(t.isTest?o.TEST_TRANSCODE_SERVER_URL:o.TRANSCODE_SERVER_URL)+this.option.tlsData.sdkAppId,this.HEARTBEAT_SERVER_URL=(t.isTest?o.TEST_HEARTBEAT_SERVER_URL:o.HEARTBEAT_SERVER_URL)+this.option.tlsData.sdkAppId,this.NOTIFY_SERVER_URL=(t.isTest?o.TEST_NOTIFY_SERVER_URL:o.NOTIFY_SERVER_URL)+this.option.tlsData.sdkAppId}D.prototype.setPermissions=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.permissions=t},D.prototype.initXmlHttp=function(){var t=window.ActiveXObject;return XMLHttpRequest?new XMLHttpRequest:new t("Microsoft.XMLHTTP")},D.prototype.setReportEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.reportEnable=t},D.prototype.reportMsg=function(t,e,i){if(this.option.classId&&this.permissions&&this.reportEnable){var r={cmd:"open_conf_svc",sub_cmd:"report_board_data",conf_id:parseInt(this.option.classId,10),board_data_list:t};this.post(r,e,i)}},D.prototype.getBoardData=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r={first_time:t,cmd:"open_conf_svc",sub_cmd:"get_board_data_bulk",seq:a.getSeq(),conf_id:parseInt(this.option.classId,10),version:1};this.post(r,e,i)},D.prototype.getLineData=function(t,e,i){var r=this,o=h.getTimeStamp(),n={cmd:"open_conf_svc",sub_cmd:"get_line",conf_id:parseInt(this.option.classId,10),boardId:t.boardId,owner:t.owner,seq:t.seq};this.post(n,(function(t){r.elkLog.report("getLineData",{action_result:0,time_consume:h.getTimeStamp()-o,extra_info:JSON.stringify(t)}),e&&e(t)}),(function(t){r.elkLog.report("getLineData",{action_result:-1,time_consume:h.getTimeStamp()-o,extra_info:JSON.stringify(t)}),i&&i(t)}))},D.prototype.getFileInfo=function(t,e,i){var r=this,o=h.getTimeStamp(),n={cmd:"open_conf_svc",sub_cmd:"get_file",conf_id:parseInt(this.option.classId,10),fid:t.fid};this.post(n,(function(t){r.elkLog.report("getFileInfo",{action_result:0,time_consume:h.getTimeStamp()-o,extra_info:JSON.stringify(t)}),e&&e(t)}),(function(t){r.elkLog.report("getFileInfo",{action_result:-1,time_consume:h.getTimeStamp()-o,extra_info:JSON.stringify(t)}),i&&i(t)}))},D.prototype.getDocTotalPage=function(t){return O.getInstance({elkLog:this.elkLog,url:t,method:"get",responseType:"blob"})},D.prototype.getCosAuthData=function(t){var e=this.COS_SERVER_URL+"?SdkAppId=".concat(this.option.tlsData.sdkAppId,"&Identifier=").concat(this.option.tlsData.identifier,"&UserSig=").concat(this.option.tlsData.userSig);return O.getInstance({elkLog:this.elkLog,url:e,method:"post",data:{cmd:"open_cos_svc",sub_cmd:"get_cos_token_for_bucket",bucket:t,duration:300,version:2}})},D.prototype.applyPermissions=function(){var t=this.WHITELIST_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier+"&contenttype=json";return O.getInstance({elkLog:this.elkLog,url:t,method:"post",data:{cmd:"open_conf_svc",sub_cmd:"verify_sdk",sdkappid:1*this.option.tlsData.sdkAppId,version:1}})},D.prototype.heartbeat=function(t){if(this.permissions){var e=this.HEARTBEAT_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier+"&contenttype=json&random="+parseInt(1e8*Math.random(0,1));return O.getInstance({elkLog:this.elkLog,url:e,method:"post",data:Object.assign({LastReportTime:0,HeartbeatVersion:"1.0"},t)})}},D.prototype.createTranscode=function(t){var e=this.TRANSCODE_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return O.getInstance({elkLog:this.elkLog,url:e,method:"post",data:Object.assign({Action:"CreateTranscode"},h.camelCase2CamelCase(t))})},D.prototype.describeTranscode=function(t){var e=this.TRANSCODE_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return O.getInstance({elkLog:this.elkLog,url:e,method:"post",data:Object.assign({Action:"DescribeTranscode"},h.camelCase2CamelCase(t))})},D.prototype.requestFileMessage=function(t){return O.getInstance({elkLog:this.elkLog,url:t,method:"get"})},D.prototype.requestFont=function(){var t=o.fontUrl;return O.getInstance({elkLog:this.elkLog,url:t,method:"get"})},D.prototype.machineNotify=function(t,e){var i,r,o,n=this.NOTIFY_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return O.getInstance({elkLog:this.elkLog,url:n,method:"post",data:(i={msgtype:t},r=t,o={content:e},r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i)})},D.prototype.urlPost=function(t,e,i,r){"undefined"==typeof axios?this.cPost(t,e,i,r):this.axiosPost(t,e,i,r)},D.prototype.post=function(t,e,i){var r=this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;"open_conf_svc"===t.cmd&&"report_board_data"===t.sub_cmd&&(r+="&contenttype=json"),"undefined"==typeof axios?this.cPost(r,t,e,i):this.axiosPost(r,t,e,i)},D.prototype.axiosPost=function(t,e,i,r){O.getInstance({elkLog:this.elkLog,url:t,method:"post",data:e}).then((function(t){i&&i(t.data,t)})).catch((function(t){r&&r(t)}))},D.prototype.corsGet=function(t,e,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){2==r.readyState?(r.onreadystatechange=null,r.abort(),e()):4==r.readyState&&i()},r.open("GET",t),r.send()},D.prototype.cPost=function(t,e,i,r){var o=this.initXmlHttp();o.open("POST",t,!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(JSON.stringify(e)),o.onreadystatechange=function(){if(4==o.readyState)if(o.status>=200&&o.status<300||304==o.status){var t=null;try{t=JSON.parse(o.responseText),i&&i(t)}catch(t){r&&r(t)}}else{var e=new Error("Network Error");r&&r(e)}}};var A=D;function I(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var x=function(){function t(e){var i=e.newEnterId,r=void 0===i?0:i,o=e.classId,n=e.request,s=e.log;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$request=n,this.elkLog=s,this.classId=Number(o),this.newEnterId=Number(r)||0,this.defaultTimeout=3e4,this.maxTimeout=10*this.defaultTimeout,this.timeout=this.defaultTimeout,this.status=!0,this.sto=null,this.maxRetry=10,this.retryCount=0,this.LastReportTime=0,this.visible=!0,this._heartbeatLifecycle="live"}var e,i;return e=t,(i=[{key:"beat",value:function(t){var e=this;clearTimeout(this.sto);var i={LastReportTime:this.LastReportTime,HeartbeatVersion:"2.0",RoomId:this.classId,HeartbeatList:[{BusinessType:"whiteboard",Submodule:"",CustomData:{Event:t}}],ClientVersion:o.VERSION,NewEnterId:this.newEnterId,UserAgent:navigator?navigator.userAgent:"",BackgroundState:this.visible?0:1};if("destroy"===this._heartbeatLifecycle)return Promise.reject();var r=h.getTimeStamp(),n=this.$request.heartbeat(i);return h.isPromise(n)?n.then((function(t){t.data.Response&&!t.data.Response.Error?(e.retryCount=0,e.LastReportTime=t.data.Response.ReportTime,e.timeout=1e3*t.data.Response.IntervalTime,e.trigger()):(e.retryCount++,e.timeout=Math.min(Math.ceil(e.retryCount/10)*e.defaultTimeout,e.maxTimeout),e.trigger(),e.reportElk(r,t.data))})).catch((function(t){e.retryCount++,e.timeout=Math.min(Math.ceil(e.retryCount/10)*e.defaultTimeout,e.maxTimeout),e.trigger(),e.reportElk(r,t)})):Promise.reject()}},{key:"trigger",value:function(){var t=this;clearTimeout(this.sto),this.sto=setTimeout((function(){t.beat(null).catch((function(t){}))}),this.timeout||this.defaultTimeout)}},{key:"setClassId",value:function(t){this.classId=Number(t)}},{key:"setVisible",value:function(t){this.visible=t;var e=[{name:t?"visible":"unvisible",timestamp:h.getSecondTime()}];this.beat(e).catch((function(t){}))}},{key:"start",value:function(){var t=[{name:"init",timestamp:h.getSecondTime()}];this.beat(t).catch((function(t){}))}},{key:"pause",value:function(){this.status=!1,clearTimeout(this.sto)}},{key:"resume",value:function(){this.status=!0,this.beat(null).catch((function(t){}))}},{key:"destroy",value:function(){var t=this,e=[{name:"uninit",timestamp:h.getSecondTime()}];this.beat(e).then((function(){t._heartbeatLifecycle="destroy",clearTimeout(t.sto)})).catch((function(){t._heartbeatLifecycle="destroy",clearTimeout(t.sto)}))}},{key:"reportElk",value:function(t,e){this.elkLog.report("heartbeat_error",{time_consume:h.getTimeStamp()-t,extra_info:JSON.stringify({retryCount:this.retryCount,error:e})})}}])&&I(e.prototype,i),t}();function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var R={TEDU_BOARD_IMAGE_FIT_MODE_CENTER:0,TEDU_BOARD_IMAGE_FIT_MODE_LEFT:4,TEDU_BOARD_IMAGE_FIT_MODE_TOP:5,TEDU_BOARD_IMAGE_FIT_MODE_RIGHT:6,TEDU_BOARD_IMAGE_FIT_MODE_BOTTOM:7};"object"===("undefined"==typeof window?"undefined":w(window))&&(window.TEduBoardImageFitMode=R);var C=R;function B(t,e){this.request=t,this.elkLog=e}B.prototype.setPreCallback=function(t){this.preCallback=t},B.prototype.setCallback=function(t){this.callback=t},B.prototype.reportCreateBoards=function(t,e){var i,r=this;if(0!==(i=Array.isArray(e)?e:[e]).length){var o=h.getTimeStamp();this.reportMsg([{type:"createBoards",seq:a.getSeq(),content:{fid:h.boardId2Fid(i[0]),createBoards:i,updateTime:h.getTimeStamp()}}],(function(e){e.ErrorCode||e.error_code?r.elkLog.boardAction("createBoards",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:h.getTimeDiff(o),boardid:t,boardid_list:i,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):r.elkLog.boardAction("createBoards",{action_result:0,action_info:null,time_consume:h.getTimeDiff(o),boardid:t,boardid_list:i,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}),(function(e){r.elkLog.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:h.getTimeDiff(o),boardid:t,boardid_list:i,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}))}},B.prototype.reportDeleteBoard=function(t,e){var i=this,r=h.getTimeStamp();this.reportMsg([{type:"deleteBoards",seq:a.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:h.getTimeStamp()}}],(function(o){o.ErrorCode||o.error_code?i.elkLog.boardAction("deleteBoards",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:h.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):i.elkLog.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:h.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})}),(function(o){i.elkLog.boardAction("deleteBoards",{action_result:-9999,action_info:o&&o.message,time_consume:h.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})}))},B.prototype.reportSetBoardBgColor=function(t,e){var i=this,r=h.getTimeStamp();this.reportMsg([{type:"setBoardBG",seq:a.getSeq(),content:{boardId:t,updateTime:h.getTimeStamp(),colorRGBA:e}}],(function(o){o.ErrorCode||o.error_code?i.elkLog.boardAction("setBoardBG",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:h.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):i.elkLog.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:h.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})}),(function(o){i.elkLog.boardAction("setBoardBG",{action_result:-9999,action_info:o&&o.message,time_consume:h.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})}))},B.prototype.reportClear=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"clean",seq:a.getSeq(),content:{boardId:t,updateTime:h.getTimeStamp()}}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("clean",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("clean",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}),(function(r){e.elkLog.boardAction("clean",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}))},B.prototype.reportClearDraws=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"cleanDraws",seq:a.getSeq(),content:{boardId:t,updateTime:h.getTimeStamp()}}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("cleanDraws",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}),(function(r){e.elkLog.boardAction("cleanDraws",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}))},B.prototype.reportImage=function(t,e){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.BACKGROUND_TYPE.IMAGE,n=h.getTimeStamp();this.reportMsg([{type:"image",seq:a.getSeq(),content:{fid:h.boardId2Fid(t),boardId:t,url:e,updateTime:h.getTimeStamp(),type:o,mode:r}}],(function(r){var o={};o[t]=e,r.ErrorCode||r.error_code?i.elkLog.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(n),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null}):i.elkLog.boardAction("image",{action_result:0,action_info:null,time_consume:h.getTimeDiff(n),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})}),(function(r){var o={};o[t]=e,i.elkLog.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(n),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})}))},B.prototype.reportImages=function(t){for(var e=this,i=h.getTimeStamp(),r=0,o=Math.ceil(t.length/100);r<o;r++){var n;n=t.slice(100*r,100*(r+1)),this.reportMsg(n,(function(r){var o=[];t.forEach((function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)})),r.ErrorCode||r.error_code?e.elkLog.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("image",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})}),(function(r){var o=[];t.forEach((function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)})),e.elkLog.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})}))}},B.prototype.reportSwitchBoard=function(t){var e=this,i=t.boardId,r=t.fid,o=t.url,n=t.type,s=t.page,l=t.step,d=t.ratio,c=t.scale,u=h.getTimeStamp();this.reportMsg([{type:"switchBoard",seq:a.getSeq(),content:{boardId:i,fid:r,url:o,type:n,page:s,step:l,ratio:d,scale:c,updateTime:h.getTimeStamp()}}],(function(t){t.ErrorCode||t.error_code?e.elkLog.boardAction("switchBoard",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:h.getTimeDiff(u),boardid:i,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:h.getTimeDiff(u),boardid:i,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}),(function(t){e.elkLog.boardAction("switchBoard",{action_result:-9999,action_info:t&&t.message,time_consume:h.getTimeDiff(u),boardid:i,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}))},B.prototype.reportGlobalBgColor=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"setGlobalBG",seq:a.getSeq(),content:{updateTime:h.getTimeStamp(),colorRGBA:t}}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("setGlobalBG",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):e.elkLog.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})}),(function(r){e.elkLog.boardAction("setGlobalBG",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})}))},B.prototype.reportAddLine=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"addLine",seq:a.getSeq(),content:t}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("addLine",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})}):e.elkLog.boardAction("addLine",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})})}),(function(r){e.elkLog.boardAction("addLine",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})})}))},B.prototype.reportAddText=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"addText",seq:a.getSeq(),content:t}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("addText",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,text:t.text}):e.elkLog.boardAction("addText",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,text:t.text})}),(function(r){e.elkLog.boardAction("addText",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,text:t.text})}))},B.prototype.reportDisplayLine=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"displayLine",seq:a.getSeq(),content:t}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("displayLine",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):e.elkLog.boardAction("displayLine",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})}),(function(r){e.elkLog.boardAction("displayLine",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})}))},B.prototype.reportGraphData=function(t){var e=this,i=h.getTimeStamp();this.reportMsg(t,(function(r){t.forEach((function(t){r.ErrorCode||r.error_code?e.elkLog.boardAction(t.type,{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):e.elkLog.boardAction(t.type,{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})}))}),(function(r){t.forEach((function(t){e.elkLog.boardAction(t.type,{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})}))}))},B.prototype.reportAddFile=function(t){var e=this,i=t.fid,r=t.title,n=t.downloadURL,s=t.pageCount,l=t.currentPageIndex,d=t.currentPageStep,c=t.uid,u=t.timestamp,p=t.platform,f=t.type,g=t.ratio,_=t.scale?Math.floor(t.scale):t.scale,m=t.isTranscodeFile,y=t.status,T=t.progress,v=t.isUpdateScale||0,E=h.getTimeStamp();this.reportMsg([{type:"addFile",seq:a.getSeq(),content:{updateTime:h.getTimeStamp(),fid:i,title:r,downloadURL:n,pageCount:s,currentPageIndex:l,currentPageStep:d,uid:c,timestamp:u,platform:p||o.PLATFORM,type:f||o.FILE_TYPE.IMG,ratio:g,scale:_,isTranscodeFile:m,status:y,progress:T,isUpdateScale:v}}],(function(t){t.ErrorCode||t.error_code?e.elkLog.boardAction("addFile",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:h.getTimeDiff(E),extra_info:JSON.stringify({downloadURL:n,pageCount:s,currentPageIndex:l,currentPageStep:d,uid:c,timestamp:u,platform:p||o.PLATFORM,type:f||o.FILE_TYPE.IMG,ratio:g,scale:_,isTranscodeFile:m,status:y,progress:T,isUpdateScale:v}),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:i,file_title:r}):e.elkLog.boardAction("addFile",{action_result:0,action_info:null,time_consume:h.getTimeDiff(E),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:i,file_title:r,extra_info:JSON.stringify({downloadURL:n,pageCount:s,currentPageIndex:l,currentPageStep:d,uid:c,timestamp:u,platform:p||o.PLATFORM,type:f||o.FILE_TYPE.IMG,ratio:g,scale:_,isTranscodeFile:m,status:y,progress:T,isUpdateScale:v})})}),(function(t){e.elkLog.boardAction("addFile",{action_result:-9999,action_info:t&&t.message,time_consume:h.getTimeDiff(E),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:i,file_title:r,extra_info:JSON.stringify({downloadURL:n,pageCount:s,currentPageIndex:l,currentPageStep:d,uid:c,timestamp:u,platform:p||o.PLATFORM,type:f||o.FILE_TYPE.IMG,ratio:g,scale:_,isTranscodeFile:m,status:y,progress:T,isUpdateScale:v})})}))},B.prototype.reportDeleteFile=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"deleteFile",seq:a.getSeq(),content:{fid:t,updateTime:h.getTimeStamp()}}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("deleteFile",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):e.elkLog.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})}),(function(r){e.elkLog.boardAction("deleteFile",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})}))},B.prototype.reportDrag=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"drag",seq:a.getSeq(),content:t}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("drag",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),extra_info:JSON.stringify(t)}):e.elkLog.boardAction("drag",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),extra_info:JSON.stringify(t)})}),(function(r){e.elkLog.boardAction("drag",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),extra_info:JSON.stringify(t)})}))},B.prototype.reportsetBoardRatio=function(t){var e=this,i=h.getTimeStamp();this.reportMsg([{type:"setRatio",seq:a.getSeq(),content:t}],(function(r){r.ErrorCode||r.error_code?e.elkLog.boardAction("setRatio",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:h.getTimeDiff(i),extra_info:JSON.stringify(t)}):e.elkLog.boardAction("setRatio",{action_result:0,action_info:null,time_consume:h.getTimeDiff(i),extra_info:JSON.stringify(t)})}),(function(r){e.elkLog.boardAction("setRatio",{action_result:-9999,action_info:r&&r.message,time_consume:h.getTimeDiff(i),extra_info:JSON.stringify(t)})}))},B.prototype.reportsetBoardContentFitMode=function(t){this.reportMsg([{type:"setBoardContentFitMode",seq:a.getSeq(),content:t}],(function(t){}),(function(t){}))},B.prototype.reportImageElement=function(t){var e=[];h.isArray(t)?t.forEach((function(t){e.push({type:"imageElement",seq:a.getSeq(),content:t})})):e.push({type:"imageElement",seq:a.getSeq(),content:t}),this.reportMsg(e,(function(t){}),(function(t){}))},B.prototype.reportElement=function(t){var e=[];h.isArray(t)?t.forEach((function(t){e.push({type:t.type,seq:a.getSeq(),content:t.property})})):e.push({type:t.type,seq:a.getSeq(),content:t.property}),this.reportMsg(e,(function(t){}),(function(t){}))},B.prototype.reportCleanAll=function(){var t=this,e=h.getTimeStamp();this.reportMsg([{type:"cleanAll",seq:a.getSeq()}],(function(i){i.ErrorCode||i.error_code?t.elkLog.boardAction("cleanAll",{action_result:i.ErrorCode?"ErrorCode:".concat(i.ErrorCode):"error_code:".concat(i.error_code),action_info:i.ErrorInfo||i.error_msg,time_consume:h.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):t.elkLog.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:h.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}),(function(i){t.elkLog.boardAction("cleanAll",{action_result:-9999,action_info:i&&i.message,time_consume:h.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})}))},B.prototype.reportMsg=function(t,e,i){var r=this;this.preCallback&&this.preCallback(t),this.request.reportMsg(t,(function(i){e&&e(i),r.callback&&r.callback(t,null)}),(function(e){i&&i(e),r.callback&&r.callback(t,e)}))};var L=B,P={postMessage:function(t,e){t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")},init:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"init",data:e},"*")},gotoNextStep:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"next_step_new",data:e},"*")},gotoPreviousStep:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"prev_step_new",data:e},"*")},gotoTimestampNew:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_timestamp_new",data:{slideIndex:e.slideIndex,stepIndex:e.stepIndex,resetStep:e.resetStep,usePrevNextStepMethod:e.usePrevNextStepMethod,isPassive:e.isPassive}},"*")},clearIframeCache:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"clear_cache"},"*")},setFid:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"set_fid",data:e},"*")},pptAction:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"ppt_action",data:e},"*")},sendMouseEvent:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"mouse_event",data:e},"*")}};function N(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var M=function(){function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardId=e||"",this.backgroundUrl="",i&&(this.backgroundUrl=i.url||""),this.backgroundColor=r||""}var e,i;return e=t,(i=[{key:"setBoardId",value:function(t){this.boardId=t}},{key:"setBackgroundUrl",value:function(t){this.backgroundUrl=t}},{key:"getBoardId",value:function(){return this.boardId}},{key:"getBackgroundUrl",value:function(){return this.backgroundUrl}},{key:"setBackgroundColor",value:function(t){this.backgroundColor=t}},{key:"getBackgroundColor",value:function(){return this.backgroundColor}}])&&N(e.prototype,i),t}(),k={TEDU_BOARD_ERROR_INIT:1,TEDU_BOARD_ERROR_AUTH:2,TEDU_BOARD_ERROR_LOAD:3,TEDU_BOARD_ERROR_HISTORYDATA:6,TEDU_BOARD_ERROR_RUNTIME:7,TEDU_BOARD_ERROR_AUTH_TIMEOUT:8},q={TEDU_BOARD_FILE_FIT_MODE_NONE:0,TEDU_BOARD_FILE_FIT_MODE_CENTER_INSIDE:1,TEDU_BOARD_FILE_FIT_MODE_CENTER_COVER:2},U={TEDU_BOARD_LINE_TYPE_SOLID:1,TEDU_BOARD_LINE_TYPE_DOTTED:2},F={TEDU_BOARD_TEXT_STYLE_NORMAL:0,TEDU_BOARD_TEXT_STYLE_BOLD:1,TEDU_BOARD_TEXT_STYLE_ITALIC:2,TEDU_BOARD_TEXT_STYLE_BOLD_ITALIC:3};function H(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var G=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.action=o.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION,this.scale=e.scale,this.xOffset=e.xOffset||50,this.yOffset=e.yOffset||50}var e,i;return e=t,(i=[{key:"update",value:function(t){Object.assign(this,t),this.scale=Math.floor(this.scale),(h.isNull(this.xOffset)||isNaN(this.xOffset))&&(this.xOffset=50),(h.isNull(this.yOffset)||isNaN(this.yOffset))&&(this.yOffset=50)}},{key:"getReportData",value:function(){return(h.isNull(this.xOffset)||isNaN(this.xOffset))&&(this.xOffset=50),(h.isNull(this.yOffset)||isNaN(this.yOffset))&&(this.yOffset=50),{updateTime:h.getSecondTime(),xOffset:Number(this.xOffset.toFixed(4)),yOffset:Number(this.yOffset.toFixed(4)),scale:Math.floor(this.scale)}}},{key:"getRealTimeData",value:function(){return(h.isNull(this.xOffset)||isNaN(this.xOffset))&&(this.xOffset=50),(h.isNull(this.yOffset)||isNaN(this.yOffset))&&(this.yOffset=50),{action:this.action,time:h.getTimeStamp(),seq:a.getSeq(),scale:Math.floor(this.scale),xOffset:Number(this.xOffset.toFixed(4)),yOffset:Number(this.yOffset.toFixed(4))}}}])&&H(e.prototype,i),t}();function W(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var V=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data={},this.maxSeqDragData={}}var e,i;return e=t,(i=[{key:"addMaxSeqDragData",value:function(t){this.maxSeqDragData={scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}}},{key:"addDragData",value:function(t,e){this.data[t]||(this.data[t]=e)}},{key:"getDragDataByFid",value:function(t){var e=[];for(var i in this.data)h.boardId2Fid(i)===t&&e.push({bid:i,data:this.data[i]});return e}},{key:"getDragData",value:function(t){return this.data[t]}},{key:"updateDragData",value:function(t,e){this.data[t].update(e)}}])&&W(e.prototype,i),t}(),Y={TEDU_BOARD_OVAL_DRAW_MODE_FIX_START:1,TEDU_BOARD_OVAL_DRAW_MODE_FIX_CENTER:2};function X(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var z=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.user=null,this.type="element",this.left=0,this.top=0,this.x=0,this.y=0,this.container=null,this.width=0,this.height=0,this.boardWidth=0,this.boardHeight=0,this.show=!0,this.rectArea={maxX:0,maxY:0,minX:0,minY:0}}var e,i;return e=t,(i=[{key:"setBoardSize",value:function(t,e){this.boardWidth=t,this.boardHeight=e,this.left=this.boardWidth*this.x/1e4,this.top=this.boardHeight*this.y/1e4}},{key:"getRealTimeData",value:function(){}},{key:"getReportData",value:function(){}},{key:"realDataToVirtualData",value:function(t){return{x:1e4*t.x/this.boardWidth,y:1e4*t.y/this.boardHeight}}},{key:"virtualDataToRealData",value:function(t){return{x:t.x*this.boardWidth/1e4,y:t.y*this.boardHeight/1e4}}},{key:"impactCheck",value:function(t,e,i){return t>this.rectArea.minX&&e>this.rectArea.minY&&t<this.rectArea.maxX&&e<this.rectArea.maxY}}])&&X(e.prototype,i),t}();function j(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var J=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scaleBasePoint=1,this.boardId=e.boardId,this.type="imageElement",this.show=e.show,this.user=e.user,this.belongSeq=e.belongSeq,this.seq=e.seq,this.url=e.url,this.width=e.width,this.height=e.height,this.time=e.time||h.getTimeStamp(),this.x=e.x||0,this.y=e.y||0,this.focusStatus="blur",this.container=null,this.boardWidth=0,this.boardHeight=0,this.deg=e.deg||0,this.rectArea={maxX:0,maxY:0,minX:0,minY:0},this.pointArr=[]}var e,i;return e=t,(i=[{key:"setBoardSize",value:function(t,e){this.boardWidth=t,this.boardHeight=e,this.left=this.boardWidth*this.x/1e4,this.top=this.boardHeight*this.y/1e4}},{key:"getImageSize",value:function(t,e,i,r){var o=this;this.boardWidth=t,this.boardHeight=e;var n=new Image;n.onload=function(s){n.onload=null;var a=0,l=0;n.naturalWidth<=t&&n.naturalHeight<=e?(a=n.naturalWidth,l=n.naturalHeight):t/e>n.naturalWidth/n.naturalHeight?(a=n.naturalWidth*e/n.naturalHeight,l=e,a/=2,l/=2):(a=t,l=n.naturalHeight*t/n.naturalWidth,a/=2,l/=2),i/=100,o.width=1e4*a/o.boardWidth/i,o.height=1e4*l/o.boardHeight/i,o.x=5e3-o.width/2,o.y=5e3-o.height/2,r&&r()},n.src=this.url}},{key:"getRealTimeData",value:function(){return{action:o.PROTOCOL_ACTION.IMAGE_ELEMENT,seq:a.getSeq(),belongSeq:this.belongSeq,url:this.url,time:this.time,show:this.show,x:1*this.x.toFixed(4),y:1*this.y.toFixed(4),width:1*this.width.toFixed(4),height:1*this.height.toFixed(4),deg:this.deg}}},{key:"getReportData",value:function(){return{uid:this.user,boardId:this.boardId,belongSeq:this.belongSeq,url:this.url,time:this.time,x:1*this.x.toFixed(4),y:1*this.y.toFixed(4),width:1*this.width.toFixed(4),height:1*this.height.toFixed(4),updateTime:h.getTimeStamp(),hidden:1*!this.show,deg:this.deg}}},{key:"renderTo",value:function(t){this.container=t;var e="tic_image_element_".concat(this.belongSeq),i=t.querySelector("#".concat(e));if(i)this.left=this.x*this.boardWidth/1e4,this.top=this.y*this.boardHeight/1e4,i.style.left=this.left+"px",i.style.top=this.top+"px",i.style.width=this.width*this.boardWidth/1e4+"px",i.style.height=this.height*this.boardHeight/1e4+"px",i.style.transform="rotate(".concat(this.deg,"deg)"),i.style.webkitTransform="rotate(".concat(this.deg,"deg)"),this.imageWrap=i;else{var r=document.createElement("img");r.src=this.url,r.dataset.belongSeq=this.belongSeq,r.dataset.imageElement=!0,r.setAttribute("style","width:100%;height:100%;"),(i=document.createElement("div")).dataset.belongSeq=this.belongSeq,i.dataset.imageElement=!0,i.dataset.boardId=this.boardId,i.id=e,i.setAttribute("style","position:absolute;left:".concat(this.left,"px;top:").concat(this.top,"px;margin:0;padding:0;width:").concat(this.width*this.boardWidth/1e4,"px;height:").concat(this.height*this.boardHeight/1e4,"px;border:1px dotted transparent;cursor:move;transform:rotate(").concat(this.deg,"deg);-webkit-transform:rotate(").concat(this.deg,"deg)")),i.appendChild(r),t.appendChild(i),this.imageWrap=i}this._updateRectArea()}},{key:"setPosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0!==e||0!==i){if(!t){var r=24e4/this.boardWidth,o=24e4/this.boardHeight;this.width<=r&&(e=0),this.height<=o&&(i=0)}this.left+=e,this.top+=i,this.x=1e4*this.left/this.boardWidth,this.y=1e4*this.top/this.boardHeight,this.imageWrap.style.left=this.left+"px",this.imageWrap.style.top=this.top+"px",this._updateRectArea()}}},{key:"setSize",value:function(t,e){if(0!==t||0!==e){this.width+=1e4*t/this.boardWidth,this.height+=1e4*e/this.boardHeight;var i=24e4/this.boardWidth,r=24e4/this.boardHeight;this.width=Math.max(i,this.width),this.height=Math.max(r,this.height),this.imageWrap.style.width=this.width*this.boardWidth/1e4+"px",this.imageWrap.style.height=this.height*this.boardHeight/1e4+"px",this._updateRectArea()}}},{key:"setRotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.deg=t,this.imageWrap.style.transform="rotate(".concat(this.deg,"deg)"),this.imageWrap.style.webkitTransform="rotate(".concat(this.deg,"deg)"),this._updateRectArea()}},{key:"_updateRectArea",value:function(){this.pointArr=[];var t=this._calcRotateXY(this.x,this.y);this.pointArr.push([t.x,t.y]);var e=t.x,i=t.y;t=this._calcRotateXY(this.x+this.width,this.y),this.pointArr.push([t.x,t.y]);var r=t.x,o=t.y;t=this._calcRotateXY(this.x+this.width,this.y+this.height),this.pointArr.push([t.x,t.y]);var n=t.x,s=t.y;t=this._calcRotateXY(this.x,this.y+this.height),this.pointArr.push([t.x,t.y]);var a=t.x,l=t.y;this.rectArea={minX:Math.min(e,r,a,n),minY:Math.min(i,o,l,s),maxX:Math.max(e,r,a,n),maxY:Math.max(i,o,l,s)}}},{key:"_calcRotateXY",value:function(t,e){var i=this.width*this.boardWidth/1e4,r=this.height*this.boardHeight/1e4,o=this.x*this.boardWidth/1e4+i/2,n=this.y*this.boardHeight/1e4+r/2,s=t*this.boardWidth/1e4,a=e*this.boardHeight/1e4,l=this.deg*(Math.PI/180),h=(s-o)*Math.cos(l)-(a-n)*Math.sin(l)+o,d=(s-o)*Math.sin(l)+(a-n)*Math.cos(l)+n;return{x:1e4*h/this.boardWidth,y:1e4*d/this.boardHeight,ox:h,oy:d}}},{key:"getRealSize",value:function(){return{left:this.left,top:this.top,width:this.width*this.boardWidth/1e4,height:this.height*this.boardHeight/1e4}}},{key:"remove",value:function(){this.imageWrap&&this.imageWrap.remove()}},{key:"pointImpactCheck",value:function(t){return h.isInPolygon(t,this.pointArr)}},{key:"impactCheck",value:function(t,e,i){return t>this.rectArea.minX&&e>this.rectArea.minY&&t<this.rectArea.maxX&&e<this.rectArea.maxY}},{key:"getBoardId",value:function(){return this.boardId}}])&&j(e.prototype,i),t}(),K=(i(96),i(97),{TIW_H5WEB_SYNC:"TIW_H5WEB_SYNC",TIW_H5WEB_ACK:"TIW_H5WEB_ACK",TIW_H5WEB_DATA:"TIW_H5WEB_DATA",TIW_H5WEB_PERMISSION:"TIW_H5WEB_PERMISSION",TIW_H5WEB_SNAPSHOT:"TIW_H5WEB_SNAPSHOT"}),Z="TIW_H5WEB",Q="tx_h5_postmessage",$={TEDU_BOARD_ELEMENT_IMAGE:1,TEDU_BOARD_ELEMENT_H5:2,TEDU_BOARD_ELEMENT_CUSTOM_GRAPH:3,TEDU_BOARD_ELEMENT_AUDIO:4,TEDU_BOARD_ELEMENT_GLOBAL_AUDIO:5};function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function rt(t){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(n,z);var e,i,r=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=rt(t);if(e){var o=rt(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return function(t,e){return!e||"object"!==tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,i)}}(n);function n(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(e=r.call(this)).subType=$.TEDU_BOARD_ELEMENT_H5,e.boardId=t.boardId,e.belongSeq=t.belongSeq,e.url=t.url,e.user=t.user,e.onloadDone=t.onloadDone,e.data=null,e.dataChanged=!1,e}return e=n,(i=[{key:"setProperty",value:function(t){this.show=t.show,this.seq=t.seq,this.width=t.width||0,this.height=t.height||0,this.time=t.time||h.getTimeStamp(),this.x=t.x||0,this.y=t.y||0,this.container=null,t.data&&(this.data=t.data)}},{key:"updateData",value:function(t){this.dataChanged=!0,this.data=t}},{key:"setBoardSize",value:function(t,e){this.boardWidth=t,this.boardHeight=e,this.left=this.boardWidth*this.x/1e4,this.top=this.boardHeight*this.y/1e4,this._updateRectArea()}},{key:"setElementSize",value:function(t){this.width=1e4,this.height=1e4,this._updateRectArea()}},{key:"renderTo",value:function(t,e){this.container=t;var i="tiw_h5web_element_".concat(this.belongSeq),r=t.querySelector("#".concat(i)),o="position:absolute;left:".concat(this.x,";top:").concat(this.y,";width: 100%;height:100%;border:none;");e||(o+="pointer-events:none"),r?r.setAttribute("style",o):(this.el=document.createElement("iframe"),this.el.id=i,this.el.setAttribute("class","tiw-board-iframe-el"),this.el.setAttribute("style",o),this.el.scrolling="auto",this.el.src=this.url,this.el.dataset.bid=this.boardId,this.el.dataset.belongSeq=this.belongSeq,this.el.setAttribute("name",JSON.stringify({id:this.belongSeq})),this.el.onload=this._onloadCallback.bind(this),t.appendChild(this.el))}},{key:"_onloadCallback",value:function(){this.postMessage(this.data),this._updateRectArea(),this.onloadDone&&this.onloadDone(),this.onloadDone=null}},{key:"remove",value:function(){this.el&&this.el.remove()}},{key:"getRealTimeData",value:function(){return{action:o.PROTOCOL_ACTION.H5Web_ELEMENT,belongSeq:this.belongSeq,seq:a.getSeq(),boardId:this.boardId,url:this.url,time:this.time,show:this.show,x:1*this.x.toFixed(4),y:1*this.y.toFixed(4),width:1*this.width.toFixed(4),height:1*this.height.toFixed(4)}}},{key:"_updateRectArea",value:function(){this.rectArea={minX:this.x,minY:this.y,maxX:this.x+this.width,maxY:this.y+this.height}}},{key:"getReportData",value:function(){var t={type:this.type,property:{subType:this.subType,uid:this.user,boardId:this.boardId,belongSeq:this.belongSeq,url:this.url,time:this.time,x:1*this.x.toFixed(4),y:1*this.y.toFixed(4),width:1*this.width.toFixed(4),height:1*this.height.toFixed(4),updateTime:h.getTimeStamp(),hidden:1*!this.show}};return this.dataChanged&&(t.property.data=this.data,this.dataChanged=!1),t}},{key:"getRealSize",value:function(){return{left:this.left,top:this.top,width:this.width*this.boardWidth/1e4,height:this.height*this.boardHeight/1e4}}},{key:"postMessage",value:function(t){this.el.contentWindow.postMessage({module:Z,cmd:K.TIW_H5WEB_DATA,data:t},"*")}},{key:"getBoardId",value:function(){return this.boardId}}])&&et(e.prototype,i),n}();function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function st(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function at(t,e){return(at=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function lt(t){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&at(t,e)}(n,z);var e,i,r=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=lt(t);if(e){var o=lt(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return function(t,e){return!e||"object"!==nt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,i)}}(n);function n(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(e=r.call(this)).userData=t.userData,e.scaleBasePoint=0,e.subType=$.TEDU_BOARD_ELEMENT_CUSTOM_GRAPH,e.container=null,e.width=0,e.height=0,e.realLeft=0,e.realTop=0,e.boardWidth=t.boardWidth||0,e.boardHeight=t.boardHeight||0,e.boardScale=(t.boardScale||100)/100,e.boardId=t.boardId,e.show=t.show,e.user=t.user,e.belongSeq=t.belongSeq,e.seq=t.seq,e.url=t.url,e.time=t.time||h.getTimeStamp(),e.x=t.x||0,e.y=t.y||0,e.naturalWidth=t.naturalWidth||0,e.naturalHeight=t.naturalHeight||0,e.realWidth=e.naturalWidth,e.realHeight=e.naturalHeight,e.deg=t.deg||0,e.naturalWidth&&e.naturalHeight?(e.scaleX=(t.scaleX||1)*e.boardWidth/e.naturalWidth,e.scaleY=(t.scaleY||1)*e.boardHeight/e.naturalHeight):(e.scaleX=1,e.scaleY=1),e.rectArea={maxX:0,maxY:0,minX:0,minY:0},e.originLeft=e.boardWidth*e.x/1e4/e.boardScale,e.originTop=e.boardHeight*e.y/1e4/e.boardScale;var i=e.naturalWidth/2*(1-e.scaleX),o=e.naturalHeight/2*(1-e.scaleY);return e.realLeft=e.originLeft-i,e.realTop=e.originTop-o,e}return e=n,(i=[{key:"setScaleXY",value:function(t,e){this.naturalWidth&&this.naturalHeight?(this.scaleX=(t||1)*this.boardWidth/this.naturalWidth,this.scaleY=(e||1)*this.boardHeight/this.naturalHeight):(this.scaleX=1,this.scaleY=1)}},{key:"setBoardSizeScale",value:function(t,e,i){this.boardWidth=t,this.boardHeight=e,this.boardScale=i/100,this._setStyle(),this._updateRectArea()}},{key:"getImageSize",value:function(t,e,i){var r=this;this.boardWidth=t,this.boardHeight=e;var o=new Image;o.onload=function(t){o.onload=null,r.naturalWidth=o.naturalWidth,r.naturalHeight=o.naturalHeight,r.realWidth=r.naturalWidth,r.realHeight=r.naturalHeight,r._addElementCalcSize(r.width,r.height)},o.src=this.url}},{key:"getRealTimeData",value:function(){return{action:o.PROTOCOL_ACTION.CUSTOM_GRAPH_ELEMENT,seq:a.getSeq(),belongSeq:this.belongSeq,url:this.url,time:this.time,show:this.show,x:this.x,y:this.y,deg:this.deg,scaleX:this.scaleX*this.naturalWidth/this.boardWidth,scaleY:this.scaleY*this.naturalHeight/this.boardHeight,naturalWidth:this.naturalWidth,naturalHeight:this.naturalHeight}}},{key:"getReportData",value:function(){return{type:this.type,property:{subType:this.subType,uid:this.user,boardId:this.boardId,belongSeq:this.belongSeq,url:this.url,time:this.time,hidden:1*!this.show,x:this.x,y:this.y,deg:this.deg,scaleX:this.scaleX*this.naturalWidth/this.boardWidth,scaleY:this.scaleY*this.naturalHeight/this.boardHeight,naturalWidth:this.naturalWidth,naturalHeight:this.naturalHeight}}}},{key:"renderTo",value:function(t){this.container=t;var e="tic_custom_graph_element_".concat(this.belongSeq),i=t.querySelector("#".concat(e));if(i)this.imageWrap=i;else{var r=document.createElement("img");r.src=this.url,r.dataset.belongSeq=this.belongSeq,r.dataset.imageElement=!0,r.setAttribute("style","width:100%;height:100%;"),(i=document.createElement("div")).dataset.belongSeq=this.belongSeq,i.dataset.imageElement=!0,i.dataset.boardId=this.boardId,i.id=e,i.appendChild(r),t.appendChild(i),this.imageWrap=i}this._setStyle(),this._updateRectArea()}},{key:"_setStyle",value:function(){this.originLeft=this.boardWidth*this.x/1e4/this.boardScale,this.originTop=this.boardHeight*this.y/1e4/this.boardScale;var t=this.naturalWidth/2*(1-this.scaleX),e=this.naturalHeight/2*(1-this.scaleY);this.realLeft=this.originLeft-t,this.realTop=this.originTop-e;var i=this.realLeft*this.boardScale+(this.boardScale-1)*this.realWidth/2,r=this.realTop*this.boardScale+(this.boardScale-1)*this.realHeight/2,o=this.scaleX*this.boardScale,n=this.scaleY*this.boardScale;this.imageWrap&&this.imageWrap.setAttribute("style","position:absolute;left:".concat(i,"px;top:").concat(r,"px;margin:0;padding:0;\n      width:").concat(this.realWidth,"px;height:").concat(this.realHeight,"px;border:1px dotted transparent;cursor:move;\n      transform:rotate(").concat(this.deg,"deg) scale(").concat(o,",").concat(n,");\n      -webkit-transform:rotate(").concat(this.deg,"deg) scale(").concat(o,",").concat(n,")"))}},{key:"setPosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;0===e&&0===i||(t||(this.boardWidth,this.boardHeight),this.realLeft+=e/this.boardScale,this.realTop+=i/this.boardScale,this.x+=1*(1e4*e*this.boardScale/this.boardWidth).toFixed(4),this.y+=1*(1e4*i*this.boardScale/this.boardHeight).toFixed(4),this._setStyle(),this._updateRectArea())}},{key:"setWidthHeight",value:function(t,e){this._addElementCalcSize(t,e)}},{key:"setSize",value:function(t,e){0===t&&0===e||(this.scaleX=1*((this.realWidth*this.scaleX+t/this.boardScale)/this.realWidth).toFixed(4),this.scaleY=1*((this.realHeight*this.scaleY+e/this.boardScale)/this.realHeight).toFixed(4),this._setStyle(),this._updateRectArea())}},{key:"setRotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.deg=t,this._setStyle(),this._updateRectArea()}},{key:"_updateRectArea",value:function(){var t=this.realLeft*this.boardScale+(this.boardScale-1)*this.realWidth/2,e=this.realTop*this.boardScale+(this.boardScale-1)*this.realHeight/2,i=this.scaleX*this.boardScale,r=this.scaleY*this.boardScale,o=t-this.realWidth*(i-1)/2,n=e-this.realHeight*(r-1)/2,s=this._calcRotateXY(o,n),a=s.x,l=s.y,h=t+this.realWidth+this.realWidth*(i-1)/2,d=n,c=(s=this._calcRotateXY(h,d)).x,u=s.y,p=o,f=e+this.realHeight+this.realHeight*(r-1)/2,g=(s=this._calcRotateXY(p,f)).x,_=s.y,m=h,y=f,T=(s=this._calcRotateXY(m,y)).x,v=s.y;this.rectArea={minX:Math.min(a,c,g,T),minY:Math.min(l,u,_,v),maxX:Math.max(a,c,g,T),maxY:Math.max(l,u,_,v)}}},{key:"_calcRotateXY",value:function(t,e){var i=this.realLeft*this.boardScale+(this.boardScale-1)*this.realWidth/2,r=this.realTop*this.boardScale+(this.boardScale-1)*this.realHeight/2,o=i+this.realWidth/2,n=r+this.realHeight/2,s=t,a=e,l=this.deg*(Math.PI/180),h=(s-o)*Math.cos(l)-(a-n)*Math.sin(l)+o,d=(s-o)*Math.sin(l)+(a-n)*Math.cos(l)+n;return{x:1e4*h/this.boardWidth,y:1e4*d/this.boardHeight,ox:h,oy:d}}},{key:"_addElementCalcSize",value:function(t,e){if(this.naturalWidth&&this.naturalHeight){this.width=1e4*this.naturalWidth/this.boardWidth,this.height=1e4*this.naturalHeight/this.boardHeight;var i=t/this.width,r=e/this.height;this.scaleX=1*(i/this.boardScale).toFixed(4),this.scaleY=1*(r/this.boardScale).toFixed(4);var o=this.naturalWidth/2*(1-this.scaleX),n=this.naturalHeight/2*(1-this.scaleY);this.realLeft=this.originLeft-o,this.realTop=this.originTop-n}else this.width=t,this.height=e}},{key:"getRealSize",value:function(){var t=this.realLeft*this.boardScale+(this.boardScale-1)*this.realWidth/2,e=this.realTop*this.boardScale+(this.boardScale-1)*this.realHeight/2,i=this.scaleX*this.boardScale,r=this.scaleY*this.boardScale;return{left:t-this.realWidth*(i-1)/2,top:e-this.realHeight*(r-1)/2,width:this.realWidth*i,height:this.realHeight*r}}},{key:"remove",value:function(){this.imageWrap&&this.imageWrap.remove()}},{key:"getBoardId",value:function(){return this.boardId}}])&&st(e.prototype,i),n}(),dt={TEDU_BOARD_WARNING_SYNC_DATA_PARSE_FAILED:1,TEDU_BOARD_WARNING_H5PPT_ALREADY_EXISTS:3,TEDU_BOARD_WANNING_ILLEGAL_OPERATION:5,TEDU_BOARD_WARNING_H5FILE_ALREADY_EXISTS:6,TEDU_BOARD_WARNING_VIDEO_ALREADY_EXISTS:7,TEDU_BOARD_WARNING_IMAGESFILE_ALREADY_EXISTS:8,TEDU_BOARD_WARNING_GRAFFITI_LOST:9,TEDU_BOARD_WARNING_CUSTOM_GRAPH_URL_NON_EXISTS:10},ct=(i(132),{TEDU_BOARD_UPLOAD_STATUS_SUCCEED:1,TEDU_BOARD_UPLOAD_STATUS_FAILED:2});function ut(t,e,i,r){this.cos=null,this.options=Object.assign({sdkAppId:null,appid:null,bucket:null},t,{region:"ap-shanghai",path:"/TIC/"}),this.request=e,this.userDataKeyMap={},this.fidKeyMap={},this.bucketCosMap={},this.event=i,this.elkLog=r,this.init()}ut.prototype.init=function(){window.COS},ut.prototype.uploadImgFile=function(t,e,i){var r=this,o=h.getTimeStamp(),n=null,s="",a="";if(h.isFile(t.data))n=t.data,s=t.data.name,a=t.userData;else{var l=t.data;s=t.name,a=t.userData;for(var d=l.split(","),u=window.atob(d[1]),p=d[0].match(/:(.*?);/)[1],f=new Uint8Array(u.length),g=0;g<u.length;g++)f[g]=u.charCodeAt(g);n=new Blob([f],{type:p})}return this.uploadCosImageFile({body:n,fileName:s,userData:a}).then((function(t){r.event.fire(r,c.TEB_FILEUPLOADSTATUS,ct.TEDU_BOARD_UPLOAD_STATUS_SUCCEED,{code:0,errorMsg:"",userData:a});var e="https://".concat(t.Bucket,".file.myqcloud.com/").concat(t.Key);return Promise.resolve({fileName:s,fileUrl:e,userData:a})}),(function(t){return r.event.fire(r,c.TEB_FILEUPLOADSTATUS,ct.TEDU_BOARD_UPLOAD_STATUS_FAILED,{code:t.statusCode?t.statusCode:-3,errorMsg:JSON.stringify(t.error),userData:a}),Promise.reject(t)})).catch((function(t){r.elkLog.report("cos_upload_file",{action_result:2,action_info:"stack:"+t.stack+" message:"+t.message,time_consume:h.getTimeStamp()-o,extra_info:JSON.stringify({bucket:r.options.bucket,cos_appid:r.options.appid,region:r.options.region,userData:a})})}))},ut.prototype.uploadCosImageFile=function(t){var e=this,i=t.body,r=t.fileName,o=t.userData;return this.upload({path:this.options.path+this.options.sdkAppId+"/"+h.getTimeStamp()+"/"+r,body:i,userData:o,onProgress:function(t){e.event.fire(self,c.TEB_FILEUPLOADPROGRESS,Object.assign({userData:o},t))}})},ut.prototype.transcodeUploadFile=function(t){var e=this,i=h.getTimeStamp(),r=null,o="",n="";if(h.isFile(t.data))r=t.data,o=t.data.name,n=t.userData;else{var s=t.data;o=t.name,n=t.userData;for(var a=s.split(","),l=window.atob(a[1]),d=a[0].match(/:(.*?);/)[1],c=new Uint8Array(l.length),u=0;u<l.length;u++)c[u]=l.charCodeAt(u);r=new Blob([c],{type:d})}return this.uploadCosFileFromTranscode({body:r,fileName:o,userData:n}).then((function(t){return Promise.resolve(t)}),(function(t){return Promise.reject(t)})).catch((function(t){e.elkLog.report("cos_upload_file",{action_result:2,action_info:"stack:"+t.stack+" message:"+t.message,time_consume:h.getTimeStamp()-i,extra_info:JSON.stringify({bucket:e.options.bucket,cos_appid:e.options.appid,region:e.options.region,userData:n})})}))},ut.prototype.uploadCosFileFromTranscode=function(t){var e=this,i=t.body,r=t.fileName,o=t.userData;return this.upload({path:this.options.path+this.options.sdkAppId+"/"+h.getTimeStamp()+"/"+r,body:i,userData:o,onProgress:function(t){var i={code:"",message:"",status:"UPLOADING",progress:100*t.percent,userData:o};e.event.fire(e,c.TEB_TRANSCODEPROGRESS,i),e.elkLog.report(c.TEB_TRANSCODEPROGRESS,{extra_info:JSON.stringify(i)})}})},ut.prototype.upload=function(t){var e=this;return new Promise((function(i,r){var o=(t.bucket||e.options.bucket)+"-"+(t.appid||e.options.appid);e.bucketCosMap[o]?e.cos=e.bucketCosMap[o]:(e.cos=new window.COS({getAuthorization:function(t,i){var r=t.Bucket.substr(0,t.Bucket.lastIndexOf("-"));e.request.getCosAuthData(r).then((function(t){try{if(t&&t.data&&0==t.data.error_code){var e=t.data;i({TmpSecretId:e.tmp_secret_id,TmpSecretKey:e.tmp_secret_key,XCosSecurityToken:e.session_token,ExpiredTime:e.expired_time})}else i({TmpSecretId:"error",TmpSecretKey:"error",XCosSecurityToken:"error",ExpiredTime:-1})}catch(t){i({TmpSecretId:"error",TmpSecretKey:"error",XCosSecurityToken:"error",ExpiredTime:-1})}})).catch((function(t){i({TmpSecretId:"error",TmpSecretKey:"error",XCosSecurityToken:"error",ExpiredTime:-1})}))}}),e.bucketCosMap[o]=e.cos),e.cos.sliceUploadFile({Bucket:o,Region:t.region||e.options.region,Key:t.path,Body:t.body,onTaskReady:function(e){h.isFunction(t.onTaskReady)&&t.onTaskReady(e)},onHashProgress:function(e){h.isFunction(t.onHashProgress)&&t.onHashProgress(e)},onProgress:function(e){h.isFunction(t.onProgress)&&t.onProgress(e)}},(function(n,s){s&&200===s.statusCode?(i(s),e.elkLog.report("cos_upload_file",{extra_info:JSON.stringify({bucket:o,userData:t.userData,data:s})})):(r(n),e.elkLog.report("cos_upload_file",{action_result:1,action_info:JSON.stringify(n),extra_info:JSON.stringify({bucket:o,userData:t.userData})}))}))}))};var pt=ut;function ft(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var gt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.timeout=5e3,this.taskMap={}}var e,i;return e=t,(i=[{key:"startTask",value:function(t,e){this.stopTask(t),this.taskMap[t]=setTimeout((function(){h.isFunction(e)&&e(t)}),this.timeout)}},{key:"stopTask",value:function(t){this.taskMap[t]&&(clearTimeout(this.taskMap[t]),delete this.taskMap[t])}},{key:"clearAllTask",value:function(){for(var t in this.taskMap)this.stopTask(t)}}])&&ft(e.prototype,i),t}();function _t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var yt=1,Tt=2,vt=3,Et=4,St=5,bt=6,Ot=7,Dt=8,At=9,It=10,xt=20,wt=-1,Rt=0,Ct=1,Bt=2,Lt=function(){function t(e,i){var r=this;mt(this,t),this._element=new Audio,this._element.id=h.getTimeStamp(),this._element.src=e,this._mediaActions=[],this._listener=null,this._isLoaded=!1,this._log=i,this._audioStatus=Ct,this._onStatusChanged(Tt),this._element.onplay=function(){r._audioStatus=Rt,r._fireActionCallback(Rt)},this._element.onpause=function(){r._audioStatus=Ct,r._fireActionCallback(Ct)},this._element.onseeked=function(){r._fireActionCallback(Bt)},this._element.ontimeupdate=function(){r._onStatusChanged(St)},this._element.onwaiting=function(){r._onStatusChanged(At)},this._element.onplaying=function(){r._onStatusChanged(It)},this._element.onended=function(){r._onStatusChanged(Dt)},this._element.onerror=function(){r._onStatusChanged(yt)},this._element.onloadedmetadata=function(){r._isLoaded=!0,r._onStatusChanged(vt),r._fireNextAction()}}var e,i;return e=t,(i=[{key:"play",value:function(t){this._pushAction(Rt,0,t)}},{key:"pause",value:function(t){this._pushAction(Ct,0,t)}},{key:"seek",value:function(t,e){var i=this;this._pushAction(Bt,t,(function(){var r=i.currentTime();Math.abs(r-t)>=3?(i._isLoaded=!1,i._element.load(),i.seek(t,e)):e&&e(0,"")}))}},{key:"mute",value:function(t){this._element.muted=t}},{key:"isLoaded",value:function(){return this._isLoaded}},{key:"setVolume",value:function(t){t=Math.min(1,t),t=Math.max(0,t),this._element.volume=t}},{key:"getVolume",value:function(){return this._element.volume}},{key:"destroy",value:function(){var t=this;this.pause((function(e,i){t._element&&(t._element.src="",t._element=null)})),this._element&&(this._element.onplay=null,this._element.onpause=null,this._element.onseeked=null,this._element.ontimeupdate=null,this._element.onwaiting=null,this._element.onplaying=null,this._element.onended=null,this._element.onerror=null,this._element.onloadedmetadata=null,this._element.src="",this._element=null),this._listener=null,this._mediaActions=[],this._listener=null,this._isLoaded=!1}},{key:"_pushAction",value:function(t,e,i){var r=new function t(){mt(this,t),this.progress=0,this.status=Rt,this.callback=null,this.hasTry=0,this.timestamp=h.getTimeStamp(),this.waitingCallback=!1};r.callback=i,r.status=t,r.progress=e,this._mediaActions.push(r),1===this._mediaActions.length&&this._fireNextAction()}},{key:"_fireActionCallback",value:function(t){if(0!=this._mediaActions.length){var e=this._mediaActions[0];if(e.status==t&&1==e.waitingCallback)switch(this._mediaActions.splice(0,1),e.callback&&e.callback(0,""),e.status){case Rt:this._onStatusChanged(Et);break;case Ct:this._onStatusChanged(bt);break;case Bt:this._onStatusChanged(Ot)}else t==Ct&&this._onStatusChanged(xt)}else t==Ct&&this._onStatusChanged(xt);this._fireNextAction()}},{key:"_fireNextAction",value:function(){if(0!=this._mediaActions.length){var t=this._mediaActions[0];this._fireAction(t)}}},{key:"_fireAction",value:function(t){var e=this;if(this._isLoaded)if(t.waitingCallback=!0,t.status===this.currentStatus())this._fireActionCallback(t.status);else{switch(t.status){case Rt:this._element.play();break;case Ct:this._element.pause();break;case Bt:t.progress=Math.max(0,t.progress),t.progress=Math.min(t.progress,this.duration()),this._element.currentTime=t.progress}setTimeout((function(){0!=e._mediaActions.length&&t.timestamp==e._mediaActions[0].timestamp&&1==t.waitingCallback&&(t.hasTry<3?(t.hasTry+=1,e._fireAction(t)):(e._mediaActions.splice(0,1),t.waitingCallback=!1,t.callback(1,"action timeout, please refresh"),e._fireNextAction()))}),3e3)}}},{key:"_onStatusChanged",value:function(t){this._listener&&this._listener(t,parseInt(this.currentTime()),this.duration())}},{key:"setEventChangeListener",value:function(t){this._listener=t}},{key:"refresh",value:function(){this._isLoaded=!1,this._element.load()}},{key:"currentTime",value:function(){return this._isLoaded&&this._element?this._element.currentTime:0}},{key:"duration",value:function(){return this._isLoaded&&this._element?this._element.duration:0}},{key:"currentStatus",value:function(){return this._audioStatus}},{key:"audioId",value:function(){return this._element?this._element.id:0}}])&&_t(e.prototype,i),t}();function Pt(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Nt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{user:"",boardId:"",belongSeq:0,url:"",subType:$.TEDU_BOARD_ELEMENT_AUDIO,boardWidth:0,boardHeight:0};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._initMediaParam(e),this._initDataParam(e),this._initEventListener(),this._createElement(),this._enableAudioControl()}var e,i;return e=t,(i=[{key:"setBoardSize",value:function(t,e){this._boardWidth=t,this._boardHeight=e,this._left=this._boardWidth*this._x/1e4,this._top=this._boardHeight*this._y/1e4}},{key:"getSize",value:function(t,e,i,r){}},{key:"setEventListener",value:function(t){this._eventListener=t}},{key:"setDataListener",value:function(t){this._dataListener=t}},{key:"getRealTimeData",value:function(){var t=o.PROTOCOL_ACTION.AUDIO_ELEMENT;return this.subType==$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO&&(t=o.PROTOCOL_ACTION.GLOBAL_AUDIO_ELEMENT),{action:t,seq:a.getSeq(),belongSeq:this.belongSeq,url:this.url,time:h.getTimeStamp(),show:this.show,x:this._x,y:this._y,deg:this.deg,width:this._width,height:this._height,progress:this._media.currentTime(),status:this._media.currentStatus()}}},{key:"setRealTimeData",value:function(t){this.belongSeq=t.belongSeq,this.url=t.url,this._time=t.time,this.show=t.show,this._x=t.x,this._y=t.y,this.deg=t.deg,this._width=t.width,this._height=t.height,this._progress=t.progress,this._status=t.status}},{key:"setReportData",value:function(t){this.subType=t.subType,this._user=t.uid,this._boardId=t.boardId,this.belongSeq=t.belongSeq,this.url=t.url,this._time=t.time,this.show=!t.hidden,this._x=t.x,this._y=t.y,this.deg=t.deg,this._width=t.width,this._height=t.height,this._progress=t.progress,this._status=t.status}},{key:"_initMediaParam",value:function(t){var e=this;this._media=new Lt(t.url,t.log),this._dataListener=null,this._eventListener=null,this._media.setEventChangeListener((function(t,i,r){var o=null;t==yt?o="error":t==Tt?o="loading":t==vt?o="loaded":t==Et?o="play":t==bt?o="pause":t==Ot?o="seek":t==Dt?o="end":t==At?o="waiting":t==It?o="playing":t==xt&&(o="exceptpause"),null!=o&&e._log.report("audio_event_".concat(o),{extra_info:JSON.stringify({current:i,total:r,url:e.url,subType:e.subType,audio_id:e.audioId()})}),t==St?e.progressBarWrap&&e.progressBarWrap.onmousemove||e._seekUI(i,r):t==vt?(e._updateMedia(),e._seekUI(i,r)):t==xt?e.play((function(t,e){})):t==Dt&&(e._progress=0,e.pause((function(t,e){}))),t!=xt&&e._onEventListener(t,i,r)}))}},{key:"_initDataParam",value:function(t){this._log=t.log,this._progress=-1,this._status=wt,this._event=t.event,this._enableControl=!0,this._toolType=t.toolType,this._totalTime=0,this._currentTime=0,this._boardId=t.boardId,this.type="element",this.subType=t.subType,this.show=!0,this._user=t.user,this.belongSeq=t.belongSeq,this._width=-1,this._height=-1,this._time=0,this._x=0,this._y=0,this.url=t.url,this.deg=0,this._boardWidth=t.boardWidth,this._boardHeight=t.boardHeight,this._left=this._boardWidth*this._x/1e4,this._top=this._boardHeight*this._y/1e4,this.rectArea={maxX:0,maxY:0,minX:0,minY:0},this.scaleBasePoint=1}},{key:"_initEventListener",value:function(){var t=this;this._event&&(this._event.on("TEB_BOARD_TOOLTYPE_CHANGE",(function(e){t._toolType=e,t._enableAudioControl()})),this._event.on("TEB_BOARD_AUDIOCONTROL_ENABLE_CHANGE",(function(e){t._enableControl=e,t._enableAudioControl()})))}},{key:"_updateMedia",value:function(){var t=this._media.currentStatus(),e=this._media.currentTime();this._log.report("update_media",{extra_info:JSON.stringify({current:e,url:this.url,status:t,audio_id:this.audioId()})}),this._status==Rt&&(this._progress=this._progress+(h.getTimeStamp()-this._time)/1e3,this._progress>=this._media.duration()&&(this._status=Ct,this._progress=0),this._log.report("update_media_fix",{extra_info:JSON.stringify({progress:this._progress,url:this.url,status:this._status,audio_id:this.audioId()})}),this._time=h.getTimeStamp()),Math.abs(this._progress-e)>1&&(this._log.report("update_media_seek",{extra_info:JSON.stringify({progress:this._progress,current:e,url:this.url,status:this._status,audio_id:this.audioId()})}),this.seek(this._progress,(function(t,e){}))),this._status!=t&&(this._status==Rt?this.play((function(t,e){})):this._status==Ct&&this.pause((function(t,e){})))}},{key:"getReportData",value:function(){return{type:this.type,property:{subType:this.subType,uid:this._user,boardId:this._boardId,belongSeq:this.belongSeq,url:this.url,time:h.getTimeStamp(),hidden:1*!this.show,x:this._x,y:this._y,deg:this.deg,width:this._width,height:this._height,progress:parseInt(this._media.currentTime()),status:this._media.currentStatus()}}}},{key:"_createElement",value:function(){var t=this,e=h.isMobile();this.mutedBtn=document.createElement("div"),this.mutedBtn.className="tiw-play__btn-muted tiw-pointer-event__none unmuted-btn",this.mutedBtn[e?"ontouchstart":"onmousedown"]=function(){"mouse"===t._toolType&&event.stopPropagation(),t._isOperationPermissions()&&(t.mutedBtn.className.indexOf("unmuted-btn")>-1?t._onMuteClick(!0):t._onMuteClick(!1))},this.progressCircleEl=document.createElement("div"),this.progressCircleEl.className="tiw-progress__circle tiw-pointer-event__none",this.progressCircleEl[e?"ontouchstart":"onmousedown"]=function(t){t.stopPropagation()},this.progressCircleEl[e?"ontouchstart":"onmousedown"]=function(i){t._isOperationPermissions()&&(t.progressCircleEl[e?"ontouchend":"onmouseup"]=function(){t.progressBarWrap.onmousemove=null},t.audioWrapEl[e?"ontouchend":"onmouseleave"]=function(){t.progressBarWrap.onmousemove=null},t.audioWrapEl[e?"ontouchend":"onmouseup"]=function(){t.progressBarWrap.onmousemove=null,t.progressBarWrap.ontouchmove=null},t.progressBarWrap[e?"ontouchmove":"onmousemove"]=function(e){var i=t.progressBarEl.clientWidth,r=0;e.changedTouches?e.target===t.progressBarEl||e.target===t.progressBarWrap?r=e.changedTouches[0].pageX-t.progressBarWrap.getBoundingClientRect().left:e.target===t.progressCircleEl&&(r=e.changedTouches[0].pageX-t.progressCircleEl.getBoundingClientRect().left+t._currentTime/t._totalTime*i):e.target===t.progressBarEl||e.target===t.progressBarWrap?r=e.offsetX:e.target===t.progressCircleEl&&(r=e.offsetX+t._currentTime/t._totalTime*i);var o=(r=Math.max(r,0))*t._totalTime/i;t._seekUI(o,t._totalTime),clearTimeout(t.seekUITask),t.seekUITask=setTimeout((function(){t._onSeekClick(o,t._totalTime)}),200)},i.stopPropagation())},this.progressRealEl=document.createElement("div"),this.progressRealEl.className="tiw-progress__real tiw-pointer-event__none",this.progressBarEl=document.createElement("div"),this.progressBarEl.className="tiw-play__bar-progress tiw-pointer-event__none",this.progressBarEl[e?"ontouchstart":"onmousedown"]=function(e){if("mouse"===t._toolType&&e.stopPropagation(),t._isOperationPermissions()){var i;i=e.changedTouches?e.changedTouches[0].pageX-t.progressBarEl.getBoundingClientRect().left:e.offsetX;var r=t.progressBarEl.clientWidth;t._currentTime=i*t._totalTime/r,t._onSeekClick(t._currentTime,t._totalTime)}},this.progressBarWrap=document.createElement("div"),this.progressBarWrap.className="tiw-play__bar-progress-wrap tiw-pointer-event__none",this.progressBarWrap.appendChild(this.progressBarEl),this.progressBarEl.appendChild(this.progressCircleEl),this.progressBarEl.appendChild(this.progressRealEl),this.progressTimeCurrentEl=document.createElement("span"),this.progressTimeCurrentEl.className="tiw-play__time-current tiw-pointer-event__none",this.progressTimeCurrentEl.innerText="00:00",this.progressTimeSplitEl=document.createElement("span"),this.progressTimeSplitEl.className="tiw-play__time-split tiw-pointer-event__none",this.progressTimeSplitEl.innerText="/",this.progressTimeTotalEl=document.createElement("span"),this.progressTimeTotalEl.className="tiw-play__time-total tiw-pointer-event__none",this.progressTimeTotalEl.innerText="00:00",this.progressTimeEl=document.createElement("div"),this.progressTimeEl.className="tiw-play__time-progress tiw-pointer-event__none",this.progressTimeEl.appendChild(this.progressTimeCurrentEl),this.progressTimeEl.appendChild(this.progressTimeSplitEl),this.progressTimeEl.appendChild(this.progressTimeTotalEl),this.playBtn=document.createElement("div"),this.playBtn.className="tiw-play__btn tiw-pointer-event__none start-btn",this.playBtn[e?"ontouchstart":"onmousedown"]=function(e){"mouse"===t._toolType&&e.stopPropagation(),t._isOperationPermissions()&&(t.playBtn.className.indexOf("start-btn")>-1?t._onPlayClick():t._onPauseClick())},this.closeBtn=document.createElement("div"),this.closeBtn.className="tiw-close__btn tiw-pointer-event__none",this.closeBtn[e?"ontouchstart":"onmousedown"]=function(e){"mouse"===t._toolType&&e.stopPropagation(),t._isOperationPermissions()&&(t.show=!1,t.remove(),t._onDataListener(!1),t._event.fire(t,c.TEB_REMOVEELEMENT,[String(t.belongSeq)]))},this.audioWrapEl=document.createElement("div"),this.audioWrapEl.className="tiw-audio__wrap tiw-pointer-event__none",this.audioWrapEl.appendChild(this.closeBtn),this.audioWrapEl.appendChild(this.playBtn),this.audioWrapEl.appendChild(this.progressTimeEl),this.audioWrapEl.appendChild(this.progressBarWrap),this.audioWrapEl.appendChild(this.mutedBtn),this.audioWrapEl.ontouchstart=this.audioWrapEl.onmousedown=this.audioWrapEl.onclick=function(e){"mouse"===t._toolType&&e.stopPropagation()},this.audioWrapEl[e?"ontouchend":"onmouseup"]=function(e){"mouse"===t._toolType&&e.stopPropagation()};var i="tic-audio-element__".concat(this.belongSeq);this.audioWrapEl.id=i}},{key:"renderTo",value:function(t){var e=this;if(this.show){if(this._media.isLoaded()&&this._updateMedia(),this.subType!=$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO){var i="tic-audio-element__".concat(this.belongSeq);if(!t.querySelector("#".concat(i))){if(-1==this._width||-1==this._height){this._width=5e3;var r=this._width*this._boardWidth/1e4*9/50;this._height=1e4*r/this._boardHeight,this._x=(1e4-this._width)/2,this._y=(1e4-this._height)/2}t.appendChild(this.audioWrapEl),setTimeout((function(){e._onResizeChange()}),200)}this._onResizeChange(),this._left=this._x*this._boardWidth/1e4,this._top=this._y*this._boardHeight/1e4,this.audioWrapEl.style.left=this._left+"px",this.audioWrapEl.style.top=this._top+"px",this.audioWrapEl.style.width=this._width*this._boardWidth/1e4+"px",this.audioWrapEl.style.height=this._height*this._boardHeight/1e4+"px",this.audioWrapEl.style.transform="rotate(".concat(this.deg,"deg)"),this.audioWrapEl.style.webkitTransform="rotate(".concat(this.deg,"deg)"),this._updateRectArea()}}else this.remove()}},{key:"setPosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0!==e||0!==i){if(!t){var r=24e4/this._boardWidth,o=24e4/this._boardHeight;this._width<=r&&(e=0),this._height<=o&&(i=0)}this._left+=e,this._top+=i,this._x=1e4*this._left/this._boardWidth,this._y=1e4*this._top/this._boardHeight,this.audioWrapEl.style.left=this._left+"px",this.audioWrapEl.style.top=this._top+"px",this._updateRectArea()}}},{key:"setSize",value:function(t,e){if(0!==t||0!==e){this._width+=1e4*t/this._boardWidth,this._height+=1e4*e/this._boardHeight;var i=24e4/this._boardWidth,r=24e4/this._boardHeight;this._width=Math.max(i,this._width),this._height=Math.max(r,this._height),this.audioWrapEl.style.width=this._width*this._boardWidth/1e4+"px",this.audioWrapEl.style.height=this._height*this._boardHeight/1e4+"px",this._updateRectArea()}}},{key:"setRotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.deg=t,this.audioWrapEl.style.transform="rotate(".concat(this.deg,"deg)"),this.audioWrapEl.style.webkitTransform="rotate(".concat(this.deg,"deg)"),this._updateRectArea()}},{key:"_updateRectArea",value:function(){this.pointArr=[];var t=this._calcRotateXY(this._x,this._y);this.pointArr.push([t.x,t.y]);var e=t.x,i=t.y;t=this._calcRotateXY(this._x+this._width,this._y),this.pointArr.push([t.x,t.y]);var r=t.x,o=t.y;t=this._calcRotateXY(this._x+this._width,this._y+this._height),this.pointArr.push([t.x,t.y]);var n=t.x,s=t.y;t=this._calcRotateXY(this._x,this._y+this._height),this.pointArr.push([t.x,t.y]);var a=t.x,l=t.y;this.rectArea={minX:Math.min(e,r,a,n),minY:Math.min(i,o,l,s),maxX:Math.max(e,r,a,n),maxY:Math.max(i,o,l,s)}}},{key:"_calcRotateXY",value:function(t,e){var i=this._width*this._boardWidth/1e4,r=this._height*this._boardHeight/1e4,o=this._x*this._boardWidth/1e4+i/2,n=this._y*this._boardHeight/1e4+r/2,s=t*this._boardWidth/1e4,a=e*this._boardHeight/1e4,l=this.deg*(Math.PI/180),h=(s-o)*Math.cos(l)-(a-n)*Math.sin(l)+o,d=(s-o)*Math.sin(l)+(a-n)*Math.cos(l)+n;return{x:1e4*h/this._boardWidth,y:1e4*d/this._boardHeight,ox:h,oy:d}}},{key:"getRealSize",value:function(){return{left:this._left,top:this._top,width:this._width*this._boardWidth/1e4,height:this._height*this._boardHeight/1e4}}},{key:"remove",value:function(){this.audioWrapEl&&this.audioWrapEl.remove(),this._media.currentStatus()!=Ct&&this.pause((function(t,e){}))}},{key:"pointImpactCheck",value:function(t){}},{key:"impactCheck",value:function(t,e,i){return t>this.rectArea.minX&&e>this.rectArea.minY&&t<this.rectArea.maxX&&e<this.rectArea.maxY}},{key:"play",value:function(t){var e=this;this._log.report("audio_play",{extra_info:JSON.stringify({url:this.url,subType:this.subType,audio_id:this.audioId()})}),this._media.play((function(i,r){e._log.report("audio_play_callback",{extra_info:JSON.stringify({code:i,desc:r,url:e.url,subType:e.subType,audio_id:e.audioId()})}),0==i&&(e._status=Rt,e._progress=e._media.currentTime(),e._time=h.getTimeStamp(),e._playUI()),t(i,r)}))}},{key:"_playUI",value:function(){this.playBtn.classList.add("pause-btn"),this.playBtn.classList.remove("start-btn")}},{key:"pause",value:function(t){var e=this;this._log.report("audio_pause",{extra_info:JSON.stringify({url:this.url,subType:this.subType,audio_id:this.audioId()})}),this._media.pause((function(i,r){e._log.report("audio_pause_callback",{extra_info:JSON.stringify({code:i,desc:r,url:e.url,subType:e.subType,audio_id:e.audioId()})}),0==i&&(e._status=Ct,e._progress=e._media.currentTime(),e._time=h.getTimeStamp(),e._pauseUI()),t(i,r)}))}},{key:"_pauseUI",value:function(){this.playBtn.classList.add("start-btn"),this.playBtn.classList.remove("pause-btn")}},{key:"mute",value:function(t){this._muteUI(t),this._media.mute(t)}},{key:"_muteUI",value:function(t){t?(this.mutedBtn.classList.add("muted-btn"),this.mutedBtn.classList.remove("unmuted-btn")):(this.mutedBtn.classList.add("unmuted-btn"),this.mutedBtn.classList.remove("muted-btn"))}},{key:"setVolume",value:function(t){this._media.setVolume(t)}},{key:"getVolume",value:function(){return this._media.getVolume()}},{key:"_onPlayClick",value:function(){var t=this;this.play((function(e,i){0==e&&t._onDataListener()}))}},{key:"_onPauseClick",value:function(){var t=this;this.pause((function(e,i){0==e&&t._onDataListener()}))}},{key:"_onSeekClick",value:function(t,e){var i=this;this.seek(t,(function(t,e){0==t&&i._onDataListener()}))}},{key:"_onMuteClick",value:function(t){this.mute(t)}},{key:"_onDataListener",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(null!=this._dataListener){var e=this.getRealTimeData(),i=this.getReportData();this._dataListener(e,i,t)}}},{key:"_onEventListener",value:function(t,e,i){null!=this._eventListener&&this._eventListener(t,e,i)}},{key:"seek",value:function(t,e){var i=this;this._log.report("audio_seek",{extra_info:JSON.stringify({url:this.url,subType:this.subType,current:t,audio_id:this.audioId()})}),this._media.seek(t,(function(r,o){i._log.report("audio_seek_callback",{extra_info:JSON.stringify({code:r,desc:o,url:i.url,subType:i.subType,current:i._media.currentTime(),audio_id:i.audioId()})}),0==r&&(i._progress=t,i._time=h.getTimeStamp(),i._seekUI(t,i._media.duration())),e(r,o)}))}},{key:"_seekUI",value:function(t,e){this._totalTime=e,this._currentTime=t=Math.max(0,t);var i=Math.max(0,Math.min(100,e?t/e*100:0));this.progressTimeCurrentEl.innerText===this._formatSecond(t)&&this.progressTimeTotalEl.innerText===this._formatSecond(e)||(this.progressTimeCurrentEl.innerText=this._formatSecond(t),this.progressTimeTotalEl.innerText=this._formatSecond(e),this.progressRealEl.style.width=i+"%",this.progressCircleEl.style.left=i+"%")}},{key:"_formatSecond",value:function(t){var e=Math.floor(t/3600),i=Math.floor(t/60%60),r=Math.floor(t%60),o="";return e&&e<10?o+="0"+e+":":e>=10&&(o+=e+":"),i<10&&(o+="0"),o+=i+":",r<10&&(o+="0"),o+r}},{key:"getBoardId",value:function(){return this._boardId}},{key:"refresh",value:function(){this._media.refresh()}},{key:"_enableAudioControl",value:function(){this._isOperationPermissions()?(this.mutedBtn.classList.remove("disable"),this.playBtn.classList.remove("disable"),this.progressBarEl.classList.remove("disable"),this.closeBtn.classList.remove("disable"),this.progressCircleEl.classList.remove("disable")):(this.mutedBtn.classList.add("disable"),this.playBtn.classList.add("disable"),this.progressBarEl.classList.add("disable"),this.closeBtn.classList.add("disable"),this.progressCircleEl.classList.add("disable"))}},{key:"_isOperationPermissions",value:function(){return this._enableControl&&"mouse"===this._toolType}},{key:"_onResizeChange",value:function(){var t=this.progressBarEl.clientHeight;this.progressCircleEl.style.width=3*t+"px",this.progressCircleEl.style.height=3*t+"px",this.progressCircleEl.style.top=-t+"px";var e=this.progressTimeEl.clientWidth/7,i=1;e<12&&(i=e/12,e=12),this.progressTimeEl.style.fontSize=e+"px",this.progressTimeEl.style.transform="scale(".concat(i,")"),this.progressTimeEl.style.webkitTransform="scale(".concat(i,")"),this.closeBtn.style.height=this.closeBtn.clientWidth+"px",this.closeBtn.style.top=this.closeBtn.clientWidth/-2+"px"}},{key:"audioId",value:function(){return this._media.audioId()}},{key:"destroy",value:function(){this._media.destroy()}}])&&Pt(e.prototype,i),t}(),Mt={TEDU_BOARD_AUDIO_STATUS_ERROR:1,TEDU_BOARD_AUDIO_STATUS_LOADING:2,TEDU_BOARD_AUDIO_STATUS_LOADED:3,TEDU_BOARD_AUDIO_STATUS_PLAYED:4,TEDU_BOARD_AUDIO_STATUS_TIMEUPDATE:5,TEDU_BOARD_AUDIO_STATUS_PAUSED:6,TEDU_BOARD_AUDIO_STATUS_SEEKED:7,TEDU_BOARD_AUDIO_STATUS_ENDED:8,TEDU_BOARD_AUDIO_STATUS_WAITING:9,TEDU_BOARD_AUDIO_STATUS_PLAYING:10},kt={TEDU_BOARD_POSITION_LEFT_TOP:0,TEDU_BOARD_POSITION_RIGHT_TOP:1,TEDU_BOARD_POSITION_RIGHT_BOTTOM:2,TEDU_BOARD_POSITION_LEFT_BOTTOM:3};function qt(t){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t){var e=this;this.loggerModuleName="Store",this.event=t.event,this.logger=t.logger,this.elkLog=t.elkLog,this.options=JSON.parse(JSON.stringify(t)),this.maxSeq=0,this.maxAddTextSeq=0,this.maxMoveSeq=0,this.maxVideoSeq=0,this.maxImageElementSeq=0,this.maxGraffitiMoveSeq=0,this.maxH5webElementSeq=0,this.maxCustomGraphElementSeq=0,this.graphEndPoint={},this.isDrawing=!1,this.customGraphData={url:"",userData:""},this.nextInputObj={text:"",keepFocus:!0},this.seqFilter={},this.laserDataMap={},this.request=new A(t),this.report=new L(this.request,this.elkLog),this.report.setCallback((function(t,i){i||e.addReportAckData(t)})),this.report.setPreCallback((function(t){e.addReportAckData(t,!1)})),this.permissions=0,this.accessibleUsers=[],h.isUndefined(t.syncHistroyEnable)||h.isNull(t.syncHistroyEnable)?this.syncHistroyEnable=!0:this.syncHistroyEnable=t.syncHistroyEnable,this.identifier=t.tlsData.identifier,this.classId=t.classId,this.user=t.tlsData.identifier,this.initTypeConstant=-1,this.beforeToolType=this.initTypeConstant,this.data={},this.progressEnable=o.PROGRESS_ENABLE,this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.pptFilePreloaded={},this.boardRatio={},this.dragDataList=new V,this.scale=this.options.scale||o.SCALE,this.ratio=this.options.ratio||o.RATIO,this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.drawEnable=!0,this.enableHandwriting=!1,this.color=0,this.thin=0,this.typeFace=o.TEXT_FONT_FAMILY,this.textSize=0,this.textColor="",this.fontStyle=F.TEDU_BOARD_TEXT_STYLE_NORMAL,this.smoothLevel=0,this.dataSyncEnable=!1,this.preloadDepth=0,this.globalBackgroundColor=h.color2RgbaColor(f.COLOR.WHITE),this.lineStyle={lineType:U.TEDU_BOARD_LINE_TYPE_SOLID,startArrowType:l.TEDU_BOARD_ARROW_TYPE_NONE,endArrowType:l.TEDU_BOARD_ARROW_TYPE_NONE},this.ovalDrawMode=Y.TEDU_BOARD_OVAL_DRAW_MODE_FIX_START,this.ovalCenterPoint=null,this.type=f.BOARD_ACTION_TYPE.LINE,this.transparent=!1,this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.reportAckDatas={},this.sendAckDatas={},this.beforeMoveType="",this.containerWidth=0,this.containerHeight=0,this.boardWidth=0,this.boardHeight=0,this.boardContentFitMode=0,this.imageTimeout=o.IMAGE_TIMEOUT,this.faceData=[],this.textInputTask=null,this.lastInputActionData=null,this.transcodeIntervalMap={},this.taskIdUserDataMap={},this.drawRaserTask=null,this.sendInterval=null,this.fileMessageCosInfo={bucket:null,appid:null,region:null},this.checkLoseLineTask=new gt,this.seqLineMap={},this.elementMap=new Map,this.fileCos=null,this.cosData={appid:null,bucket:null},this.heartbeat=new x({newEnterId:this.options.newEnterId,classId:this.classId,request:this.request,log:this.elkLog}),this.systemCursorEnable=this.options.systemCursorEnable||!1,this.toolTypeTitleStyle={title:"",style:{}},this.applyPermissions(),this.initInterval(),this.isSyncAudioStatus=!0}Ut.prototype.initFont=function(){var t=this;this.request.requestFont().then((function(e){t.setNeedDraw(!0)})).catch((function(){t.setNeedDraw(!0)}))},Ut.prototype.applyPermissions=function(){var t=this;this.logger.info(this.loggerModuleName,"applyPermissions");var e=h.getTimeStamp();this.request.applyPermissions().then((function(i){if(t.permissions=0,0===i.data.error_code){var r=h.getTimeStamp();if(i.data.level){window.performance&&window.performance.now&&!h.isMobile()?(a.performanceNow=window.performance.now(),a.serverTime=i.data.server_time+Math.floor((r-e)/2)):(a.localTime=h.getTimeStamp(),a.serverTime=i.data.server_time+Math.floor((r-e)/2),a.localServerTimeDiff=a.localTime-a.serverTime),t.cosData={appid:i.data.cos_appid,bucket:i.data.cos_bucket},t.fileMessageCosInfo.bucket=i.data.file_message.bucket,t.fileMessageCosInfo.appid=i.data.file_message.appid,t.fileMessageCosInfo.region=i.data.file_message.region,t.fileCos=new pt(Object.assign({sdkAppId:t.options.sdkAppId},t.options.cosData,t.cosData),t.request,t.event,t.elkLog),t.permissions=i.data.level,t.request.setPermissions(t.permissions),t.setDefaultBoard(),t.initData(t.options);var o=r-e;return t.elkLog.report("verify_sdk",{time_consume:o,extra_info:JSON.stringify({permissions:t.permissions,server_time:i.data.server_time,startTime:e,endTime:r})}),t.syncHistroyEnable&&t.classId?t.syncHistroyData():!t.syncHistroyEnable&&t.classId&&setTimeout((function(){t.event.fire(t,"TEB_HISTROYDATA_SYNCCOMPLETED")}),200),t.event.fire(t,"TEB_INIT"),t.heartbeat.start(),void t.setNeedDraw(!0)}t.event.fire(t,"TEB_ERROR",k.TEDU_BOARD_ERROR_AUTH,"please purchase the service first"),t.elkLog.report("verify_sdk",{action_result:i.data.error_code,action_info:JSON.stringify(i.data),time_consume:h.getTimeStamp()-e,extra_info:JSON.stringify({permissions:t.permissions})})}else void 0!==i.data.error_code&&0!=i.data.error_code?(t.event.fire(t,"TEB_ERROR",k.TEDU_BOARD_ERROR_RUNTIME,i.data.error_msg),t.elkLog.report("verify_sdk",{action_result:i.data.error_code,action_info:JSON.stringify(i.data),time_consume:h.getTimeStamp()-e,extra_info:JSON.stringify({permissions:t.permissions,message:i.data.error_msg})})):void 0!==i.data.ErrorCode?(60008===i.data.ErrorCode?t.event.fire(t,"TEB_ERROR",k.TEDU_BOARD_ERROR_AUTH_TIMEOUT,"the request has timed out. please try again"):t.event.fire(t,"TEB_ERROR",k.TEDU_BOARD_ERROR_RUNTIME,"ErrorCode:".concat(i.data.ErrorCode,",ErrorInfo:").concat(i.data.ErrorInfo)),t.elkLog.report("verify_sdk",{action_result:i.data.ErrorCode,action_info:JSON.stringify(i.data),time_consume:h.getTimeStamp()-e,extra_info:JSON.stringify({permissions:t.permissions})})):(t.event.fire(t,"TEB_ERROR",k.TEDU_BOARD_ERROR_RUNTIME,"server error"),t.elkLog.report("verify_sdk",{action_result:-9999,action_info:JSON.stringify(i.data),time_consume:h.getTimeStamp()-e,extra_info:JSON.stringify({permissions:t.permissions})}));t.permissions=0,t.request.setPermissions(t.permissions)}),(function(i){t.permissions=0,t.request.setPermissions(t.permissions),t.event.fire(t,"TEB_ERROR",k.TEDU_BOARD_ERROR_AUTH_TIMEOUT,"the request has timed out. please try again"),t.elkLog.report("verify_sdk",{action_result:-9998,action_info:JSON.stringify(i),time_consume:h.getTimeStamp()-e,extra_info:JSON.stringify({permissions:t.permissions})})}))},Ut.prototype.setVisible=function(t){this.heartbeat.setVisible(t)},Ut.prototype.createBoardIdForFile=function(t,e,i,r,n,s){for(var a=1,l=[],h=0;h<r;h++){var d;d=s===o.FILE_TYPE.VOD?"".concat(n,"_").concat(e,"_").concat(Math.floor(t.replace("#","")/1e3),"_").concat(a++,"_").concat(t):"".concat(n,"_").concat(e,"_").concat(i,"_").concat(a++,"_").concat(t),l.push(d)}return l},Ut.prototype.createBoardId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentGroup,e=arguments.length>1?arguments[1]:void 0;return this.logger.info(this.loggerModuleName,"createBoardId"),0==this.boardIdSeq?(this.boardIdSeq++,o.COMMON_DEFAULT_BOARD):"".concat(o.PLATFORM,"_").concat(this.identifier,"_").concat(e||h.getSecondTime(),"_").concat(this.boardIdSeq++,"_").concat(t)},Ut.prototype.initInterval=function(){var t=this;this.sendInterval=setInterval((function(){t.realTimeData.length>0&&t.sendRequest()}),200)},Ut.prototype.resetData=function(){this.logger.info(this.loggerModuleName,"resetData"),this.data={},this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.seq=0,this.maxSeq=0,this.maxAddTextSeq=0,this.maxMoveSeq=0,this.maxVideoSeq=0,this.maxImageElementSeq=0,this.maxGraffitiMoveSeq=0,this.seqFilter={},this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.setDefaultBoard()},Ut.prototype.initData=function(t){var e=this;(h.isUndefined(t.drawEnable)||h.isNull(t.drawEnable))&&(t.drawEnable=!0),this.setDrawEnable(t.drawEnable),this.setProgressEnable(t.progressEnable),this.setColor(t.brushColor),this.setThin(t.brushThin),this.setTextFontFamily(t.textFamily),this.setTextSize(t.textSize),this.setTextColor(t.textColor),this.setTextFontStyle(t.textStyle),this.setSmoothLevel(t.smoothLevel),this.setDataSyncEnable(t.dataSyncEnable),this.setPreloadDepth(t.preloadDepth),this.setBoardContentFitMode(t.boardContentFitMode,!1),this.setImageTimeout(t.imageTimeout||o.IMAGE_TIMEOUT),this.setSystemCursorEnable(t.systemCursorEnable||!1),this.types=["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM","GRAPH-SQUARE","GRAPH-SQUARE-SOLID","GRAPH-CIRCLE","GRAPH-CIRCLE-SOLID","CUSTOM-GRAPH"],(h.isUndefined(t.toolType)||h.isNull(t.toolType))&&(t.toolType=1),this.setType(f.BOARD_ACTION_TYPE[this.types[t.toolType]]),this.setGlobalBackgroundColor(t.globalBackgroundColor,!0),this.setTransparent(t.transparent),this.setSelectArea(),setTimeout((function(){e.event.fire(e,"TEB_OPERATE_CANREDO_STATUS_CHANGED",e.canRedo()),e.event.fire(e,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",e.canUndo())}),500)},Ut.prototype.addBoard=function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[];if(Array.isArray(t))r=t;else{if(!t)return;r=[t]}var n={};for(var s in r.forEach((function(t,i){e.userData[t]={},e.userData[t][e.identifier]=[],e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.backgroundColor[t]=e.globalBackgroundColor,e.backgroundPic[t]={url:"",user:t===o.COMMON_DEFAULT_BOARD?e.identifier:h.boardId2Uid(t),show:!0,mode:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,type:f.BACKGROUND_TYPE.IMAGE},-1===e.boardList.indexOf(t)&&e.boardList.push(t);var r=h.boardId2Fid(t);n[r]||(n[r]=[]),n[r].push(t)})),n)this.event.fire(this,"TEB_ADDBOARD",n[s],s);return this.sortBoard(),i&&this.report.reportCreateBoards(this.currentBoard,r),this.boardList},Ut.prototype.findLine=function(t,e,i){for(var r,o=this.userData[t][e],n=0,s=o.length;n<s;n++){var a=o[n];if("line"===a.type&&a.seq==i.belongSeq){r=a;break}}return r},Ut.prototype.setNeedDraw=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.needDraw!=t&&(this.needDraw=t)},Ut.prototype.getNeedDraw=function(){return this.needDraw},Ut.prototype.setIncreasingDraw=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.increasingDraw!=t&&(this.increasingDraw=t)},Ut.prototype.getIncreasingDraw=function(){return this.increasingDraw},Ut.prototype.setPartDraw=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.partDraw!=t&&(this.partDraw=t)},Ut.prototype.getPartDraw=function(){return this.partDraw},Ut.prototype.setLaserDraw=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.laserDraw!=t&&(this.laserDraw=t)},Ut.prototype.getLaserDraw=function(){return this.laserDraw},Ut.prototype.getBoardList=function(){return this.boardList},Ut.prototype.getBoardPicList=function(){return this.backgroundPic},Ut.prototype.setDefaultBoard=function(){this.logger.info(this.loggerModuleName,"setDefaultBoard"),this.currentGroup=o.COMMON_GROUP;var t=h.getSecondTime();this.addGroup(o.COMMON_GROUP,o.COMMON_GROUP,this.user,null,1,0,t,o.PLATFORM,o.FILE_TYPE.IMG,0),this.currentBoard=this.createBoardId(),this.addBoard(this.currentBoard,!1),this.setBackgroundColor(this.globalBackgroundColor,!0),delete this.setDefaultBoard},Ut.prototype.removeBoard=function(t){this.logger.info(this.loggerModuleName,"removeBoard",{param:{boardIds:t}}),Array.isArray(t)||(t=[t]);for(var e=[],i=[],r=!1,n={},s=0,a=t.length;s<a;s++){var l,d=t[s];if(d!==o.COMMON_DEFAULT_BOARD&&(l=this.boardList.indexOf(d))>-1){e.push(d);var c=h.boardId2Fid(d);if(n[c]||(n[c]=[]),n[c].push(d),delete this.userData[d],delete this.data[d],delete this.opData[d],delete this.opIndex[d],delete this.backgroundColor[d],delete this.backgroundPic[d],d==this.currentBoard){r=!0;var u=this.getBoardByGroup(this.currentGroup),p=u.indexOf(d);if(this.currentBoard=0===p?u[p+1]:u[p-1],!this.currentBoard){var f=this.getBoardByGroup(o.COMMON_GROUP);this.currentBoard=f[this.getFileInfo(o.COMMON_GROUP).currentPageIndex]}}this.boardList.splice(l,1);var g=h.boardId2Fid(d),_=this.getBoardByGroup(g),m=this.getFileInfo(g);0===_.length?m&&(this.deleteGroup(g),i.push(g)):m&&(m.pageCount=m.pageCount-1,m.pageCount===m.currentPageIndex&&(m.currentPageIndex=m.currentPageIndex-1),this.updateFileInfo(m))}}var y=h.boardId2Fid(this.currentBoard),T=this.getBoardByGroup(y);for(var v in(m=this.getFileInfo(y))&&(m.pageCount=T.length,m.currentPageIndex=T.indexOf(this.currentBoard),this.updateFileInfo(m)),this.currentGroup=h.boardId2Fid(this.currentBoard),n)this.event.fire(this,"TEB_DELETEBOARD",n[v],v);return r&&this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,h.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),{deleteBoards:e,deleteFids:i}},Ut.prototype.deleteBoard=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentBoard,e=arguments.length>1?arguments[1]:void 0;this.logger.info(this.loggerModuleName,"deleteBoard",{param:{boardId:t,fid:e}});var i=this.removeBoard(t)||[],r=i.deleteBoards,n=i.deleteFids;if(r.length){var s=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";s&&this.addRealtimeData({action:o.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:s,time:h.getTimeStamp(),seq:a.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var l=[];e?n.indexOf(e)>-1?l=n:l.push(e):l=n;var d=this.getBoardByGroup(this.currentGroup),c=d.indexOf(this.currentBoard),u=a.getSeq();this.addRealtimeData({action:o.PROTOCOL_ACTION.SWITCH_ACTION,time:h.getTimeStamp(),seq:u,toBoardId:this.currentBoard,deleteBoards:l.length?[]:r,deleteFiles:l.length?l:[],page:c,step:0}),this.maxSeq=u,this.sendRequest(),this.report.reportDeleteBoard(r,this.currentBoard);var p=this.getFileInfo(this.currentGroup);p.currentPageIndex=c,p.currentPageStep=0,p.pageCount=d.length,this.report.reportAddFile(p),this.report.reportSwitchBoard({boardId:this.currentBoard,fid:p.fid,url:p.downloadURL,type:p.type,page:p.currentPageIndex,step:p.currentPageStep,ratio:p.ratio,scale:p.scale})}return r},Ut.prototype.getGroup=function(){return this.groups},Ut.prototype.getFileInfoList=function(){var t=this,e=Object.assign([],this.groups);return e.forEach((function(e){var i=[];(t.getBoardByGroup(e.fid)||[]).forEach((function(e){var r=new M(e,t.backgroundPic[e],t.backgroundColor[e]);i.push(r)})),e.boardInfoList=i})),e},Ut.prototype.getBoardInfoList=function(t){var e=this,i=[];return(this.getBoardByGroup(t)||[]).forEach((function(t){var r=new M(t,e.backgroundPic[t],e.backgroundColor[t]);i.push(r)})),i},Ut.prototype.getFileInfo=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentGroup,e=null,i=this.getGroup(),r=0,o=i.length;r<o;r++){var n=i[r];if(t===n.fid){e=n;break}}return e},Ut.prototype.getBoardByGroup=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentGroup,e=[],i="_".concat(t),r=0;r<this.boardList.length;r++){var n=this.boardList[r];(t===o.COMMON_GROUP&&n===o.COMMON_DEFAULT_BOARD||n.indexOf(i)>-1)&&e.push(n)}return e},Ut.prototype.addGroupNotReport=function(t,e,i,r,n,s,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:o.PLATFORM,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:o.FILE_TYPE.IMG,d=arguments.length>9?arguments[9]:void 0,c=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0,f=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;this.logger.info(this.loggerModuleName,"addGroupNotReport",{param:{fid:t,uid:i,pageCount:n,currentPageIndex:s,currentPageStep:d}});for(var _=!1,m=0,y=this.groups.length;m<y;m++)if(this.groups[m].fid==t){_=!0;break}if(_)return this.groups;var T={fid:t,title:e||t,downloadURL:r,pageCount:n,currentPageIndex:s,currentPageStep:d,uid:i,timestamp:a,platform:l,ratio:c,type:h,scale:u,status:f,progress:g};this.groups.push(T),p?this.event.fire(this,"TEB_ADDTRANSCODEFILE",t):h==o.FILE_TYPE.IMG?this.event.fire(this,"TEB_ADDFILE",t):h==o.FILE_TYPE.IMAGESFILE?(this.event.fire(this,"TEB_ADDIMAGESFILE",t),this.elkLog.report("add_images_file_event_peer",{extra_info:JSON.stringify({fid:t})})):this.event.fire(this,"TEB_ADDH5PPTFILE",t)},Ut.prototype.addGroup=function(t,e,i,r,n,s,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:o.PLATFORM,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:o.FILE_TYPE.IMG,d=arguments.length>9?arguments[9]:void 0,c=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0;this.logger.info(this.loggerModuleName,"addGroup",{param:{fid:t,uid:i,pageCount:n,currentPageIndex:s,currentPageStep:d}});for(var f=!1,g=0,_=this.groups.length;g<_;g++)if(this.groups[g].fid==t){f=!0;break}if(f)return this.groups;var m={fid:t,title:e||t,downloadURL:r,pageCount:n,currentPageIndex:s,currentPageStep:d,uid:i,timestamp:a,platform:l,ratio:c,type:h,scale:u,isTranscodeFile:!!p,progress:0,status:0};t&&t!==o.COMMON_GROUP&&this.report.reportAddFile(m),this.groups.push(m),p?this.event.fire(this,"TEB_ADDTRANSCODEFILE",t):h==o.FILE_TYPE.IMG?this.event.fire(this,"TEB_ADDFILE",t):h==o.FILE_TYPE.IMAGESFILE?(this.event.fire(this,"TEB_ADDIMAGESFILE",t),this.elkLog.report("add_images_file_event_myself",{extra_info:JSON.stringify({fid:t})})):this.event.fire(this,"TEB_ADDH5PPTFILE",t)},Ut.prototype.deleteGroup=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.logger.info(this.loggerModuleName,"deleteGroup",{param:{groupId:t,needReport:e}}),t===o.COMMON_GROUP)return[];for(var i=-1,r=0,n=this.groups.length;r<n;r++)if(this.groups[r].fid==t){i=r;break}return i>-1&&(this.groups.splice(i,1),P.clearIframeCache(this.iframeDom)),e&&this.report.reportDeleteFile(t),this.getBoardByGroup(t)},Ut.prototype.setDrawEnable=function(t){this.drawEnable=!!t,this.drawEnable||(this.cancelSelect(),this.hideLaserData()),this.elkLog.report("call_method",{extra_info:JSON.stringify({method:"setDrawEnable",data:this.drawEnable})}),this.logger.info(this.loggerModuleName,"setDrawEnable",{param:{drawEnable:this.drawEnable}})},Ut.prototype.isDrawEnable=function(t){return this.drawEnable},Ut.prototype.setColor=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.COLOR.RED;this.logger.info(this.loggerModuleName,"setColor",{param:{color:t}}),this.cancelSelect(),this.color=h.color2RgbaColor(t)},Ut.prototype.getColor=function(){return this.color},Ut.prototype.setThin=function(t){t||(t=o.THIN),this.cancelSelect(),this.thin=Math.floor(t)},Ut.prototype.getThin=function(){return this.thin},Ut.prototype.setSmoothLevel=function(t){(h.isUndefined(t)||h.isNull(t))&&(t=o.SMOOTH_LEVEL),t=Math.max(0,Math.min(1,t)),this.smoothLevel=t},Ut.prototype.getSmoothLevel=function(){return this.smoothLevel},Ut.prototype.setTextSize=function(t){t||(t=o.TEXT_SIZE),this.cancelSelect(),this.textSize=t},Ut.prototype.getTextSize=function(){return this.textSize},Ut.prototype.setTextColor=function(t){t||(t=o.TEXT_COLOR),this.cancelSelect(),this.textColor=h.color2RgbaColor(t)},Ut.prototype.getTextColor=function(){return this.textColor},Ut.prototype.setTextFontFamily=function(t){this.typeFace=o.TEXT_FONT_FAMILY},Ut.prototype.getTextFontFamily=function(){return this.typeFace},Ut.prototype.setTextFontStyle=function(t){t||(t=F.TEDU_BOARD_TEXT_STYLE_NORMAL),this.cancelSelect(),this.fontStyle=t},Ut.prototype.getTextFontStyle=function(){return this.fontStyle},Ut.prototype.setDataSyncEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.DATA_SYNC_ENABLE;this.logger.info(this.loggerModuleName,"setDataSyncEnable",{param:{enable:t}}),this.request.setReportEnable(t),this.dataSyncEnable=t,this.elkLog.report("call_method",{extra_info:JSON.stringify({method:"setDataSyncEnable",data:t})})},Ut.prototype.isDataSyncEnable=function(){return this.dataSyncEnable},Ut.prototype.setAccessibleUsers=function(t){this.logger.info(this.loggerModuleName,"setAccessibleUsers",{param:{users:t}}),this.accessibleUsers=t||[]},Ut.prototype.setProgressEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.PROGRESS_ENABLE;this.progressEnable=t},Ut.prototype.isProgressEnable=function(){return this.progressEnable},Ut.prototype.setPreloadDepth=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.PRELOAD_DEPTH;this.preloadDepth=t},Ut.prototype.setType=function(t){var e=Object.values(f.BOARD_ACTION_TYPE);this.cancelSelect(),e.indexOf(t)>-1?this.type=t:this.type=f.BOARD_ACTION_TYPE.LINE,this.elkLog.report("call_method",{extra_info:JSON.stringify({method:"setType",data:t})}),this.event.fire(this,"TEB_BOARD_TOOLTYPE_CHANGE",this.type)},Ut.prototype.getType=function(){return this.type},Ut.prototype.setTransparent=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.transparent=t},Ut.prototype.getTransparent=function(){return this.transparent},Ut.prototype.setBackgroundColor=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.COLOR.WHITE,e=arguments.length>1?arguments[1]:void 0;this.logger.info(this.loggerModuleName,"setBackgroundColor",{param:{color:t}});var i,r=this.currentBoard;("object"===qt(t)&&(r=t.boardId,t=t.color),this.backgroundColor[r]=h.color2RgbaColor(t),this.setNeedDraw(!0),e)||(i=h.rgbaColor2DecimalColor(this.backgroundColor[r]),this.addRealtimeData({action:o.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),color:i,isGlobal:0}),this.report.reportSetBoardBgColor(r,i))},Ut.prototype.getBackgroundColor=function(){return this.backgroundColor[this.getCurrentBoard()]},Ut.prototype.setSelectArea=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.selectArea={x:t,y:e,width:i,height:r}},Ut.prototype.getSelectArea=function(){return this.selectArea},Ut.prototype.getCurrentBoard=function(){return this.currentBoard},Ut.prototype.getCurrentFile=function(){return this.currentGroup},Ut.prototype.getData=function(){return this.data},Ut.prototype.getFaceData=function(){var t,e,i=this.getCurrentBoardData(),r=this.faceData.pop();if(r&&r.content&&r.content.fid){var n=r.content;if(n.type===o.FILE_TYPE.IMG){t={downloadURL:n.url,currentPageIndex:n.page,currentPageStep:n.step,type:n.type,fid:n.fid,ratio:n.ratio};var s="";n.url&&((s=h.fileDownLoadUrlToPreviewUrl(n.url)).endsWith("/")?s+=n.page+1+".jpg":s+=n.page+1),e={mode:0,show:!0,type:0,url:s}}else n.type===o.FILE_TYPE.H5PPT&&(t={downloadURL:n.url,currentPageIndex:n.page,currentPageStep:n.step,type:n.type,fid:n.fid,ratio:n.ratio},e={mode:0,show:!0,type:0,url:""})}return this.faceData=[],{fileInfo:t,backgroundColor:i.backgroundColor,currentPic:e,data:i.data}},Ut.prototype.getCurrentBoardData=function(){return{data:this.data[this.currentBoard],userData:this.userData[this.currentBoard],opData:this.opData[this.currentBoard],opIndex:this.opIndex[this.currentBoard],backgroundPic:this.backgroundPic[this.currentBoard],backgroundColor:this.backgroundColor[this.currentBoard],ratio:this.boardRatio[this.currentBoard],scale:this.getBoardScale()}},Ut.prototype.getCurrentBoardPic=function(){return this.backgroundPic[this.currentBoard]},Ut.prototype.getCurrentBoardColor=function(){return this.backgroundColor[this.currentBoard]},Ut.prototype.getSelectList=function(){return this.selectedList},Ut.prototype.clearBoard=function(t,e,i){if(this.logger.info(this.loggerModuleName,"clearBoard",{param:{clearBackground:t,clearSelectedOnly:e,accessAllUser:i}}),this.currentBoard){if(e){var r=this.getType();"select"!==r&&"pointselect"!==r||(this.deleteSelectedData(),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo()),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()))}else{if(!i&&this.accessibleUsers&&this.accessibleUsers.length>0)this.deleteBoardData();else{for(var n=0,s=this.data[this.currentBoard].length;n<s;n++){var a=this.data[this.currentBoard][n];if("imageElement"===a.type)a.remove();else if("inputtext"===a.type){var l=document.getElementById("tic-textarea__".concat(a.belongSeq));l&&(l.value="",l.blur(),l.remove())}else"element"===a.type&&(a.subType==$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO||(a.remove(),this.elementMap.delete(String(a.belongSeq))))}for(var h in this.data[this.currentBoard]=[],this.opData[this.currentBoard]=[],this.opIndex[this.currentBoard]=0,this.userData[this.currentBoard])this.userData[this.currentBoard][h]=[];this.userData[this.currentBoard][this.identifier]=[],t&&(this.getCurrentFile()===o.COMMON_GROUP&&(this.backgroundPic[this.currentBoard]={show:!1,mode:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,url:"",type:f.BACKGROUND_TYPE.IMAGE,user:""}),this.backgroundColor[this.currentBoard]=this.globalBackgroundColor)}this.cancelSelect()}this.setNeedDraw(!0)}},Ut.prototype.clear=function(t,e){this.logger.info(this.loggerModuleName,"clear",{param:{clearBackground:t,clearSelectedOnly:e}}),e?this.clearBoard(!1,!0):this.accessibleUsers&&this.accessibleUsers.length>0?this.clearBoard(!1,!1):t?(this.clearBoard(!0,!1),this.addRealtimeData({action:101,seq:a.getSeq()}),this.report.reportClear(this.currentBoard)):(this.clearBoard(!1,!1),this.addRealtimeData({action:102,seq:a.getSeq()}),this.report.reportClearDraws(this.currentBoard))},Ut.prototype.clearFileDrawData=function(t){var e=this;this.logger.info(this.loggerModuleName,"clearFileDrawData",{param:{fids:t}}),t.forEach((function(t){(e.getBoardByGroup(t)||[]).forEach((function(t){for(var i=0,r=e.data[t].length;i<r;i++){var o=e.data[t][i];if("imageElement"===o.type)o.remove();else if("inputtext"===o.type){var n=document.getElementById("tic-textarea__".concat(o.belongSeq));n&&(n.value="",n.blur(),n.remove())}}e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.userData[t]={},e.userData[t][e.identifier]=[]}))})),this.cancelSelect(),this.setNeedDraw(!0)},Ut.prototype.clearFileDraws=function(t){var e=this;if(this.logger.info(this.loggerModuleName,"clearFileDraws",{param:{fids:t}}),t){Array.isArray(t)||(t=[t]),this.clearFileDrawData(t);var i=[];t.forEach((function(t){i=i.concat(e.getBoardByGroup(t))})),this.addRealtimeData({action:o.PROTOCOL_ACTION.FILE_CLEAR_ACTION,seq:a.getSeq(),fids:t}),this.report.reportClearDraws(i)}},Ut.prototype.clearAll=function(){this.logger.info(this.loggerModuleName,"clearAll"),this.report.reportCleanAll(),this.addRealtimeData({action:o.PROTOCOL_ACTION.RESET_DATA_ACTION,seq:a.getSeq()}),this.sendRequest(),this.resetData(),this.removeAllElement()},Ut.prototype.addBackgroundPic=function(t){var e=this,i=t.boardIds,r=t.urls,n=t.type,s=void 0===n?f.BACKGROUND_TYPE.IMAGE:n,l=t.needReport,d=void 0===l||l,c=t.position,u=void 0===c?C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER:c;this.logger.info(this.loggerModuleName,"addBackgroundPic",{param:{boardIds:i,urls:r,type:s,needReport:d,position:u}});var p=[],g=[];if(Array.isArray(i)){if(!Array.isArray(r)||i.length!=r.length)return!1;p=i,g=r}else{if(Array.isArray(r))return!1;p=[i],g=[r]}var _=[];this.cancelSelect(),p.forEach((function(t,i){t===e.currentBoard&&d&&e.addRealtimeData({action:o.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:encodeURI(g[i]),time:h.getTimeStamp(),seq:a.getSeq(),mode:u,type:s,cleanBoard:0}),e.data[t]||e.addBoard(t),e.backgroundPic[t].url=g[i],e.backgroundPic[t].show=!0,e.backgroundPic[t].mode=u,e.backgroundPic[t].type=s,_.push({type:"image",seq:a.getSeq(),content:{fid:h.boardId2Fid(t),boardId:t,url:g[i],updateTime:h.getTimeStamp(),type:s,mode:u}})})),d&&this.report.reportImages(_),this.setNeedDraw(!0)},Ut.prototype.setBackgroundPic=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER;this.logger.info(this.loggerModuleName,"setBackgroundPic",{param:{boardId:t,url:e,position:i}});var r=h.boardId2Fid(t);e&&r==o.COMMON_GROUP&&(this.cancelSelect(),this.addBackgroundPic({boardIds:t||this.currentBoard,urls:e,type:f.BACKGROUND_TYPE.IMAGE,needReport:!1,position:i}),this.sendRequest(t,[{action:o.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:e,time:h.getTimeStamp(),seq:a.getSeq(),mode:i,type:f.BACKGROUND_TYPE.IMAGE,cleanBoard:0}]),this.report.reportImage(t||this.currentBoard,e,i))},Ut.prototype.setBackgroundH5=function(t){this.logger.info(this.loggerModuleName,"setBackgroundH5",{param:{url:t}}),t&&this.currentGroup==o.COMMON_GROUP&&(this.cancelSelect(),this.addBackgroundPic({boardIds:this.currentBoard,urls:t,type:f.BACKGROUND_TYPE.H5,needReport:!1}),this.addRealtimeData({action:o.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:h.getTimeStamp(),seq:a.getSeq(),mode:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,type:f.BACKGROUND_TYPE.H5,cleanBoard:0}),this.report.reportImage(this.currentBoard,t,C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,f.BACKGROUND_TYPE.H5))},Ut.prototype.updateCurrentFillMode=function(t){this.logger.info(this.loggerModuleName,"updateCurrentFillMode",{param:{position:t}});var e=this.backgroundPic[this.currentBoard];e&&e.url&&this.setBackgroundPic(this.currentBoard,e.url,t)},Ut.prototype.deleteBackgroundPic=function(t){this.logger.info(this.loggerModuleName,"deleteBackgroundPic",{param:{boardId:t}}),this.cancelSelect(),this.backgroundPic[t].show=!1,this.setNeedDraw(!0)},Ut.prototype.cancelBackgroundPic=function(){this.logger.info(this.loggerModuleName,"cancelBackgroundPic"),this.cancelSelect(),this.deleteBackgroundPic(this.currentBoard),this.img.style.display="none",this.addRealtimeData({action:o.PROTOCOL_ACTION.DELETE_BG_IMG_ACTION,seq:this.getSeq()}),this.report.reportImage(this.currentBoard,"",0)},Ut.prototype.clearGlobalBgColor=function(){this.logger.info(this.loggerModuleName,"clearGlobalBgColor"),this.setGlobalBackgroundColor(this.options.globalBackgroundColor)},Ut.prototype.updateVideo=function(t,e,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=this.getFileInfo(t);if(null!=n){this.cancelSelect(),e>=0&&(n.status=e),i>=0&&(n.progress=i);var s=h.getTimeStamp();n.timestamp=s,r&&(this.addRealtimeData({action:o.PROTOCOL_ACTION.VIDEO_EVENT_ACTION,time:s,seq:a.getSeq(),fid:t,status:n.status,progress:n.progress}),this.sendRequest(),this.report.reportAddFile(n))}},Ut.prototype.switchPage=function(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.logger.info(this.loggerModuleName,"switchPage",{param:{index:i}}),t=(e=this.getBoardByGroup(this.getCurrentFile()))[i=Math.min(i,e.length-1)],this.switchBoard(t)},Ut.prototype.switchH5Board=function(t){var e=t.fid,i=t.slideIndex,r=t.stepIndex,n=t.resetStep,s=t.usePrevNextStepMethod;this.logger.info(this.loggerModuleName,"switchH5Board",{param:{fid:e,slideIndex:i,stepIndex:r,resetStep:n,usePrevNextStepMethod:s}}),this.cancelSelect();var l=this.getBoardByGroup(e),d=this.getFileInfo(e),c=l[i],u=!1;if(c!==this.currentBoard&&(u=!0),this.currentBoard=c,this.currentGroup=e,d.currentPageIndex===i&&d.currentPageStep==Math.max(0,r))return c;d.currentPageIndex=i,d.currentPageStep=Math.max(0,r),d.pageCount=l.length;var p=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";p&&this.addRealtimeData({action:o.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:p,time:h.getTimeStamp(),seq:a.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var f=a.getSeq();return this.addRealtimeData({action:o.PROTOCOL_ACTION.SWITCH_ACTION,time:h.getTimeStamp(),seq:f,toBoardId:c,deleteBoards:[],deleteFiles:[],page:d.currentPageIndex,step:r,resetStep:n,usePrevNextStepMethod:s}),this.maxSeq=f,this.sendRequest(),this.report.reportSwitchBoard({boardId:c,fid:d.fid,url:d.downloadURL,type:d.type,page:d.currentPageIndex,step:d.currentPageStep,ratio:d.ratio,scale:d.scale}),this.report.reportAddFile(d),u&&this.event.fire(this,"TEB_GOTOBOARD",c,e),this.setNeedDraw(!0),c},Ut.prototype.switchBoard=function(t){if(this.logger.info(this.loggerModuleName,"switchBoard",{param:{boardId:t}}),this.cancelSelect(),t&&!this.data[t])return!1;t||(t=this.createBoardId(),this.addBoard(t)),this.currentBoard=t,this.currentGroup=h.boardId2Fid(t);var e=this.getBoardByGroup(this.currentGroup),i=this.getFileInfo(this.currentGroup),r=e.indexOf(t),n=i.currentPageStep;i.currentPageIndex=r,i.currentPageStep=n,i.pageCount=e.length;var s=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";s&&this.addRealtimeData({action:o.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:s,time:h.getTimeStamp(),seq:a.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var l=a.getSeq();return this.addRealtimeData({action:o.PROTOCOL_ACTION.SWITCH_ACTION,time:h.getTimeStamp(),seq:l,toBoardId:t,deleteBoards:[],deleteFiles:[],page:i.currentPageIndex,step:n}),this.maxSeq=l,this.sendRequest(),this.report.reportSwitchBoard({boardId:t,fid:i.fid,url:i.downloadURL,type:i.type,page:i.currentPageIndex,step:i.currentPageStep,ratio:i.ratio,scale:i.scale}),this.report.reportAddFile(i),this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,h.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),t},Ut.prototype.setGlobalBackgroundColor=function(){var t,e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.COLOR.WHITE,r=arguments.length>1?arguments[1]:void 0;(this.logger.info(this.loggerModuleName,"setGlobalBackgroundColor",{param:{color:i,noSend:r}}),this.globalBackgroundColor=h.color2RgbaColor(i),this.boardList.forEach((function(t){e.backgroundColor[t]=e.globalBackgroundColor})),this.setNeedDraw(!0),r)||(t=h.rgbaColor2DecimalColor(this.globalBackgroundColor),this.addRealtimeData({action:o.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),color:t,isGlobal:1}),this.report.reportGlobalBgColor(t))},Ut.prototype.getGlobalBackgroundColor=function(){return this.globalBackgroundColor},Ut.prototype.preloadBoard=function(){for(var t=[],e=0;e<this.groups.length;++e){var i=this.groups[e];if(i.type==o.FILE_TYPE.IMG){var r=this.getBoardByGroup(i.fid);t=t.concat(r)}else if(i.type==o.FILE_TYPE.H5&&!this.pptFilePreloaded[i.fid]){if(i.fid===this.currentGroup){this.pptFilePreloaded[i.fid]=!0;continue}!function(t,e){setTimeout((function(){var e=document.createElement("iframe");e.setAttribute("style","position:fixed;visibility:hidden;width:0px;height:0px;border:none;"),document.body.appendChild(e),e.onload=function(){setTimeout((function(){e.remove()}),100)},e.setAttribute("src",t)}),1e3)}(i.downloadURL+"?page=".concat(i.currentPageIndex,"&step=").concat(i.currentPageStep,"&fid=").concat(encodeURIComponent(i.fid))),this.pptFilePreloaded[i.fid]=!0}}if(0!==t.length)for(var n=t.indexOf(this.currentBoard),s=-this.preloadDepth;s<this.preloadDepth;++s){var a=n+s;if(!(a<0||a>=t.length)){var l=t[a],h=this.backgroundPic[l];if(h&&!h.preloaded&&void 0!==h.url&&""!==h.url){if(0===s){h.preloaded=!0;continue}h.type===f.BACKGROUND_TYPE.IMAGE?function(t,e){setTimeout((function(){var e=new Image;e.onload=function(){},e.onabort=function(){},e.onerror=function(){},e.src=t}),e)}(h.url,200*(Math.abs(s)-1)):h.type===f.BACKGROUND_TYPE.H5&&function(t,e){setTimeout((function(){var e=document.createElement("iframe");e.setAttribute("style","position:fixed;visibility:hidden;width:0px;height:0px;border:none;"),document.body.appendChild(e),e.onload=function(){e.remove()},e.setAttribute("src",t)}),e)}(h.url,200*(Math.abs(s)-1)),h.preloaded=!0}}}},Ut.prototype.resetOperation=function(){this.opData[this.currentBoard]=this.opData[this.currentBoard].slice(0,this.opIndex[this.currentBoard])},Ut.prototype.collectLineData=function(){var t=this,e=this;return{start:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=a.getSeq(),s=h.getTimeStamp();t.belongLineSeq=n;var l=new m(t.identifier,{action:o.PROTOCOL_ACTION.LINE_START_ACTION,color:t.color,thin:t.thin,x:e,y:i,w:t.thin,writing:r,show:!0,seq:n,belongSeq:n,time:s,timestamp:s});l.drawIndex=l.lines.length,t.seqLineMap[n]=l,t.userData[t.currentBoard][t.identifier].push(l),t._pushBoardData(t.currentBoard,l),t.opData[t.currentBoard].push(new g(t.identifier,{seq:l.seq,type:t.type})),t.opIndex[t.currentBoard]++;var d={action:o.PROTOCOL_ACTION.LINE_START_ACTION,color:h.rgbaColor2DecimalColor(l.color),scale:100,thin:l.thin,time:s,timestamp:s,seq:l.seq,belongSeq:l.belongSeq,x:e,y:i,w:l.thin,writing:r?1:0,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style};t.addRealtimeData(d)},draw:function(e,i,r){var n=t.userData[t.currentBoard][t.identifier].length,s=t.userData[t.currentBoard][t.identifier][n-1];s||(t.collectLineData().start(e,i,t.isHandwritingEnable()),n=t.userData[t.currentBoard][t.identifier].length,s=t.userData[t.currentBoard][t.identifier][n-1]),s.setBorder(e,i);var l=a.getSeq(),d=h.getTimeStamp();s.lines.push({action:o.PROTOCOL_ACTION.LINE_MOVE_ACTION,x:e,y:i,w:r,seq:l,timestamp:d}),s.drawIndex=s.lines.length;var c={action:o.PROTOCOL_ACTION.LINE_MOVE_ACTION,seq:l,belongSeq:t.belongLineSeq,x:e,y:i,w:r,timestamp:d,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style};t.addRealtimeData(c)},end:function(i,r,n){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=t.userData[t.currentBoard][t.identifier].length,d=t.userData[t.currentBoard][t.identifier][l-1];d||(t.collectLineData().start(i,r,t.isHandwritingEnable()),l=t.userData[t.currentBoard][t.identifier].length,d=t.userData[t.currentBoard][t.identifier][l-1]),d.setBorder(i,r);var c=a.getSeq(),u=h.getTimeStamp();d.lines.push({action:o.PROTOCOL_ACTION.LINE_END_ACTION,x:i,y:r,w:n||e.thin,seq:c,timestamp:u}),d.endSeq=c,d.drawIndex=d.lines.length;var p={action:o.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:t.belongLineSeq,seq:c,x:i,y:r,w:n,timestamp:u,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style};t.addRealtimeData(p);var f=[];d.lines.forEach((function(t){f.push({seq:t.seq,x:t.x,y:t.y,w:t.w,timestamp:h.getTimeStamp()})})),t.report.reportAddLine({belongSeq:t.belongLineSeq,boardId:t.currentBoard,uid:d.user,colorRGBA:h.rgbaColor2DecimalColor(t.color),scale:100,width:t.thin,writing:s?1:0,time:d.time,updateTime:h.getTimeStamp(),seq:d.seq,hidden:1*!d.show,points:f})},over:function(t,i){this.end(t,i,e.thin)}}},Ut.prototype.collectTextInputData=function(){var t=this;return{start:function(e,i){var r,o=a.getSeq();try{var n=t.data[t.currentBoard],s={seq:0,index:-1};if(n.forEach((function(r,o){if("inputtext"===r.type&&r.show&&r.user===t.identifier){var n=5/t.boardWidth*1e4,a=5/t.boardHeight*1e4,l=r.location.x-n,h=r.location.y-a,d=r.location.x+r.textWidth+n,c=r.location.y+r.textHeight+a;e>=l&&e<=d&&i>=h&&i<=c&&r.belongSeq>s.seq&&(s={seq:r.belongSeq,index:o})}})),s.index>-1){var l=t.data[t.currentBoard].splice(s.index,1)[0];l.show=!0,r=l,(t.userData[t.currentBoard][t.identifier]||[]).forEach((function(e,i){e.belongSeq===r.belongSeq&&t.userData[t.currentBoard][t.identifier].splice(i,1)}))}}catch(t){}r||((r=new T(t.identifier,{x:e,y:i,belongSeq:o})).color=t.getTextColor(),r.textSize=t.getTextSize(),r.typeFace=t.getTextFontFamily(),r.fontStyle=t.getTextFontStyle()),t.userData[t.currentBoard][t.identifier].push(r),t._pushBoardData(t.currentBoard,r);for(var h=!1,d=0,c=t.opData[t.currentBoard].length;d<c;d++)if(t.opData[t.currentBoard][d].seq===r.belongSeq){h=!0;break}return h||(t.opData[t.currentBoard].push(new g(t.identifier,{seq:r.belongSeq,type:t.type})),t.opIndex[t.currentBoard]++),clearInterval(t.textInputTask),t.textInputTask=null,t.lastInputActionData=null,r},inputting:function(e,i,r,n,s){var l=a.getSeq(),d=e.boardId||t.currentBoard;if(t.userData[d][t.identifier].length,i){i.text=r,i.seq=l,i.textWidth=n/t.boardWidth*1e4,i.textHeight=s/t.boardHeight*1e4;var c={action:o.PROTOCOL_ACTION.INPUT_TEXT_ACTION,seq:l,belongSeq:i.belongSeq,color:h.rgbaColor2DecimalColor(i.color),scale:100,typeFace:i.typeFace,textSize:Math.floor(i.textSize),fontStyle:i.fontStyle,time:h.getTimeStamp(),x:i.location.x,y:i.location.y,text:encodeURI(escape(r)),textWidth:i.textWidth,textHeight:i.textHeight};t.realTimeData=t.realTimeData.filter((function(t){return t.action!==o.PROTOCOL_ACTION.INPUT_TEXT_ACTION||t.belongSeq!==i.belongSeq})),t.addRealtimeData(c),t.lastInputActionData=c,function(e){t.textInputTask||(t.textInputTask=setInterval((function(){if(e!=t.getCurrentBoard())return clearInterval(t.textInputTask),void(t.textInputTask=null);t.realTimeData=t.realTimeData.filter((function(e){return e.action!==o.PROTOCOL_ACTION.INPUT_TEXT_ACTION||e.belongSeq!==t.lastInputActionData.belongSeq})),t.lastInputActionData.seq=a.getSeq(),t.addRealtimeData(t.lastInputActionData)}),3e3))}(d)}},draw:function(e,i,r,n,s){clearInterval(t.textInputTask),t.textInputTask=null,t.lastInputActionData=null;var l=e.boardId||t.currentBoard,d=t.userData[l][t.identifier].length;if(!r&&!r.trim()){for(var c=-1,u=0,p=t.opData[l].length;u<p;u++)if(t.opData[l][u].seq===i.belongSeq){c=u;break}return c>-1&&(t.opData[l].splice(c,1),t.opIndex[l]--),t.userData[l][t.identifier].splice(d-1,1),void t.data[l].splice(t.data[l].length-1,1)}if(i){var f=a.getSeq();i.seq=f,i.text=r,i.show=!0,i.textWidth=n/t.boardWidth*1e4,i.textHeight=s/t.boardHeight*1e4,t.report.reportAddText({belongSeq:i.belongSeq,time:i.time,boardId:l,uid:i.user,x:Math.floor(i.location.x),y:Math.floor(i.location.y),colorRGBA:h.rgbaColor2DecimalColor(i.color),scale:100,updateTime:h.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:Math.floor(i.textSize),fontStyle:i.fontStyle,text:encodeURI(escape(r)),text_wh:"".concat(i.textWidth,",").concat(i.textHeight)});var g={action:o.PROTOCOL_ACTION.INPUT_TEXT_ACTION,seq:i.seq,belongSeq:i.belongSeq,color:h.rgbaColor2DecimalColor(i.color),scale:100,typeFace:i.typeFace,textSize:Math.floor(i.textSize),fontStyle:i.fontStyle,time:h.getTimeStamp(),x:i.location.x,y:i.location.y,text:encodeURI(escape(r)),textWidth:i.textWidth,textHeight:i.textHeight};t.sendRequest(l,[g]),t.setNeedDraw(!0)}},clearTask:function(){clearInterval(t.textInputTask),t.textInputTask=null,t.lastInputActionData=null}}},Ut.prototype.collectEraserData=function(t,e){var i=this.eraserImpactCheck(t,e,this.thin/2);if(i.length>0){this.opData[this.currentBoard].push(new g(this.identifier,{seq:i,type:this.type})),this.opIndex[this.currentBoard]++;var r={action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),x:0,y:0,lines:i};i.length&&(this.addRealtimeData(r),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:i})),this.setNeedDraw(!0)}},Ut.prototype.collectRaserData=function(){var t=this;return{start:function(e,i,r){var n=h.getTimeStamp(),s=new b(t.identifier,{action:o.PROTOCOL_ACTION.RASER_SHOW_ACTION,color:h.color2RgbaColor(f.COLOR.RED),radius:t.thin/2,x:e,y:i,timestamp:n,seq:a.getSeq(),toolType:r,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style}),l={action:o.PROTOCOL_ACTION.RASER_HIDE_ACTION,r:s.radius,seq:s.seq,x:e,y:i,timestamp:n,toolType:r,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style,ignore:!0};t.addRealtimeData(l),t.event.fire(t,"draw_laser",s)},draw:function(e,i,r,n,s){var l=h.getTimeStamp(),d=new b(t.identifier,{action:o.PROTOCOL_ACTION.RASER_SHOW_ACTION,color:h.color2RgbaColor(f.COLOR.RED),radius:t.thin/2,x:e,y:i,timestamp:l,seq:a.getSeq(),toolType:r,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style});1==r&&n||s&&t.addRealtimeData({action:o.PROTOCOL_ACTION.RASER_SHOW_ACTION,seq:d.seq,x:e,y:i,r:d.radius,timestamp:l,toolType:r,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style}),t.event.fire(t,"draw_laser",d)},end:function(e,i,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=o.PROTOCOL_ACTION.RASER_SHOW_ACTION;n||(s=o.PROTOCOL_ACTION.RASER_HIDE_ACTION);var l=h.getTimeStamp(),d=new b(t.identifier,{action:s,color:h.color2RgbaColor(f.COLOR.RED),radius:t.thin/2,x:e,y:i,timestamp:l,seq:a.getSeq(),toolType:r,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style}),c={action:s,seq:d.seq,r:t.thin/2,x:e,y:i,timestamp:l,toolType:r,title:t.toolTypeTitleStyle.title,style:t.toolTypeTitleStyle.style};t.addRealtimeData(c),t.event.fire(t,"draw_laser",d)},over:function(t){this.end(-1e4,-1e4,t,!1)}}},Ut.prototype.collectSelectData=function(){var t=this;return{start:function(e,i){t.beforeMoveType="select";var r=new S(t.identifier,{startx:e,starty:i,x:e,y:i});t.seq=r.seq,t.userData[t.currentBoard][t.identifier].push(r),t._pushBoardData(t.currentBoard,r)},draw:function(e,i){var r=t.userData[t.currentBoard][t.identifier].length;t.userData[t.currentBoard][t.identifier][r-1].location={x:e,y:i},t.setNeedDraw(!0)},end:function(e,i,r,o){for(var n=0,s=e>r?e:r,a=i>o?i:o,l=e+r-s,h=i+o-a,d=1e4,u=1e4,p=0,f=0,g=t.data[t.currentBoard].length-1;g>=0;g--){var _=t.data[t.currentBoard][g];if(!(t.accessibleUsers&&t.accessibleUsers.length>0)||t.accessibleUsers.includes(_.user))if("line"==_.type&&_.show)s>=_.border.maxX&&a>=_.border.maxY&&l<=_.border.minX&&h<=_.border.minY&&(_.select=!0,t.selectedList.push(_),d=(d=d<_.border.minX?d:_.border.minX)<_.border.maxX?d:_.border.maxX,u=(u=u<_.border.minY?u:_.border.minY)<_.border.maxY?u:_.border.maxY,p=(p=p>_.border.minX?p:_.border.minX)>_.border.maxX?p:_.border.maxX,f=(f=f>_.border.minY?f:_.border.minY)>_.border.maxY?f:_.border.maxY);else if("graph"==_.type&&_.show)s>=_.endPoint.x&&a>=_.endPoint.y&&l<=_.startPoint.x&&h<=_.startPoint.y&&(_.select=!0,t.selectedList.push(_),d=(d=d<_.startPoint.x?d:_.startPoint.x-_.thin)<_.endPoint.x?d:_.endPoint.x-_.thin,u=(u=u<_.startPoint.y?u:_.startPoint.y-_.thin)<_.endPoint.y?u:_.endPoint.y-_.thin,p=(p=p>_.startPoint.x?p:_.startPoint.x+_.thin)>_.endPoint.x?p:_.endPoint.x+_.thin,f=(f=f>_.startPoint.y?f:_.startPoint.y+_.thin)>_.endPoint.y?f:_.endPoint.y+_.thin);else if("inputtext"==_.type&&_.show&&_.text){var m=_.location.x,y=_.location.y,T=_.location.x+_.textWidth,v=_.location.y+_.textHeight;s>=T&&a>=v&&l<=m&&h<=y&&(_.select=!0,t.selectedList.push(_),d=(d=d<_.location.x?d:_.location.x)<T?d:T,u=(u=u<_.location.y?u:_.location.y)<v?u:v,p=(p=p>_.location.x?p:_.location.x)>T?p:T,f=(f=f>_.location.y?f:_.location.y)>v?f:v)}else"imageElement"==_.type&&_.show?s>=_.rectArea.maxX&&a>=_.rectArea.maxY&&l<=_.rectArea.minX&&h<=_.rectArea.minY&&(++n,t.selectedList.push(_)):"element"==_.type&&_.show&&s>=_.rectArea.maxX&&a>=_.rectArea.maxY&&l<=_.rectArea.minX&&h<=_.rectArea.minY&&(++n,t.selectedList.push(_))}t.selectedList.length>0&&(t.selectedList.length===n?t.selectArea={x:-10,y:-10,width:0,height:0}:t.selectArea={x:d,y:u,width:p-d,height:f-u}),t.userData[t.currentBoard][t.identifier][t.userData[t.currentBoard][t.identifier].length-1].show=!1,t.setNeedDraw(!0),t.selectedList.length&&t.event.fire(t,c.TEB_RECTSELECTED)}}},Ut.prototype.collectPointSelectData=function(t,e){this.beforeMoveType="pointselect";for(var i=!1,r=1e4,o=1e4,n=0,s=0,a=this.data[this.currentBoard].length-1;a>=0;a--){var l=this.data[this.currentBoard][a];if(!(this.accessibleUsers&&this.accessibleUsers.length>0)||this.accessibleUsers.includes(l.user))if("line"==l.type&&l.show){if(l.impactCheck(t,e,this.thin)){i=!0,l.select=!0,this.selectedList=[l],r=(r=r<l.border.minX?r:l.border.minX)<l.border.maxX?r:l.border.maxX,o=(o=o<l.border.minY?o:l.border.minY)<l.border.maxY?o:l.border.maxY,n=(n=n>l.border.minX?n:l.border.minX)>l.border.maxX?n:l.border.maxX,s=(s=s>l.border.minY?s:l.border.minY)>l.border.maxY?s:l.border.maxY;break}}else if("graph"==l.type&&l.show){if(l.impactCheck(this.boardWidth,this.boardHeight,t,e,this.thin/2)){i=!0,l.select=!0,this.selectedList=[l],r=(r=r<l.startPoint.x?r:l.startPoint.x-l.thin)<l.endPoint.x?r:l.endPoint.x-l.thin,o=(o=o<l.startPoint.y?o:l.startPoint.y-l.thin)<l.endPoint.y?o:l.endPoint.y-l.thin,n=(n=n>l.startPoint.x?n:l.startPoint.x+l.thin)>l.endPoint.x?n:l.endPoint.x+l.thin,s=(s=s>l.startPoint.y?s:l.startPoint.y+l.thin)>l.endPoint.y?s:l.endPoint.y+l.thin;break}}else if("inputtext"===l.type&&l.show&&l.text){if(l.impactCheck(t,e,this.thin/2)){i=!0,l.select=!0,this.selectedList=[l];var h=l.getRectArea();r=Math.min(h.minX,r),o=Math.min(h.minY,o),n=Math.max(h.maxX,n),s=Math.max(h.maxY,s);break}}else if("imageElement"===l.type&&l.show){if(l.pointImpactCheck([t,e])){i=!0,this.selectedList=[l],r=0,o=0,n=0,s=0;break}}else if("element"===l.type&&l.show&&l.impactCheck(t,e,this.thin/2)){i=!0,this.selectedList=[l],r=0,o=0,n=0,s=0;break}}i&&(this.selectArea={x:r,y:o,width:n-r,height:s-o},this.setNeedDraw(!0))},Ut.prototype.collectMoverData=function(){var t=this;return{beforeStart:function(e,i){if(0==t.selectedList.length)return!1;var r=!1;return e>t.selectArea.x&&e<t.selectArea.x+t.selectArea.width&&i>t.selectArea.y&&i<t.selectArea.y+t.selectArea.height&&(r=!0),!!r||(t.cancelSelect(),!1)},start:function(e,i){var r=[];t.selectedList.forEach((function(t){"line"==t.type?r.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?r.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"==t.type&&r.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})})),t.opData[t.currentBoard].push(new g(t.identifier,{seq:{origin:r,final:[]},type:"move"}))},draw:function(e,i,r,o){if(t.selectedList.length>0){for(var n=0;n<t.selectedList.length;n++){var s=t.selectedList[n],a=e-r,l=i-o;"line"==s.type?(s.border.maxX+=a,s.border.minX+=a,s.border.maxY+=l,s.border.minY+=l,s.lines.forEach((function(t){t.x+=a,t.y+=l}))):"graph"==s.type?(s.startPoint.x+=a,s.startPoint.y+=l,s.endPoint.x+=a,s.endPoint.y+=l):"inputtext"===s.type&&(s.location.x+=a,s.location.y+=l)}t.selectArea.x+=a,t.selectArea.y+=l,t.setNeedDraw(!0)}},end:function(){t.setNeedDraw(!0);var e=[];if(0!=t.selectedList.length){t.selectedList.forEach((function(t){"line"==t.type?e.push({seq:t.seq,x:t.lines[0].x,y:t.lines[0].y,uid:t.user}):"graph"==t.type?e.push({seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y,uid:t.user}):"inputtext"===t.type&&e.push({seq:t.belongSeq,x:t.location.x,y:t.location.y,uid:t.user})}));var i={action:o.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,seq:a.getSeq(),moves:e,time:h.getTimeStamp()};t.addRealtimeData(i);var r=[];t.selectedList.forEach((function(t){"line"==t.type?r.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?r.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"===t.type&&r.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})})),t.opData[t.currentBoard][t.opData[t.currentBoard].length-1].seq.final=r,t.opIndex[t.currentBoard]++;var n=[];e.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r];if("line"==o.type&&e.seq==o.seq){var s=[];o.lines.forEach((function(t){s.push({seq:t.seq,x:t.x,y:t.y})})),n.push({type:"addLine",seq:a.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getTimeStamp(),seq:o.seq,hidden:0,points:s}})}else if("graph"==o.type&&e.seq==o.startPoint.seq){var l={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle",square:"addPatternRectangle"}[o.graph],seq:a.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getTimeStamp(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}};"oval"==o.graph||"circle"==o.graph?l.content.fillRect=o.solid?1:0:"rect"==o.graph&&(l.content.fillRect=o.solid?1:0,l.content.cornerRadius=0),n.push(l)}else"inputtext"===o.type&&e.seq==o.belongSeq&&n.push({type:"addText",seq:a.getSeq(),content:{belongSeq:o.belongSeq,time:h.getTimeStamp(),boardId:t.currentBoard,uid:o.user,x:o.location.x,y:o.location.y,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:o.scale,updateTime:h.getTimeStamp(),hidden:0,typeface:o.typeFace,textSize:o.textSize,fontStyle:o.fontStyle,text:encodeURI(escape(o.text)),text_wh:"".concat(o.textWidth,",").concat(o.textHeight)}})}})),t.report.reportGraphData(n)}}}},Ut.prototype.collectGraphData=function(){var t=this;return{start:function(e,i){var r=t.type.split("-")[1],o=new E(t.identifier,{graph:r,color:t.color,thin:t.thin,seq:a.getSeq(),beginPoint:{x:e,y:i,seq:a.getSeq()},endPoint:{x:e,y:i,seq:a.getSeq()},show:!0,solid:t.type.indexOf("solid")>-1});"line"==o.graph&&(o.style=Object.assign({},t.lineStyle)),"circle"!=o.graph&&"oval"!=o.graph||t.ovalDrawMode!=Y.TEDU_BOARD_OVAL_DRAW_MODE_FIX_CENTER||(t.ovalCenterPoint=Object.assign({},o.startPoint)),t.seq=o.seq,t.userData[t.currentBoard][t.identifier].push(o),t._pushBoardData(t.currentBoard,o),t.opData[t.currentBoard].push(new g(t.identifier,{seq:o.startPoint.seq,type:"graph"})),t.opIndex[t.currentBoard]++},draw:function(e,i){var r=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][r-1];o.endPoint.x=e,o.endPoint.y=i,t.isDrawing=!0,"circle"!=o.graph&&"oval"!=o.graph||t.ovalDrawMode!=Y.TEDU_BOARD_OVAL_DRAW_MODE_FIX_CENTER||(o.startPoint.x=2*t.ovalCenterPoint.x-e,o.startPoint.y=2*t.ovalCenterPoint.y-i),t.graphEndPoint=JSON.parse(JSON.stringify(o.endPoint)),"circle"==o.graph&&t.circleFix(o),"square"==o.graph&&t.squareFix(o),t.setNeedDraw(!0)},end:function(e,i){t.isDrawing=!1;var r=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][r-1];o.endPoint.x=e,o.endPoint.y=i,"square"==o.graph&&t.squareFix(o),"circle"==o.graph&&t.circleFix(o),-1==["line","square","rect"].indexOf(o.graph)&&t.graphFix(o),t.setNeedDraw(!0),t.beforeToolType!=t.initTypeConstant&&(t.setType(f.BOARD_ACTION_TYPE[t.types[t.beforeToolType]]),t.beforeToolType=t.initTypeConstant);var n={seq:o.seq,time:h.getTimeStamp(),color:h.rgbaColor2DecimalColor(t.color),scale:100,thin:t.thin,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}};n.action={line:10,oval:11,circle:11,rect:12,square:12}[o.graph];var s={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle",square:"addPatternRectangle"}[o.graph],seq:a.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.rgbaColor2DecimalColor(t.color),scale:100,width:t.thin,time:o.time,updateTime:h.getTimeStamp(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}},l=1*o.solid;10==n.action&&(n.style=Object.assign({},t.lineStyle),s.content.style=Object.assign({},t.lineStyle)),11==n.action&&(n.fillRect=l,s.content.fillRect=l),12==n.action&&(n.fillRect=l,s.content.fillRect=l,n.cornerRadius=0,s.content.cornerRadius=0),t.addRealtimeData(n),t.report.reportGraphData([s])},over:function(t,e){this.end(t,e)}}},Ut.prototype.collectDragData=function(){var t=this;return{start:function(t){},draw:function(e,i,r,o,n){var s,a,l,h,d=e.currentTarget.getElementsByClassName("tx_board_canvas_box")[0],c=r-n,u=(i-o)/t.boardWidth*100,p=c/t.boardHeight*100;t.boardWidth/t.boardHeight>t.containerWidth/t.containerHeight?(t.boardHeight>t.containerHeight?(l=50+(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,h=50-(t.boardHeight-t.containerHeight)/2/t.boardHeight*100):(l=50,h=50),s=50+(t.boardWidth-t.containerWidth)/2/t.boardWidth*100,a=50-(t.boardWidth-t.containerWidth)/2/t.boardWidth*100):(l=50+(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,h=50-(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,t.boardWidth>t.containerWidth?(s=50+(t.boardWidth-t.containerWidth)/2/t.boardWidth*100,a=50-(t.boardWidth-t.containerWidth)/2/t.boardWidth*100):(s=50,a=50));var f=1*d.style.left.replace("%","")+u;f=Math.min(s,Math.max(a,f)),d.style.left=f+"%";var g=1*d.style.top.replace("%","")+p;g=Math.min(l,Math.max(h,g)),d.style.top=g+"%";var _=d.getAttribute("style");-1===_.indexOf("-webkit-transform")&&(_+="-webkit-transform: translateX(-50%) translateY(-50%);"),d.setAttribute("style",_),t.dragDataList.getDragData(t.currentBoard)?t.dragDataList.updateDragData(t.currentBoard,{xOffset:f,yOffset:g}):t.dragDataList.addDragData(t.currentBoard,new G({scale:t.getBoardScale(),xOffset:f,yOffset:g})),t.addRealtimeData(t.dragDataList.getDragData(t.currentBoard).getRealTimeData())},scrollEventDraw:function(e,i,r){e.style.left=i+"%",e.style.top=r+"%";var o=e.getAttribute("style");-1===o.indexOf("-webkit-transform")&&(o+="-webkit-transform: translateX(-50%) translateY(-50%);"),e.setAttribute("style",o),t.dragDataList.getDragData(t.currentBoard)?t.dragDataList.updateDragData(t.currentBoard,{xOffset:i,yOffset:r}):t.dragDataList.addDragData(t.currentBoard,new G({scale:t.getBoardScale(),xOffset:i,yOffset:r})),t.addRealtimeData(t.dragDataList.getDragData(t.currentBoard).getRealTimeData()),t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))},scaleDraw:function(e,i){if(i.length){var r,n=t.dragDataList.getDragData(t.currentBoard);n||(n=new G({scale:o.SCALE,xOffset:50,yOffset:50}),t.dragDataList.addDragData(t.currentBoard,n)),r=parseInt(e*i[i.length-1]),r=Math.max(o.MIN_SCALE,Math.min(o.MAX_SCALE,r)),n.scale=r,t.setNeedDraw(!0)}},end:function(){t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))},touchEnd:function(e){if(e.length){var i=t.dragDataList.getDragData(t.currentBoard);t.setBoardScale(i.scale)}else t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))},over:function(){t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))}}},Ut.prototype.cancelSelect=function(){for(var t=this.selectedList.length,e=0;e<t;e++)this.selectedList[e].select=!1;this.selectedList=[],this.selectArea={x:0,y:0,width:0,height:0},t&&this.setNeedDraw(!0)},Ut.prototype.deleteSelectedData=function(){this.logger.info(this.loggerModuleName,"deleteSelectedData");var t=[];this.selectedList.forEach((function(e){"line"===e.type?t.push({uid:e.user,seq:e.seq}):"graph"===e.type?t.push({uid:e.user,seq:e.startPoint.seq}):"inputtext"===e.type||"imageElement"===e.type?t.push({uid:e.user,seq:e.belongSeq}):"element"===e.type&&t.push({uid:e.user||e._user,seq:e.belongSeq}),e.show=!1})),this.opData[this.currentBoard].push(new g(this.identifier,{seq:t,type:"delete"})),this.opIndex[this.currentBoard]++;var e={action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),x:0,y:0,lines:t};t.length&&(this.addRealtimeData(e),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:t})),this.cancelSelect()},Ut.prototype.deleteBoardData=function(){var t=this;this.logger.info(this.loggerModuleName,"deleteBoardData");var e=[];this.data[this.currentBoard].forEach((function(i){t.accessibleUsers&&t.accessibleUsers.length>0&&!t.accessibleUsers.includes(i.user)||("line"===i.type?e.push({uid:i.user,seq:i.seq}):"graph"===i.type?e.push({uid:i.user,seq:i.startPoint.seq}):"inputtext"===i.type&&e.push({uid:i.user,seq:i.belongSeq}),i.show=!1)}));var i={action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),x:0,y:0,lines:e};e.length&&(this.addRealtimeData(i),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:e}))},Ut.prototype.eraserImpactCheck=function(t,e,i){var r=this,o=[],n=this.data[this.currentBoard];return n&&n.forEach((function(n){r.accessibleUsers&&r.accessibleUsers.length>0&&!r.accessibleUsers.includes(n.user)||("line"==n.type&&n.show?n.impactCheck(t,e,i)&&(n.show=!1,o.push({uid:n.user,seq:n.seq})):"graph"==n.type&&n.show?n.impactCheck(r.boardWidth,r.boardHeight,t,e,i)&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq})):"inputtext"==n.type&&n.show?n.impactCheck(t,e,i)&&(n.show=!1,o.push({uid:n.user,seq:n.belongSeq})):"element"!=n.type&&"imageElement"!=n.type||!n.show||n.impactCheck(t,e,i)&&(n.show=!1,o.push({uid:n.user||n._user,seq:n.belongSeq}),"element"===n.type&&r.event.fire(r,c.TEB_REMOVEELEMENT,[String(n.belongSeq)])))})),o},Ut.prototype.circleFix=function(t){var e,i,r=t.startPoint.x,o=t.startPoint.y,n=t.endPoint.x,s=t.endPoint.y,a=(e=t.startPoint,i=t.endPoint,Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))),l=Math.floor(Math.sqrt(a*a/2));r<=n?o<=s?(t.endPoint.x=r+l,t.endPoint.y=o+Math.floor(l*this.boardWidth/this.boardHeight)):(t.endPoint.x=r+l,t.endPoint.y=o-Math.floor(l*this.boardWidth/this.boardHeight)):o<=s?(t.endPoint.x=r-l,t.endPoint.y=o+Math.floor(l*this.boardWidth/this.boardHeight)):(t.endPoint.x=r-l,t.endPoint.y=o-Math.floor(l*this.boardWidth/this.boardHeight))},Ut.prototype.graphFix=function(t){var e=t.startPoint.x,i=t.startPoint.y,r=t.endPoint.x,o=t.endPoint.y;t.startPoint={x:e>r?r:e,y:i>o?o:i,seq:t.startPoint.seq},t.endPoint={x:e>r?e:r,y:i>o?i:o,seq:t.endPoint.seq}},Ut.prototype.squareFix=function(t){var e=t.startPoint.x,i=t.startPoint.y,r=t.endPoint.x,o=t.endPoint.y,n=Math.abs(e-r);e<=r?i<=o?(t.endPoint.x=e+n,t.endPoint.y=i+Math.floor(n*this.boardWidth/this.boardHeight)):(t.endPoint.x=e+n,t.endPoint.y=i-Math.floor(n*this.boardWidth/this.boardHeight)):i<=o?(t.endPoint.x=e-n,t.endPoint.y=i+Math.floor(n*this.boardWidth/this.boardHeight)):(t.endPoint.x=e-n,t.endPoint.y=i-Math.floor(n*this.boardWidth/this.boardHeight))},Ut.prototype.sendRequest=function(t,e){if(this.permissions){var i=JSON.parse(JSON.stringify(e||this.realTimeData));t=t||this.currentBoard,i.forEach((function(e,i){e.boardId=t}));var r={seq:a.getSeq(),timestamp:h.getTimeStamp(),value:{boardId:t,operator:this.identifier,actions:i}};e||(this.realTimeData=[]),i.length&&this.fireSyncDataEvent(t,r)}},Ut.prototype.fireSyncDataEvent=function(t,e){var i=this,r=JSON.stringify(e);r.length>o.REALTIMEDATA_MAX_LENGTH?this.uploadBoardMessageToCos(r).then((function(e){var r={seq:a.getSeq(),timestamp:h.getTimeStamp(),value:{boardId:t,operator:i.identifier,actions:[{action:o.PROTOCOL_ACTION.FILE_MESSAGE_ACTION,seq:a.getSeq(),url:e,boardId:t}]}};i.addSendAckData(JSON.stringify(r),!1),i.event.fire(i,"TEB_SYNCDATA",r)})):(this.addSendAckData(r,!1),this.event.fire(this,"TEB_SYNCDATA",e))},Ut.prototype.addHistory=function(t,e){var i=this;this.logger.info(this.loggerModuleName,"addHistory",{param:{isRenderFace:e}});var r=this;this.sortBoard(),t.forEach((function(t){var e,n;i.seqFilter[t.seq+""]=!0;try{t.content=JSON.parse(t.content)}catch(t){}if("setGlobalBG"===t.type);else if("createBoards"===t.type){var s=[];t.content&&t.content.createBoards.forEach((function(t){(e=t)&&!r.userData[e]&&s.push(e)})),s.length&&r.addBoard(s,!1)}else if("addFile"===t.type){for(var a=t.content.fid,l=t.content.title,d=t.content.downloadURL,c=t.content.pageCount,u=t.content.currentPageIndex,p=t.content.currentPageStep||0,g=t.content.timestamp,_=(t.content.updateTime,t.content.uid),y=t.content.platform,v=t.content.type,S=t.content.ratio,b=t.content.scale,O=t.content.status,D=t.content.progress,A=!!t.content.isTranscodeFile,I=!1,x=0,w=r.groups.length;x<w;x++){var R=r.groups[x];if(R.fid==a){R.title=l,R.downloadURL=d,R.pageCount=c,R.currentPageIndex=u,R.currentPageStep=p,R.timestamp=g,R.uid=_,R.type=v,R.ratio=S,R.scale=b,R.isTranscodeFile=A,R.status=O,R.progress=D,I=!0;break}}if(I?I&&a===o.COMMON_GROUP&&r.event.fire(i,"TEB_ADDFILE",a):r.addGroupNotReport(a,l,_,d,c,u,g,y,v,p,S,b,A,O,D),!g&&!_)return;if(a!=o.COMMON_GROUP){var C=[],B=r.createBoardIdForFile(a,_,g,c,y,v),L=[],P="";v==o.FILE_TYPE.IMG&&(P=d?h.fileDownLoadUrlToPreviewUrl(d):"");for(var N=0;N<c;N++)e=B[N],P&&v==o.FILE_TYPE.IMG&&(P.endsWith("/")?L.push("".concat(P).concat(N+1,".jpg")):L.push(P+(N+1))),e&&!r.userData[e]&&C.push(e);if(r.addBoard(C,!1),d)if(v==o.FILE_TYPE.IMG)r.addBackgroundPic({boardIds:B,urls:L,type:f.BACKGROUND_TYPE.IMAGE,needReport:!1});else if(v==o.FILE_TYPE.IMAGESFILE){var M=(new Date).getTime(),k=h.decompress(d),q=(new Date).getTime();L=JSON.parse(k),r.addBackgroundPic({boardIds:B,urls:L,type:f.BACKGROUND_TYPE.IMAGE,needReport:!1});var U=q-M;r.elkLog.report("add_images_file_history",{extra_info:JSON.stringify({urls:k,urls_length:k.length,elapse:U})})}}r.sortGroup()}else e=t.content.boardId,n=t.content.uid,e&&!r.userData[e]&&r.addBoard(e,!1),e&&!r.userData[e][n]&&(r.userData[e][n]=[]);if(t.content.colorRGBA&&(t.content.color=h.color2RgbaColor(t.content.colorRGBA)),t.content.width&&(t.content.thin=t.content.width),"addLine"==t.type){for(var F,H=0;H<t.content.points.length;H++){var W=t.content.points[H].x,V=t.content.points[H].y,Y=t.content.points[H].w,X=t.content.points[H].seq,z=t.content.points[H].timestamp,j=t.content.points[0].seq;0==H?F=new m(n,{action:o.PROTOCOL_ACTION.LINE_START_ACTION,time:t.content.time,timestamp:z,color:t.content.color,thin:t.content.thin,x:W,y:V,w:Y||t.content.thin,seq:X,belongSeq:j,writing:t.content.writing,show:!t.content.hidden}):(F.lines.push({action:o.PROTOCOL_ACTION.LINE_MOVE_ACTION,x:W,y:V,w:Y||t.content.thin,belongSeq:j,seq:X,timestamp:z}),H==t.content.points.length-1&&(F.sort(),F.endSeq=t.content.points[H].seq,F.lines[H].action=o.PROTOCOL_ACTION.LINE_END_ACTION)),F.setBorder(W,V)}if(F){F.drawIndex=F.lines.length;var K=!1;r.userData[e][n].forEach((function(t,i){t.seq===F.seq&&(r.userData[e][n][i]=F,K=!0)})),K||r.userData[e][n].push(F),K=!1,r.data[e].forEach((function(t,i){t.seq===F.seq&&(r.data[e][i]=F,K=!0)})),K||r._pushBoardData(e,F),i.seqLineMap[F.belongSeq]=F}}else if("addText"==t.type){var Z=new T(n,{belongSeq:t.content.belongSeq,x:t.content.x,y:t.content.y});Z.seq=t.content.belongSeq,Z.scale=t.content.scale,Z.color=t.content.color,Z.typeFace=t.content.typeface,Z.textSize=t.content.textSize,Z.fontStyle=t.content.fontStyle,Z.time=t.content.time,Z.show=!t.content.hidden;try{Z.text=unescape(decodeURI(t.content.text))}catch(e){Z.text=t.content.text}try{var Q=t.content.text_wh.split(",");Z.textWidth=parseFloat(Q[0]),Z.textHeight=parseFloat(Q[1])}catch(t){Z.textWidth=0,Z.textHeight=0}r.userData[e][n].filter((function(t){return t.seq===Z.seq})).length||r.userData[e][n].push(Z),r.data[e].filter((function(t){return t.seq===Z.seq})).length||r._pushBoardData(e,Z)}else if("displayLine"==t.type)t.content.lines.forEach((function(e){for(var i=0;i<r.userData[r.currentBoard][n].length;i++){var o=r.userData[r.currentBoard][n][i];("line"==o.type&&o.startSeq==e.seq||"graph"==o.type&&o.startPoint.seq==e.seq||"inputtext"==o.type&&o.belongSeq==e.seq||"imageElement"==o.type&&o.belongSeq==e.seq)&&(o.show=!!t.content.display)}}));else if("addPatternLine"==t.type||"addPatternCircle"==t.type||"addPatternRectangle"==t.type){t.content.graph={addPatternLine:"line",addPatternCircle:"oval",addPatternRectangle:"rect"}[t.type],t.content.seq=t.content.beginPoint.seq,t.content.show=!t.content.hidden,t.content.solid=!!t.content.fillRect;var tt=new E(n,t.content);r.userData[e][n].filter((function(t){return t.seq===tt.seq})).length||r.userData[e][n].push(tt),r.data[e].filter((function(t){return t.seq===tt.seq})).length||r._pushBoardData(e,tt)}else if("image"==t.type)t.content.url?r.addBackgroundPic({boardIds:t.content.boardId,urls:t.content.url,type:t.content.type,needReport:!1,position:t.content.mode}):r.deleteBackgroundPic(t.content.boardId);else if("clean"==t.type)r.clearBoard(!0,!1,!0);else if("cleanDraws"==t.type)r.clearBoard(!1,!1,!0);else if("switchBoard"==t.type){if(!e)return;(1*t.seq||0)>r.maxSeq?(r.maxSeq=t.seq,r.data[e]||r.addBoard(e,!1),r.currentBoard=e,e===o.COMMON_DEFAULT_BOARD?r.currentGroup=o.COMMON_GROUP:r.currentGroup=e.match(/\d+_#\w+$/)[0].split("_")[1],r.event.fire(i,"TEB_SWITCHFILE",r.currentGroup)):r.elkLog.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:r.maxSeq,boardId:e,method:"addHistory"})})}else if("setBoardBG"==t.type)r.setBackgroundColor({boardId:e,color:t.content.colorRGBA},!0);else if("setGlobalBG"==t.type)r.setGlobalBackgroundColor(t.content.colorRGBA,!0);else if("drag"==t.type)i.dragDataList.addDragData(e,new G({scale:t.content.scale,xOffset:t.content.xOffset,yOffset:t.content.yOffset}));else if("setRatio"==t.type){var et=t.content||{};for(var it in et)i.boardRatio[it]=et[it]}else if("imageElement"==t.type){var rt=new J({user:n,url:t.content.url,belongSeq:t.content.belongSeq,seq:t.content.seq,time:t.content.time,width:t.content.width,height:t.content.height,x:t.content.x,y:t.content.y,boardId:e,show:!t.content.hidden,deg:t.content.deg});i.userData[e][n].push(rt),i._pushBoardData(e,rt)}else if("element"==t.type)if(t.content.subType==$.TEDU_BOARD_ELEMENT_H5){var nt=new ot({belongSeq:t.content.belongSeq,seq:t.content.seq,user:t.content.uid,url:t.content.url,boardId:t.content.boardId});nt.setProperty({show:!t.content.hidden,width:t.content.width,height:t.content.height,x:t.content.x,y:t.content.y,data:t.content.data}),i.elementMap.set(String(nt.belongSeq),nt),i.userData[e][i.identifier].push(nt),i._pushBoardData(e,nt)}else if(t.content.subType==$.TEDU_BOARD_ELEMENT_CUSTOM_GRAPH){var st=new ht({belongSeq:t.content.belongSeq,seq:t.content.seq,user:t.content.uid,url:t.content.url,boardId:t.content.boardId,show:!t.content.hidden,x:t.content.x,y:t.content.y,deg:t.content.deg,boardScale:i.getBoardScale(),scaleX:t.content.scaleX,scaleY:t.content.scaleY,boardWidth:i.boardWidth,boardHeight:i.boardHeight,naturalWidth:t.content.naturalWidth,naturalHeight:t.content.naturalHeight});i.elementMap.set(String(st.belongSeq),st),i.userData[e][i.identifier].push(st),i._pushBoardData(e,st)}else t.content.subType!=$.TEDU_BOARD_ELEMENT_AUDIO&&t.content.subType!=$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO||0===t.content.hidden&&i.addAudioElement(t.content.uid,e,t.content.belongSeq,t.content.url,t.content.subType,null,t.content)})),this._sortGraphData(),e?this.event.fire(this,"TEB_DRAW_FACE"):this.setNeedDraw(!0)},Ut.prototype.undo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]-1];if(e){if("line"===e.type)for(var i=0;i<this.userData[this.currentBoard][e.user].length;i++){var r=this.userData[this.currentBoard][e.user][i];if(e.seq==r.seq){r.show=!1,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r];("line"==o.type&&e.seq==o.seq||"graph"==o.type&&e.seq==o.startPoint.seq||"inputtext"==o.type&&e.seq==o.belongSeq||"imageElement"==o.type&&e.seq==o.belongSeq)&&(o.show=!0)}})),this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:a.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:1,lines:e.seq});else if("graph"==e.type)for(var n=0;n<this.userData[this.currentBoard][e.user].length;n++){var s=this.userData[this.currentBoard][e.user][n];if("graph"==s.type&&e.seq==s.startPoint.seq){s.show=!1,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("inputtext"==e.type)for(var l=0;l<this.userData[this.currentBoard][e.user].length;l++){var d=this.userData[this.currentBoard][e.user][l];if("inputtext"==d.type&&e.seq==d.belongSeq){d.show=!1,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var c=[];e.seq.origin.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r],n=0,s=0;"line"==o.type&&e.seq==o.seq?(n=e.x-o.lines[0].x,s=e.y-o.lines[0].y,o.border.maxX+=n,o.border.minX+=n,o.border.maxY+=s,o.border.minY+=s,o.lines.forEach((function(t){t.x+=n,t.y+=s})),c.push({uid:i,seq:e.seq,x:e.x,y:e.y})):"graph"==o.type&&e.seq==o.startPoint.seq?(n=e.x-o.startPoint.x,s=e.y-o.startPoint.y,o.startPoint.x+=n,o.startPoint.y+=s,o.endPoint.x+=n,o.endPoint.y+=s,c.push({uid:i,seq:e.seq,x:e.x,y:e.y})):"inputtext"==o.type&&e.seq==o.belongSeq&&(o.location.x=e.x,o.location.y=e.y,c.push({uid:i,seq:o.belongSeq,x:e.x,y:e.y}))}})),this.addRealtimeData({action:o.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),moves:c});var u=[];e.seq.origin.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r];if("line"==o.type&&e.seq==o.seq){var n=[];o.lines.forEach((function(t){n.push({seq:t.seq,x:t.x,y:t.y})})),u.push({type:"addLine",seq:a.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getTimeStamp(),seq:o.seq,hidden:0,points:n}})}else if("graph"==o.type&&e.seq==o.startPoint.seq){var s={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle",square:"addPatternRectangle"}[o.graph],seq:a.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getTimeStamp(),hidden:0,fillRect:o.solid?1:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}};"rect"==o.graph&&(s.content.cornerRadius=0),u.push(s)}else"inputtext"===o.type&&e.seq==o.belongSeq&&u.push({type:"addText",seq:a.getSeq(),content:{belongSeq:o.belongSeq,time:h.getTimeStamp(),boardId:t.currentBoard,uid:o.user,x:o.location.x,y:o.location.y,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:o.scale,updateTime:h.getTimeStamp(),hidden:0,typeface:o.typeFace,textSize:o.textSize,fontStyle:o.fontStyle,text:encodeURI(escape(o.text)),text_wh:"".concat(o.textWidth,",").concat(o.textHeight)}})}})),this.report.reportGraphData(u)}else if("delete"==e.type)e.seq.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r];("line"==o.type&&e.seq==o.seq||"graph"==o.type&&e.seq==o.startPoint.seq||"inputtext"==o.type&&e.seq==o.belongSeq)&&(o.show=!0)}})),this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:a.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:1,lines:e.seq});else if("imageElement"==e.type)for(var p=0;p<this.userData[this.currentBoard][e.user].length;p++){var f=this.userData[this.currentBoard][e.user][p];if("imageElement"==f.type&&e.seq==f.belongSeq){f.show=!1,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}this.opIndex[this.currentBoard]--,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},Ut.prototype.canUndo=function(){return 0!=this.opIndex[this.currentBoard]},Ut.prototype.redo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]];if(e){if("line"==e.type)for(var i=0;i<this.userData[this.currentBoard][e.user].length;i++){var r=this.userData[this.currentBoard][e.user][i];if(e.seq==r.seq){r.show=!0,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("inputtext"==e.type)for(var n=0;n<this.userData[this.currentBoard][e.user].length;n++){var s=this.userData[this.currentBoard][e.user][n];if("inputtext"==s.type&&e.seq==s.belongSeq){s.show=!0,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r];("line"==o.type&&e.seq==o.seq||"graph"==o.type&&e.seq==o.startPoint.seq||"inputtext"===o.type&&e.seq==o.belongSeq||"imageElement"===o.type&&e.seq==o.belongSeq)&&(o.show=!1)}})),this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:e.seq});else if("graph"==e.type)for(var l=0;l<this.userData[this.currentBoard][e.user].length;l++){var d=this.userData[this.currentBoard][e.user][l];if("graph"==d.type&&e.seq==d.startPoint.seq){d.show=!0,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var c=[];e.seq.final.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r],n=0,s=0;"line"==o.type&&e.seq==o.seq?(n=e.x-o.lines[0].x,s=e.y-o.lines[0].y,o.border.maxX+=n,o.border.minX+=n,o.border.maxY+=s,o.border.minY+=s,o.lines.forEach((function(t){t.x+=n,t.y+=s})),c.push({uid:i,seq:e.seq,x:e.x,y:e.y})):"graph"==o.type&&e.seq==o.startPoint.seq?(n=e.x-o.startPoint.x,s=e.y-o.startPoint.y,o.startPoint.x+=n,o.startPoint.y+=s,o.endPoint.x+=n,o.endPoint.y+=s,c.push({uid:i,seq:e.seq,x:e.x,y:e.y})):"inputtext"==o.type&&e.seq==o.belongSeq&&(o.location.x=e.x,o.location.y=e.y,c.push({uid:i,seq:o.belongSeq,x:e.x,y:e.y}))}})),this.addRealtimeData({action:o.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),moves:c});var u=[];e.seq.final.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r];if("line"==o.type&&e.seq==o.seq){var n=[];o.lines.forEach((function(t){n.push({seq:t.seq,x:t.x,y:t.y})})),u.push({type:"addLine",seq:a.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getTimeStamp(),seq:o.seq,hidden:0,points:n}})}else if("graph"==o.type&&e.seq==o.startPoint.seq){var s={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle",square:"addPatternRectangle"}[o.graph],seq:a.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getTimeStamp(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}};"oval"==o.graph||"circle"==o.graph?s.content.fillRect=0:"rect"==o.graph&&(s.content.fillRect=0,s.content.cornerRadius=0),u.push(s)}else"inputtext"===o.type&&e.seq==o.belongSeq&&u.push({type:"addText",seq:a.getSeq(),content:{belongSeq:o.belongSeq,time:h.getTimeStamp(),boardId:t.currentBoard,uid:o.user,x:o.location.x,y:o.location.y,colorRGBA:h.rgbaColor2DecimalColor(o.color),scale:o.scale,updateTime:h.getTimeStamp(),hidden:0,typeface:o.typeFace,textSize:o.textSize,fontStyle:o.fontStyle,text:encodeURI(escape(o.text)),text_wh:"".concat(o.textWidth,",").concat(o.textHeight)}})}})),this.report.reportGraphData(u)}else if("delete"==e.type)e.seq.forEach((function(e){for(var i=e.uid,r=0;r<t.userData[t.currentBoard][i].length;r++){var o=t.userData[t.currentBoard][i][r];("line"==o.type&&e.seq==o.seq||"graph"==o.type&&e.seq==o.startPoint.seq||"inputtext"==o.type&&e.seq==o.belongSeq)&&(o.show=!1)}})),this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:a.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:e.seq});else if("imageElement"==e.type)for(var p=0;p<this.userData[this.currentBoard][e.user].length;p++){var f=this.userData[this.currentBoard][e.user][p];if("imageElement"==f.type&&e.seq==f.belongSeq){f.show=!0,this.addRealtimeData({action:o.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:a.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}this.opIndex[this.currentBoard]++,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},Ut.prototype.canRedo=function(){return this.opIndex[this.currentBoard]!=this.opData[this.currentBoard].length},Ut.prototype.syncHistroyData=function(){var t=this;this.logger.info(this.loggerModuleName,"syncHistroyData");var e=this,i=[],r=[],o=[],n=[],s=0,a=!1;return new Promise((function(l,d){!function l(d,c,u){var p=h.getTimeStamp();new Promise((function(i,r){t.request.getBoardData(d,(function(t,r){t.error_code?(e.elkLog.report("getBoardData",{action_result:t.error_code,action_info:t.error_msg,time_consume:h.getTimeStamp()-p,extra_info:JSON.stringify(t)}),e.event.fire(this,"TEB_ERROR",k.TEDU_BOARD_ERROR_HISTORYDATA,"errorCode:".concat(t.error_code,",errorMessage:").concat(t.error_msg))):(e.elkLog.report("getBoardData",{time_consume:h.getTimeStamp()-p,extra_info:JSON.stringify(t)}),i({res:t,oresp:r}))}),(function(t){r(t)}))})).then((function(h){var d=h.res,p=h.oresp;JSON.parse(p.config.data).first_time&&(i=[],r=[],o=[],n=[],s=0,a=!1,e.clearBoard(!0,!1,!0),e.resetData()),(d.board_data_list||[]).forEach((function(s){if("switchBoard"===s.type){if(a)return;a=!0,e.faceData.push(s);var l=JSON.parse(s.content).fid;o=o.filter((function(t){return JSON.parse(t.content).fid!=l||(n.push(t),!1)})),t.renderFace(n,e.faceData,i)}else"setGlobalBG"===s.type?i.push(s):"addFile"===s.type?o.push(s):a?r.push(s):e.faceData.push(s)})),s++,!d.is_finish&&s<50?l(!1,c,u):c()})).catch((function(i){e.event.fire(t,"TEB_ERROR",k.TEDU_BOARD_ERROR_HISTORYDATA,i.message),e.elkLog.report("getBoardData",{action_result:-3,action_info:i.message,time_consume:0,extra_info:JSON.stringify({stack:i.stack,message:i.message})})}))}(!0,(function(){var t=this;a||(e.addHistory(i),r=r.concat(e.faceData),e.faceData=[]),e.addHistory(o),e.addHistory(r),e.fixBoardData(),e.sortBoard(),e.syncBoardSeq(),setTimeout((function(){e.event.fire(t,"TEB_HISTROYDATA_SYNCCOMPLETED")}),200)}))}))},Ut.prototype.renderFace=function(t,e,i){this.addHistory(i),this.addHistory(t),this.addHistory(e,!0)},Ut.prototype.fixBoardData=function(){var t=this;try{var e=[];this.getGroup().forEach((function(t){e.push(t.fid)}));var i=[];this.boardList.forEach((function(r,n){var s=h.boardId2Fid(r);s!=o.COMMON_GROUP&&-1===e.indexOf(s)&&(i.push(n),delete t.userData[r],delete t.data[r],delete t.opData[r],delete t.opIndex[r],delete t.backgroundPic[r],delete t.backgroundColor[r])})),i.sort((function(t,e){return e-t})),i.forEach((function(e){t.boardList.splice(e,1)}))}catch(t){}},Ut.prototype.sortBoard=function(){this.boardList=this.boardList.sort((function(t,e){var i=t===o.COMMON_DEFAULT_BOARD?0:t.match(/\d+_\d+_#\w+$/)[0].split("_")[0],r=e===o.COMMON_DEFAULT_BOARD?0:e.match(/\d+_\d+_#\w+$/)[0].split("_")[0];return i!=r?i-r:(t===o.COMMON_DEFAULT_BOARD?0:t.match(/\d+_#\w+$/)[0].split("_")[0])-(e===o.COMMON_DEFAULT_BOARD?0:e.match(/\d+_#\w+$/)[0].split("_")[0])}))},Ut.prototype.syncBoardSeq=function(){1==this.boardList.length&&this.boardList[0]===o.COMMON_DEFAULT_BOARD?this.boardIdSeq=1:this.boardList[this.boardList.length-1]&&(this.boardIdSeq=1*this.boardList[this.boardList.length-1].match(/\d+_#\w+$/)[0].split("_")[0]+1)},Ut.prototype.sortGroup=function(){this.groups=this.groups.sort((function(t,e){return t.fid===o.COMMON_GROUP?-1:e.fid===o.COMMON_GROUP?1:1*t.fid.replace(/\D*/,"")-1*e.fid.replace(/\D*/,"")}))},Ut.prototype.addData=function(t){var e=this;if(this.permissions){if(t=JSON.parse(JSON.stringify(t)))try{var i=[6,7],r=t.value.actions.filter((function(t){return-1===i.indexOf(t.action)}));r.length&&this.elkLog.report("addData",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify({seq:t.seq,timestamp:t.timestamp,value:{boardId:t.value.boardId,operator:t.value.operator,actions:r}})})}catch(t){}var n=t.value.operator,s=t.value.actions,a=t.value.boardId;this.userData[a]||this.addBoard(a,!1),this.userData[a][n]||(this.userData[a][n]=[]),this.userData[a][n].length;var l=0,d=0,u=!1,p=[];s.forEach((function(t,i){if(a=t.toBoardId||t.boardId||a,t.color&&(t.color=h.color2RgbaColor(t.color)),e.seqFilter[t.seq+""])t.action==o.PROTOCOL_ACTION.LINE_START_ACTION||t.action==o.PROTOCOL_ACTION.LINE_MOVE_ACTION||t.action==o.PROTOCOL_ACTION.LINE_END_ACTION?++d:t.action!=o.PROTOCOL_ACTION.RASER_SHOW_ACTION&&t.action!=o.PROTOCOL_ACTION.RASER_HIDE_ACTION||++l;else{e.seqFilter[t.seq+""]=!0;var r=null;if(t.action==o.PROTOCOL_ACTION.LINE_START_ACTION){if(e.checkLoseLineTask.stopTask(t.belongSeq),(r=e.findLine(a,n,t))?(r.writing=t.writing,r.color=t.color,r.thin=t.thin,r.show=!0,r.lines.push({action:t.action,x:t.x,y:t.y,w:t.w||t.thin,belongSeq:t.belongSeq,seq:t.seq,timestamp:t.timestamp}),r.sort(),r.setBorder(t.x,t.y),e.setPartDraw(!0)):((r=new m(n,t)).show=!0,e.userData[a][n].push(r),e._pushBoardData(a,r),e.seqLineMap[r.belongSeq]=r),e._buildRaserData(i,n,{action:o.PROTOCOL_ACTION.RASER_SHOW_ACTION,color:t.color,radius:t.thin,x:t.x,y:t.y,timestamp:t.timestamp,seq:t.seq,toolType:1,title:t.title,style:t.style}),0!==r.endSeq&&e.smoothLevel>0){var c=[];r.lines.forEach((function(t){c.push([t.x,t.y])}))}t.timestamp?e.setIncreasingDraw(!0):e.setPartDraw(!0),++d}else if(t.action==o.PROTOCOL_ACTION.LINE_MOVE_ACTION||t.action==o.PROTOCOL_ACTION.LINE_END_ACTION){if(r=e.findLine(a,n,t)){if(r.lines.push({action:t.action,x:t.x,y:t.y,w:t.w||t.thin,belongSeq:t.belongSeq,seq:t.seq,timestamp:t.timestamp}),r.lines.length>1){var f=r.lines[r.lines.length-2];t.seq<f.seq&&(r.sort(),e.setPartDraw(!0))}r.setBorder(t.x,t.y)}else r=new m(n,t),e.userData[a][n].push(r),e._pushBoardData(a,r),e.seqLineMap[r.belongSeq]=r,e.checkLoseLineTask.startTask(t.belongSeq,(function(t){var i=e.seqLineMap[t],r=!0;if(i){for(var o=0,n=i.lines.length;o<n;o++)if(1===i.lines[o].action){r=!1;break}r&&e.event.fire(e,"TEB_WARNING",dt.TEDU_BOARD_WARNING_GRAFFITI_LOST,"graffiti lost")}}));if(t.action==o.PROTOCOL_ACTION.LINE_END_ACTION&&(r.endSeq=t.seq,function(t,i){setTimeout((function(){t.color&&t.thin||e.request.getLineData({boardId:i,owner:t.user,seq:t.belongSeq},(function(t){t.error_code||(e.addHistory([{content:t.content,type:t.type}]),e.sortBoard(),e.syncBoardSeq(),e.setNeedDraw(!0))}))}),500)}(r,a)),0!==r.endSeq&&e.smoothLevel>0){var g=[];r.lines.forEach((function(t){g.push([t.x,t.y])}))}t.timestamp?e.setIncreasingDraw(!0):e.setPartDraw(!0),++d,e._buildRaserData(i,n,{action:o.PROTOCOL_ACTION.RASER_SHOW_ACTION,color:t.color,radius:t.thin,x:t.x,y:t.y,timestamp:t.timestamp,seq:t.seq,toolType:1,title:t.title,style:t.style})}else if(t.action==o.PROTOCOL_ACTION.RASER_SHOW_ACTION)++l,e._buildRaserData(i,n,t);else if(t.action==o.PROTOCOL_ACTION.RASER_HIDE_ACTION){++l;var _=new b(n,{action:t.action,color:t.color,radius:t.r,x:t.x,y:t.y,timestamp:t.timestamp,seq:t.seq,toolType:t.toolType,title:t.title,style:t.style});t.ignore||e.pushLaserData(_),e.setLaserDraw(!0)}else if(8==t.action){if(!t.lines)return;t.lines.forEach((function(i){for(var r=0;r<e.userData[a][i.uid].length;r++){var o=e.userData[a][i.uid][r];"line"==o.type&&o.startSeq==i.seq||"graph"==o.type&&o.startPoint.seq==i.seq||"inputtext"==o.type&&o.belongSeq==i.seq||"imageElement"==o.type&&o.belongSeq==i.seq?o.show=!!t.display:"element"==o.type&&o.belongSeq==i.seq&&(o.show=!!t.display,o.show||p.push(String(o.belongSeq)))}}))}else if(9==t.action){if(!t.moves)return;(1*t.seq||0)>e.maxGraffitiMoveSeq?t.moves.forEach((function(t){for(var i=0;i<e.userData[a][t.uid].length;i++){var r=e.userData[a][t.uid][i],o=0,n=0;"line"==r.type&&r.startSeq==t.seq?(o=t.x-r.lines[0].x,n=t.y-r.lines[0].y,r.border.maxX+=o,r.border.minX+=o,r.border.maxY+=n,r.border.minY+=n,r.lines.forEach((function(t){t.x+=o,t.y+=n}))):"graph"==r.type&&r.startPoint.seq==t.seq?(o=t.x-r.startPoint.x,n=t.y-r.startPoint.y,r.startPoint.x+=o,r.startPoint.y+=n,r.endPoint.x+=o,r.endPoint.y+=n):"inputtext"==r.type&&r.belongSeq==t.seq&&(r.location.x=t.x,r.location.y=t.y)}})):e.elkLog.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxAddTextSeq:e.maxGraffitiMoveSeq,boardId:a,method:"addData"})})}else if(10==t.action||11==t.action||12==t.action||14==t.action||15==t.action){t.graph={10:"line",11:"oval",12:"rect"}[t.action],t.solid=!!t.fillRect,t.show=!0;var y=new E(n,t);e.userData[a][n].push(y),e._pushBoardData(a,y)}else if(13==t.action)if((1*t.seq||0)>e.maxAddTextSeq){e.maxAddTextSeq=t.seq;for(var v=null,S=0;S<e.data[a].length;S++){var O=e.data[a][S];if(O.belongSeq===t.belongSeq){t.seq>O.seq&&(O.seq=t.seq),v=O;break}}v?v.text==unescape(decodeURI(t.text))&&v.textWidth==t.textWidth&&v.textHeight==t.textHeight&&v.color==t.color&&v.typeFace==t.typeFace&&v.textSize==t.textSize&&v.fontStyle==t.fontStyle?1===s.length&&(u=!0):(v.text=unescape(decodeURI(t.text)),v.textWidth=t.textWidth,v.textHeight=t.textHeight,v.color=t.color,v.scale=t.scale,v.typeFace=t.typeFace,v.textSize=t.textSize,v.fontStyle=t.fontStyle):((v=new T(n,{x:t.x,y:t.y,belongSeq:t.belongSeq})).color=t.color,v.scale=t.scale,v.typeFace=t.typeFace,v.textSize=t.textSize,v.fontStyle=t.fontStyle,v.time=t.time,v.text=unescape(decodeURI(t.text)),v.textWidth=t.textWidth,v.textHeight=t.textHeight,e.userData[a][n].push(v),e._pushBoardData(a,v))}else e.elkLog.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxAddTextSeq:e.maxAddTextSeq,boardId:a,method:"addData"})});else if(t.action==o.PROTOCOL_ACTION.IMAGE_ELEMENT){if((1*t.seq||0)<e.maxImageElementSeq)return void e.elkLog.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxImageElementSeq:e.maxImageElementSeq,boardId:a,method:"addData"})});var D;e.maxImageElementSeq=t.seq;for(var A=e.data[a]||[],I=0,x=A.length;I<x;I++){var w=A[I];if(w.belongSeq===t.belongSeq){D=w;break}}D?(D.seq=t.seq,D.width=t.width,D.height=t.height,D.x=t.x,D.y=t.y,D.show=t.show,D.deg=t.deg):(D=new J({user:n,url:t.url,belongSeq:t.belongSeq,seq:t.seq,time:t.time,width:t.width,height:t.height,x:t.x,y:t.y,boardId:a,show:t.show,deg:t.deg}),e.userData[a][n].push(D),e._pushBoardData(a,D))}else if(101==t.action)e.clearBoard(!0,!1,!0);else if(102==t.action)e.clearBoard(!1,!1,!0);else if(103==t.action)try{e.clearFileDrawData(t.fids)}catch(t){}else if(104==t.action){e.resetData();var R=document.querySelector("#".concat(e.options.id));if(R){var C=R.querySelector(".tic_board_textbox"),B=R.querySelector(".tic_board__imagewrap"),L=R.querySelector(".tiw_board_webview_wrap");C&&(C.innerHTML=""),B&&(B.innerHTML=""),L&&(L.innerHTML="")}e.removeAllElement()}else if(t.action==o.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION)e.setBoardRatio(a,t.ratio,!1);else if(201==t.action)e.addBackgroundPic({boardIds:a,urls:t.url,type:t.type,needReport:!1,position:t.mode});else if(202==t.action)e.deleteBackgroundPic(a);else if(203==t.action)t.color&&(t.color=h.rgbaColor2DecimalColor(t.color)),t.isGlobal?e.setGlobalBackgroundColor(t.color,!0):e.setBackgroundColor(t.color,!0);else if(t.action==o.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION)if((1*t.seq||0)>e.maxMoveSeq){e.maxMoveSeq=t.seq;var N=e.dragDataList.getDragData(a);N?e.dragDataList.updateDragData(a,{scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}):(N=new G({scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}),e.dragDataList.addDragData(a,N)),e.dragDataList.addMaxSeqDragData(e.dragDataList.getDragData(a)),e.event.fire(e,"TEB_ZOOM_DRAG_STATUS",{fid:h.boardId2Fid(a),scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset})}else e.elkLog.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxMoveSeq:e.maxMoveSeq,boardId:a,method:"addData"})});else if(t.action==o.PROTOCOL_ACTION.FILE_SCALE_ACTION)e.resolveFileScaleAction(t);else if(401==t.action)e.resolveSwitchBoardAction(t);else if(501==t.action)e.resolveAddFileAction(t.file);else if(t.action===o.PROTOCOL_ACTION.PPT_EVENT_ACTION)P.pptAction(e.iframeDom,t.data);else if(t.action===o.PROTOCOL_ACTION.VIDEO_EVENT_ACTION)e.resolveUpdateVideoAction(t);else if(t.action===o.PROTOCOL_ACTION.H5Web_ELEMENT){if((1*t.seq||0)<e.maxH5webElementSeq)return void e.elkLog.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxH5webElementSeq:e.maxH5webElementSeq,boardId:a,method:"addData"})});e.maxH5webElementSeq=t.seq;var M=e.elementMap.get(String(t.belongSeq));M||(M=new ot({belongSeq:t.belongSeq,boardId:t.boardId,user:n,url:t.url}),e.userData[a][n].push(M),e._pushBoardData(a,M)),M.setProperty({show:t.show,width:t.width,height:t.height,x:t.x,y:t.y,data:t.data}),e.elementMap.set(String(M.belongSeq),M)}else if(t.action===o.PROTOCOL_ACTION.H5WEB_EVENT_ACTION){var k=e.elementMap.get(String(t.belongSeq));k&&k.postMessage(t.data)}else if(t.action===o.PROTOCOL_ACTION.FILE_MESSAGE_ACTION)e.resolveFileMessage(t);else if(t.action===o.PROTOCOL_ACTION.CUSTOM_GRAPH_ELEMENT){if((1*t.seq||0)<e.maxCustomGraphElementSeq)return;e.maxCustomGraphElementSeq=t.seq;var q=e.elementMap.get(String(t.belongSeq));q?(q.show=t.show,q.x=t.x,q.y=t.y,q.deg=t.deg,q.boardScale=e.getBoardScale(),q.boardWidth=e.boardWidth,q.boardHeight=e.boardHeight,q.naturalWidth=t.naturalWidth,q.naturalHeight=t.naturalHeight,q.setScaleXY(t.scaleX,t.scaleY)):(q=new ht({belongSeq:t.belongSeq,seq:t.belongSeq,user:n,url:t.url,boardId:t.boardId,show:t.show,x:t.x,y:t.y,deg:t.deg,boardScale:e.getBoardScale(),scaleX:t.scaleX,scaleY:t.scaleY,boardWidth:e.boardWidth,boardHeight:e.boardHeight,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight}),e.userData[a][n].push(q),e._pushBoardData(a,q)),e.elementMap.set(String(q.belongSeq),q)}else if(t.action===o.PROTOCOL_ACTION.AUDIO_ELEMENT||t.action===o.PROTOCOL_ACTION.GLOBAL_AUDIO_ELEMENT){var U=e.elementMap.get(String(t.belongSeq));if((1*t.seq||0)<e.maxCustomGraphElementSeq||U&&!U.show)return;e.maxCustomGraphElementSeq=t.seq,e.addAudioElement(n,a,t.belongSeq,t.url,t.action===o.PROTOCOL_ACTION.AUDIO_ELEMENT?$.TEDU_BOARD_ELEMENT_AUDIO:$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO,t,null),t.show||p.push(String(t.belongSeq))}}})),l==s.length||d==s.length||l+d==s.length||u||this.setNeedDraw(!0),p.length&&this.event.fire(this,c.TEB_REMOVEELEMENT,p)}},Ut.prototype.resolveFileScaleAction=function(t){var e=this,i=t.fid,r=this.getFileInfo(i);r?(r.scale=t.scale,this.dragDataList.getDragDataByFid(i).forEach((function(i){e.dragDataList.updateDragData(i.bid,{scale:t.scale})})),this.event.fire(this,"TEB_ZOOM_DRAG_STATUS",{fid:i,scale:t.scale,xOffset:0,yOffset:0}),this.setNeedDraw(!0)):this.request.getFileInfo({fid:i},(function(o){o&&0==o.error_code&&(r=JSON.parse(o.content),e.resolveAddFileAction(r),r.scale=t.scale,e.dragDataList.getDragDataByFid(i).forEach((function(i){e.dragDataList.updateDragData(i.bid,{scale:t.scale})})),e.event.fire(e,"TEB_ZOOM_DRAG_STATUS",{fid:i,scale:t.scale,xOffset:0,yOffset:0}),e.setNeedDraw(!0))}),(function(t){}))},Ut.prototype.resolveSwitchBoardAction=function(t){var e=this;this.logger.info(this.loggerModuleName,"resolveSwitchBoardAction");var i=t.toBoardId,r=[],n=[];if((1*t.seq||0)>this.maxSeq){this.maxSeq=t.seq,r=t.deleteFiles||[],n=t.deleteBoards||[],r.forEach((function(t){e.deleteGroup(t,!1),n=n.concat(e.getBoardByGroup(t))})),n.forEach((function(t){e.removeBoard(t)})),this.data[i]||this.addBoard(i,!1),this.currentBoard=i;var s=h.boardId2Fid(i);this.currentGroup=s;var a=Math.max(t.page,0),l=Math.max(t.step,0),d=this.getFileInfo(s);d?(d.type===o.FILE_TYPE.H5PPT&&P.gotoTimestampNew(this.iframeDom,{slideIndex:a,stepIndex:l,resetStep:t.resetStep,usePrevNextStepMethod:t.usePrevNextStepMethod,isPassive:!0}),this.updateFileInfo({fid:s,pageCount:this.getBoardByGroup(s).length,currentPageIndex:a||0,currentPageStep:l||0}),this.event.fire(this,"TEB_GOTOBOARD",i,h.boardId2Fid(i))):this.request.getFileInfo({fid:s},(function(r){r&&0==r.error_code&&(d=JSON.parse(r.content),e.resolveAddFileAction(d),e.setNeedDraw(!0),setTimeout((function(){d.type===o.FILE_TYPE.H5PPT&&P.gotoTimestampNew(e.iframeDom,{slideIndex:a,stepIndex:l,resetStep:t.resetStep,usePrevNextStepMethod:t.usePrevNextStepMethod,isPassive:!0}),e.updateFileInfo({fid:s,pageCount:e.getBoardByGroup(s).length,currentPageIndex:a||0,currentPageStep:l||0}),e.event.fire(e,"TEB_GOTOBOARD",i,h.boardId2Fid(i))}),200))}),(function(t){}))}else r=t.deleteFiles||[],n=t.deleteBoards||[],r.forEach((function(t){e.deleteGroup(t,!1),n=n.concat(e.getBoardByGroup(t))})),n.forEach((function(t){e.removeBoard(t)})),this.elkLog.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:this.maxSeq,boardId:i,method:"addData"})})},Ut.prototype.resolveAddFileAction=function(t){this.logger.info(this.loggerModuleName,"resolveAddFileAction");var e=null,i=[];if(t.type===o.FILE_TYPE.H5PPT){i=[];for(var r=0;r<t.pageCount;r++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(r+1,"_").concat(t.fid),i.push(e);this.addBoard(i,!1),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,o.FILE_TYPE.H5PPT,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)}else if(t.type==o.FILE_TYPE.IMG){var n=t.downloadURL,s=n?h.fileDownLoadUrlToPreviewUrl(n):"",a=[];i=[];for(var l=0;l<t.pageCount;l++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(l+1,"_").concat(t.fid),i.push(e),s.endsWith("/")?a.push("".concat(s).concat(l+1,".jpg")):a.push(s+(l+1));this.addBoard(i,!1),n&&this.addBackgroundPic({boardIds:i,urls:a,type:f.BACKGROUND_TYPE.IMAGE,needReport:!1}),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,o.FILE_TYPE.IMAGE,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)}else if(t.type==o.FILE_TYPE.IMAGESFILE){if(t.downloadURL){var d=(new Date).getTime(),c=h.decompress(t.downloadURL),u=(new Date).getTime();a=JSON.parse(c);var p=u-d;this.elkLog.report("add_images_file_peer",{extra_info:JSON.stringify({urls:c,urls_length:c.length,elapse:p})}),this.addImagesToBoard(t,a)}}else if(t.type==o.FILE_TYPE.VOD||t.type==o.FILE_TYPE.VODFILE||t.type==o.FILE_TYPE.LIVE||t.type==o.FILE_TYPE.H5FILE){i=[];for(var g=0;g<t.pageCount;g++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(g+1,"_").concat(t.fid),i.push(e);this.addBoard(i,!1),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,t.type,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)}},Ut.prototype.addImagesToBoard=function(t,e){this.logger.info(this.loggerModuleName,"addImagesToBoard",{param:{uid:t.uid,fid:t.fid}});for(var i=null,r=[],o=0;o<t.pageCount;o++)i="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(o+1,"_").concat(t.fid),r.push(i);this.addBoard(r,!1),e&&e.length>0&&this.addBackgroundPic({boardIds:r,urls:e,type:f.BACKGROUND_TYPE.IMAGE,needReport:!1}),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,t.type,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)},Ut.prototype.resolveUpdateVideoAction=function(t){if((1*t.seq||0)>this.maxVideoSeq){this.maxVideoSeq=t.seq;var e=t.status,i=t.progress,r=t.fid,o=t.time;this.updateFileInfo({fid:r,status:e,progress:i,timestamp:o})}},Ut.prototype.addFile=function(t,e,i,r,n,s,l){var d=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(this.logger.info(this.loggerModuleName,"addFile",{param:{fid:t,downloadUrl:r}}),!Array.isArray(e))return"";t=t||"#".concat(h.getTimeStamp());var c,u,p,f,g,_=h.getSecondTime();if(c=this.createBoardIdForFile(t,this.user,_,e.length,o.PLATFORM,l)||[],n=(p=(u=2===this.boardContentFitMode||1===this.boardContentFitMode?h.calcRatioWidthHeight(n,o.RATIO):h.calcRatioWidthHeight(this.ratio,o.RATIO)).ratioWidth)+":"+(f=u.ratioHeight),2===this.boardContentFitMode){var m=this.containerWidth/p,y=this.containerHeight/f,T=Math.min(m,y);g=Math.max(m,y)/T*100}else this.boardContentFitMode,g=100;this.addGroup(t,i,this.user,r,e.length,0,_,o.PLATFORM,l,0,n,g,s),this.addBoard(c),this.addBackgroundPic({boardIds:c,urls:e});var v={action:o.PROTOCOL_ACTION.ADD_FILE_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),file:{fid:t,title:i,downloadURL:r,pageCount:e.length,uid:this.identifier,timestamp:_,platform:o.PLATFORM,type:l,ratio:n,scale:g,isTranscodeFile:s}};return this.addRealtimeData(v),c.length&&d&&this.switchFile(t),t},Ut.prototype.addH5PPTFile=function(t,e,i,r,n,s,l){var d=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];this.logger.info(this.loggerModuleName,"addH5PPTFile",{param:{fid:t,uid:this.user,url:e}});for(var c=!1,u=this.getGroup()||[],p=0,f=u.length;p<f;p++)if(u[p].downloadURL==e){c=!0;break}if(!c){t=t||"#".concat(h.getTimeStamp());var g,_=h.getSecondTime();g=this.createBoardIdForFile(t,this.user,_,r,o.PLATFORM,o.FILE_TYPE.H5PPT)||[];var m,y,T,v,E=null;if(n&&s){var S=h.maxCommonDivisor(n,s);E=n/S+":"+s/S}else E=this.ratio;if(E=(y=(m=2===this.boardContentFitMode||1===this.boardContentFitMode?h.calcRatioWidthHeight(E,o.RATIO):h.calcRatioWidthHeight(this.ratio,o.RATIO)).ratioWidth)+":"+(T=m.ratioHeight),2===this.boardContentFitMode){var b=this.containerWidth/y,O=this.containerHeight/T,D=Math.min(b,O);v=Math.max(b,O)/D*100}else this.boardContentFitMode,v=100;var A={action:o.PROTOCOL_ACTION.ADD_FILE_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),file:{fid:t,title:i,downloadURL:e,pageCount:r,uid:this.identifier,timestamp:_,platform:o.PLATFORM,type:o.FILE_TYPE.H5PPT,ratio:E,scale:v,isTranscodeFile:l}};return this.addRealtimeData(A),this.addGroup(t,i,this.user,e,r,0,_,o.PLATFORM,o.FILE_TYPE.H5PPT,0,E,v,l),this.addBoard(g),g.length&&d&&this.switchFile(t),t}},Ut.prototype.addH5File=function(t,e,i,r){this.logger.info(this.loggerModuleName,"addH5File",{param:{fid:t,url:e,width:i,height:r}}),this.addVideoFile(t,e,i,r,o.FILE_TYPE.H5FILE)},Ut.prototype.addVideoFile=function(t,e,i,r,n){this.logger.info(this.loggerModuleName,"addVideoFile",{param:{fid:t,url:e,width:i,height:r,type:n}});for(var s=!1,l=this.getGroup()||[],d=0,c=l.length;d<c;d++)if(l[d].downloadURL==e){s=!0;break}if(!s){t=t||"#".concat(h.getTimeStamp());var u,p=h.getSecondTime();u=this.createBoardIdForFile(t,this.user,p,1,o.PLATFORM,n)||[];var f,g,_,m,y=null;if(i&&r){var T=h.maxCommonDivisor(i,r);y=i/T+":"+r/T}else y=this.ratio;if(y=(g=(f=2===this.boardContentFitMode||1===this.boardContentFitMode?h.calcRatioWidthHeight(y,o.RATIO):h.calcRatioWidthHeight(this.ratio,o.RATIO)).ratioWidth)+":"+(_=f.ratioHeight),2===this.boardContentFitMode){var v=this.containerWidth/g,E=this.containerHeight/_,S=Math.min(v,E);m=Math.max(v,E)/S*100}else this.boardContentFitMode,m=100;this.addGroup(t,"",this.user,e,1,0,p,o.PLATFORM,n,0,y,m,!1),this.addBoard(u);var b={action:o.PROTOCOL_ACTION.ADD_FILE_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),file:{fid:t,title:"",downloadURL:e,pageCount:1,uid:this.identifier,timestamp:p,platform:o.PLATFORM,type:n,ratio:y,scale:m,isTranscodeFile:!1,status:0,progress:0}};return this.addRealtimeData(b),u.length&&this.switchFile(t),t}},Ut.prototype.deleteFile=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCurrentFile();if(this.logger.info(this.loggerModuleName,"deleteFile",{param:{fid:t}}),t===o.COMMON_GROUP)return!1;var e=this.deleteGroup(t);return t==this.getCurrentFile()&&this.switchFile(o.COMMON_GROUP),this.event.fire(this,"TEB_DELETEFILE",t),!(!e||!e.length||(this.deleteBoard(e,t),0))},Ut.prototype.switchFile=function(t,e,i){this.logger.info(this.loggerModuleName,"switchFile",{param:{fid:t,boardId:e,sIndex:i}});for(var r=!1,n=0,s=this.groups.length;n<s;n++)if(this.groups[n].fid==t){r=!0;break}if(r){this.currentGroup=t;var a=this.getBoardByGroup(this.currentGroup),l=this.getFileInfo(this.currentGroup),h=a.indexOf(e);return 0<=h&&h<=l.pageCount&&(l.currentPageIndex=h),h=Math.max(0,l.currentPageIndex),isNaN(h)&&(h=l.currentPageIndex||0),l.currentPageIndex=h,l.fid!==o.COMMON_GROUP&&(i=Math.max(0,i),isNaN(i)&&(i=l.currentPageStep||0),l.currentPageStep=i),e=a[h],this.event.fire(this,"TEB_SWITCHFILE",t),this.switchBoard(e),t}return!1},Ut.prototype.setBoardSize=function(t,e){this.boardWidth=t,this.boardHeight=e},Ut.prototype.setContainerSize=function(t,e){this.containerWidth=t,this.containerHeight=e},Ut.prototype.setIframeDom=function(t){this.iframeDom=t},Ut.prototype.setBoardRatio=function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger.info(this.loggerModuleName,"setBoardRatio",{param:{boardId:t,ratio:e,needReport:i}}),this.boardRatio[t]=e;var r={};r[t]=e,i&&this.addRealtimeData({action:o.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION,seq:a.getSeq(),ratio:e}),i&&this.report.reportsetBoardRatio(r),this.setNeedDraw(!0)},Ut.prototype.getBoardRatio=function(){if(this.getCurrentFile()===o.COMMON_GROUP)return this.boardRatio[this.currentBoard]||this.ratio;var t=this.boardRatio[this.currentBoard];if(t)return t;var e=this.getFileInfo(this.getCurrentFile());return e&&e.ratio?e.ratio:this.ratio},Ut.prototype.addDragData=function(t,e){var i=new G(e);this.dragDataList.addDragData(t,i)},Ut.prototype.getDragData=function(){return this.dragDataList.getDragData(this.currentBoard)},Ut.prototype.setBoardScale=function(t){t||(t=o.SCALE),t=Math.max(o.MIN_SCALE,Math.min(o.MAX_SCALE,t));var e=this.dragDataList.getDragData(this.currentBoard);e?this.dragDataList.updateDragData(this.currentBoard,{scale:t}):(e=new G({scale:t,xOffset:50,yOffset:50}),this.dragDataList.addDragData(this.currentBoard,e)),this.addRealtimeData(e.getRealTimeData()),this.report.reportDrag(Object.assign(e.getReportData(),{boardId:this.currentBoard})),this.setNeedDraw(!0)},Ut.prototype.getBoardScale=function(){var t,e=this.dragDataList.getDragData(this.currentBoard);if(e)t=e.scale;else{var i=this.getFileInfo(this.getCurrentFile());i&&(t=i.scale),t||(t=this.scale)}return t},Ut.prototype.setBoardContentFitMode=function(t){this.logger.info(this.loggerModuleName,"setBoardContentFitMode",{param:{mode:t}}),this.boardContentFitMode=t||q.TEDU_BOARD_FILE_FIT_MODE_NONE},Ut.prototype.getBoardContentFitMode=function(){return this.boardContentFitMode||q.TEDU_BOARD_FILE_FIT_MODE_NONE},Ut.prototype.updateFileInfo=function(t){this.logger.info(this.loggerModuleName,"updateFileInfo",{param:{fid:t.fid,uid:t.uid}});for(var e=t.fid,i=!1,r=0,o=this.groups.length;r<o;r++){var n=this.groups[r];if(n.fid==e){n.title=n.title||t.title,n.pageCount=t.pageCount||n.pageCount,n.currentPageIndex=void 0===t.currentPageIndex?n.currentPageIndex:t.currentPageIndex,n.currentPageStep=void 0===t.currentPageStep?n.currentPageStep:t.currentPageStep,n.downloadURL=n.downloadURL||t.downloadURL,n.uid=n.uid||t.uid,n.timestamp=t.timestamp||n.timestamp,n.ratio=t.ratio||n.ratio,n.scale=t.scale||n.scale,n.status=void 0===t.status?n.status:t.status,n.progress=void 0===t.progress?n.progress:t.progress,i=!0;break}}i||this.groups.push({fid:t.fid,title:t.title,pageCount:t.pageCount,currentPageIndex:t.currentPageIndex||0,currentPageStep:t.currentPageStep||0,downloadURL:t.downloadURL,uid:t.uid,timestamp:t.timestamp,type:t.type||0,ratio:t.ratio||0,scale:t.scale,status:t.status||0,progress:t.progress||0})},Ut.prototype.isFileUrlExist=function(t){for(var e=!1,i=this.getGroup()||[],r=0,o=i.length;r<o;r++)if(i[r].downloadURL==t){e=!0;break}return e},Ut.prototype.getFileInfoByUrl=function(t){for(var e={},i=this.getGroup()||[],r=0,o=i.length;r<o;r++)if(i[r].downloadURL==t){e=i[r];break}return e},Ut.prototype.setLineStyle=function(t){this.logger.info(this.loggerModuleName,"setLineStyle",{param:{style:t}}),"object"==qt(t)&&(this.lineStyle=Object.assign(this.lineStyle,t))},Ut.prototype.getLineStyle=function(){return this.lineStyle},Ut.prototype.setOvalDrawMode=function(t){this.logger.info(this.loggerModuleName,"setOvalDrawMode",{param:{mode:t}}),this.ovalDrawMode=t},Ut.prototype.getOvalDrawMode=function(){return this.ovalDrawMode},Ut.prototype.setCursorIcon=function(t,e){var i,r,n;this.logger.info(this.loggerModuleName,"setCursorIcon",{param:{toolType:t,cursorIcon:e}}),this.elkLog.report("setCursorIcon",{extra_info:JSON.stringify({toolType:t,cursorIcon:e})}),h.isObject(e)&&(h.isNumber(e.offsetX)?(e.offsetX>32&&(e.offsetX=Math.min(32,e.offsetX)),e.offsetX<0&&(e.offsetX=Math.max(0,e.offsetX))):delete e.offsetX,h.isNumber(e.offsetY)?(e.offsetY>32&&(e.offsetY=Math.min(32,e.offsetY)),e.offsetY<0&&(e.offsetY=Math.max(0,e.offsetY))):delete e.offsetY,Object.assign(o.ICONS,(i={},r=t,n=Object.assign(o.ICONS[t],e),r in i?Object.defineProperty(i,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[r]=n,i)))},Ut.prototype.setZoomCursorIcon=function(t,e){this.logger.info(this.loggerModuleName,"setZoomCursorIcon",{param:{zoomInCursorIcon:t,zoomOutCursorIcon:e}}),h.isObject(t)&&Object.assign(o.ICONS,{12:t})},Ut.prototype.getCursorIcons=function(){return o.ICONS},Ut.prototype.pptAction=function(t){this.logger.info(this.loggerModuleName,"pptAction",{param:{data:t}}),this.addRealtimeData({action:o.PROTOCOL_ACTION.PPT_EVENT_ACTION,seq:a.getSeq(),data:t})},Ut.prototype.createTranscode=function(t){return this.logger.info(this.loggerModuleName,"createTranscode",{param:{data:t}}),this.request.createTranscode(t)},Ut.prototype.describeTranscode=function(t){var e=this;h.isString(t)&&(t={taskId:t}),this.logger.info(this.loggerModuleName,"describeTranscode",{param:{data:t}}),this.request.describeTranscode(t).then((function(i){if(i.data.Response.Error){var r={status:"ERROR",code:i.data.Response.Error.Code,message:i.data.Response.Error.Message,taskId:t.taskId,userData:e.taskIdUserDataMap[t.taskId]};e.event.fire(e,"TEB_TRANSCODEPROGRESS",r),e.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(r)}),clearInterval(e.transcodeIntervalMap[t.taskId])}else if(i.data.Response){var o=Object.assign({code:"",message:"",userData:e.taskIdUserDataMap[t.taskId]},h.CamelCase2camelCase(i.data.Response));e.event.fire(e,"TEB_TRANSCODEPROGRESS",o),"FINISHED"===i.data.Response.Status&&(clearInterval(e.transcodeIntervalMap[t.taskId]),e.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(o)}))}}),(function(i){var r={status:"ERROR",code:"FailedOperation.SdkModule",message:"transcode failure, request error",taskId:t.taskId,userData:e.taskIdUserDataMap[t.taskId]};e.event.fire(e,"TEB_TRANSCODEPROGRESS",r),e.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(r)}),clearInterval(e.transcodeIntervalMap[t.taskId])})).catch((function(i){var r={status:"ERROR",code:"FailedOperation.SdkModule",message:"transcode failure, "+i.message,taskId:t.taskId,userData:e.taskIdUserDataMap[t.taskId]};e.event.fire(e,"TEB_TRANSCODEPROGRESS",r),e.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(r)}),clearInterval(e.transcodeIntervalMap[t.taskId])}))},Ut.prototype.destroy=function(){this.logger.info(this.loggerModuleName,"destroy"),this.heartbeat&&this.heartbeat.destroy(),this.textInputTask&&clearInterval(this.textInputTask),this.drawRaserTask&&clearInterval(this.drawRaserTask),this.sendInterval&&clearInterval(this.sendInterval),this.removeAllElement()},Ut.prototype.addImageElement=function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.getCurrentBoard();this.logger.info(this.loggerModuleName,"addImageElement",{param:{boardId:r,url:t}});var o=function(t){var e=this,o=a.getSeq(),n=new J({belongSeq:o,seq:o,user:this.identifier,url:t,boardId:r,show:i});n.getImageSize(this.boardWidth,this.boardHeight,this.getBoardScale(),(function(t){e.userData[r][e.identifier].push(n),e._pushBoardData(r,n),e.setNeedDraw(!0),e.addRealtimeData(n.getRealTimeData()),e.report.reportImageElement(n.getReportData())}))};if(h.isString(t))o.call(this,t),this.event.fire(this,"TEB_ADDIMAGEELEMENT","",t,"");else if(h.isObject(t)){var n=t,s=this.getCurrentFile();this.fileCos.uploadImgFile(n,s).then((function(t){o.call(e,t.fileUrl),e.event.fire(e,"TEB_ADDIMAGEELEMENT",t.fileName,t.fileUrl,t.userData)}))}},Ut.prototype.updateElements=function(t){var e=this,i=[],r=[];t.forEach((function(t){"imageElement"===t.type?i.push(t.getReportData()):"element"===t.type&&r.push(t.getReportData()),e.addRealtimeData(t.getRealTimeData())})),this.report.reportImageElement(i),this.report.reportElement(r)},Ut.prototype.updateDragDataFromTextTool=function(t,e,i){var r=!1;if(this.dragDataList.getDragData(this.currentBoard)){var n=this.getDragData();i=Math.floor(i?n.scale/i:n.scale),i=Math.max(o.MIN_SCALE,Math.min(o.MAX_SCALE,i)),(t||e||n.scale!==i)&&(r=!0),this.dragDataList.updateDragData(this.currentBoard,{scale:i,xOffset:n.xOffset-t,yOffset:n.yOffset-e})}else this.dragDataList.addDragData(this.currentBoard,new G({scale:this.getBoardScale(),xOffset:50-t,yOffset:50-e})),(t||e)&&(r=!0);r&&(this.addRealtimeData(this.dragDataList.getDragData(this.currentBoard).getRealTimeData()),this.report.reportDrag(Object.assign(this.dragDataList.getDragData(this.currentBoard).getReportData(),{boardId:this.currentBoard})))},Ut.prototype.machineNotify=function(t,e){},Ut.prototype.addRealtimeData=function(t){if(this.dataSyncEnable){if(t.action==o.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION){if(!(t.seq>=this.maxMoveSeq))return this.dragDataList.updateDragData(this.currentBoard,this.dragDataList.maxSeqDragData),void this.setNeedDraw(!0);this.maxMoveSeq=t.seq}t.boardId=this.currentBoard,this.realTimeData.push(t)}},Ut.prototype.reportElement=function(t){this.report.reportElement(t)},Ut.prototype.addSendAckData=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.dataSyncEnable){try{t=JSON.parse(t)}catch(t){}t.value.actions=t.value.actions.filter((function(t){return 6!=t.action})),this.sendAckDatas[t.seq]?delete this.sendAckDatas[t.seq]:e||(this.sendAckDatas[t.seq]=t)}},Ut.prototype.addReportAckData=function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.forEach((function(t,r){e.reportAckDatas[t.seq]?delete e.reportAckDatas[t.seq]:i||(e.reportAckDatas[t.seq]=t)}))},Ut.prototype.syncAndReload=function(){var t=this;if(this.permissions){var e=Object.keys(this.reportAckDatas).length;e?(this.request.reportMsg(Object.values(this.reportAckDatas),(function(e,i){t.syncHistroyData()})),this.elkLog.report("sync_report_failed",{extra_info:JSON.stringify({count:e})}),this.reportAckDatas={}):this.syncHistroyData();var i=Object.keys(this.sendAckDatas).length;if(i>0){var r=null;Object.values(this.sendAckDatas).forEach((function(t,e){null==r?r=t:(t.timestamp>r.timestamp&&(r.timestamp=t.timestamp,r.seq=t.seq),r.value.actions.push.apply(r.value.actions,t.value.actions))})),this.fireSyncDataEvent(this.getCurrentBoard(),r),this.elkLog.report("sync_send_failed",{extra_info:JSON.stringify({count:i})}),this.sendAckDatas={}}}},Ut.prototype.setImageTimeout=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.IMAGE_TIMEOUT;h.isNumber(t)&&(t=o.IMAGE_TIMEOUT),this.imageTimeout=t,this.elkLog.report("call_method",{extra_info:JSON.stringify({method:"setImageTimeout",data:t})})},Ut.prototype.getImageTimeout=function(){return this.imageTimeout},Ut.prototype.setHandwritingEnable=function(t){this.enableHandwriting=t},Ut.prototype.isHandwritingEnable=function(){return this.enableHandwriting},Ut.prototype.addH5Element=function(t,e){var i=this,r=this.getCurrentBoard(),o=new ot({belongSeq:t,seq:t,user:this.identifier,url:e.url,boardId:r,onloadDone:function(){i.event.fire(i,c.TEB_ADDELEMENT,{id:String(t),userData:e.userData||""}),i.addRealtimeData(o.getRealTimeData()),i.addReportData(o.getReportData())}});return o.setProperty({show:!0,x:0,y:0}),this.userData[r][this.identifier].push(o),this._pushBoardData(r,o),this.elementMap.set(String(o.belongSeq),o),this.setNeedDraw(!0),o},Ut.prototype.addCustomGraphElement=function(t){var e=this.getCurrentBoard(),i=t.url,r=t.show,o=t.x,n=t.y,s=t.userData;this.logger.info(this.loggerModuleName,"addCustomGraphElement",{param:{boardId:e,url:i}});var l=a.getSeq(),h=new ht({userData:s,belongSeq:l,seq:l,user:this.identifier,url:i,boardId:e,show:r,x:o,y:n,boardWidth:this.boardWidth,boardHeight:this.boardHeight,boardScale:this.getBoardScale()});this.userData[e][this.identifier].push(h),this._pushBoardData(e,h),this.elementMap.set(String(h.belongSeq),h),h.getImageSize(this.boardWidth,this.boardHeight,(function(t){}))},Ut.prototype.addElement=function(t,e,i){var r=null;r=i&&h.isString(i)?i:a.getSeq(),this.logger.info(this.loggerModuleName,"addElement",{param:Object.assign({seq:r,boardId:o},e)});var o=this.getCurrentBoard();return t===$.TEDU_BOARD_ELEMENT_H5?this.addH5Element(r,{url:e,userData:e}):t===$.TEDU_BOARD_ELEMENT_IMAGE?this.addImageElement(e):t===$.TEDU_BOARD_ELEMENT_CUSTOM_GRAPH?(this.customGraphData.url=e,this.customGraphData.userData=e,h.imageCache(this.customGraphData.url)):(t===$.TEDU_BOARD_ELEMENT_AUDIO||t===$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO)&&this.addAudioElement(this.identifier,this.getCurrentBoard(),r,e,t),r.toString()},Ut.prototype.removeElement=function(t){var e=this.elementMap.get(t);if(!e)return!1;e.show=!1;var i=null;return e.subType===$.TEDU_BOARD_ELEMENT_H5?(this.elementMap.delete(t),e.remove(),this.addRealtimeData(e.getRealTimeData()),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.belongSeq}]}),i=t):e.subType!==$.TEDU_BOARD_ELEMENT_CUSTOM_GRAPH&&e.subType!==$.TEDU_BOARD_ELEMENT_AUDIO&&e.subType!==$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO||(this.elementMap.delete(t),e.remove(),this.addRealtimeData(e.getRealTimeData()),this.reportElement(e.getReportData()),i=t),this.setNeedDraw(!0),this.isElementInSelectList(e.belongSeq)&&this.cancelSelect(),!!i},Ut.prototype.applyFileTranscode=function(t,e){var i=this,r="";if(h.isObject(t)){var o=t.userData;if(r=h.isFile(t.data)?t.data.name:t.name,/\.(bmp|jpg|jpeg|png|gif|webp|svg|psd|ai)/i.test(r)){var n={code:"FailedOperation.SdkModule",message:"transcode does not support image",userData:o,status:"ERROR"};return this.event.fire(this,"TEB_TRANSCODEPROGRESS",n),void this.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(n)})}this.fileCos.transcodeUploadFile(t).then((function(t){var r="https://".concat(t.Bucket,".file.myqcloud.com/").concat(t.Key);e=h.isObject(e)?Object.assign(e,{url:r}):{url:r},i.createTranscode(e).then((function(t){var e=null;if(t.data.Response.Error)e={code:t.data.Response.Error.Code,message:t.data.Response.Error.Message,status:"ERROR",userData:o},i.event.fire(i,"TEB_TRANSCODEPROGRESS",e);else{e=Object.assign({},h.CamelCase2camelCase(t.data.Response),{code:"",message:"",userData:o,status:"CREATED"}),i.event.fire(i,"TEB_TRANSCODEPROGRESS",e);var r=t.data.Response.TaskId;i.transcodeIntervalMap[r]=setInterval((function(){i.describeTranscode({taskId:r})}),5e3),i.taskIdUserDataMap[r]=o}i.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(e)})}),(function(t){var e={code:"FailedOperation.SdkModule",message:"transcode failure, request error",userData:o,status:"ERROR"};i.event.fire(i,"TEB_TRANSCODEPROGRESS",e),i.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(e)})})).catch((function(t){var e={code:"FailedOperation.SdkModule",message:"transcode failure, "+t.message,userData:o,status:"ERROR"};i.event.fire(i,"TEB_TRANSCODEPROGRESS",e),i.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(e)})}))})).catch((function(t){var e={status:"ERROR",code:"FailedOperation.SdkModule",message:"upload file failure, "+t.message,userData:o};i.event.fire(i,"TEB_TRANSCODEPROGRESS",e),i.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(e)})}))}else{var s={code:"FailedOperation.SdkModule",message:"invalid arguments",status:"ERROR",userData:""};this.event.fire(this,"TEB_TRANSCODEPROGRESS",s),this.elkLog.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(s)})}},Ut.prototype._setBackgroundImage=function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,r=this.getCurrentBoard();if(h.isString(t))this.setBackgroundPic(r,t,i),this.event.fire(this,"TEB_SETBACKGROUNDIMAGE","",t,"");else if(h.isObject(t)){var o=t,n=this.getCurrentFile();this.fileCos.uploadImgFile(o,n).then((function(t){e.setBackgroundPic(r,t.fileUrl,i),e.event.fire(e,"TEB_SETBACKGROUNDIMAGE",t.fileName,t.fileUrl,t.userData)})).catch((function(t){}))}},Ut.prototype.uploadBoardMessageToCos=function(t){var e=this,i="".concat(this.user,"_").concat(h.formatDateTime(h.getTimeStamp()),".txt"),r=new File([t],i,{type:"text/plain"});return new Promise((function(t,i){e.fileCos.upload({bucket:e.fileMessageCosInfo.bucket,appid:e.fileMessageCosInfo.appid,region:e.fileMessageCosInfo.region,body:r,path:"/message/"+e.options.tlsData.sdkAppId+"/"+e.options.classId+"/"+r.name}).then((function(e){var i=e.Bucket.substr(0,e.Bucket.lastIndexOf("-")),r="https://".concat(i,".").concat(o.CDN_DOMAIN,"/").concat(e.Key);t(r)}),(function(t){i(t)}))}))},Ut.prototype.resolveFileMessage=function(t){var e=this,i=t.url;this.request.requestFileMessage(i).then((function(t){200===t.status&&(e.addData(t.data),e.setNeedDraw())}),(function(t){}))},Ut.prototype.getFileScale=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentGroup,i=this.getFileInfo(e);return i&&(t=i.scale),t||(t=this.scale),t},Ut.prototype.setFileScale=function(t,e){var i=this,r=this.getFileInfo(t);if(r){e=Math.max(o.MIN_SCALE,Math.min(e,o.MAX_SCALE)),isNaN(e)&&(e=o.SCALE),r.scale=e;var n={action:o.PROTOCOL_ACTION.FILE_SCALE_ACTION,time:h.getTimeStamp(),seq:a.getSeq(),fid:t,scale:e};this.dragDataList.getDragDataByFid(t).forEach((function(t){i.dragDataList.updateDragData(t.bid,{scale:e})})),this.addRealtimeData(n),this.report.reportAddFile(Object.assign({},r,{isUpdateScale:1})),this.report.reportSwitchBoard({boardId:this.currentBoard,fid:r.fid,url:r.downloadURL,type:r.type,page:r.currentPageIndex,step:r.currentPageStep,ratio:r.ratio,scale:r.scale}),this.setNeedDraw(!0)}},Ut.prototype._buildRaserData=function(t,e,i){var r=1*i.seq||0,o=this.laserDataMap[String(e)]||[];if(0==o.length||r>o[0].seq){var n=new b(e,{action:i.action,color:i.color,radius:i.r,x:i.x,y:i.y,timestamp:i.timestamp,seq:i.seq,toolType:i.toolType,title:i.title,style:i.style});(i.timestamp||t%3==0)&&(this.pushLaserData(n),this.setLaserDraw(!0))}else o[0].seq},Ut.prototype.hideLaserData=function(){var t=this.getType();"line"!==t&&"raser"!==t||this.collectRaserData().over("raser"===this.getType()?3:1)},Ut.prototype.collectCustomGraph=function(){var t=this;return{start:function(e,i){t.customGraphData.url?t.addCustomGraphElement({url:t.customGraphData.url,userData:t.customGraphData.userData,show:!1,x:e,y:i}):t.event.fire(t,"TEB_WARNING",dt.TEDU_BOARD_WARNING_CUSTOM_GRAPH_URL_NON_EXISTS,"The url of the custom graphic does not exist")},draw:function(e,i,r,o){if(t.customGraphData.url){var n=t.userData[t.currentBoard][t.identifier].length,s=t.userData[t.currentBoard][t.identifier][n-1];s.setWidthHeight(r-e,o-i),Math.abs(s.realWidth*s.scaleX)>=4&&Math.abs(s.realHeight*s.scaleY)>=4?s.show=!0:s.show=!1,s.show=!0,t.setNeedDraw(!0)}},end:function(){if(t.customGraphData.url){var e=t.userData[t.currentBoard][t.identifier].length,i=t.userData[t.currentBoard][t.identifier][e-1];i.show?(i.show=!0,t.setNeedDraw(!0),t.addRealtimeData(i.getRealTimeData()),t.report.reportElement(i.getReportData()),t.event.fire(t,c.TEB_ADDELEMENT,{id:String(i.belongSeq),userData:i.userData})):(t.userData[t.currentBoard][t.identifier].pop(),t.elementMap.delete(String(i.belongSeq)))}}}},Ut.prototype._pushBoardData=function(t,e){if(this.data[t]||(this.data[t]=[]),this.data[t].push(e),this.data[t].length>1){var i=this.data[t][this.data[t].length-1],r=this.data[t][this.data[t].length-2];i.seq<r.seq&&this._sortGraphDataForBoard(t)}},Ut.prototype._sortGraphData=function(){if(this.data&&h.isObject(this.data))for(var t in this.data)this._sortGraphDataForBoard(t)},Ut.prototype._sortGraphDataForBoard=function(t){var e=this.data[t];e&&h.isArray(e)&&e.length&&(this.data[t]=e.sort((function(t,e){return t.seq-e.seq})))},Ut.prototype.setSystemCursorEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.systemCursorEnable=t},Ut.prototype.getSystemCursorEnable=function(){return this.systemCursorEnable},Ut.prototype.pushLaserData=function(t){var e=this.laserDataMap[t.user];if(e||(this.laserDataMap[t.user]=[],e=this.laserDataMap[t.user]),e.push(t),e.length>1){var i=e[e.length-1],r=e[e.length-2];i.seq<r.seq&&(this.laserDataMap[t.user]=e.sort((function(t,e){return t.seq-e.seq})))}},Ut.prototype.setToolTypeTitle=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={position:kt.TEDU_BOARD_POSITION_RIGHT_TOP,size:200,color:"#000000",style:F.TEDU_BOARD_TEXT_STYLE_NORMAL},r=Object.assign({},i,e);this.toolTypeTitleStyle.title=t;var o=i.size;r.size&&h.isNumber(r.size)&&(o=r.size),r.size=o*this.boardHeight/1e4,this.toolTypeTitleStyle.style=r,this.logger.info(this.loggerModuleName,"setToolTypeTitle",{param:r})},Ut.prototype.enableAudioControl=function(t){this.event.fire(this,"TEB_BOARD_AUDIOCONTROL_ENABLE_CHANGE",t),this.elkLog.report("call_method",{extra_info:JSON.stringify({method:"enableAudioControl",data:this.enable})}),this.logger.info(this.loggerModuleName,"enableAudioControl",{param:{enable:this.enable}})},Ut.prototype.setSyncAudioStatusEnable=function(t){this.isSyncAudioStatus=t},Ut.prototype.addAudioElement=function(t,e,i,r,n){var s=this,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=this.elementMap.get(String(i));if(n===$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO&&(e=o.COMMON_DEFAULT_BOARD,l&&(l.boardId=e)),!h){(h=new Nt({event:this.event,belongSeq:i,seq:i,user:t,url:r,subType:n,toolType:this.type,boardId:e,boardWidth:this.boardWidth,boardHeight:this.boardHeight,log:this.elkLog})).setDataListener((function(t,e,i){!s.isSyncAudioStatus&&i||(s.addRealtimeData(t),s.reportElement(e))}));var d=0;h.setEventListener((function(t,e,r){t==Mt.TEDU_BOARD_AUDIO_STATUS_LOADED&&(a||l||(l=h.getReportData(),a=h.getRealTimeData(),s.addRealtimeData(a),s.reportElement(l))),h.show&&(5==t?e>0&&e!=d&&e%2==0&&(d=e,s.elkLog.report("audio_status_change",{extra_info:JSON.stringify({id:String(i),status:t,progress:e,duration:r,audio_id:h.audioId()})})):s.elkLog.report("audio_status_change",{extra_info:JSON.stringify({id:String(i),status:t,progress:e,duration:r,audio_id:h.audioId()})}),s.event.fire(s,"TEB_AUDIO_STATUS_CHANGED",{id:String(i),status:t,progress:e,duration:r}))})),this.userData[e][t]||(this.userData[e][t]=[]),this.userData[e][t].push(h),this._pushBoardData(e,h),this.elementMap.set(String(i),h),a||l||this.event.fire(this,c.TEB_ADDELEMENT,{id:String(i),userData:""})}return a&&h.setRealTimeData(a),l&&h.setReportData(l),this.setNeedDraw(!0),h},Ut.prototype.getBoardElementList=function(t){t=t||this.getCurrentBoard();var e=[];return this.elementMap.forEach((function(i){i.getBoardId()!==t&&i.subType!==$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO||!i.show||e.push({boardId:i.getBoardId(),elementId:String(i.belongSeq),type:i.subType,url:i.url})})),e},Ut.prototype.removeAllElement=function(){var t=[];this.elementMap.forEach((function(e,i){e.show&&t.push(i),e.remove&&e.remove(),e.destroy&&e.destroy()})),this.elementMap=new Map,t.length&&this.event.fire(this,c.TEB_REMOVEELEMENT,t)},Ut.prototype.removeRenderedElement=function(){var t=this;return this.elementMap.forEach((function(e,i){e.subType!==$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO&&(e.getBoardId()===t.getCurrentBoard()&&e.show||e.remove&&e.remove())})),[]},Ut.prototype.isElementInSelectList=function(t){for(var e=this.getSelectList()||[],i=!1,r=0,o=e.length;r<o;r++)if(e[r].belongSeq===t){i=!0;break}return i},Ut.prototype.filterGlobalAudioElement=function(){var t=[];return this.elementMap.forEach((function(e){e.subType===$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO&&t.push(e)})),t};var Ft=Ut,Ht={TEDU_BOARD_IMAGE_STATUS_LOADING:1,TEDU_BOARD_IMAGE_STATUS_LOAD_DONE:2,TEDU_BOARD_IMAGE_STATUS_LOAD_ABORT:3,TEDU_BOARD_IMAGE_STATUS_LOAD_ERROR:4,TEDU_BOARD_IMAGE_STATUS_LOAD_TIMEOUT:5,TEDU_BOARD_IMAGE_STATUS_LOAD_CANCEL:6},Gt={TEDU_BOARD_BACKGROUND_H5_STATUS_LOADING:1,TEDU_BOARD_BACKGROUND_H5_STATUS_LOAD_FINISH:2},Wt={TEDU_BOARD_H5_FILE_STATUS_LOADING:1,TEDU_BOARD_H5_FILE_STATUS_LOADED:2},Vt={TEDU_BOARD_H5_PPT_STATUS_LOADING:1,TEDU_BOARD_H5_PPT_STATUS_LOADED:2,TEDU_BOARD_H5_PPT_STATUS_CANCEL:3,TEDU_BOARD_H5_PPT_STATUS_TIMEOUT:4,TEDU_BOARD_H5_PPT_STATUS_RESOURCES_LOADING_ERROR:5,TEDU_BOARD_H5_PPT_STATUS_RUNTIME_ERROR:6},Yt={TEDU_BOARD_TOOL_TYPE_MOUSE:0,TEDU_BOARD_TOOL_TYPE_PEN:1,TEDU_BOARD_TOOL_TYPE_ERASER:2,TEDU_BOARD_TOOL_TYPE_LASER:3,TEDU_BOARD_TOOL_TYPE_LINE:4,TEDU_BOARD_TOOL_TYPE_OVAL:5,TEDU_BOARD_TOOL_TYPE_RECT:6,TEDU_BOARD_TOOL_TYPE_OVAL_SOLID:7,TEDU_BOARD_TOOL_TYPE_RECT_SOLID:8,TEDU_BOARD_TOOL_TYPE_POINT_SELECT:9,TEDU_BOARD_TOOL_TYPE_RECT_SELECT:10,TEDU_BOARD_TOOL_TYPE_TEXT:11,TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG:12,TEDU_BOARD_TOOL_TYPE_SQUARE:13,TEDU_BOARD_TOOL_TYPE_SQUARE_SOLID:14,TEDU_BOARD_TOOL_TYPE_CIRCLE:15,TEDU_BOARD_TOOL_TYPE_CIRCLE_SOLID:16,TEDU_BOARD_TOOL_TYPE_BOARD_CUSTOM_GRAPH:17};function Xt(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var zt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._insertStyle()}var e,i;return e=t,(i=[{key:"_insertStyle",value:function(){var t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.innerText="\n    .tx_board_canvas_wrap {\n      -webkit-user-select:none; /*webkit浏览器*/\n      user-select:none;\n    }\n    \n    /*    ================================== 激光笔，画笔 =========================================  */\n    .tic-board_laserwrap {\n      pointer-events: none;\n      position:relative;\n      z-index:40;\n      width:100%;\n      height:100%;\n      top: 0;\n      left: 0;\n      -webkit-transform: translateX(-50%) translateY(-50%) !important;\n      transform: translateX(-50%) translateY(-50%) !important;\n    }\n\n    .tic-board_laser-item {\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 40;\n    }\n    \n    .tic-board_laser-item-img {\n      width: 100%;\n      height: auto;\n      display: block;\n    }\n\n    .tic-board_laser-item-img.hide {\n      visibility: hidden;\n    }\n\n    .tic-board_laser-item-title {\n      position: absolute;\n      z-index: 40;\n      line-height:1;\n      white-space: nowrap;\n    }\n    /*    ================================== 激光笔，画笔 =========================================  */\n\n    /*    ================================== 滚动条 =========================================         */\n    .tiw-scroll-vertical__wrap {\n      position: absolute;\n      right: 0;\n      top: 0;\n      width: 10px;\n      height: 100%;\n      overflow-y: auto;\n      z-index: 2000;\n    }\n\n    .tiw-scroll-horizontal__wrap {\n      position: absolute;\n      left: 0;\n      bottom: 0;\n      width: 100%;\n      height: 10px;\n      overflow-x: auto;\n      z-index: 2000;\n    }\n\n    .tiw-scroll-vertical__wrap.disable-scroll, .tiw-scroll-horizontal__wrap.disable-scroll {\n      pointer-events: none;\n    }\n\n    .tiw-scroll-vertical {\n      width: 100%;\n    }\n\n    .tiw-scroll-horizontal {\n      height: 10px;\n    }\n\n\n    /* 滚动条滑轨 */\n    .tiw-scroll-vertical__wrap::-webkit-scrollbar {\n        width: 10px;\n        height: 0;\n    }\n\n    .tiw-scroll-horizontal__wrap::-webkit-scrollbar {\n      width: 0;\n      height: 10px;\n    }\n\n    /* 滚动条滑轨 */\n    .tiw-scroll-vertical__wrap::-webkit-scrollbar-track, .tiw-scroll-horizontal__wrap::-webkit-scrollbar-track{\n      border-radius: 6px;\n      background: rgba(0,0,0,0.06);\n    }\n\n    /* 滚动条滑块 */\n    .tiw-scroll-vertical__wrap::-webkit-scrollbar-thumb, .tiw-scroll-horizontal__wrap::-webkit-scrollbar-thumb {\n      border-radius: 6px;\n      background: rgba(0,0,0,0.12);\n      -webkit-box-shadow: inset 0 0 10px rgba(0,0,0,0.2);\n    }\n    /*    ================================== 滚动条 =========================================         */\n\n\n    /* ====================================== audio ============================================        */\n    .tic-board__audiowrap {\n      pointer-events: none;\n      position: absolute;\n      z-index: 50;\n      width:100%;\n      height:100%;\n      top: 0;\n      left: 0;\n      font-size: 12px;\n      -webkit-transform: translateX(-50%) translateY(-50%) !important;\n      transform: translateX(-50%) translateY(-50%) !important;\n    }\n\n    .tiw-audio__wrap {\n      position: absolute;\n      pointer-events: auto;\n      display: flex;\n      align-items: center;\n      background: #f1f3f4;\n      height: 54px;\n      padding: 0 2%;\n      border-radius: 200px;\n      box-sizing: border-box;\n      cursor: auto;\n    }\n\n    .tiw-audio__wrap .tiw-play__btn {\n      width: 6.5%;\n      height: 100%;\n      cursor: pointer;\n      background-size: contain;\n      background-repeat: no-repeat;\n      background-position: center center;\n    }\n\n    .tiw-audio__wrap .tiw-play__btn.disable {\n      cursor: not-allowed;\n    }\n\n    .tiw-audio__wrap .tiw-play__btn:hover {\n      transform: scale(1.2);\n      -webkit-transform: scale(1.2);\n    }\n\n    .tiw-audio__wrap .tiw-play__btn.disable:hover {\n      transform: scale(1);\n      -webkit-transform: scale(1);\n    }\n\n    .tiw-audio__wrap .tiw-play__btn.start-btn {\n      background-image: url(".concat(o.audioIcons.startIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-play__btn.pause-btn {\n      background-image: url(").concat(o.audioIcons.pauseIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-play__btn.start-btn.disable {\n      background-image: url(").concat(o.audioIcons.disableStartIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-play__btn.pause-btn.disable {\n      background-image: url(").concat(o.audioIcons.disablePauseIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-play__time-progress {\n      padding: 0 3%;\n      font-size: 108%;\n      width: 28%;\n      transform-origin: 0;\n      font-family: customFontFamily;\n      color: #0b0b0b;\n      word-break: keep-all;\n    }\n\n    .tiw-audio__wrap .tiw-play__time-split {\n      margin: 2px;\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress-wrap {\n      flex: 1;\n      height: 100%;\n      tap-highlight-color: rgba(0, 0, 0, 0);\n      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress {\n      position: relative;\n      background: #c1c2c3;\n      height: 6%;\n      border-radius: 4px;\n      top: 50%;\n      transform: translateY(-50%);\n      -webkit-transform:translateY(-50%);\n      cursor: pointer;\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress.disable {\n      cursor: not-allowed;\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress:hover {\n      box-shadow:0px 0px 4px #c1c2c3;\n      -webkit-box-shadow:0px 0px 4px #c1c2c3; \n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress.disable:hover {\n      box-shadow:none;\n      -webkit-box-shadow:none;\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress .tiw-progress__real {\n      pointer-events: none;\n      background: #0b0b0b;\n      height: 100%;\n      width: 0;\n      border-radius: 4px;\n    }\n    \n    .tiw-audio__wrap .tiw-play__bar-progress .tiw-progress__circle {\n      position: absolute;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background-color: #0b0b0b;\n      top: -4px;\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress .tiw-progress__circle:hover {\n      transform: scale(1.2, 1.2);\n      -webkit-transform: scale(1.2, 1.2);\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress .tiw-progress__circle.disable {\n      background-color: #bfbfbf;\n    }\n\n    .tiw-audio__wrap .tiw-play__bar-progress .tiw-progress__circle.disable:hover {\n      transform: scale(1);\n      -webkit-transform: scale(1);\n    }\n\n\n    .tiw-audio__wrap .tiw-play__btn-muted {\n      margin-left: 4%;\n      width: 6.5%;\n      height: 100%;\n      background-size: contain;\n      background-repeat: no-repeat;\n      background-position: center center;\n      cursor: pointer;\n    }\n\n    .tiw-audio__wrap .tiw-play__btn-muted.disable {\n      cursor: not-allowed;\n    }\n\n    .tiw-audio__wrap .tiw-play__btn-muted:hover {\n      transform: scale(1.2);\n      -webkit-transform: scale(1.2);\n    }\n\n    .tiw-audio__wrap .tiw-play__btn-muted.disable:hover {\n      transform: scale(1);\n      -webkit-transform: scale(1);\n    }\n\n    .tiw-audio__wrap .tiw-play__btn-muted.muted-btn {\n      background-image: url(").concat(o.audioIcons.mutedIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-play__btn-muted.muted-btn.disable {\n      background-image: url(").concat(o.audioIcons.disableMutedIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-play__btn-muted.unmuted-btn {\n      background-image: url(").concat(o.audioIcons.unmutedIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-play__btn-muted.unmuted-btn.disable {\n      background-image: url(").concat(o.audioIcons.disableUnmutedIcon,");\n    }\n\n\n    .tiw-audio__wrap .tiw-close__btn {\n      position: absolute;\n      right: 0;\n      top: 0;\n      width: 6%;\n      background-size: contain;\n      background-repeat: no-repeat;\n      background-position: center center;\n      cursor: pointer;\n      background-image: url(").concat(o.audioIcons.closeIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-close__btn:hover {\n      transform: scale(1.2);\n      -webkit-transform: scale(1.2);\n    }\n\n    .tiw-audio__wrap .tiw-close__btn.disable {\n      cursor: not-allowed;\n      background-image: url(").concat(o.audioIcons.disableCloseIcon,");\n    }\n\n    .tiw-audio__wrap .tiw-close__btn.disable:hover {\n      transform: scale(1);\n      -webkit-transform: scale(1);\n    }\n\n    /* =====================================  audio =============================================      */\n    "),t.appendChild(e)}},{key:"getTemplate",value:function(){return'<canvas style="z-index:10;position:absolute; top:0; left:0;line-height:1;"></canvas>\n    <canvas style="z-index:15;position:absolute; top:0; left:0;line-height:1;"></canvas>\n    <div class="tic-board_laserwrap"></div>\n    <div class="tic-board__audiowrap"></div>\n    <div id="tic_video_wrap" style="z-index:20;position:absolute; top:0; left:0; display:none;"></div>\n    <div class="tic_board__imagewrap" style="position:absolute;z-index:7;width:100%;height:100%;"></div>\n    <div class="tic_board_textbox" style="position:absolute;z-index:10;width:100%;height:100%;"></div>\n    <div class="tic_cursorlayer__wrap" style="position:absolute;z-index:0;width:100%;height:100%;"></div>\n    <div class="tiw_board_webview_wrap" style="position:absolute;z-index:0;width:100%;height:100%;"></div>\n    <div class="tx_board_canvas_box" style="position: absolute;">\n      <img src="'.concat(o.defaultLoadingImage,'" width="48" height="48" class="tic_board_bg_progress" style="display:none;position:absolute;left: 50%;top: 50%;-webkit-transform: translateX(-50%) translateY(-50%);transform: translateX(-50%) translateY(-50%);" />\n      <img class="tic_board_img_bg" style="display:none; position:absolute; top:0; left:0;z-index:5;" />\n      <div class="tic_board_bg" style="z-index:4;position:absolute; top:0; left:0;"></div>\n      <textarea maxlength="').concat(o.TEXT_MAX_LENGTH,'" style="display:none;" rows="1"></textarea>\n    </div>\n    ')}}])&&Xt(e.prototype,i),t}(),jt=i(101),Jt=i.n(jt);function Kt(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Zt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.src=e,this.dom=null,this.isRepeatLoad=!1}var e,i;return e=t,(i=[{key:"createElement",value:function(t,e,i){var r=this.remove(t,e);r?(this.dom=r,this.isRepeatLoad=!0):(this.isRepeatLoad=!1,this.dom=document.createElement("iframe"),this.dom.classList.add("tic_board_h5_bg"),this.dom.style.display="none",this.dom.style.border="none",this.dom.style.position="absolute",this.dom.style.top=0,this.dom.style.left=0,this.dom.style.zIndex=5,this.dom.src=e,this.dom.scrolling="no",this.dom.onload=function(){i&&i(this.src)},t.appendChild(this.dom))}},{key:"render",value:function(t){this.isRepeatLoad||t&&t(),this.dom.style.display="block"}},{key:"layout",value:function(t,e){this.dom.width=t,this.dom.height=e}},{key:"remove",value:function(t,e){for(var i=null,r=t.getElementsByClassName("tic_board_h5_bg"),o=0,n=r.length;o<n;o++){var s=r[o],a=s.getAttribute("src");!e||a!=e&&a!=encodeURI(e)?s.remove():i=s}return i}}])&&Kt(e.prototype,i),t}();function Qt(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var $t=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.src=e,this.dom=null,this.isRepeatLoad=!1}var e,i;return e=t,(i=[{key:"createElement",value:function(t,e,i){var r=this.remove(t,e);r?(this.dom=r,this.isRepeatLoad=!0):(this.isRepeatLoad=!1,this.dom=document.createElement("iframe"),this.dom.classList.add("tic_board_h5_file"),this.dom.style.display="none",this.dom.style.border="none",this.dom.style.position="absolute",this.dom.style.top=0,this.dom.style.left=0,this.dom.style.zIndex=25,this.dom.src=e,this.dom.scrolling="auto",this.dom.onload=function(){i&&i()},t.appendChild(this.dom))}},{key:"render",value:function(t){this.isRepeatLoad||t&&t(),this.dom.style.display="block"}},{key:"layout",value:function(t,e){this.dom&&(this.dom.width=t,this.dom.height=e)}},{key:"remove",value:function(t,e){for(var i=null,r=t.getElementsByClassName("tic_board_h5_file"),o=0,n=r.length;o<n;o++){var s=r[o],a=s.getAttribute("src");!e||a!=e&&a!=encodeURI(e)?s.remove():i=s}return i}}])&&Qt(e.prototype,i),t}();function te(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ee=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,i=[{key:"createElement",value:function(t){var e=document.createElement("iframe");return e.classList.add("tic_iframe_H5"),e.style.border="none",e.style.display="none",e.scrolling="no",e.setAttribute("name",JSON.stringify({sdkAppId:t.sdkAppId,userId:t.userId,version:o.VERSION,progressBarUrl:t.progressBarUrl})),e}}],null&&te(e.prototype,null),i&&te(e,i),t}();function ie(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var re=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,(i=[{key:"onCompositionstart",value:function(){this.compositionLock=!0}},{key:"onCompositionupdate",value:function(){}},{key:"onCompositionend",value:function(){this.compositionLock=!1,this.compositionEndCallback&&this.compositionEndCallback()}}])&&ie(e.prototype,i),t}(),oe={TEDU_BOARD_VIDEO_STATUS_ERROR:1,TEDU_BOARD_VIDEO_STATUS_LOADING:2,TEDU_BOARD_VIDEO_STATUS_LOADED:3,TEDU_BOARD_VIDEO_STATUS_PLAYED:4,TEDU_BOARD_VIDEO_STATUS_TIMEUPDATE:5,TEDU_BOARD_VIDEO_STATUS_PAUSED:6,TEDU_BOARD_VIDEO_STATUS_SEEKED:7,TEDU_BOARD_VIDEO_STATUS_ENDED:8,TEDU_BOARD_VIDEO_STATUS_WAITING:9,TEDU_BOARD_VIDEO_STATUS_PLAYING:10};function ne(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var se=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=e,this.listener=i,this._insertStyle(),this._createElement(),this.isTouchDown=!1,this.touchId=null,this.direction=null}var e,i;return e=t,(i=[{key:"_insertStyle",value:function(){var t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.innerText="\n      .tiw-drag__dir {\n        position:absolute;\n        width:12px;\n        height:12px;\n        background:red;\n      }\n\n      .tiw-left-top__dir {\n        left:-1px;\n        top:-1px;\n        cursor:nwse-resize;\n      }\n\n      .tiw-top-center__dir {\n        left:calc(50% - 6px);\n        top:-1px;\n        cursor:ns-resize;\n      }\n\n      .tiw-right-top__dir {\n        right:-1px;\n        top:-1px;\n        cursor:nesw-resize;\n      }\n\n      .tiw-right-center__dir {\n        right:-1px;\n        top:calc(50% - 6px);\n        cursor:ew-resize;\n      }\n\n      .tiw-right-bottom__dir {\n        right:-1px;\n        bottom:-1px;\n        cursor:nwse-resize;\n      }\n\n      .tiw-bottom-center__dir {\n        left:calc(50% - 6px);\n        bottom:-1px;\n        cursor:ns-resize;\n      }\n\n      .tiw-left-bottom__dir {\n        left:-1px;\n        bottom:-1px;\n        cursor:nesw-resize;\n      }\n\n      .tiw-left-center__dir {\n        left:-1px;\n        top:calc(50% - 6px);\n        cursor:ew-resize;\n      }\n    ",t.appendChild(e)}},{key:"_createElement",value:function(){var t=this.cursorPositionLayer=document.createElement("div");t.setAttribute("style","position:relative;left:0;top:0;width:100%;height:100%;border:1px dotted red;cursor:move;visibility: hidden;");var e=this.leftTopScaleEl=this._createScaleElement("tiw-left-top__dir tiw-point__0");t.appendChild(e);var i=this.topCenterScaleEl=this._createScaleElement("tiw-top-center__dir tiw-point__1");t.appendChild(i);var r=this.rightTopScaleEl=this._createScaleElement("tiw-right-top__dir tiw-point__2");t.appendChild(r);var o=this.rightCenterScaleEl=this._createScaleElement("tiw-right-center__dir tiw-point__3");t.appendChild(o);var n=this.rightBottomScaleEl=this._createScaleElement("tiw-right-bottom__dir tiw-point__4");t.appendChild(n);var s=this.bottomCenterScaleEl=this._createScaleElement("tiw-bottom-center__dir tiw-point__5");t.appendChild(s);var a=this.leftBottomScaleEl=this._createScaleElement("tiw-left-bottom__dir tiw-point__6");t.appendChild(a);var l=this.leftCenterScaleEl=this._createScaleElement("tiw-left-center__dir tiw-point__7");t.appendChild(l),this.eightDirectionEl=[this.leftTopScaleEl,this.topCenterScaleEl,this.rightTopScaleEl,this.rightCenterScaleEl,this.rightBottomScaleEl,this.bottomCenterScaleEl,this.leftBottomScaleEl,this.leftCenterScaleEl],this._eightDirectionEl=[this.leftTopScaleEl,this.topCenterScaleEl,this.rightTopScaleEl,this.rightCenterScaleEl,this.rightBottomScaleEl,this.bottomCenterScaleEl,this.leftBottomScaleEl,this.leftCenterScaleEl];var h=this.rotateEl=this._createRotateElement();t.appendChild(h),this.container.appendChild(t)}},{key:"_createScaleElement",value:function(t){var e=document.createElement("div");return e.setAttribute("class","tiw-drag__dir ".concat(t||"")),e}},{key:"_createRotateElement",value:function(){var t=this.rotateDivEl=document.createElement("div");t.setAttribute("style","margin-left:-12px;width:24px;height:24px;background:url(".concat("https://res.qcloudtiw.com/board/icons/rotate-icon.png",") no-repeat center center;background-size:contain;cursor:url(").concat("https://res.qcloudtiw.com/board/icons/rotate-cursor-icon.png","), url(").concat("https://res.qcloudtiw.com/board/icons/rotate-cursor-icon2.png","), auto;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"));var e=document.createElement("div");e.setAttribute("style","width:1px;height:20px;background:red;");var i=this.rotateContainerDiv=document.createElement("div");return i.setAttribute("style","position:absolute;left:calc(50%);top:-44px;"),i.appendChild(t),i.appendChild(e),i}},{key:"showSelectLayer",value:function(t){var e=this;this.elements=t,this._showSelectLayer(),this.cursorPositionLayer.style.visibility="visible",this.elements.length>1?this._showElement(this.rotateContainerDiv,!1):this._showElement(this.rotateContainerDiv,!0),this.rotateDivEl.onmouseenter=function(t){t.stopPropagation()},this.rotateDivEl.onmousedown=function(t){t.stopPropagation(),e._showScaleElement(!1),e.rotateDivEl.style.cursor="url(".concat("https://res.qcloudtiw.com/board/icons/rotate-cursor-icon2.png","), auto");var i=e._getEventPageXY(t);e.rotateAction(t,i.clientX,i.clientY)},this.cursorPositionLayer.onmouseenter=function(t){e.cursorPositionLayer.style.cursor="move"},this.cursorPositionLayer.onmousedown=function(t){e.cursorPositionLayer.style.cursor="move",e.moveScaleAction(t,e.cursorPositionLayer)},this.cursorPositionLayer.ontouchstart=function(t){e.cursorPositionLayer.style.cursor="move",e.isTouchDown=!0,e.moveScaleAction(t,e.cursorPositionLayer),e.listener.ontouchstart&&e.listener.ontouchstart()},this.rotateDivEl.ontouchstart=function(t){t.stopPropagation(),e._showScaleElement(!1),e.rotateDivEl.style.cursor="url(".concat("https://res.qcloudtiw.com/board/icons/rotate-cursor-icon2.png","), auto");var i=e._getEventPageXY(t);e.rotateAction(t,i.clientX,i.clientY)},this.eightDirectionEl.forEach((function(t){t.ontouchstart=null,t.onmousedown=null,t.ontouchstart=t.onmousedown=function(i){e.moveScaleAction(i,t)}}))}},{key:"moveScaleAction",value:function(t,e){var i=this;t.stopPropagation(),t.preventDefault();var r=0,o=0,n=this._getEventPageXY(t);r=n.pageX,o=n.pageY,-1e6===r&&-1e6===o||(this.container.onmousemove=function(t){var n=i._doMove(t,e,r,o);r=n.startX,o=n.startY},this.container.onmouseleave=function(t){t.stopPropagation(),t.preventDefault(),i.container.onmousemove=null,i.container.onmouseleave=null,i.container.onmouseup=null,r=0,o=0},this.container.onmouseup=function(t){t.stopPropagation(),t.preventDefault(),i.container.onmousemove=null,i.container.onmouseleave=null,i.container.onmouseup=null,r=0,o=0},this.container.ontouchmove=function(t){var n=i._doMove(t,e,r,o);r=n.startX,o=n.startY},this.container.ontouchend=function(t){var e=i._getEventPageXY(t);-1e6===e.pageX&&-1e6===e.pageY||(i.isTouchDown=!1,i.touchId=null,t.stopPropagation(),t.preventDefault(),i.container.ontouchmove=null,i.container.ontouchend=null,i.container.ontouchcancel=null,r=0,o=0,i.listener.ontouchend&&i.listener.ontouchend())},this.container.ontouchcancel=function(t){var e=i._getEventPageXY(t);-1e6===e.pageX&&-1e6===e.pageY||(i.isTouchDown=!1,i.touchId=null,t.stopPropagation(),t.preventDefault(),i.container.ontouchmove=null,i.container.ontouchend=null,i.container.ontouchcancel=null,r=0,o=0,i.listener.ontouchcancel&&i.listener.ontouchcancel())})}},{key:"_doMove",value:function(t,e,i,r){t.preventDefault(),t.stopPropagation();var o=this._getEventPageXY(t);if(-1e6!==o.pageX||-1e6!==o.pageY){if(e===this.cursorPositionLayer)this.setSize(0,0),this.setPosition(e,o.pageX-i,o.pageY-r);else if(e===this.leftTopScaleEl||e===this.rightTopScaleEl||e===this.leftBottomScaleEl||e===this.rightBottomScaleEl){var n,s;this.cursorPositionLayer.style.cursor=e.style.cursor;var a;this.direction||(o.pageX-i!=0?this.direction="x":o.pageY-r!=0?this.direction="y":this.direction="xy"),e===this.leftTopScaleEl?(n=(this.borderWidth-(o.pageX-i))/this.borderWidth,s=(this.borderHeight-(o.pageY-r))/this.borderHeight):e===this.rightTopScaleEl?(n=(this.borderWidth+o.pageX-i)/this.borderWidth,s=(this.borderHeight-(o.pageY-r))/this.borderHeight):e===this.leftBottomScaleEl?(n=(this.borderWidth-(o.pageX-i))/this.borderWidth,s=(this.borderHeight+(o.pageY-r))/this.borderHeight):e===this.rightBottomScaleEl&&(n=(this.borderWidth+o.pageX-i)/this.borderWidth,s=(this.borderHeight+o.pageY-r)/this.borderHeight),a="x"==this.direction?n:"y"==this.direction?s:Math.max(n,s),this.setPositionSize(e,a,a)}else if(e===this.leftCenterScaleEl){var l=(this.borderWidth-(o.pageX-i))/this.borderWidth;this.setPositionSize(e,l,1)}else if(e===this.rightCenterScaleEl){var h=(this.borderWidth+o.pageX-i)/this.borderWidth;this.setPositionSize(e,h,1)}else if(e===this.topCenterScaleEl){var d=(this.borderHeight-(o.pageY-r))/this.borderHeight;this.setPositionSize(e,1,d)}else if(e===this.bottomCenterScaleEl){var c=(this.borderHeight+o.pageY-r)/this.borderHeight;this.setPositionSize(e,1,c)}return i=o.pageX,r=o.pageY,this.listener.onmousemove&&this.listener.onmousemove(this.elements),this._showSelectLayer(),{startX:i,startY:r}}}},{key:"rotateAction",value:function(t,e,i){var r=this,o=t.currentTarget.getBoundingClientRect();this.container.onmousemove=function(t){t.stopPropagation();var n=r._calcRotateDeg(t,o,e,i);r.elementRotate(n),r.cursorPositionLayer.style.cursor=r.rotateDivEl.style.cursor},this.container.onmouseleave=function(t){t.stopPropagation(),t.preventDefault(),r.container.onmousemove=null,r.container.onmouseleave=null,r.container.onmouseup=null,r._showScaleElement(!0)},this.container.onmouseup=function(t){t.stopPropagation(),t.preventDefault(),r.container.onmousemove=null,r.container.onmouseleave=null,r.container.onmouseup=null,r._showScaleElement(!0)},this.container.ontouchmove=function(t){t.stopPropagation();var n=r._calcRotateDeg(t,o,e,i);r.elementRotate(n),r.cursorPositionLayer.style.cursor=r.rotateDivEl.style.cursor},this.container.ontouchend=function(t){var e=r._getEventPageXY(t);-1e6===e.pageX&&-1e6===e.pageY||(r.isTouchDown=!1,r.touchId=null,t.stopPropagation(),t.preventDefault(),r.container.ontouchmove=null,r.container.ontouchend=null,r.container.ontouchcancel=null,r.listener.ontouchend&&r.listener.ontouchend(),r._showScaleElement(!0))},this.container.ontouchcancel=function(t){var e=r._getEventPageXY(t);-1e6===e.pageX&&-1e6===e.pageY||(r.isTouchDown=!1,r.touchId=null,t.stopPropagation(),t.preventDefault(),r.container.ontouchmove=null,r.container.ontouchend=null,r.container.ontouchcancel=null,r.listener.ontouchcancel&&r.listener.ontouchcancel(),r._showScaleElement(!0))}}},{key:"elementRotate",value:function(t){this.cursorPositionLayer.style.transform="rotate(".concat(t,"deg)"),this.cursorPositionLayer.style.webkitTransform="rotate(".concat(t,"deg)"),this.elements.forEach((function(e){e.setRotate(t)})),this.listener.onmousemove&&this.listener.onmousemove(this.elements)}},{key:"setPositionSize",value:function(t,e,i){var r=this;this.elements.forEach((function(o){var n=o.getRealSize(),s=o.deg,a="";t===r.leftTopScaleEl?a="RIGHT_BOTTOM":t===r.rightTopScaleEl?a="LEFT_BOTTOM":t===r.leftBottomScaleEl?a="RIGHT_TOP":t===r.rightBottomScaleEl?a="LEFT_TOP":t===r.leftCenterScaleEl?a="RIGHT_TOP":t===r.rightCenterScaleEl?a="LEFT_TOP":t===r.topCenterScaleEl?a="LEFT_BOTTOM":t===r.bottomCenterScaleEl&&(a="LEFT_TOP");var l,h={LEFT_TOP:{x:n.left,y:n.top},RIGHT_TOP:{x:n.left+n.width,y:n.top},RIGHT_BOTTOM:{x:n.left+n.width,y:n.top+n.height},LEFT_BOTTOM:{x:n.left,y:n.top+n.height},MIDDLE:{x:(n.left+n.left+n.width)/2,y:(n.top+n.top+n.height)/2}},d=n.width*(e-1),c=n.height*(i-1),u=r._calcRotateXY(s,h[a],h.MIDDLE);l={LEFT_TOP:{x:n.left,y:n.top},RIGHT_TOP:{x:n.left+n.width+d,y:n.top},RIGHT_BOTTOM:{x:n.left+n.width+d,y:n.top+n.height+c},LEFT_BOTTOM:{x:n.left,y:n.top+n.height+c},MIDDLE:{x:(n.left+n.left+n.width+d)/2,y:(n.top+n.top+n.height+c)/2}};var p=r._calcRotateXY(s,l[a],l.MIDDLE),f=u.x-p.x,g=u.y-p.y;o.setSize(d,c),o.setPosition(!1,f,g)}))}},{key:"setPosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.elements.forEach((function(t){t.setPosition(!0,e,i)}))}},{key:"setSize",value:function(t,e){this.elements.forEach((function(i){i.setSize(t,e)}))}},{key:"_showSelectLayer",value:function(){for(var t=1e4,e=1e4,i=0,r=0,o=0,n=this.elements.length;o<n;o++){var s=this.elements[o];if(1==this.elements.length){var a=s.getRealSize();t=Math.min(t,a.left),e=Math.min(e,a.top),i=Math.max(i,a.left+a.width),r=Math.max(r,a.top+a.height)}else{var l=s.rectArea;t=Math.min(t,l.minX*s.boardWidth/1e4),e=Math.min(e,l.minY*s.boardHeight/1e4),i=Math.max(i,l.maxX*s.boardWidth/1e4),r=Math.max(r,l.maxY*s.boardHeight/1e4)}}i-=t,r-=e,this.borderWidth=i,this.borderHeight=r,this.borderLeft=t,this.borderTop=e,this.cursorPositionLayer.style.left=t+"px",this.cursorPositionLayer.style.top=e+"px",this.cursorPositionLayer.style.width=i+"px",this.cursorPositionLayer.style.height=r+"px";var h;h=1===this.elements.length?"rotate(".concat(this.elements[0].deg,"deg)"):"none",this.cursorPositionLayer.style.transform=h,this.cursorPositionLayer.style.webkitTransform=h}},{key:"setListener",value:function(t){this.listener=t}},{key:"_getEventPageXY",value:function(t){if(t.changedTouches){var e=null;if(null==this.touchId)this.touchId=t.changedTouches[0].identifier,e=t.changedTouches[0];else{for(var i=0,r=t.changedTouches.length;i<r;i++){var o=t.changedTouches[i];if(this.touchId===o.identifier){e=o;break}}e||(e={pageX:-1e6,pageY:-1e6,clientX:0,clientY:0})}return{pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY}}return{pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY}}},{key:"_calcRotateDeg",value:function(t,e,i,r){var o=this._getEventPageXY(t),n=e.left+e.width/2+(o.clientX-i),s=e.top+e.height/2+(o.clientY-r),a=this.cursorPositionLayer.getBoundingClientRect(),l=a.left+a.width/2,h=a.top+a.height/2,d=Math.atan2(h-s,n-l)/(Math.PI/180)-90;return(d=-d)<0&&(d=360+d),d=d.toFixed(2),Number(d||0)}},{key:"_showScaleElement",value:function(t){var e=this;this.eightDirectionEl.forEach((function(i){e._showElement(i,t)}))}},{key:"_showElement",value:function(t,e){t&&(t.style.display=e?"block":"none")}},{key:"_eightDirectionElSwitchPosition",value:function(){var t=h.getTranslate(this.cursorPositionLayer,"rotate");t<=45?this.resetDirectionElement(0):t<=90?this.resetDirectionElement(1):t<=135?this.resetDirectionElement(2):t<=180?this.resetDirectionElement(3):t<=225?this.resetDirectionElement(4):t<=270?this.resetDirectionElement(5):t<=315?this.resetDirectionElement(6):this.resetDirectionElement(7)}},{key:"resetDirectionElement",value:function(t){var e=this,i=["tiw-point__0","tiw-point__1","tiw-point__2","tiw-point__3","tiw-point__4","tiw-point__5","tiw-point__6","tiw-point__7"],r=["tiw-left-top__dir","tiw-top-center__dir","tiw-right-top__dir","tiw-right-center__dir","tiw-right-bottom__dir","tiw-bottom-center__dir","tiw-left-bottom__dir","tiw-left-center__dir"];this.eightDirectionEl.forEach((function(o,n){var s=n-t;s<0&&(s=e.eightDirectionEl.length+s);var a=i[s];(o=e.cursorPositionLayer.querySelector("."+a)).className="",o.classList.add("tiw-drag__dir",r[n],a),o&&(o.ontouchstart=null,o.onmousedown=null,o.ontouchstart=o.onmousedown=function(t){e.moveScaleAction(t,o)})}))}},{key:"_calcRotateXY",value:function(t,e,i){var r=t*(Math.PI/180);return{x:(e.x-i.x)*Math.cos(r)-(e.y-i.y)*Math.sin(r)+i.x,y:(e.x-i.x)*Math.sin(r)+(e.y-i.y)*Math.cos(r)+i.y}}}])&&ne(e.prototype,i),t}();function ae(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}i(136);var le=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardId=e.boardId,this.lineHeight=1,this.measureTextElement=document.getElementById("tic_measuretext__tool"),this.dpr=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||1,this.board=e.board}var e,i;return e=t,(i=[{key:"createElement",value:function(t){this.textContainer=t,this.dom=document.createElement("textarea"),this.dom.setAttribute("spellcheck",!1),t.appendChild(this.dom),this.initStyle()}},{key:"initStyle",value:function(){Object.assign(this.dom.style,{position:"absolute","z-index":9,"box-sizing":"content-box",outline:"none",resize:"none","word-break":"break-all",overflow:"hidden",background:"transparent","line-height":this.lineHeight+"px",border:"1px dotted transparent","font-family":"customFontFamily",margin:0,padding:0,"white-space":"pre-wrap","border-radius":0})}},{key:"initEvent",value:function(t){var e=this;this.eventConfig=t,this.dom.ontouchstart=function(t){t.stopPropagation()},this.dom.ontouchmove=function(t){t.stopPropagation()},this.dom.ontouchend=function(t){t.stopPropagation()},this.dom.ontouchcancel=function(t){t.stopPropagation()},this.dom.onmousedown=function(t){t.stopPropagation()},this.dom.onmousemove=function(t){t.stopPropagation()},this.dom.onmouseup=function(t){t.stopPropagation()},this.dom.onmouseleave=function(t){t.stopPropagation()},this.dom.onfocus=null,this.dom.onfocus=function(){if(11==e.board.getToolType()){e.initStyle();var i=e._calcShowFullText(),r=i.scale,o=i.dragOffsetX,n=i.dragOffsetY;t.onfocus&&t.onfocus(e,o,n,r);var s=e._calcShowFullText(),a=s.scale,l=s.dragOffsetX,h=s.dragOffsetY;t.onfocus&&t.onfocus(e,l,h,a),e.showBorder(!0)}else e.dom.blur()},this.dom.compositionLock=!1,this.dom.addEventListener("compositionstart",(function(){e.dom.compositionLock=!0})),this.dom.addEventListener("compositionend",(function(t){h.isIOS8910()?setTimeout((function(){e.smartPaintText(t)}),0):e.smartPaintText(t)})),this.dom.oninput=null,this.dom.oninput=function(t){if(e.dom.compositionLock){if(-1===e.dom.value.indexOf("\n\f")&&-1===e.dom.value.indexOf("\n")){e.setSize();var i=Number(e.dom.style.maxWidth.replace("px","")),r=Number(e.dom.style.width.replace("px",""));if(r>i){var o=Math.ceil(r/i);e.dom.style.height=e.dom.style.height.replace("px","")*o+"px"}}}else e.smartPaintText(t)},this.dom.onblur=null,this.dom.onblur=function(){e.showBorder(!1),""!==e.dom.value&&""!==e.dom.value.trim()||(e.textItem.show=!1,e.remove()),t.onblur&&t.onblur(e)}}},{key:"smartPaintText",value:function(t){var e=this,i=h.isIOS8910()?this.dom.selectionEnd:this.dom.selectionStart,r=!1;this.dom.compositionLock=!1;var o=0;if(this.dom.value.indexOf("\n\f")>-1){var n=new RegExp("\n\f","g");this.dom.value=this.dom.value.replace(n,(function(t,e){return e<i&&(o+="\n\f".length),""}))}i-=o,"\n"==this.dom.value.substr(this.dom.value.length-1)?(this.dom.value=this.dom.value+" ",this.measureTextElement.textContent=this.dom.value,r=!0):this.measureTextElement.textContent=this.dom.value;for(var s=0,a=0;a<this.dom.value.length;a++){var l=this.dom.value[a];if("\n"===l||"\n\f"===l);else if(this.measureTextElement.textContent=this.dom.value.substring(s,a+1),this.getMeasureTextToolComputedStyle("width")>this.dom.style.maxWidth.replace("px","")-this.fontSize&&(a<i&&(i+="\n\f".length),s=a+1,this.dom.value=this.dom.value.substring(0,a)+"\n\f"+this.dom.value.substring(a),this.measureTextElement.textContent=this.dom.value),this.measureTextElement.textContent=this.dom.value.substring(0,a+1),this.getMeasureTextToolComputedStyle("height")>1*this.dom.style.maxHeight.replace("px","")){this.dom.value=this.dom.value.substring(0,Math.max(this.dom.value.lastIndexOf("\n"),this.dom.value.lastIndexOf("\n\f"))),this.measureTextElement.textContent=this.dom.value,r=!1;break}}this.setSize(),r&&" "==this.dom.value.charAt(this.dom.value.length-1)&&(this.dom.value=this.dom.value.substring(0,this.dom.value.length-1)),this.dom.setSelectionRange?this.dom.setSelectionRange(i,i):(this.dom.selectionStart=i,this.dom.selectionEnd=i);var d=this._calcShowFullText(),c=d.scale,u=d.dragOffsetX,p=d.dragOffsetY;this.eventConfig.oninput&&this.eventConfig.oninput(this,u,p,c);var f=this._calcShowFullText(),g=f.scale,_=f.dragOffsetX,m=f.dragOffsetY;this.eventConfig.oninput&&this.eventConfig.oninput(this,_,m,g),setTimeout((function(){e.dom.scrollTop&&e.smartPaintText(t)}),0)}},{key:"setTextItem",value:function(t){this.dom.id="tic-textarea__".concat(t.belongSeq),this.dom.value=t.text,this.textItem=t,this.setTextStyle()}},{key:"setFontSize",value:function(t){this.fontSize=t,this.lineHeight=this.fontSize,this.dom.style.fontSize=t+"px",this.dom.style.minWidth=this.fontSize+"px",this.dom.style.minHeight=this.fontSize+"px",this.dom.style.lineHeight=this.fontSize+"px",this.measureTextElement.style.fontSize=(this.fontSize/this.dpr).toFixed(4)+"px",this.measureTextElement.style.lineHeight=(this.fontSize/this.dpr).toFixed(4)+"px"}},{key:"setMaxSize",value:function(){var t=h.calcPointAndBoardRightBorderDistance(this.boardWidth,this.containerWidth,this.boardHeight,this.containerHeight,this.textItem.location.x,this.textItem.location.y),e=t.distanceX,i=t.distanceY;this.maxWidth=e-2,this.maxHeight=i-2,this.dom.style.maxWidth=this.maxWidth+"px",this.dom.style.maxHeight=this.maxHeight+"px"}},{key:"setPosition",value:function(t,e){this.dom.style.left=t+"px",this.dom.style.top=e+"px"}},{key:"showBorder",value:function(t){this.dom.style.border="1px dashed ".concat(t?"red":"transparent")}},{key:"focus",value:function(){var t=this.isAllowShowInput();return t?this.dom.focus():this.remove(),t}},{key:"setFontScale",value:function(t){this.fontScale=t,this.dom.style.transformOrigin="0 0",this.dom.style.transform="scale(".concat(t,")"),this.dom.style.webkitTransformOrigin="0 0",this.dom.style.webkitTransform="scale(".concat(t,")"),this.dom.style.maxWidth=this.maxWidth/t+"px",this.dom.style.maxHeight=this.maxHeight/t+"px",this.measureTextElement.style.transformOrigin="0 0",this.measureTextElement.style.transform="scale(".concat(t,")"),this.measureTextElement.style.webkitTransformOrigin="0 0",this.measureTextElement.style.webkitTransform="scale(".concat(t,")")}},{key:"setTextStyle",value:function(){var t={color:this.textItem.color},e=this.textItem.fontStyle;for(var i in e===F.TEDU_BOARD_TEXT_STYLE_NORMAL?(t.fontStyle="normal",t.fontWeight="normal"):e===F.TEDU_BOARD_TEXT_STYLE_BOLD?(t.fontStyle="normal",t.fontWeight="bold"):e===F.TEDU_BOARD_TEXT_STYLE_ITALIC?(t.fontStyle="italic",t.fontWeight="normal"):e===F.TEDU_BOARD_TEXT_STYLE_BOLD_ITALIC&&(t.fontStyle="italic",t.fontWeight="bold"),t)this.dom.style[i]=t[i]}},{key:"setSize",value:function(t){var e,i;"\n"==(t=t||this.dom.value).substr(t.length-1)?this.measureTextElement.textContent=t+" ":this.measureTextElement.textContent=t,e=h.isIOS()?this.getMeasureTextToolComputedStyle("width")+6+"px":this.getMeasureTextToolComputedStyle("width","px"),i=this.getMeasureTextToolComputedStyle("height","px"),this.dom.style.width!=e&&(this.dom.style.width=e),this.dom.style.height!=i&&(this.dom.style.height=i),this.textItem.textWidth=(2+1*this.dom.style.width.replace("px",""))/this.boardWidth*1e4*this.fontScale,this.textItem.textHeight=this.dom.style.height.replace("px","")/this.boardHeight*1e4*this.fontScale,this.eventConfig&&this.eventConfig.onresize&&this.eventConfig.onresize(this)}},{key:"remove",value:function(){var t=this;setTimeout((function(){t.dom&&t.dom.remove()}),0)}},{key:"getMeasureTextToolComputedStyle",value:function(t,e){var i=window.getComputedStyle(this.measureTextElement),r=1*i[t].replace("px",""),o=1*i.fontSize.replace("px",""),n=1*i.lineHeight.replace("px","");return"width"===t?o>(this.fontSize/this.dpr).toFixed(4)&&o>=12||(r=12*r/o):"height"===t?r=n*this.measureTextElement.textContent.split("\n").length*this.dpr:r*=this.dpr,r=Math.ceil(r),e?r+e:r}},{key:"setBoardContainerSize",value:function(t,e,i,r){this.boardWidth=t,this.containerWidth=e,this.boardHeight=i,this.containerHeight=r}},{key:"_calcShowFullText",value:function(){var t=h.calcPointAndContainerRightBorderDistance(this.boardWidth,this.containerWidth,this.boardHeight,this.containerHeight,this.textContainer.style.left.replace("%",""),this.textContainer.style.top.replace("%",""),this.textItem.location.x,this.textItem.location.y),e=t.distanceX,i=t.distanceY,r=h.calcPointAndContainerLeftBorderDistance(this.boardWidth,this.containerWidth,this.boardHeight,this.containerHeight,this.textContainer.style.left.replace("%",""),this.textContainer.style.top.replace("%",""),this.textItem.location.x,this.textItem.location.y),o=r.distanceX,n=r.distanceY,s=this.dom.style.width.replace("px","")*this.fontScale+12*this.fontScale,a=this.dom.style.height.replace("px","")*this.fontScale+12*this.fontScale,l=0,d=0,c=0,u=0;return s>this.containerWidth?c=(s+12*this.fontScale)/this.containerWidth:l=o<0?(o-12*this.fontScale)/this.boardWidth*100:e<s?(s-e)/this.boardWidth*100:0,a>this.containerHeight?u=(a+12*this.fontScale)/this.containerHeight:d=n<0?(n-12*this.fontScale)/this.boardHeight*100:i<a?(a-i)/this.boardHeight*100:0,{scale:c>0&&u>0?Math.max(c,u):0==c&&0==u?0:Math.max(c,u),dragOffsetX:l,dragOffsetY:d}}},{key:"isAllowShowInput",value:function(){var t=this.fontScale*this.fontSize;return!(this.maxHeight-2<=t||this.maxWidth-2<=2*t)}}])&&ae(e.prototype,i),t}(),he=function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.RATIO,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.SCALE,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.TOP,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:o.LEFT;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var l=h.calcRatioWidthHeight(r,o.RATIO),d=l.ratioWidth,c=l.ratioHeight,u=e/d,p=i/c,f=Math.min(u,p);this.ratioWidth=d,this.ratioHeight=c,this.scale=n,this.top=s,this.left=a,this.ratio=r,this.width=f*d,this.height=f*c};function de(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ce=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scrollEnable=!0,this.container=e,this.horizontalScrollBar=null,this.verticalScrollBar=null,this.scrollEventCallback=i,this.horizontalScrollLeft=null,this.verticalScrollTop=null,this.initElement()}var e,i;return e=t,(i=[{key:"scrollToScrollBar",value:function(t,e){this.horizontalScrollLeft=t,this.verticalScrollTop=e,this.horizontalScrollBarWrap.scrollTo(t,0),this.verticalScrollBarWrap.scrollTo(0,e)}},{key:"setScrollBarSize",value:function(t,e){this.horizontalScrollBar.style.width=t+"px",this.verticalScrollBar.style.height=e+"px"}},{key:"initElement",value:function(){var t=this;this.verticalScrollBarWrap=document.createElement("div"),this.verticalScrollBarWrap.className="tiw-scroll-vertical__wrap",this.verticalScrollBar=document.createElement("div"),this.verticalScrollBar.className="tiw-scroll-vertical",this.verticalScrollBarWrap.appendChild(this.verticalScrollBar),this.horizontalScrollBarWrap=document.createElement("div"),this.horizontalScrollBarWrap.className="tiw-scroll-horizontal__wrap",this.horizontalScrollBar=document.createElement("div"),this.horizontalScrollBar.className="tiw-scroll-horizontal",this.horizontalScrollBarWrap.appendChild(this.horizontalScrollBar),this.container.appendChild(this.verticalScrollBarWrap),this.container.appendChild(this.horizontalScrollBarWrap),this.verticalScrollBarWrap.addEventListener("scroll",h.debounce((function(e){t.enableScroll&&(t.horizontalScrollLeft===t.horizontalScrollBarWrap.scrollLeft&&t.verticalScrollTop===t.verticalScrollBarWrap.scrollTop||t.scrollEventCallback&&t.scrollEventCallback(t.horizontalScrollBarWrap.scrollLeft,t.verticalScrollBarWrap.scrollTop))}),200)),this.horizontalScrollBarWrap.addEventListener("scroll",h.debounce((function(e){t.enableScroll&&(t.horizontalScrollLeft===t.horizontalScrollBarWrap.scrollLeft&&t.verticalScrollTop===t.verticalScrollBarWrap.scrollTop||t.scrollEventCallback&&t.scrollEventCallback(t.horizontalScrollBarWrap.scrollLeft,t.verticalScrollBarWrap.scrollTop))}),200))}},{key:"disableScroll",value:function(){this.scrollEnable=!1,this.verticalScrollBarWrap.classList.add("disable-scroll"),this.horizontalScrollBarWrap.classList.add("disable-scroll")}},{key:"enableScroll",value:function(){this.scrollEnable=!0,this.verticalScrollBarWrap.classList.remove("disable-scroll"),this.horizontalScrollBarWrap.classList.remove("disable-scroll")}}])&&de(e.prototype,i),t}();function ue(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var pe=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initElement(e,i),this.prevTitleStyle=null}var e,i;return e=t,(i=[{key:"initElement",value:function(t,e){this.cursorWrap=document.createElement("div"),this.cursorWrap.dataset.user=e.user,this.cursorWrap.className="tic-board_laser-item",this.imgEl=document.createElement("img"),this.imgEl.className="tic-board_laser-item-img",this.titleEl=document.createElement("span"),this.titleEl.className="tic-board_laser-item-title",this.cursorWrap.appendChild(this.titleEl),this.cursorWrap.appendChild(this.imgEl),t.appendChild(this.cursorWrap)}},{key:"move",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1e4,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1e4,a=arguments.length>7?arguments[7]:void 0;if(this.cursorWrap){i!==this.imgEl.src&&(this.imgEl.src=i),t&&e?this.imgEl.classList.add("hide"):this.imgEl.classList.remove("hide"),this.titleEl.innerText!==r&&(this.titleEl.innerText=r);var l="translate(".concat(n,"px, ").concat(s,"px) scale(").concat(a,")");if(this.cursorWrap.style.transform=l,this.cursorWrap.style.webkitTransform=l,r&&o&&h.isObject(o)){var d=JSON.stringify(o);if(this.prevTitleStyle===d)return;this.prevTitleStyle=d;var c="",u=o.size||12;c+="font-size:".concat(u,"px;");var p=o.color;c+="color:".concat(p,";");var f=o.style;switch(f===F.TEDU_BOARD_TEXT_STYLE_NORMAL?(c+="font-style: normal;",c+="font-weight: normal;"):f===F.TEDU_BOARD_TEXT_STYLE_BOLD?(c+="font-style: normal;",c+="font-weight: bold;"):f===F.TEDU_BOARD_TEXT_STYLE_ITALIC?(c+="font-style: italic;",c+="font-weight: normal;"):f===F.TEDU_BOARD_TEXT_STYLE_BOLD_ITALIC&&(c+="font-style: italic;",c+="font-weight: bold;"),this.titleEl.setAttribute("style",c),o.position){case 0:c+="left:".concat(-this.titleEl.clientWidth,"px;"),c+="top:".concat(-this.titleEl.clientHeight,"px;");break;case 1:c+="right:".concat(-this.titleEl.clientWidth,"px;"),c+="top:".concat(-this.titleEl.clientHeight,"px;");break;case 2:c+="right:".concat(-this.titleEl.clientWidth,"px;"),c+="bottom:".concat(-this.titleEl.clientHeight,"px;");break;case 3:c+="left:".concat(-this.titleEl.clientWidth,"px;"),c+="bottom:".concat(-this.titleEl.clientHeight,"px;")}this.titleEl.setAttribute("style",c)}}}},{key:"remove",value:function(){this.cursorWrap&&this.cursorWrap.remove()}}])&&ue(e.prototype,i),t}();function fe(t){var e=this;if(!(this instanceof fe))return new fe(t);this.loggerModuleName="Board",this.option=t,this.event=this.option.event,this.logger=this.option.logger,this.elkLog=this.option.elkLog,this.container=document.getElementById(this.option.id),this.container?(this.classId=this.option.classId,this.pinchScale=[],this.beforePinchScale,this.isMoving=!1,this.scaleRatio=10,this.scaleIcons={enlarge:o.zoomInIcon,shrink:o.zoomOutIcon},this.isDragMoving=!1,this.minLineWidth=t.minLineWidth||o.MIN_LINE_WIDTH,this.isRenderFace=!1,t.progressEnable?this.progressBarUrl=t.progressBarUrl||o.defaultLoadingImage:this.progressBarUrl=o.defaultLoadingImage,this.backgroundIFrameManager=new Zt,this.h5Iframe=null,this.store=new Ft(t),this.maxLaserSeq=0,this.isTouchType="mouse",this.textInputStatus=0,this.touchID=null,this.resetVideoStatus(),this.isSyncVideoStatus=!0,this.isShowVideoControl=!0,this.syncVideoStatusTimer=null,this.drawTimer=null,this.userTime={},this.enableSyncTime=!0,this.compositionEvent=new re,this.taskIdTitleMap={},this.textAreaComponentMap={},this.imageElementMapData={},this.textAreaFocusBlurStatus={},this.addFileNeedSwitchMap={},this.boardBaseWidth=0,this.boardBaseHeight=0,this.enableLineOptimization=!0,this.fpsOptimization=!0,this.preDrawLineTimestamp=0,this.enableRaserOptimization=!0,this.boardImageLoadStatus={backgrounds:{},elements:{}},this.checkH5PPTStatus={fid:null,status:0,task:null},this.preLayout={width:0,height:0,left:0,top:0,ratio:0,scale:0},this.preRenderCost=0,this.moveDragArea={minTop:0,maxTop:0,minLeft:0,maxLeft:0},this.zoomStatusMap={isShiftPressed:!1,isMouseDowned:!1,isMoved:!1,isWheeled:!1},this.selectToolType=0,this.laserCursorMap=new Map,this.init(),this.initFont(),this.updateCursorIcons(),this.initRemoteCursorIcon(),this.initMeasureTextElement(),this.initPermission()):setTimeout((function(){e.event.fire(e,"TEB_ERROR",k.TEDU_BOARD_ERROR_INIT,"not found id:"+e.option.id+" Node")}),10)}fe.prototype.initPermission=function(){fe.hasVideoPermission()?this.elkLog.report("has_video_permission",{}):(this.elkLog.report("init_video_permission",{}),fe.applyVideoPermission(10,this.elkLog))},fe.hasVideoPermission=function(){return!(!fe.videoPermissionDiv||0==fe.videoPermissionDiv.getElementsByTagName("video").length)},fe.applyVideoPermission=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;if(fe.hasVideoPermission())e&&e.report("has_apply_video_permission",{});else{fe.videoPermissionDiv=document.createElement("div"),fe.videoPermissionDiv.id="board_permission_videos",fe.videoPermissionDiv.style.display="none";for(var i=[],r=0;r<t;r++){var o=document.createElement("video");o.setAttribute("class","video-js"),o.setAttribute("x5-video-player-type","h5-page"),o.setAttribute("controlsList","nodownload nofullscreen"),o.setAttribute("disablePictureInPicture","disablePictureInPicture"),o.setAttribute("webkit-playsinline","webkit-playsinline"),o.setAttribute("playsinline","playsinline"),o.setAttribute("controls","controls"),o.setAttribute("style","height:100%; width:100%;"),fe.videoPermissionDiv.appendChild(o),i.push(o)}document.body.appendChild(fe.videoPermissionDiv),i.forEach((function(t){try{t.play().catch((function(){}))}catch(t){}})),e&&e.report("apply_video_permission",{extra_info:JSON.stringify({count:t})})}},fe.prototype.updateCursorIcons=function(){this.penIcon=new Image;var t=o.ICONS[1].url;t&&(this.penIcon.onerror=function(){this.src.indexOf("try=true")>-1||(-1==this.src.indexOf("?")?this.src=this.src+"?try=true":this.src=this.src+"&try=true")},this.penIcon.src=t),this.laserIcon=new Image;var e=o.ICONS[3].url;e&&(this.laserIcon.onerror=function(){this.src.indexOf("try=true")>-1||(-1==this.src.indexOf("?")?this.src=this.src+"?try=true":this.src=this.src+"&try=true")},this.laserIcon.src=e)},fe.prototype.initRemoteCursorIcon=function(){this.remotePenIcon=new Image;var t=o.ICONS[1].url||o.penCursorIcon;t&&this.remotePenIcon.src!=t&&(this.remotePenIcon.onerror=function(){this.src.indexOf("try=true")>-1||(-1==this.src.indexOf("?")?this.src=this.src+"?try=true":this.src=this.src+"&try=true")},this.remotePenIcon.src=t),this.remoteLaserIcon=new Image;var e=o.ICONS[3].url||o.laserCursorIcon;e&&this.remoteLaserIcon.src!=e&&(this.remoteLaserIcon.onerror=function(){this.src.indexOf("try=true")>-1||(-1==this.src.indexOf("?")?this.src=this.src+"?try=true":this.src=this.src+"&try=true")},this.remoteLaserIcon.src=e)},fe.prototype.initMeasureTextElement=function(){var t=document.createElement("div");t.id="tic_measuretext__tool",t.style.position="fixed",t.style.left="-10000px",t.style.fontFamily="customFontFamily",t.style.visibility="hidden",t.style.boxSizing="content-box",t.style.display="inline-block",t.style.margin=0,t.style.padding=0,t.style.whiteSpace="pre-wrap",t.style.lineHeight=1,document.body.appendChild(t)},fe.prototype.initFont=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML="@font-face {font-family: 'customFontFamily';src: url(".concat(o.fontUrl,") format('truetype');}");var e=document.createElement("div");e.style.fontFamily="customFontFamily",e.style.position="fixed",e.style.left="-10000px",e.style.width="1px",e.innerHTML="&nbsp;",document.body.appendChild(t),document.body.appendChild(e)},fe.prototype.resize=function(){this.option&&document.getElementById(this.option.id)&&this.container!=document.getElementById(this.option.id)&&(this.container=document.getElementById(this.option.id)),this.store.setNeedDraw(!0),this.draw()},fe.prototype.getEventLocation=function(t){var e,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={x:0,y:0,ox:0,oy:0},n=this.boardBox,s=n.getBoundingClientRect();if(t.changedTouches&&!r){var a=null,l={x:-1e6,y:-1e6,ox:-1e6,oy:-1e6};if("touchstart"==t.type){if(null!=this.touchID&&1!==t.touches.length)return l;this.touchID=t.changedTouches[0].identifier,a=t.changedTouches[0]}else if("touchmove"==t.type){for(var h=0;h<t.changedTouches.length;h++)if(t.changedTouches[h].identifier==this.touchID){a=t.changedTouches[h];break}if(!a)return l}else if("touchend"==t.type||"touchcancel"==t.type){for(var d=0;d<t.changedTouches.length;d++)if(t.changedTouches[d].identifier==this.touchID){a=t.changedTouches[d];break}if(!a&&0!==t.touches.length)return l;this.touchID=null}e=a.pageX-s.left-n.ownerDocument.defaultView.pageXOffset,i=a.pageY-s.top-n.ownerDocument.defaultView.pageYOffset,o.clientX=parseInt(a.clientX),o.clientY=parseInt(a.clientY)}else if(r){var c=t.changedTouches[0];e=c.pageX-s.left-n.ownerDocument.defaultView.pageXOffset,i=c.pageY-s.top-n.ownerDocument.defaultView.pageYOffset,o.clientX=parseInt(c.clientX),o.clientY=parseInt(c.clientY)}else e=t.pageX-s.left-n.ownerDocument.defaultView.pageXOffset,i=t.pageY-s.top-n.ownerDocument.defaultView.pageYOffset,o.clientX=parseInt(t.clientX),o.clientY=parseInt(t.clientY);return o.x=parseInt(e/this.width*1e4),o.y=parseInt(i/this.height*1e4),o.ox=parseInt(e),o.oy=parseInt(i),o},fe.prototype.draw=function(){if(this.store.getCurrentBoard()){var t=this.store.getCurrentBoardData(),e=this.store.filterGlobalAudioElement(),i=t.data.concat(e),r=t.backgroundPic;this.layout()&&(this.store.setPartDraw(!0),this.store.setLaserDraw(!0));var o=this.el.getContext("2d");(this.store.getPartDraw()||this.store.getNeedDraw())&&o.clearRect(-5,-5,this.width+10,this.height+10),this.preloadTriggered=!1;var n=this.getFileInfo(this.getCurrentFile());n&&(this.store.getNeedDraw()&&(this.renderVideo(n),this.renderH5PPT(n),this.renderH5File(n),this.renderBackgroundImageAndH5(r),this.renderBackgroundColor(t.backgroundColor,n)),this.drawData(i,o),this.preloadTriggered||this.store.preloadBoard())}},fe.prototype.drawFace=function(){if(this.store.getCurrentBoard()){var t=this.store.getFaceData();if(t.fileInfo&&this.layout(t.fileInfo)){var e=this.el.getContext("2d");this.laserCanvas&&this.laserCanvas.getContext("2d"),e.clearRect(-5,-5,this.width+10,this.height+10),this.preloadTriggered=!1,this.renderH5PPT(t.fileInfo,!0),this.renderBackgroundImageAndH5(t.currentPic),this.renderBackgroundColor(t.backgroundColor,t.fileInfo),this.drawData(t.data,e),this.preloadTriggered||this.store.preloadBoard()}}},fe.prototype._displayImage=function(){this.img.removeAttribute("src"),this.img.removeAttribute("width"),this.img.removeAttribute("height"),this.img.style.display="none"},fe.prototype.renderBackgroundImageAndH5=function(t){var e=this,i=this,r=this.getCurrentBoard(),n=this.boardImageLoadStatus.backgrounds,s=!0;if(n?n.boardId!=r||decodeURI(t.url)!==decodeURI(n.url)?("start"===n.status&&(this.event.fire(this,"TEB_IMAGE_STATUS_CHANGED",Ht.TEDU_BOARD_IMAGE_STATUS_LOAD_CANCEL,{currentBoardId:n.boardId,imgUrl:n.url,currentImgUrl:this.img.currentSrc}),n.status="cancel",clearTimeout(this.pregressTask),this.progress.style.display="none",this.elkLog.report("load_cancel_img",{time_consume:h.getTimeStamp()-d,image_url:n.url,boardid:n.boardId,extra_info:JSON.stringify({image_url:n.url,boardid:n.boardId,currentSrc:this.img.currentSrc})})),this._displayImage(),this.boardImageLoadStatus.backgrounds[r]={boardId:r,status:null,url:null}):"cancel"!==n.status&&"timeout"!==n.status&&"start"!==n.status||(s=!1):(n={boardId:r,status:null,url:null},this.boardImageLoadStatus.backgrounds[r]=n),t.url&&t.show)if(t.type===f.BACKGROUND_TYPE.IMAGE){if(!s)return;var a=t.mode||C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,l=t.url!==i.img.src&&encodeURI(t.url)!==i.img.src&&decodeURI(t.url)!==decodeURI(i.img.src);if(navigator.userAgent.toLocaleLowerCase().indexOf("iphone os 8")>-1&&decodeURI(t.url)==decodeURI(i.img.src).replace(/(&|\?)imgtime=\d+_imgtime/g,"")&&(l=!1),l){var d=h.getTimeStamp();i.img.onload=function(){n.status="loaded";var e=i.img.naturalWidth,r=i.img.naturalHeight;i.width/i.height>e/r?(i.img.setAttribute("height",i.height),a===C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER?i.img.setAttribute("style","display:none; position:absolute !important; top:0 !important; left:50% !important;transform: translateX(-50%) !important;-webkit-transform: translateX(-50%) !important;z-index:5 !important;"):a===C.TEDU_BOARD_IMAGE_FIT_MODE_LEFT?i.img.setAttribute("style","display:none; position:absolute !important; top:0 !important; left:0 !important;z-index:5 !important;"):a===C.TEDU_BOARD_IMAGE_FIT_MODE_TOP?i.img.setAttribute("style","display:none; position:absolute !important; top:0 !important; left:50% !important;transform: translateX(-50%) !important;-webkit-transform: translateX(-50%) !important;z-index:5 !important;"):a===C.TEDU_BOARD_IMAGE_FIT_MODE_RIGHT?i.img.setAttribute("style","display:none; position:absolute !important; top:0 !important; right:0 !important;z-index:5 !important;"):i.img.setAttribute("style","display:none; position:absolute !important; top:0 !important; left:50% !important;transform: translateX(-50%) !important;-webkit-transform: translateX(-50%) !important;z-index:5 !important;"),i.img.removeAttribute("width")):(i.img.setAttribute("width",i.width),a===C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER||a===C.TEDU_BOARD_IMAGE_FIT_MODE_LEFT?i.img.setAttribute("style","display:none; position:absolute !important; top:50% !important; left:0 !important;transform: translateY(-50%) !important;-webkit-transform: translateY(-50%) !important;z-index:5 !important;"):a===C.TEDU_BOARD_IMAGE_FIT_MODE_TOP?i.img.setAttribute("style","display:none; position:absolute !important; top:0 !important; left:0 !important;z-index:5 !important;"):a===C.TEDU_BOARD_IMAGE_FIT_MODE_RIGHT?i.img.setAttribute("style","display:none; position:absolute !important; top:50% !important; left:0 !important;transform: translateY(-50%) !important;-webkit-transform: translateY(-50%) !important;z-index:5 !important;"):a===C.TEDU_BOARD_IMAGE_FIT_MODE_BOTTOM?i.img.setAttribute("style","display:none; position:absolute !important; bottom:0 !important; left:0 !important;z-index:5 !important;"):i.img.setAttribute("style","display:none; position:absolute !important; top:50% !important; left:0 !important;transform: translateY(-50%) !important;-webkit-transform: translateY(-50%) !important;z-index:5 !important;"),i.img.removeAttribute("height")),i.img.style.display="block",i.img.onload=null,clearTimeout(i.pregressTask),i.progress.style.display="none",i.event.fire(this,"TEB_IMAGE_STATUS_CHANGED",Ht.TEDU_BOARD_IMAGE_STATUS_LOAD_DONE,{currentBoardId:i.getCurrentBoard(),imgUrl:t.url,currentImgUrl:i.img.currentSrc}),i.elkLog.report("load_succ_img",{time_consume:h.getTimeStamp()-d,image_url:t.url,boardid:i.getCurrentBoard(),extra_info:JSON.stringify({image_url:t.url,boardid:i.getCurrentBoard(),currentSrc:i.img.currentSrc})}),i.store.preloadBoard()},i.img.onabort=function(){n.status="abort",i.img.onabort=null,clearTimeout(i.pregressTask),i.progress.style.display="none",i.event.fire(this,"TEB_IMAGE_STATUS_CHANGED",Ht.TEDU_BOARD_IMAGE_STATUS_LOAD_ABORT,{currentBoardId:i.getCurrentBoard(),imgUrl:t.url,currentImgUrl:i.img.currentSrc}),i.elkLog.report("load_abort_img",{time_consume:h.getTimeStamp()-d,image_url:t.url,boardid:i.getCurrentBoard(),extra_info:JSON.stringify({image_url:t.url,boardid:i.getCurrentBoard(),currentSrc:i.img.currentSrc})}),i.store.preloadBoard()},i.img.onerror=function(){if(n.status="error",i.img.currentSrc.endsWith("try=1"))i.img.style.display="none",i.img.onerror=null,clearTimeout(i.pregressTask),i.progress.style.display="none",i.event.fire(this,"TEB_IMAGE_STATUS_CHANGED",Ht.TEDU_BOARD_IMAGE_STATUS_LOAD_ERROR,{currentBoardId:i.getCurrentBoard(),imgUrl:t.url,currentImgUrl:i.img.currentSrc}),i.elkLog.report("load_error_img",{time_consume:h.getTimeStamp()-d,image_url:t.url,boardid:i.getCurrentBoard(),extra_info:JSON.stringify({image_url:t.url,boardid:i.getCurrentBoard(),currentSrc:i.img.currentSrc})});else{var e=t.url;t.url.indexOf("?")>-1?e+="&try=1":e+="?try=1",setTimeout((function(){i.img.src=e,i.elkLog.report("load_try_img",{time_consume:h.getTimeStamp()-d,image_url:e,boardid:i.getCurrentBoard(),extra_info:JSON.stringify({image_url:e,boardid:i.getCurrentBoard(),currentSrc:i.img.currentSrc})})}),100)}i.store.preloadBoard()},i.event.fire(this,"TEB_IMAGE_STATUS_CHANGED",Ht.TEDU_BOARD_IMAGE_STATUS_LOADING,{currentBoardId:i.getCurrentBoard(),imgUrl:t.url,currentImgUrl:i.img.currentSrc}),i.elkLog.report("start_load_img",{image_url:t.url,boardid:i.getCurrentBoard(),extra_info:JSON.stringify({image_url:t.url,boardid:i.getCurrentBoard(),currentSrc:i.img.currentSrc})}),i.img.style.display="none",navigator.userAgent.toLocaleLowerCase().indexOf("iphone os 8")>-1?t.url.indexOf("?")>-1?i.img.src=t.url+"&imgtime="+Date.now()+"_imgtime":i.img.src=t.url+"?imgtime="+Date.now()+"_imgtime":i.img.src=t.url,n.status="start",n.boardId=r,n.url=t.url,clearTimeout(this.checkImageStatusTask),this.checkImageStatusTask=setTimeout((function(){"start"===n.status&&(e.event.fire(e,"TEB_IMAGE_STATUS_CHANGED",Ht.TEDU_BOARD_IMAGE_STATUS_LOAD_TIMEOUT,{currentBoardId:n.boardId,imgUrl:n.url,currentImgUrl:e.img.currentSrc}),e._displayImage(),n.status="timeout",clearTimeout(e.pregressTask),e.progress.style.display="none",i.elkLog.report("load_timeout_img",{time_consume:h.getTimeStamp()-d,image_url:n.url,boardid:n.boardId,extra_info:JSON.stringify({image_url:n.url,boardid:n.boardId,currentSrc:e.img.currentSrc})}))}),1e3*this.store.getImageTimeout()),i.preloadTriggered=!0,clearTimeout(this.pregressTask),i.pregressTask=setTimeout((function(){i.store.isProgressEnable()&&(i.progress.style.display="block")}),o.PROGRESS_SHOW_DELAY)}else{i.img.style.display="none";var c=i.img.naturalWidth,u=i.img.naturalHeight,p="z-index:5";if(i.width/i.height>c/u){i.img.setAttribute("height",i.height);var g="transform: translateX(-50%);-webkit-transform: translateX(-50%)";a===C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER?i.img.setAttribute("style","display:none; position:absolute; top:0; left:50%;".concat(g,";").concat(p)):a===C.TEDU_BOARD_IMAGE_FIT_MODE_LEFT?i.img.setAttribute("style","display:none; position:absolute; top:0; left:0;".concat(p)):a===C.TEDU_BOARD_IMAGE_FIT_MODE_TOP?i.img.setAttribute("style","display:none; position:absolute; top:0; left:50%;".concat(g,";").concat(p)):a===C.TEDU_BOARD_IMAGE_FIT_MODE_RIGHT?i.img.setAttribute("style","display:none; position:absolute; top:0; right: 0;".concat(p)):i.img.setAttribute("style","display:none; position:absolute; top:0; left:50%;".concat(g,";").concat(p)),i.img.removeAttribute("width")}else{i.img.setAttribute("width",i.width);var _="transform: translateY(-50%);-webkit-transform: translateY(-50%)";a===C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER||a===C.TEDU_BOARD_IMAGE_FIT_MODE_LEFT?i.img.setAttribute("style","display:none; position:absolute; top:50%; left:0;".concat(_,";").concat(p)):a===C.TEDU_BOARD_IMAGE_FIT_MODE_TOP?i.img.setAttribute("style","display:none; position:absolute; top:0; left:0;".concat(p)):a===C.TEDU_BOARD_IMAGE_FIT_MODE_RIGHT?i.img.setAttribute("style","display:none; position:absolute; top:50%; left:0;".concat(_,";").concat(p)):a===C.TEDU_BOARD_IMAGE_FIT_MODE_BOTTOM?i.img.setAttribute("style","display:none; position:absolute; bottom:0; left:0;".concat(p)):i.img.setAttribute("style","display:none; position:absolute; top:50%; left:0;".concat(_,";").concat(p)),i.img.removeAttribute("height")}i.img.style.display="block"}i.preloadTriggered=!0,this.backgroundIFrameManager.remove(this.boardBox)}else this._displayImage(),this.backgroundIFrameManager.createElement(this.boardBox,t.url,(function(t){t&&(i.event.fire(i,"TEB_H5BACKGROUND_STATUS_CHANGED",Gt.TEDU_BOARD_BACKGROUND_H5_STATUS_LOAD_FINISH,{currentBoardId:i.getCurrentBoard(),url:t}),i.elkLog.report("iframe_load_done",{boardid:i.getCurrentBoard(),extra_info:"H5_Background",image_url:t})),clearTimeout(i.pregressTask),i.progress.style.display="none",i.store.preloadBoard()})),this.backgroundIFrameManager.layout(i.width,i.height),this.backgroundIFrameManager.render((function(){e.preloadTriggered=!0,clearTimeout(e.pregressTask),e.pregressTask=setTimeout((function(){e.store.isProgressEnable()&&(e.progress.style.display="block")}),o.PROGRESS_SHOW_DELAY),e.event.fire(e,"TEB_H5BACKGROUND_STATUS_CHANGED",Gt.TEDU_BOARD_BACKGROUND_H5_STATUS_LOADING,{currentBoardId:e.getCurrentBoard(),url:t.url}),i.elkLog.report("iframe_start_load",{boardid:e.getCurrentBoard(),extra_info:"H5_Background",image_url:t.url})}));else this._displayImage(),this.backgroundIFrameManager.remove(this.boardBox)},fe.prototype.renderH5File=function(t){var e=this,i=t.fid,r=t.type,n=t.downloadURL;if(r==o.FILE_TYPE.H5FILE&&n){if(!this.h5Iframe||this.h5Iframe.src!=n){var s=this;this.h5Iframe&&(this.h5Iframe.remove(this.boardWrap),this.h5Iframe=null),this.h5Iframe=new $t(n),this.h5Iframe.createElement(this.boardWrap,n,(function(){n&&(s.event.fire(s,"TEB_H5FILE_STATUS_CHANGED",{fileId:i,status:Wt.TEDU_BOARD_H5_FILE_STATUS_LOADED}),s.elkLog.report("iframe_load_done",{file_id:i,extra_info:"H5_FILE",url:n}))}));var a=this.boardWrap.clientWidth,l=this.boardWrap.clientHeight;this.h5Iframe.layout(a,l),this.h5Iframe.render((function(){e.event.fire(e,"TEB_H5FILE_STATUS_CHANGED",{fileId:i,status:Wt.TEDU_BOARD_H5_FILE_STATUS_LOADING}),s.elkLog.report("iframe_start_load",{fid:i,extra_info:"H5_FILE",image_url:n})}))}}else this.h5Iframe&&(this.h5Iframe.remove(this.boardWrap),this.h5Iframe=null)},fe.prototype.getVideoFormat=function(t){var e=(t=t.split("?")[0]).split(":"),i=o.VIDEO_FORMAT.NONE;return 0!=e.length&&"rtmp"==e[0].toLocaleLowerCase()?i=o.VIDEO_FORMAT.RTMP:0!=(e=t.split(".")).length&&("m3u8"==(i=e[e.length-1].toLocaleLowerCase())?i=o.VIDEO_FORMAT.M3U8:"flv"==i?i=o.VIDEO_FORMAT.FLV:"mp4"==i&&(i=o.VIDEO_FORMAT.MP4)),i},fe.prototype.getVideoType=function(t){var e=this.getVideoFormat(t);return e==o.VIDEO_FORMAT.MP4?o.FILE_TYPE.VOD:e==o.VIDEO_FORMAT.M3U8||e==o.VIDEO_FORMAT.RTMP||e==o.VIDEO_FORMAT.FLV?o.FILE_TYPE.LIVE:o.FILE_TYPE.NONE},fe.prototype.videoPlayed=function(t){if(""===this.videoStatus.fid)return this.elkLog.report("video_palyed_null"),this.videoStatus.actions.pause=o.VIDEO_ACTION.PASSIVE,void this.videoPlayer.pause();if(this.videoStatus.preStatus=o.VIDEO_STATUS.PLAY,this.isShowVideoControl||this.videoStatus.actions.play!=o.VIDEO_ACTION.EXCEPTIOIN)if(this.videoStatus.actionTimes.play=0,this.videoStatus.isCreated){var e=this.videoPlayer.currentTime()||0,i=this.videoPlayer.duration();if(0==e&&0==i)this.store.setNeedDraw(),this.elkLog.report("video_played_error",{file_id:r,extra_info:JSON.stringify({url:this.videoStatus.url,progress:e,duration:i})});else{var r=this.videoStatus.fid,n=this.isSyncVideoStatus;this.videoStatus.actions.play==o.VIDEO_ACTION.PASSIVE&&(n=!1);var s=o.VIDEO_STATUS.PLAY;this.store.updateVideo(r,s,e,n),this.store.setNeedDraw(),this.videoStatus.isFixed.play?(this.elkLog.report("video_played",{file_id:r,extra_info:JSON.stringify({url:this.videoStatus.url,progress:e,duration:i,needSync:n})}),this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:r,status:oe.TEDU_BOARD_VIDEO_STATUS_PLAYED,progress:e,duration:i})):(this.videoStatus.isFixed.play=!0,this.elkLog.report("video_played_fixed",{file_id:r,extra_info:JSON.stringify({url:this.videoStatus.url,progress:e,duration:i})}),this.videoStatus.isFixed.play&&this.videoStatus.isFixed.pause&&this.videoStatus.isFixed.seek&&this.videoLoaded())}}else this.store.setNeedDraw();else this.elkLog.report("video_played_exception",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,isShowVideoControl:this.isShowVideoControl,videoAction:this.videoStatus.actions.play})}),this.store.setNeedDraw();this.videoStatus.actions.play=o.VIDEO_ACTION.EXCEPTIOIN},fe.prototype.videoLoaded=function(){if(this.videoPlayer.controlBar&&this.videoPlayer.controlBar.playToggle){var t=this.videoPlayer.controlBar.playToggle;0!=this.videoStatus.duration&&parseInt(this.videoStatus.preProgress)==parseInt(this.videoStatus.duration)?t.hasClass("vjs-ended")||t.toggleClass("vjs-ended"):this.videoStatus.preStatus==o.VIDEO_STATUS.PAUSE?(t.hasClass("vjs-playing")||t.toggleClass("vjs-playing"),t.hasClass("vjs-paused")&&t.toggleClass("vjs-paused")):(t.hasClass("vjs-playing")&&t.toggleClass("vjs-playing"),t.hasClass("vjs-paused")||t.toggleClass("vjs-paused"))}this.videoStatus.isLoaded=!0,this.elkLog.report("video_loaded",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,progress:this.videoPlayer.currentTime(),duration:this.videoPlayer.duration()})}),this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:this.videoStatus.fid,status:oe.TEDU_BOARD_VIDEO_STATUS_LOADED,progress:this.videoPlayer.currentTime(),duration:this.videoPlayer.duration()})},fe.prototype.videoCreated=function(){if(""!==this.videoStatus.fid){if(this.isShowVideoControl||this.videoStatus.actions.create!=o.VIDEO_ACTION.EXCEPTIOIN){if(1!=this.videoStatus.isCreated){this.videoDiv.setAttribute("style","z-index:20; position:absolute; top:0; left:0; height:".concat(this.height,"px; width:").concat(this.width,"px; display:block; outline:none;")),this.showVideoControl(this.isShowVideoControl);var t=this.videoPlayer.duration()||0,e=this.videoStatus.fid;this.videoStatus.url,this.videoStatus.type,this.videoStatus.duration=t,this.videoStatus.actions.create,o.VIDEO_ACTION.PASSIVE,this.videoStatus.isCreated=!0,this.elkLog.report("video_created",{file_id:e,extra_info:JSON.stringify({url:this.videoStatus.url,duration:t})});var i=this.getFileInfo(this.videoStatus.fid),r=0;if(i){r=i.progress;var n=h.getTimeStamp();i.status==o.VIDEO_STATUS.PLAY&&(r=Math.floor((n-i.timestamp)/1e3+r))}this.store.updateVideo(e,-1,r,!1),this.store.setNeedDraw(),i.status==o.VIDEO_STATUS.PAUSE&&this.videoStatus.preStatus==o.VIDEO_STATUS.PLAY&&(this.videoStatus.isFixed.pause=!1),i.status==o.VIDEO_STATUS.PLAY&&this.videoStatus.preStatus==o.VIDEO_STATUS.PAUSE&&(this.videoStatus.isFixed.play=!1),Math.floor(i.progress)!=Math.floor(this.videoStatus.preProgress)&&(this.videoStatus.isFixed.seek=!1),this.videoStatus.isFixed.play&&this.videoStatus.isFixed.pause&&this.videoStatus.isFixed.seek&&this.videoLoaded()}}else this.elkLog.report("video_created_exception",{file_id:e,extra_info:JSON.stringify({url:this.videoStatus.url,isShowVideoControl:this.isShowVideoControl,videoAction:this.videoStatus.actions.create})}),this.store.setNeedDraw();this.videoStatus.actions.create=o.VIDEO_ACTION.EXCEPTIOIN}else this.elkLog.report("video_created_null")},fe.prototype.videoPaused=function(t){if(this.videoStatus.preStatus=o.VIDEO_STATUS.PAUSE,this.isShowVideoControl||this.videoStatus.actions.pause!=o.VIDEO_ACTION.EXCEPTIOIN){this.videoStatus.actionTimes.pause=0;var e=document.querySelector("div.tx_board_canvas_box");if(e&&e.parentNode)if(this.videoStatus.isCreated){var i=this.videoPlayer.currentTime()||0,r=this.videoPlayer.duration()||0;if(0==i&&0==r)this.store.setNeedDraw(),this.elkLog.report("video_paused_error",{file_id:n,extra_info:JSON.stringify({url:this.videoStatus.url,progress:i,duration:r})});else{var n=this.videoStatus.fid,s=this.isSyncVideoStatus;this.videoStatus.actions.pause==o.VIDEO_ACTION.PASSIVE&&(s=!1);var a=o.VIDEO_STATUS.PAUSE;this.store.updateVideo(n,a,i,s),this.store.setNeedDraw(),this.videoStatus.isFixed.pause?(this.elkLog.report("video_paused",{file_id:n,extra_info:JSON.stringify({url:this.videoStatus.url,progress:i,duration:r,needSync:s})}),this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:n,status:oe.TEDU_BOARD_VIDEO_STATUS_PAUSED,progress:i,duration:r})):(this.videoStatus.isFixed.pause=!0,this.elkLog.report("video_paused_fixed",{file_id:n,extra_info:JSON.stringify({url:this.videoStatus.url,progress:i,duration:r})}),this.videoStatus.isFixed.play&&this.videoStatus.isFixed.pause&&this.videoStatus.isFixed.seek&&this.videoLoaded())}}else this.store.setNeedDraw()}else this.elkLog.report("video_paused_exception",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,isShowVideoControl:this.isShowVideoControl,videoAction:this.videoStatus.actions.pause})}),this.store.setNeedDraw();this.videoStatus.actions.pause=o.VIDEO_ACTION.EXCEPTIOIN},fe.prototype.videoTimeUpdate=function(t){if(!this.hidden||!h.isMobile())if(""!==this.videoStatus.fid){if(this.videoStatus.isFixed.play&&this.videoStatus.isFixed.pause&&this.videoStatus.isFixed.seek&&this.videoStatus.preStatus==o.VIDEO_STATUS.PLAY){var e=this.videoStatus.fid,i=this.videoStatus.duration,r=this.videoPlayer.currentTime()||0;this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:e,status:oe.TEDU_BOARD_VIDEO_STATUS_TIMEUPDATE,progress:r,duration:i})}}else this.elkLog.report("video_videoTimeUpdate_null")},fe.prototype.videoEnded=function(){var t=this.videoStatus.fid,e=this.videoPlayer.duration();this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:t,status:oe.TEDU_BOARD_VIDEO_STATUS_ENDED,progress:e,duration:e}),this.videoStatus.preProgress=e,this.videoStatus.preStatus=o.VIDEO_STATUS.STOP,this.elkLog.report("video_ended",{file_id:t,extra_info:JSON.stringify({url:this.videoStatus.url,needSync:!1})}),this.store.updateVideo(t,o.VIDEO_STATUS.STOP,e,!1)},fe.prototype.videoSeeked=function(){if(this.isShowVideoControl||this.videoStatus.actions.seek!=o.VIDEO_ACTION.EXCEPTIOIN)if(this.videoStatus.actionTimes.seek=0,this.videoStatus.isCreated){var t=this.videoPlayer.currentTime()||0,e=this.videoPlayer.duration()||0;if(0==parseInt(t)&&0==e)this.store.setNeedDraw(),this.elkLog.report("video_seeked_error",{file_id:i,extra_info:JSON.stringify({url:this.videoStatus.url,progress:t,duration:e})});else if(0!=parseInt(t)||this.videoStatus.isFixed.seek){var i=this.videoStatus.fid;this.videoStatus.preProgress=t;var r=this.isSyncVideoStatus;this.videoStatus.actions.seek==o.VIDEO_ACTION.PASSIVE&&(r=!1),this.store.updateVideo(i,-1,t,r),this.store.setNeedDraw(),this.videoStatus.isFixed.seek?(this.elkLog.report("video_seeked",{file_id:i,extra_info:JSON.stringify({url:this.videoStatus.url,progress:t,duration:e,needSync:r})}),this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:i,status:oe.TEDU_BOARD_VIDEO_STATUS_SEEKED,progress:t,duration:e})):(this.videoStatus.isFixed.seek=!0,this.elkLog.report("video_seeked_fixed",{file_id:i,extra_info:JSON.stringify({url:this.videoStatus.url,progress:t,duration:e})}),this.videoStatus.isFixed.play&&this.videoStatus.isFixed.pause&&this.videoStatus.isFixed.seek&&this.videoLoaded())}else this.videoStatus.isFixed.seekTimes<2?(this.videoStatus.isFixed.seekTimes++,this.store.setNeedDraw(),this.elkLog.report("video_seeked_error",{file_id:i,extra_info:JSON.stringify({url:this.videoStatus.url,progress:t,duration:e})})):this.videoError()}else this.store.setNeedDraw();else this.elkLog.report("video_seeked_exception",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,isShowVideoControl:this.isShowVideoControl,videoAction:this.videoStatus.actions.seek})}),this.store.setNeedDraw();this.videoStatus.actions.seek=o.VIDEO_ACTION.EXCEPTIOIN},fe.prototype.videoMetaDataLoaded=function(){this.elkLog.report("video_metadata_loaded",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.videoWaiting=function(){if(this.videoStatus.isLoaded){this.videoStatus.waitingTime=h.getTimeStamp(),this.videoStatus.isWaiting=!0,this.elkLog.report("video_waiting",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})});var t=this.videoPlayer.currentTime()||0,e=this.videoPlayer.duration()||0;this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:this.videoStatus.fid,status:oe.TEDU_BOARD_VIDEO_STATUS_WAITING,progress:t,duration:e})}},fe.prototype.videoPlaying=function(){if(this.videoStatus.isWaiting){this.videoStatus.isWaiting=!1;var t=h.getTimeStamp()-this.videoStatus.waitingTime;this.elkLog.report("video_playing",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,cost:t})});var e=this.videoPlayer.currentTime()||0,i=this.videoPlayer.duration()||0;this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:this.videoStatus.fid,status:oe.TEDU_BOARD_VIDEO_STATUS_PLAYING,progress:e,duration:i})}},fe.prototype.videoError=function(){this.videoPlayer.errorDisplay&&this.videoPlayer.errorDisplay.hide(),this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:this.videoStatus.fid,status:oe.TEDU_BOARD_VIDEO_STATUS_ERROR,progress:0,duration:0}),this.videoPlayer.error()},fe.prototype.visibilityChange=function(){"hidden"===document.visibilityState?(this.hidden=!0,this.store.setVisible(!1),this.elkLog.report("move_background",{})):(this.hidden=!1,this.store.setVisible(!0),this.elkLog.report("move_foreground",{}),this.store.setNeedDraw(!0))},fe.prototype.createVideo=function(t,e){var i=this;this.elkLog.report("video_cors",{file_id:t,extra_info:JSON.stringify({url:e})}),this.store.request.corsGet(e,(function(){i.innerCreateVideo(t,e,!0)}),(function(){i.innerCreateVideo(t,e,!1)}))},fe.prototype.innerCreateVideo=function(t,e,i){var r=this;this.elkLog.report("create_video",{file_id:t,extra_info:JSON.stringify({url:e,corss:i})});var n=this.width,s=this.height;this.videoDiv.setAttribute("style","z-index:20; position:absolute; top:0; left:0; height:".concat(s,"px; width:").concat(n,"px; display:none;")),this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:t,status:oe.TEDU_BOARD_VIDEO_STATUS_LOADING,progress:0,duration:0});var a=this;if(this.videoTag)i?this.videoTag.setAttribute("crossOrigin","Anonymous"):this.videoTag.removeAttribute("crossOrigin"),this.videoTag.setAttribute("data-fid",t),this.videoPlayer.src([{src:e}]),this.videoPlayer.load(),setTimeout((function(){if(h.isMobile()){var t=h.getTimeStamp();r.videoStatus.actionTimes.play=t,window.WeixinJSBridge?window.WeixinJSBridge.invoke("getNetworkType",{},(function(t){this.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,this.videoPlayer.play()}),!1):(r.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,r.videoPlayer.play());var e=setInterval((function(){r&&r.videoStatus.actionTimes.play==t?(r.elkLog.report("create_play_miss_callback",{file_id:r.videoStatus.fid,extra_info:JSON.stringify({url:r.videoStatus.url,try:a.videoStatus.tryTimes.play})}),a.videoStatus.tryTimes.play++,a.videoStatus.tryTimes.play>=o.VIDEO_ACTION_TRYTIMES?(a.videoStatus.tryTimes.play=0,a.videoError()):window.WeixinJSBridge?window.WeixinJSBridge.invoke("getNetworkType",{},(function(t){a.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,a.videoPlayer.play()}),!1):(a.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,a.videoPlayer.play())):clearInterval(e)}),2e3)}}),500);else{if(!fe.hasVideoPermission())return;if(this.videoTag=fe.videoPermissionDiv.getElementsByTagName("video")[0],i?this.videoTag.setAttribute("crossOrigin","Anonymous"):this.videoTag.removeAttribute("crossOrigin"),this.videoTag.setAttribute("data-fid",t),this.videoTag.addEventListener("mousedown",(function(t){t.stopPropagation()})),this.videoTag.addEventListener("touchstart",(function(t){t.stopPropagation()})),this.videoTag.pause(),!this.videoTag)return void this.elkLog.report("no_auth_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})});var l=Math.floor(1e6*Math.random());this.videoTag.id="tic_video_".concat(l),this.videoDiv.appendChild(this.videoTag),this.videoPlayer=window.videojs(this.videoTag.id,{width:n,height:s,preload:"auto"},(function(){this.tech_&&this.tech_.off("dblclick"),a.resetVideoJSControl(),a.videoTag=a.videoDiv.getElementsByTagName("video")[0],this.src([{src:e}]),this.on("loadstart",(function(){})),this.on("loadedmetadata",(function(){a.videoMetaDataLoaded(),a.videoStatus.isLoaded||h.isMobile()||a.videoCreated()})),this.on("loadeddata",(function(){})),this.on("canplay",(function(){a.elkLog.report("video_canplay",{file_id:a.videoStatus.fid,extra_info:JSON.stringify({url:a.videoStatus.url,duration:this.duration()})})})),this.on("durationchange",(function(){a.elkLog.report("video_durationchange",{file_id:a.videoStatus.fid,extra_info:JSON.stringify({url:a.videoStatus.url,duration:this.duration()})})})),this.on("play",(function(){a.videoPlayed(),a.videoStatus.isLoaded||h.isMobile()&&a.videoCreated()})),this.on("pause",(function(){a.videoPaused()})),this.on("ended",(function(){a.videoEnded()})),this.on("seeked",(function(){a.videoSeeked()})),this.on("timeupdate",(function(){a.videoTimeUpdate()})),this.on("waiting",(function(){a.videoWaiting()})),this.on("playing",(function(){a.videoPlaying()})),this.on("error",(function(){a.videoError()})),a.videoPlayer.load(),setTimeout((function(){if(h.isMobile()){var t=h.getTimeStamp();a.videoStatus.actionTimes.play=t,window.WeixinJSBridge?window.WeixinJSBridge.invoke("getNetworkType",{},(function(t){a.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,a.videoPlayer.play()}),!1):(a.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,a.videoPlayer.play());var e=setInterval((function(){a&&a.videoStatus.actionTimes.play==t?(a.elkLog.report("create_play_miss_callback",{file_id:a.videoStatus.fid,extra_info:JSON.stringify({url:a.videoStatus.url,try:a.videoStatus.tryTimes.play})}),a.videoStatus.tryTimes.play++,a.videoStatus.tryTimes.play>=o.VIDEO_ACTION_TRYTIMES?(a.videoStatus.tryTimes.play=0,a.videoError()):window.WeixinJSBridge?window.WeixinJSBridge.invoke("getNetworkType",{},(function(t){a.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,a.videoPlayer.play()}),!1):(a.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,a.videoPlayer.play())):clearInterval(e)}),2e3)}}),500)}))}},fe.prototype.splitVodVideoOption=function(t){var e=t.split("_");return 3!=e.length?{appId:0,vodId:0,hasExt:"false"}:{appId:e[0],vodId:e[1],hasExt:e[2]}},fe.prototype.createVodVideo=function(t,e){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.videoPlayer&&(this.videoPlayer.dispose(),this.videoPlayer=null);var n=this.width,s=this.height;this.videoDiv.setAttribute("style","z-index:20; position:absolute; top:0; left:0; height:".concat(s,"px; width:").concat(n,"px; display:none"));var a=document.createElement("video"),l="tic_video_".concat(h.getTimeStamp());a.setAttribute("style","width:100%; height:100%"),a.setAttribute("id",l),this.videoDiv.appendChild(a),this.event.fire(this,"TEB_VIDEO_STATUS_CHANGED",{fileId:t,status:oe.TEDU_BOARD_VIDEO_STATUS_LOADING,progress:0,duration:0});var d=this.splitVodVideoOption(e),c={appID:d.appId,fileID:d.vodId,width:n,height:s};if(r)for(var u in r)c[u]=r[u];this.videoPlayer=new window.TCPlayer(l,c),this.videoPlayer.on("error",(function(){i.event.fire(i,"TEB_VIDEO_STATUS_CHANGED",{fileId:t,status:oe.TEDU_BOARD_VIDEO_STATUS_ERROR,progress:0,duration:0})})),this.videoPlayer.on("loadstart",(function(){var t=i.container.getElementsByTagName("video")[0];t&&(t.setAttribute("x5-video-player-type","h5-page"),t.setAttribute("controlsList","nodownload"),t.setAttribute("disablePictureInPicture",""),i.removeTCPlayerControl())})),this.videoPlayer.on("loadedmetadata",(function(){i.videoMetaDataLoaded()})),this.videoPlayer.on("play",(function(){i.videoPlayed(),h.isMobile()&&(i.videoStatus.isCreated||setTimeout((function(){window.WeixinJSBridge||h.isMobile()&&"ios"!=o.PLATFORM.toLowerCase()&&"android"!=o.PLATFORM.toLowerCase()||i.videoPlayer.mute(!1),i.videoCreated(n,s)}),500))})),this.videoPlayer.on("pause",(function(){i.videoPaused()})),this.videoPlayer.on("ended",(function(){i.videoEnded()})),this.videoPlayer.on("seeked",(function(){i.videoSeeked()})),this.videoPlayer.on("seeking",(function(){h.isAndroid()&&h.isTBS()&&i.videoSeeked()})),this.videoPlayer.on("timeupdate",(function(){i.videoTimeUpdate()})),this.videoPlayer.on("loadeddata",(function(){h.isMobile()||i.videoCreated(n,s)}))},fe.prototype.setVODExtParam=function(t,e){this.videoStatus.fid==t&&(this.videoStatus.extParam=e,this.createVodVideo(t,this.videoStatus.url,e))},fe.prototype.resetVideoTag=function(){this.videoTag=this.videoDiv.getElementsByTagName("video")[0],this.videoTag&&(this.videoTag.setAttribute("x5-video-player-type","h5-page"),this.videoTag.setAttribute("controlsList","nodownload nofullscreen"),this.videoTag.setAttribute("disablePictureInPicture","disablePictureInPicture"),this.videoTag.setAttribute("webkit-playsinline","webkit-playsinline"),this.videoTag.setAttribute("playsinline","playsinline"),this.videoTag.setAttribute("style","height:100%; width:100%;"),this.videoTag.addEventListener("mousedown",(function(t){t.stopPropagation()})),this.videoTag.addEventListener("touchstart",(function(t){t.stopPropagation()})))},fe.prototype.resetVideoStatus=function(){this.videoStatus={fid:"",url:"",type:o.FILE_TYPE.VOD,format:o.VIDEO_FORMAT.MP4,duration:0,isLoaded:!1,isFixed:{play:!0,pause:!0,seek:!0,seekTimes:0},isCreated:!1,isWaiting:!1,waitingTime:0,preStatus:-1,preProgress:0,actions:{play:o.VIDEO_ACTION.EXCEPTIOIN,pause:o.VIDEO_ACTION.EXCEPTIOIN,seek:o.VIDEO_ACTION.EXCEPTIOIN,create:o.VIDEO_ACTION.EXCEPTIOIN},tryTimes:{play:0,pause:0,seek:0,duration:0},actionTimes:{play:0,pause:0,seek:0}},this.videoPlayer&&(this.videoPlayer.reset(),this.resetVideoTag(),this.resetVideoJSControl())},fe.prototype.updateVideoStatus=function(t,e,i){var r=this;if(this.hidden&&h.isMobile())this.elkLog.report("ignore_video_update",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,progress:e,status:t,duration:this.videoStatus.duration})});else{var n=!1;if(t==this.videoStatus.preStatus?1e3*Math.abs(parseInt(this.videoStatus.preProgress)-parseInt(e))>o.SYNC_VIDEO_STATUS_PRECISION&&(n=!0):1e3*Math.abs(parseInt(this.videoStatus.preProgress)-parseInt(e))>0&&(n=!0),n){var s=h.getTimeStamp();this.videoStatus.actionTimes.seek=s,this.videoStatus.actions.seek=o.VIDEO_ACTION.PASSIVE,this.videoPlayer.currentTime(e),setTimeout((function(){r&&r.videoStatus.actionTimes.seek==s&&(r.elkLog.report("seek_miss_callback",{file_id:r.videoStatus.fid,extra_info:JSON.stringify({url:r.videoStatus.url,progress:e,duration:r.videoStatus.duration,try:r.videoStatus.tryTimes.seek})}),r.videoStatus.tryTimes.seek++,r.videoStatus.tryTimes.seek>=o.VIDEO_ACTION_TRYTIMES?(r.videoStatus.tryTimes.seek=0,r.videoError()):r.store.setNeedDraw())}),2e3),this.elkLog.report("video_status_update_seek",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,progress:e,duration:this.videoStatus.duration})})}else{var a=this.videoDiv.getElementsByTagName("video")[0],l=a&&a.paused,d=!l,c=null,u=h.getTimeStamp();t!=o.VIDEO_STATUS.STOP||l?t==o.VIDEO_STATUS.PLAY&&l?(this.videoStatus.actionTimes.play=u,this.videoStatus.actions.play=o.VIDEO_ACTION.PASSIVE,this.videoPlayer.play(),setTimeout((function(){r&&r.videoStatus.actionTimes.play==u&&(r.elkLog.report("play_miss_callback",{file_id:r.videoStatus.fid,extra_info:JSON.stringify({url:r.videoStatus.url,progress:e,duration:r.videoStatus.duration,try:r.videoStatus.tryTimes.play})}),r.videoStatus.tryTimes.play++,r.videoStatus.tryTimes.play>=o.VIDEO_ACTION_TRYTIMES?(r.videoStatus.tryTimes.play=0,r.videoError()):r.store.setNeedDraw())}),2e3),c="video_status_update_play"):t==o.VIDEO_STATUS.PAUSE&&d&&(this.videoStatus.actionTimes.pause=u,this.videoStatus.actions.pause=o.VIDEO_ACTION.PASSIVE,this.videoPlayer.pause(),setTimeout((function(){r&&r.videoStatus.actionTimes.pause==u&&(r.elkLog.report("pause_miss_callback",{file_id:r.videoStatus.fid,extra_info:JSON.stringify({url:r.videoStatus.url,progress:e,duration:r.videoStatus.duration,try:r.videoStatus.tryTimes.pause})}),r.videoStatus.tryTimes.pause++,r.videoStatus.tryTimes.pause>=o.VIDEO_ACTION_TRYTIMES?(r.videoStatus.tryTimes.pause=0,r.videoError()):r.store.setNeedDraw())}),2e3),c="video_status_update_pause"):(this.videoStatus.actionTimes.pause=u,this.videoStatus.actions.pause=o.VIDEO_ACTION.PASSIVE,this.videoPlayer.pause(),setTimeout((function(){r&&r.videoStatus.actionTimes.pause==u&&(r.elkLog.report("stop_miss_callback",{file_id:r.videoStatus.fid,extra_info:JSON.stringify({url:r.videoStatus.url,progress:e,duration:r.videoStatus.duration,try:r.videoStatus.tryTimes.pause})}),r.videoStatus.tryTimes.pause++,r.videoStatus.tryTimes.pause>=o.VIDEO_ACTION_TRYTIMES?(r.videoStatus.tryTimes.pause=0,r.videoError()):r.store.setNeedDraw())}),2e3),c="video_status_update_stop")}null!=c&&this.elkLog.report(c,{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,progress:e,duration:this.videoStatus.duration})})}},fe.prototype.showVideoControl=function(t){this.isShowVideoControl=t,this.videoPlayer&&this.videoPlayer.controls(t)},fe.prototype.removeTCPlayerControl=function(){this.resetVideoJSControl()},fe.prototype.resetVideoJSControl=function(){this.videoPlayer&&(this.videoPlayer.bigPlayButton&&this.videoPlayer.bigPlayButton.hide(),this.videoPlayer.controlBar&&(this.videoPlayer.controlBar.addClass("tiw-vjs-control-bar"),this.videoPlayer.controlBar.liveDisplay&&this.videoPlayer.controlBar.liveDisplay.hide(),this.videoPlayer.controlBar.seekToLive&&this.videoPlayer.controlBar.seekToLive.hide(),this.videoPlayer.controlBar.fullscreenToggle&&this.videoPlayer.controlBar.fullscreenToggle.hide(),this.videoPlayer.controlBar.pictureInPictureToggle&&this.videoPlayer.controlBar.pictureInPictureToggle.hide(),this.videoPlayer.errorDisplay&&this.videoPlayer.errorDisplay.hide()))},fe.prototype.playVideo=function(){this.videoStatus.actions.play=o.VIDEO_ACTION.API,this.videoPlayer&&this.videoPlayer.play(),this.elkLog.report("play_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.pauseVideo=function(){this.videoStatus.actions.pause=o.VIDEO_ACTION.API,this.videoPlayer&&this.videoPlayer.pause(),this.elkLog.report("pause_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.seekVideo=function(t){this.videoStatus.actions.seek=o.VIDEO_ACTION.API,this.videoPlayer&&this.videoPlayer.currentTime(t),this.elkLog.report("seek_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.muteVideo=function(t){this.videoTag&&(this.videoTag.muted=t),this.elkLog.report("mute_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.setSyncVideoStatusEnable=function(t){this.isSyncVideoStatus=t},fe.prototype.setSyncAudioStatusEnable=function(t){this.store.setSyncAudioStatusEnable(t)},fe.prototype.startSyncVideoStatus=function(t){var e=this;this.videoStatus.isCreated&&(this.syncVideoStatusTimer&&(clearInterval(this.syncVideoStatusTimer),this.syncVideoStatusTimer=null),this.syncVideoStatusTimer=setInterval((function(){e.store.updateVideo(e.videoStatus.fid,e.videoStatus.preStatus,e.videoPlayer.currentTime())}),1e3*t),this.elkLog.report("start_video_sync_timer",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,interval:t})}))},fe.prototype.stopSyncVideoStatus=function(){this.syncVideoStatusTimer&&clearInterval(this.syncVideoStatusTimer),this.elkLog.report("stop_video_sync_timer",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.playVideo=function(){this.videoStatus.actions.play=o.VIDEO_ACTION.API,this.videoPlayer&&this.videoPlayer.play(),this.elkLog.report("play_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.pauseVideo=function(){this.videoStatus.actions.pause=o.VIDEO_ACTION.API,this.videoPlayer&&this.videoPlayer.pause(),this.elkLog.report("pause_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.seekVideo=function(t){this.videoStatus.actions.seek=o.VIDEO_ACTION.API,this.videoPlayer&&this.videoPlayer.currentTime(t),this.elkLog.report("seek_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.muteVideo=function(t){this.videoTag&&(this.videoTag.muted=t),this.elkLog.report("mute_video",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})})},fe.prototype.renderVideo=function(t){var e=this,i=t.fid,r=t.type,n=t.downloadURL,s=r==o.FILE_TYPE.VODFILE&&null!=n,a=(r==o.FILE_TYPE.VOD||r==o.FILE_TYPE.LIVE)&&null!=n;if(s||a){var l=t.status||0,d=t.progress||0;if(this.videoStatus.isCreated&&l==o.VIDEO_STATUS.PLAY){var c=d,u=h.getTimeStamp();d=Math.floor((u-t.timestamp)/1e3+d),Math.floor(c)!=Math.floor(d)&&this.elkLog.report("video_fix_progress",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,before:c,beforeTime:t.timestamp,after:d,currentTime:u})})}if(this.videoStatus.fid!=i){if(this.resetVideoStatus(),this.stopSyncVideoStatus(),a)this.videoStatus.fid=i,this.videoStatus.url=n,this.videoStatus.format=this.getVideoFormat(n),this.videoStatus.type=this.getVideoType(n),this.videoStatus.actions.create=o.VIDEO_ACTION.PASSIVE,this.store.addVideoFile(i,n,this.boardBaseWidth,this.boardBaseHeight,this.videoStatus.type),this.createVideo(i,n);else if(s){this.videoStatus.fid=i,this.videoStatus.url=n,this.videoStatus.type=o.FILE_TYPE.VODFILE,this.videoStatus.actions.create=o.VIDEO_ACTION.PASSIVE;var p=this.splitVodVideoOption(n);this.store.addVideoFile(i,n,this.boardBaseWidth,this.boardBaseHeight,this.videoStatus.type),"true"==p.hasExt?this.event.fire(this,"TEB_VODEXTPARAM",{fileId:i,appId:p.appId,vodId:p.vodId}):this.createVodVideo(i,n)}}else this.videoDiv.style.display="block";if(!this.videoStatus.isCreated)return;if(this.videoStatus.preStatus==l&&parseInt(this.videoStatus.preProgress)==parseInt(d))return;if(0==this.videoStatus.duration&&(this.elkLog.report("video_get_duration",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url})}),this.videoStatus.duration=this.videoPlayer.duration()||0,0==this.videoStatus.duration))return void setTimeout((function(){e.videoStatus.tryTimes.duration++,e.videoStatus.tryTimes.duration>=o.VIDEO_ACTION_TRYTIMES?(e.videoStatus.tryTimes.duration=0,e.videoError()):e.store.setNeedDraw()}),1e3);l==o.VIDEO_STATUS.PLAY&&parseInt(d)>=parseInt(this.videoStatus.duration)&&(d=parseInt(this.videoStatus.duration),l=o.VIDEO_STATUS.PAUSE,this.elkLog.report("video_fix_progress",{file_id:this.videoStatus.fid,extra_info:JSON.stringify({url:this.videoStatus.url,progress:d})})),this.updateVideoStatus(l,d,r)}else this.videoPlayer&&(this.videoDiv.style.display="none",this.videoStatus.actions.pause=o.VIDEO_ACTION.PASSIVE,this.videoPlayer.pause()),this.resetVideoStatus()},fe.prototype.renderH5PPT=function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.type||o.FILE_TYPE.IMG,n=t.downloadURL,s=t.currentPageIndex,a=t.currentPageStep,l=t.fid;if((r!=o.FILE_TYPE.H5PPT||l&&l!=this.checkH5PPTStatus.fid)&&(1===this.checkH5PPTStatus.status&&(this.elkLog.report("ppt_status_cancel",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify({fid:this.checkH5PPTStatus.fid})}),this.event.fire(this,c.TEB_H5PPT_STATUS_CHANGED,Vt.TEDU_BOARD_H5_PPT_STATUS_CANCEL,{fid:this.checkH5PPTStatus.fid,message:""}),this.checkH5PPTStatus.status=3),clearTimeout(this.checkH5PPTStatus.task)),this.getCurrentFile()!=o.COMMON_GROUP){var h=this.iframeDOM.getAttribute("src")||"";if(r==o.FILE_TYPE.H5PPT&&n){if((h&&h.indexOf("?")>-1?h.substring(0,h.indexOf("?")):h)!=(n.indexOf("?")>-1?n.substring(0,n.indexOf("?")):n)){this.iframeDOM.removeAttribute("src");var d=t.downloadURL;d.indexOf("?")>-1?d+="&page=".concat(s,"&step=").concat(a,"&fid=").concat(encodeURIComponent(l)):d+="?page=".concat(s,"&step=").concat(a,"&fid=").concat(encodeURIComponent(l)),this.elkLog.report("iframe_start_load",{file_id:l,extra_info:d}),this.iframeDOM.setAttribute("src",d),this.event.fire(this,c.TEB_H5PPT_STATUS_CHANGED,Vt.TEDU_BOARD_H5_PPT_STATUS_LOADING,{fid:l,message:""}),this.checkH5PPTStatus.fid=l,this.checkH5PPTStatus.status=1,clearTimeout(this.checkH5PPTStatus.task),function(t){e.checkH5PPTStatus.task=setTimeout((function(){1==e.checkH5PPTStatus.status&&e.checkH5PPTStatus.fid==t&&(e.elkLog.report("ppt_status_timeout",{boardid:e.getCurrentBoard(),extra_info:JSON.stringify({fid:t})}),e.event.fire(e,c.TEB_H5PPT_STATUS_CHANGED,Vt.TEDU_BOARD_H5_PPT_STATUS_TIMEOUT,{fid:t,message:"ppt loading timeout"}),e.checkH5PPTStatus.status=4,e.resetPPTIframe())}),1e3*o.H5PPT_TIMEOUT)}(l),this.isRenderFace=i,this.preloadTriggered=!0}}else this.resetPPTIframe()}else this.iframeDOM.src&&this.resetPPTIframe()},fe.prototype.playAudio=function(t){var e=this;this.elkLog.report("playAudio",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify({elementId:t})});var i=this.store.elementMap.get(t);null!=i&&i.show&&i.play((function(t,r){if(0==t&&e.store.isSyncAudioStatus){var o=i.getRealTimeData(),n=i.getReportData();e.store.addRealtimeData(o),e.store.reportElement(n)}}))},fe.prototype.pauseAudio=function(t){var e=this;this.elkLog.report("pauseAudio",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify({elementId:t})});var i=this.store.elementMap.get(t);null!=i&&i.show&&i.pause((function(t,r){if(0==t&&e.store.isSyncAudioStatus){var o=i.getRealTimeData(),n=i.getReportData();e.store.addRealtimeData(o),e.store.reportElement(n)}}))},fe.prototype.seekAudio=function(t,e){var i=this;this.elkLog.report("seekAudio",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify({elementId:t,time:e})});var r=this.store.elementMap.get(t);null!=r&&r.show&&r.seek(e,(function(t,e){if(0==t&&i.store.isSyncAudioStatus){var o=r.getRealTimeData(),n=r.getReportData();i.store.addRealtimeData(o),i.store.reportElement(n)}}))},fe.prototype.muteAudio=function(t,e){this.elkLog.report("muteAudio",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify({elementId:t,muted:e})});var i=this.store.elementMap.get(t);null!=i&&i.show&&i.mute(e)},fe.prototype.setAudioVolume=function(t,e){this.elkLog.report("setAudioVolume",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify({elementId:t,volume:e})});var i=this.store.elementMap.get(t);null!=i&&i.show&&i.setVolume(e)},fe.prototype.getAudioVolume=function(t){var e=this.store.elementMap.get(t);return null!=e&&e.show?e.getVolume():0},fe.prototype.renderBackgroundColor=function(t,e){o.FILE_TYPE.IMG,e&&e.type,t?this.bgDiv.setAttribute("style","z-index:4 !important;position:absolute !important; top:0 !important; left:0 !important;background-color:".concat(t," !important;width:").concat(this.width,"px !important;height:").concat(this.height,"px !important;")):this.bgDiv.setAttribute("style","z-index:4 !important;position:absolute !important; top:0 !important; left:0 !important;")},fe.prototype.drawData=function(t,e){var i=this,r=this,o=this.store.getNeedDraw();if(this.store.getLaserDraw()||o){var n=!1;for(var s in this.store.laserDataMap){var a=this.store.laserDataMap[s],d=a.length;if(d>0){var c=null;o?(c=a[d-1],this.store.laserDataMap[s]=[],this.store.pushLaserData(c),a=this.store.laserDataMap[s]):c=1==d?a[0]:a.shift(),c&&this.drawLaser(c),!n&&a.length&&1!=d&&(n=!0)}n&&setTimeout((function(){i.store.setLaserDraw(!0)}),0)}}if((o||this.store.getIncreasingDraw()||this.store.getPartDraw())&&t.forEach((function(t){var o,n;if("line"===t.type&&t.show)r.drawLine(e,t);else if("raser"==t.type&&t.status);else if("select"==t.type&&t.show)e.setLineDash&&e.setLineDash([15,5]),e.lineWidth=1,e.strokeStyle=h.color2RgbaColor(f.COLOR.RED),e.strokeRect(t.startInfo.x/1e4*r.width,t.startInfo.y/1e4*r.height,(t.location.x-t.startInfo.x)/1e4*r.width,(t.location.y-t.startInfo.y)/1e4*r.height),e.setLineDash&&e.setLineDash([]);else if("graph"==t.type&&t.show){var s=t.thin/1e4*r.height;if("line"==t.graph)t.style?function(t,e,i,o,n,s,a,h){if(t.beginPath(),t.moveTo(e,i),t.lineTo(o,n),t.strokeStyle=a,t.lineWidth=s,t.lineCap="round",h.lineType==U.TEDU_BOARD_LINE_TYPE_DOTTED){var d=.01*r.width+s;t.setLineDash&&t.setLineDash([d,d])}if(t.stroke(),t.setLineDash&&t.setLineDash([]),h.startArrowType!=l.TEDU_BOARD_ARROW_TYPE_NONE||h.endArrowType!=l.TEDU_BOARD_ARROW_TYPE_NONE){var c=s+.02*r.width,u=180*Math.atan2(n-i,o-e)/Math.PI,p=(u-25)*Math.PI/180,f=(u+25)*Math.PI/180,g=c*Math.cos(p),_=c*Math.sin(p),m=c*Math.cos(f),y=c*Math.sin(f);h.endArrowType==l.TEDU_BOARD_ARROW_TYPE_NORMAL?(t.beginPath(),t.moveTo(o-g,n-_),t.lineTo(o,n),t.lineTo(o-m,n-y),t.stroke()):h.endArrowType==l.TEDU_BOARD_ARROW_TYPE_SOLID&&(t.beginPath(),t.moveTo(o-g,n-_),t.lineTo(o,n),t.lineTo(o-m,n-y),t.closePath(),t.fillStyle=a,t.fill(),t.stroke()),h.startArrowType==l.TEDU_BOARD_ARROW_TYPE_NORMAL?(t.beginPath(),t.moveTo(e+g,i+_),t.lineTo(e,i),t.lineTo(e+m,i+y),t.stroke()):h.startArrowType==l.TEDU_BOARD_ARROW_TYPE_SOLID&&(t.beginPath(),t.moveTo(e+g,i+_),t.lineTo(e,i),t.lineTo(e+m,i+y),t.closePath(),t.fillStyle=a,t.fill(),t.stroke())}}(e,t.startPoint.x/1e4*r.width,t.startPoint.y/1e4*r.height,t.endPoint.x/1e4*r.width,t.endPoint.y/1e4*r.height,Math.max(s,r.minLineWidth),t.color,t.style):(e.beginPath(),e.moveTo(t.startPoint.x/1e4*r.width,t.startPoint.y/1e4*r.height),e.lineTo(t.endPoint.x/1e4*r.width,t.endPoint.y/1e4*r.height),e.strokeStyle=t.color,e.lineWidth=Math.max(s,r.minLineWidth),e.lineCap="round",e.stroke());else if("rect"==t.graph||"square"==t.graph){e.strokeStyle=t.color,e.lineWidth=Math.max(s,r.minLineWidth);var a=Math.abs(t.startPoint.x-t.endPoint.x)/1e4*r.width,d=Math.abs(t.startPoint.y-t.endPoint.y)/1e4*r.height;o=t.startPoint.x,n=t.startPoint.y,t.startPoint.x<=t.endPoint.x?t.startPoint.y<=t.endPoint.y||(d=-d):t.startPoint.y<=t.endPoint.y?a=-a:(a=-a,d=-d),t.solid?(e.fillStyle=t.color,e.fillRect(o/1e4*r.width,n/1e4*r.height,a,d)):e.strokeRect(o/1e4*r.width,n/1e4*r.height,a,d)}else if("oval"==t.graph||"circle"==t.graph){o=(t.startPoint.x+t.endPoint.x)/2/1e4*r.width,n=(t.startPoint.y+t.endPoint.y)/2/1e4*r.height;var c=Math.abs(t.startPoint.x-t.endPoint.x)/2/1e4*r.width,u=Math.abs(t.startPoint.y-t.endPoint.y)/2/1e4*r.height;e.strokeStyle=t.color,e.lineWidth=Math.max(s,r.minLineWidth),function(t,e,i,r,o,n,s){var a=.5522848,l=r*a,h=o*a;t.beginPath(),t.moveTo(e-r,i),t.bezierCurveTo(e-r,i-h,e-l,i-o,e,i-o),t.bezierCurveTo(e+l,i-o,e+r,i-h,e+r,i),t.bezierCurveTo(e+r,i+h,e+l,i+o,e,i+o),t.bezierCurveTo(e-l,i+o,e-r,i+h,e-r,i),t.closePath(),t.stroke(),n&&(t.fillStyle=s,t.fill())}(e,o,n,c,u,t.solid,t.color),e.stroke()}}else"inputtext"==t.type?i.renderTextTool(t):"imageElement"==t.type?i.renderImageElement(t):"element"==t.type&&(t.subType===$.TEDU_BOARD_ELEMENT_H5?i.renderH5WebElement(t):t.subType===$.TEDU_BOARD_ELEMENT_CUSTOM_GRAPH?i.renderCustomGraph(t):t.subType!==$.TEDU_BOARD_ELEMENT_AUDIO&&t.subType!==$.TEDU_BOARD_ELEMENT_GLOBAL_AUDIO||i.renderAudio(t))})),r.store.getSelectList().length>0){for(var u=[],p=0,g=r.store.getSelectList().length;p<g;p++){var _=r.store.getSelectList()[p];("imageElement"===_.type||"element"===_.type)&&u.push(_)}u.length?(this.cursorLayerWrap.style.display="block",this.cursorLayerWrap.style.zIndex=100,this.teduBoardCursorLayer.showSelectLayer(u)):this.cursorLayerWrap.style.display="none";var m=r.store.getSelectArea();e.strokeStyle=h.color2RgbaColor(f.COLOR.RED),e.setLineDash&&e.setLineDash([15,5]),e.lineWidth=1,e.strokeRect(m.x/1e4*r.width,m.y/1e4*r.height,m.width/1e4*r.width,m.height/1e4*r.height),e.setLineDash&&e.setLineDash([])}else this.cursorLayerWrap.style.display="none";this.removeImageElement(),this.removeTextTool(),this.removeH5WebElement(),this._removeRenderedElement()},fe.prototype._removeRenderedElement=function(){this.store.removeRenderedElement()},fe.prototype.renderImageElement=function(t){t.show?(this.imageElementMapData[""+t.belongSeq]=t,t.setBoardSize(this.width,this.height),t.renderTo(this.imageElementWrap)):(t.remove(),delete this.imageElementMapData[""+t.belongSeq])},fe.prototype.removeImageElement=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.getCurrentBoard();for(var i in this.imageElementMapData){var r=this.imageElementMapData[i];(t&&r.boardId==e||!t&&r.boardId!=e)&&(r.remove(),delete this.imageElementMapData[""+r.belongSeq])}},fe.prototype.renderTextTool=function(t){var e=this;if(t.show){var i,r=document.getElementById("tic-textarea__".concat(t.belongSeq)),o=t.textSize/1e4*this.height/12;r?i=this.textAreaComponentMap[t.belongSeq]:((i=new le({boardId:this.getCurrentBoard(),board:this})).createElement(this.textAreaBox),i.initEvent({onfocus:function(t,i,r,o){e.textAreaFocusBlurStatus.focus=t,e.textInputStatus=1,e.store.updateDragDataFromTextTool(i,r,o),e.draw()},oninput:function(t,i,r,o){e.textInputStatus=1;var n=t.dom.value;e.store.collectTextInputData().inputting(t,t.textItem,n,t.dom.clientWidth,t.dom.clientHeight),e.store.updateDragDataFromTextTool(i,r,o),e.draw()},onblur:function(t){var i;e.textAreaFocusBlurStatus.focus===t&&(e.textAreaFocusBlurStatus.focus=null),e.textInputStatus=0,e.store.cancelSelect(),t.dom&&(i=t.dom.value),i?e.store.collectTextInputData().draw(t,t.textItem,i,t.dom.clientWidth+12,t.dom.clientHeight):(delete e.textAreaComponentMap[t.textItem.belongSeq],e.store.collectTextInputData().clearTask())},onresize:function(t){t.textItem}})),this.textAreaComponentMap[t.belongSeq]=i,i&&(i.setBoardContainerSize(this.width,this.container.offsetWidth,this.height,this.container.offsetHeight),i.setTextItem(t),i.setPosition(t.location.x/1e4*this.width,t.location.y/1e4*this.height),i.setFontSize(12),i.setMaxSize(),i.setFontScale(o),i.setSize())}else this.textAreaComponentMap[t.belongSeq]&&(this.textAreaComponentMap[t.belongSeq].dom.blur(),this.textAreaComponentMap[t.belongSeq].remove()),delete this.textAreaComponentMap[t.belongSeq]},fe.prototype.removeTextTool=function(){var t=this.getCurrentBoard();for(var e in this.textAreaComponentMap){var i=this.textAreaComponentMap[e];i&&i.boardId!=t&&(this.textAreaFocusBlurStatus.focus===i&&i.dom&&i.dom.blur(),i.remove(),delete this.textAreaComponentMap[""+i.belongSeq])}},fe.prototype.getBoardData=function(){return JSON.parse(JSON.stringify(this.store.getData()))},fe.prototype.addHistory=function(t){this.store.addHistory(t)},fe.prototype.addData=function(t){var e=this;if(h.isString(t))try{t=JSON.parse(t)}catch(e){this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WARNING_SYNC_DATA_PARSE_FAILED,e.message+", "+t)}if(h.isUndefined(t.avsdk_time))try{if(this.enableSyncTime){var i=t.value.operator;this.checkUserTime(i),this.userTime[i].imTimeOffset=h.getTimeStamp()-t.timestamp;var r=this.userTime[i].avTimeOffset-this.userTime[i].imTimeOffset;r>0?setTimeout((function(){e.store&&e.store.addData(t)}),r):this.store.addData(t)}else this.store.addData(t)}catch(e){this.elkLog.report("addData",{action_result:-1,extra_info:JSON.stringify({data:t,stack:e.stack,message:e.message})})}},fe.prototype.deleteBoard=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.store.getCurrentBoard();this.logger.info(this.loggerModuleName,"deleteBoard",{param:{boardId:t}}),this.inputBlur(),h.boardId2Fid(t)==o.COMMON_GROUP&&this.store.deleteBoard(t)},fe.prototype.getBoardList=function(){return JSON.parse(JSON.stringify(this.store.getBoardList()))},fe.prototype.getBoardPicList=function(){return JSON.parse(JSON.stringify(this.store.getBoardPicList()))},fe.prototype.getCurrentBoard=function(){return this.store.currentBoard},fe.prototype.getCurrentFile=function(){return this.store.getCurrentFile()},fe.prototype.addBoard=function(){return this.inputBlur(),this.store.getCurrentFile()!=o.COMMON_GROUP&&this.store.switchFile(o.COMMON_GROUP),this.store.switchBoard()},fe.prototype.switchBoard=function(t,e){var i=this;if(this.logger.info(this.loggerModuleName,"switchBoard",{param:{boardId:t,resetStep:e}}),this.inputBlur(),-1===this.getBoardList().indexOf(t)&&(t=o.COMMON_DEFAULT_BOARD),t){var r=h.boardId2Fid(t);if(this.getFileInfo(r).type===o.FILE_TYPE.H5PPT){var n=this.getBoardByGroup(r).indexOf(t);P.gotoTimestampNew(this.iframeDOM,{slideIndex:n,resetStep:e,isPassive:!1})}else this.store.switchBoard(t)}else clearTimeout(this.bgH5LoadTask),this.backgroundIFrameManager.remove(this.boardBox),this.bgH5LoadTask=setTimeout((function(){i.store.switchBoard(t)}),50)},fe.prototype.switchPage=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.store.switchPage(t)},fe.prototype.prevBoard=function(t){this.inputBlur();var e=this.getFileInfo(this.getCurrentFile()),i=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<1||this.switchBoard(i[e.currentPageIndex-1],t)},fe.prototype.prevStep=function(){var t=this.store.getFileInfo(this.store.getCurrentFile());t.type==o.FILE_TYPE.H5PPT?(this.inputBlur(),P.gotoPreviousStep(this.iframeDOM,{currentPageIndex:t.currentPageIndex,currentPageStep:t.currentPageStep})):this.prevBoard()},fe.prototype.nextBoard=function(t){this.inputBlur();var e=this.getFileInfo(this.getCurrentFile()),i=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<e.pageCount-1&&this.switchBoard(i[e.currentPageIndex+1],t)},fe.prototype.nextStep=function(){this.store.getFileInfo(this.store.getCurrentFile()).type==o.FILE_TYPE.H5PPT?(this.inputBlur(),P.gotoNextStep(this.iframeDOM,{})):this.nextBoard()},fe.prototype.setGlobalBackgroundColor=function(t){this.store.setGlobalBackgroundColor(t)},fe.prototype.setBackgroundColor=function(t){this.store.setBackgroundColor(t)},fe.prototype.initListenEvent=function(){var t=this;document.addEventListener("keydown",(function(e){if(16==e.keyCode||"Shift"==e.key)if(t.getToolType()==Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG)t.zoomStatusMap.isShiftPressed||(t.zoomStatusMap.isShiftPressed=!0,null!=t.scaleIcons.shrink&&(t.store.setCursorIcon(Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG,{cursor:"url",url:t.scaleIcons.shrink}),t.updateCursor()));else{var i=t.store.userData[t.getCurrentBoard()][t.store.identifier].length,r=null;i&&(r=t.store.userData[t.getCurrentBoard()][t.store.identifier][i-1]),t.getToolType()==Yt.TEDU_BOARD_TOOL_TYPE_RECT?(t.setType(Yt.TEDU_BOARD_TOOL_TYPE_SQUARE),r&&"rect"==r.graph&&t.store.isDrawing&&(r.graph="square",r.endPoint=JSON.parse(JSON.stringify(t.store.graphEndPoint)),t.store.squareFix(r),t.store.setNeedDraw()),t.store.beforeToolType=Yt.TEDU_BOARD_TOOL_TYPE_RECT):t.getToolType()==Yt.TEDU_BOARD_TOOL_TYPE_RECT_SOLID?(t.setType(Yt.TEDU_BOARD_TOOL_TYPE_SQUARE_SOLID),r&&"rect"==r.graph&&t.store.isDrawing&&(r.graph="square",r.endPoint=JSON.parse(JSON.stringify(t.store.graphEndPoint)),t.store.squareFix(r),t.store.setNeedDraw()),t.store.beforeToolType=Yt.TEDU_BOARD_TOOL_TYPE_RECT_SOLID):t.getToolType()==Yt.TEDU_BOARD_TOOL_TYPE_OVAL?(t.setType(Yt.TEDU_BOARD_TOOL_TYPE_CIRCLE),r&&"oval"==r.graph&&t.store.isDrawing&&(r.graph="circle",r.endPoint=JSON.parse(JSON.stringify(t.store.graphEndPoint)),t.store.circleFix(r),t.store.setNeedDraw()),t.store.beforeToolType=Yt.TEDU_BOARD_TOOL_TYPE_OVAL):t.getToolType()==Yt.TEDU_BOARD_TOOL_TYPE_OVAL_SOLID&&(t.setType(Yt.TEDU_BOARD_TOOL_TYPE_CIRCLE_SOLID),r&&"oval"==r.graph&&t.store.isDrawing&&(r.graph="circle",r.endPoint=JSON.parse(JSON.stringify(t.store.graphEndPoint)),t.store.circleFix(r),t.store.setNeedDraw()),t.store.beforeToolType=Yt.TEDU_BOARD_TOOL_TYPE_OVAL_SOLID)}}),!1),document.addEventListener("keyup",(function(e){if(16==e.keyCode||"Shift"==e.key){if(t.zoomStatusMap.isShiftPressed=!1,t.store.beforeToolType!=t.store.initTypeConstant){var i=t.store.userData[t.getCurrentBoard()][t.store.identifier].length,r=null;i&&(r=t.store.userData[t.getCurrentBoard()][t.store.identifier][i-1]),t.setType(t.store.beforeToolType),r&&"square"==r.graph&&t.store.isDrawing&&(r.graph="rect",r.endPoint=t.store.graphEndPoint,t.store.setNeedDraw()),r&&"circle"==r.graph&&t.store.isDrawing&&(r.graph="oval",r.endPoint=t.store.graphEndPoint,t.store.setNeedDraw()),t.store.beforeToolType=t.store.initTypeConstant}null!=t.scaleIcons.enlarge&&(t.store.setCursorIcon(Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG,{cursor:"url",url:t.scaleIcons.enlarge}),t.updateCursor()),t.scaleRatio=Math.abs(t.scaleRatio)}}),!1)},fe.prototype.init=function(){var t,e,i,r=this,n=this;this.initListenEvent(),this.elkLog.report("init",{extra_info:JSON.stringify({option:this.option})}),this.reportContainerSize(),this.visibilityChangeName="visibilitychange",void 0!==document.hidden?this.visibilityChangeName="visibilitychange":void 0!==document.mozHidden?this.visibilityChangeName="mozvisibilitychange":void 0!==document.msHidden?this.visibilityChangeName="msvisibilitychange":void 0!==document.webkitHidden&&(this.visibilityChangeName="webkitvisibilitychange"),this.hidden=!1,this.visibilityChangeBind=this.visibilityChange.bind(this),document.addEventListener(this.visibilityChangeName,this.visibilityChangeBind),this.windowResizeListenerBind=this.windowResizeListener.bind(this),window.addEventListener("resize",this.windowResizeListenerBind),this.windowMessageListenerBind=this.windowMessageListener.bind(this),window.addEventListener("message",this.windowMessageListenerBind,!1),fe.prototype.renderCanvas=function(){var e=this,i=new zt;this.container.innerHTML='<div class="tx_board_canvas_wrap" oncontextmenu="return false;" onselectstart="return false;">'.concat(i.getTemplate(),"</div>"),this.boardWrap=this.container.getElementsByClassName("tx_board_canvas_wrap")[0],this.boardBox=this.container.getElementsByClassName("tx_board_canvas_box")[0],this.keyboardinput=this.container.getElementsByTagName("textarea")[0],this.el=this.container.getElementsByTagName("canvas")[0],this.laserCanvas=this.container.getElementsByTagName("canvas")[1],this.progress=this.container.getElementsByClassName("tic_board_bg_progress")[0],this.img=this.container.getElementsByClassName("tic_board_img_bg")[0],this.bgDiv=this.container.getElementsByClassName("tic_board_bg")[0],this.videoDiv=document.getElementById("tic_video_wrap"),this.imageElementWrap=this.container.getElementsByClassName("tic_board__imagewrap")[0],this.cursorLayerWrap=this.container.getElementsByClassName("tic_cursorlayer__wrap")[0],this.webviewWrap=this.container.getElementsByClassName("tiw_board_webview_wrap")[0],this.laserWrap=this.container.getElementsByClassName("tic-board_laserwrap")[0],this.audioWrap=this.container.getElementsByClassName("tic-board__audiowrap")[0],this.progress.src=this.progressBarUrl,this.teduBoardCursorLayer=new se(this.cursorLayerWrap,{onmousemove:h.debounce((function(t){e.store.updateElements(t)}),200),ontouchstart:function(){null===e.touchID&&(e.touchID=0)},ontouchend:function(){e.touchID=null},ontouchcancel:function(){e.touchID=null}}),this.resetPPTIframe(),this.textAreaBox=this.container.getElementsByClassName("tic_board_textbox")[0],this.teduBoardScroll=new ce(this.container,(function(t,i){var r=(1-t/(e.width-e.container.clientWidth))*(e.moveDragArea.maxLeft-e.moveDragArea.minLeft)+e.moveDragArea.minLeft,o=(1-i/(e.height-e.container.clientHeight))*(e.moveDragArea.maxTop-e.moveDragArea.minTop)+e.moveDragArea.minTop;e.store.collectDragData().scrollEventDraw(e.boardBox,r,o),e.draw()})),this.isDrawEnable()?this.teduBoardScroll.enableScroll():this.teduBoardScroll.disableScroll(),this.el.getContext("2d").translate(.5,.5),this.laserCanvas&&this.laserCanvas.getContext("2d").translate(.5,.5),this.draw(),document.body.addEventListener("mouseup",this.mouseupUpdateCursor=function(t){_=!0,s=!1,e.updateCursor()},!1),window.addEventListener("mouseup",this.mouseupUpdateCursor,!1),this.boardWrap.addEventListener("click",(function(t){if(y(t),e.isDrawEnable()){var i=e.getEventLocation(t);-1e6==i.x&&-1e6==i.y||"mouse"!=e.store.getType()||P.sendMouseEvent(e.iframeDOM,{type:t.type,x:i.x,y:i.y,touch:h.extractTouch(t)})}}),!1);var r=null;this.boardWrap.addEventListener("mousewheel",(function(t){if(e.getToolType()==Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG){var i={};if(e.zoomStatusMap.isShiftPressed){if("number"==typeof t.wheelDeltaY){var o=Math.floor(t.wheelDeltaY/150*e.scaleRatio);e.focusScale(t,o),i={cursor:"url",url:o>0?e.scaleIcons.enlarge:e.scaleIcons.shrink}}}else{i={cursor:"move",url:""},r&&(clearTimeout(r),r=null),r=setTimeout((function(){h.isMobile()?e.store.collectDragData().touchEnd(e.pinchScale):(e.store.collectDragData().end(),i={cursor:"url",url:e.scaleIcons.enlarge},e.store.setCursorIcon(Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG,i),e.updateCursor())}),200);var n=0,s=0;"number"==typeof t.wheelDeltaX&&(n=.6*t.wheelDeltaX),"number"==typeof t.wheelDeltaY&&(s=.6*t.wheelDeltaY),"number"!=typeof e.dragStartX&&(e.dragStartX=0,e.dragStartY=0),e.moveBoard(n,s,t)}e.store.setCursorIcon(Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG,i),e.updateCursor()}}),!1),this.boardWrap.addEventListener("mousedown",(function(t){e.isTouchType="mouse";try{T.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"mousedown",error:t.message,stack:t.stack})})}}),!1),this.boardWrap.addEventListener("mousemove",(function(t){e.isTouchType="mouse";try{v.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"mousemove",error:t.message,stack:t.stack})})}}),!0),this.boardWrap.addEventListener("mouseup",(function(t){e.isTouchType="mouse";try{E.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"mouseup",error:t.message,stack:t.stack})})}}),!1),this.boardWrap.addEventListener("mouseleave",(function(t){e.isTouchType="mouse";try{S.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"mouseleave",error:t.message,stack:t.stack})})}}),!1),document.body.addEventListener("keydown",this.keydownBodyEvent=function(t){e.isTouchType="mouse",function(t){if(this.isDrawEnable()&&(46===t.keyCode||8===t.keyCode)){var e=this.store.getType();"select"!=e&&"pointselect"!=e||this.isMoving||(this.store.deleteSelectedData(),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo()),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.store.canRedo()))}}.apply(e,[t])},!1);var o=new Jt.a(this.boardWrap,{});o.on("touchStart",(function(t){e.isTouchType="finger",e.pinchScale=[];try{T.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"touchStart",error:t.message,stack:t.stack})})}})),o.on("touchMove",(function(t){e.isTouchType="finger";try{v.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"touchMove",error:t.message,stack:t.stack})})}})),o.on("touchEnd",(function(t){e.isTouchType="finger";try{E.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"touchEnd",error:t.message,stack:t.stack})})}})),o.on("touchCancel",(function(t){e.isTouchType="finger";try{S.apply(e,[t])}catch(t){e.elkLog.report("interaction",{extra_info:JSON.stringify({event:"touchCancel",error:t.message,stack:t.stack})})}})),o.on("pinch",(function(i){e.isTouchType="finger","zoom"===(t=e.store.getType())&&e.pinchScale.push(i.zoom)})),o.on("singleTap",(function(t){if(y(t),e.isDrawEnable()){var i=e.getEventLocation(t,!0);-1e6==i.x&&-1e6==i.y||"mouse"!=e.store.getType()||P.sendMouseEvent(e.iframeDOM,{type:"click",x:i.x,y:i.y,touch:h.extractTouch(t)})}}))},this.renderCanvas(),this.layout(),clearTimeout(this.pregressTask),n.pregressTask=setTimeout((function(){n.store.isProgressEnable()&&(n.progress.style.display="block")}),o.PROGRESS_SHOW_DELAY),n.event.on("TEB_HISTROYDATA_SYNCCOMPLETED",(function(){clearTimeout(n.pregressTask),n.progress.style.display="none"})),n.event.on("draw_laser",(function(t){r.drawLaser(t)})),this.event.on("TEB_DRAW_FACE",(function(){try{r.drawFace()}catch(i){var t=i.stack,e="render face page："+i.message;r.store.machineNotify("markdown",'白板渲染错误\n                \n>version：<font color="#ff0000">'.concat(o.VERSION,'</font>\n                \n>sdkAppId：<font color="#ff0000">').concat(r.option.sdkAppId,'</font>\n                \n>userId：<font color="#ff0000">').concat(r.option.userId,'</font>\n                \n>classId：<font color="#ff0000">').concat(r.option.classId,'</font>\n                \n>信息：<font color="#ff0000">').concat(e,'</font>\n                \n>堆栈：<font color="#ff0000">').concat(t,"</font>")),r.elkLog.report("drawerror",{boardid:r.store.getCurrentBoard(),extra_info:JSON.stringify({stack:t,message:e})})}})),this.drawTimer=setInterval((function(){r.render()}),o.RENDER_INTERVAL);var s=!1,a=-10,l=-10,d=-10,c=-10,u=-10,p=-10,f=h.getTimeStamp(),g=!1,_=!0,m=this.el.getContext("2d");function y(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function T(r){t=this.store.getType(),e=this.store.getColor(),i=this.store.getThin();var n=this;if(y(r),this.isDrawEnable()){var f=this.getEventLocation(r);if(-1e6!=f.x||-1e6!=f.y){var T=this.getFileInfo(this.getCurrentFile());if(T&&!h.isDisableDrawFileType(T.type)){if(this.zoomStatusMap.isMoved=!1,this.zoomStatusMap.isWheeled=!1,this.zoomStatusMap.isMouseDowned=!0,g=!0,s=!0,_=!1,"mouse"==t){if(T.type===o.FILE_TYPE.H5PPT)return void P.sendMouseEvent(this.iframeDOM,{type:r.type,x:f.x,y:f.y,touch:h.extractTouch(r)});if(T.fid===o.COMMON_GROUP)return void this.nextBoard();if(T.type===o.FILE_TYPE.IMG)return void this.nextBoard()}if(this.store.resetOperation(),u=-10,p=-10,d=a=f.x,c=l=f.y,this.dragStartX=f.clientX,this.dragStartY=f.clientY,"line"==t){if(this.preLineTimestamp=h.getTimeStamp(),this.preLinePoint={x:a,y:l},this.preSpeed=0,this.preWidth=i,this.pointCount=0,this.ignorePointCount=0,this.hasOptimizeStart=!1,this.hasOptimizeEnd=!0,this.store.collectRaserData().start(a,l,this.getToolType()),this.updateCursor(),this.store.cancelSelect(),!this.store.isHandwritingEnable()){var v=Math.max(i/1e4*this.height,this.minLineWidth);m.beginPath(),m.arc(a/1e4*this.width,l/1e4*this.height,v/2,0,2*Math.PI,!0),m.fillStyle=e,m.fill(),m.closePath()}this.store.collectLineData().start(a,l,this.store.isHandwritingEnable())}else if("eraser"==t)this.store.cancelSelect(),this.store.collectEraserData(a,l);else if("raser"==t);else if("select"==t)this.selectToolType=1,this.store.collectMoverData().beforeStart(a,l)?this.isMoving=!0:(this.store.cancelSelect(),this.store.collectSelectData().start(a,l));else if("pointselect"==t)this.selectToolType=0,this.store.collectMoverData().beforeStart(a,l)&&(this.isMoving=!0);else if("inputtext"==t){if(g=!1,s=!1,_=!0,1===this.textInputStatus){var E=this.textAreaFocusBlurStatus.focus;return void(E&&E.dom&&E.dom.blur())}var S,b=f.ox,O=f.oy,D=f.x,A=f.y,I=b,x=O,w=this.store.collectTextInputData().start(D,A),R=this.store.getTextSize()/1e4*n.height/12;w.text?document.getElementById("tic-textarea__".concat(w.belongSeq))&&(S=this.textAreaComponentMap[w.belongSeq]):(S=new le({boardId:this.getCurrentBoard(),board:this})).createElement(this.textAreaBox),S.initEvent({onfocus:function(t,e,i,r){n.textAreaFocusBlurStatus.focus=t,n.textInputStatus=1,n.store.updateDragDataFromTextTool(e,i,r),n.draw()},oninput:function(t,e,i,r){n.textInputStatus=1;var o=t.dom.value;n.store.collectTextInputData().inputting(t,t.textItem,o,t.dom.clientWidth+12,t.dom.clientHeight),n.store.updateDragDataFromTextTool(e,i,r),n.draw()},onblur:function(t){var e;n.textAreaFocusBlurStatus.focus===t&&(n.textAreaFocusBlurStatus.focus=null),n.textInputStatus=0,n.store.cancelSelect(),t.dom&&(e=t.dom.value),e?n.store.collectTextInputData().draw(t,t.textItem,e,t.dom.clientWidth+12,t.dom.clientHeight):(delete n.textAreaComponentMap[t.textItem.belongSeq],n.store.collectTextInputData().clearTask())},onresize:function(t){t.textItem}}),n.textAreaComponentMap[w.belongSeq]=S,S&&(S.setBoardContainerSize(this.width,this.container.offsetWidth,this.height,this.container.offsetHeight),w.text=this.store.nextInputObj.text,S.setTextItem(w),S.setPosition(I,x),S.setFontSize(12),S.setMaxSize(),S.setFontScale(R),S.setSize(),S.focus()||(delete this.textAreaComponentMap[S.textItem.belongSeq],this.store.collectTextInputData().clearTask()),0==this.store.nextInputObj.keepFocus&&this.inputBlur())}else t.indexOf("graph-")>-1?(this.store.cancelSelect(),this.store.collectGraphData().start(a,l)):"zoom"===t?h.isMobile()?this.beforePinchScale=this.getBoardScale():(this.store.cancelSelect(),this.store.collectDragData().start(r)):"custom-graph"===t&&this.store.collectCustomGraph().start(a,l);1==this.isMoving&&this.store.collectMoverData().beforeStart(a,l)&&(this.isMoving=!0,this.store.collectMoverData().start(a,l))}}}}function v(r){if(11!==this.getToolType()&&(y(r),this.isDrawEnable())){var o=this.getFileInfo(this.getCurrentFile());if(o&&!h.isDisableDrawFileType(o.type)){t=this.store.getType(),e=this.store.getColor(),i=this.store.getThin();var n=this.getEventLocation(r);if(-1e6!=n.x||-1e6!=n.y)if("mouse"!=t){var g=n.x,v=n.y,E=n.clientX,O=n.clientY;if(s){if("line"==t){try{var D=this.store.userData[this.getCurrentBoard()][this.option.userId],A=D[D.length-1];if(A&&!A.show)return S.apply(this,[r]),void T.apply(this,[r])}catch(t){}if(this.store.isHandwritingEnable())b.apply(this,[g,v]);else{var I=h.getTimeStamp();if(this.pointCount++,this.enableLineOptimization){var x=Math.sqrt(Math.pow(this.preLinePoint.x-g,2)+Math.pow(this.preLinePoint.y-v,2));if(I-this.preLineTimestamp<20||x<5)return void this.ignorePointCount++}if(this.preLineTimestamp=I,this.preLinePoint={x:g,y:v},u>=0&&p>=0){var w=(u+g)/2,R=(p+v)/2;m.beginPath(),m.moveTo(d/1e4*this.width,c/1e4*this.height),m.quadraticCurveTo(u/1e4*this.width,p/1e4*this.height,w/1e4*this.width,R/1e4*this.height),m.strokeStyle=e,m.lineWidth=Math.max(i/1e4*this.height,this.minLineWidth),m.lineCap="round",m.stroke(),d=w,c=R}u=g,p=v,this.store.collectLineData().draw(g,v,i)}}else"eraser"==t?this.store.collectEraserData(g,v):"select"==t&&!this.isMoving||"pointselect"==t&&1===this.selectToolType?Math.abs(this.dragStartX-E)>1||Math.abs(this.dragStartY-O)>1?(this.store.collectSelectData().draw(g,v),this.selectToolType=1):this.selectToolType=0:"pointselect"==t&&!this.isMoving||"select"==t&&0===this.selectToolType?(Math.abs(this.dragStartX-E)>1||Math.abs(this.dragStartY-O)>1)&&(this.selectToolType=1,this.store.collectSelectData().start(g,v)):t.indexOf("graph-")>-1?this.store.collectGraphData().draw(g,v):"zoom"===t?(Math.abs(this.dragStartX-E)>1||Math.abs(this.dragStartY-O)>1)&&(this.store.setCursorIcon(Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG,{cursor:"move",url:""}),this.updateCursor(),this.isDragMoving=!0,h.isMobile()&&this.pinchScale.length?this.store.collectDragData().scaleDraw(this.beforePinchScale,this.pinchScale):(this.store.collectDragData().draw(r,E,O,this.dragStartX,this.dragStartY),this.dragStartX=E,this.dragStartY=O,this.draw())):"custom-graph"===t&&this.store.collectCustomGraph().draw(a,l,g,v);this.isMoving&&(this.store.collectMoverData().draw(g,v,d,c),d=g,c=v)}else"line"==t&&this.updateCursor(),_||"line"==t&&T.apply(this,[r]);if("raser"==t||"line"==t){var C=function(){var t=h.getTimeStamp();if(this.enableRaserOptimization&&t-f<20)return!1;return f=t,!0}.apply(this);this.store.collectRaserData().draw(g,v,this.getToolType(),s,C)}}else P.sendMouseEvent(this.iframeDOM,{type:r.type,x:n.x,y:n.y,touch:h.extractTouch(r)})}}}function E(r){if(y(r),this.zoomStatusMap.isMouseDowned=!1,this.isDrawEnable()){var o=this.getFileInfo(this.getCurrentFile());if(o&&!h.isDisableDrawFileType(o.type)){t=this.store.getType();var n=this.getEventLocation(r);if(-1e6!=n.x||-1e6!=n.y)if(_=!0,s=!1,"mouse"!=t){var u=n.x,p=n.y,f=n.clientX,T=n.clientY;if("line"==t){if(!g)return;this.store.isHandwritingEnable()?(this.hasOptimizeEnd=!1,b.apply(this,[u,p])):(m.beginPath(),m.moveTo(d/1e4*this.width,c/1e4*this.height),m.lineTo(u/1e4*this.width,p/1e4*this.height),m.strokeStyle=e,m.lineWidth=Math.max(i/1e4*this.height,this.minLineWidth),m.lineCap="round",m.stroke(),this.store.collectLineData().end(u,p,i,this.store.isHandwritingEnable())),h.isMobile()&&this.store.collectRaserData().end(u,p,this.getToolType(),"finger"!==this.isTouchType)}else if("eraser"==t)this.store.collectEraserData(u,p);else if("raser"==t)this.store.collectRaserData().end(u,p,this.getToolType(),"finger"!==this.isTouchType);else if("select"!=t||this.isMoving)if("pointselect"!=t||this.isMoving)t.indexOf("graph-")>-1?this.store.collectGraphData().end(u,p):"zoom"===t?(this.isDragMoving?this.zoomStatusMap.isMoved=!0:this.zoomStatusMap.isMoved=!1,this.isDragMoving=!1,h.isMobile()?this.store.collectDragData().touchEnd(this.pinchScale):this.zoomStatusMap.isMoved?(this.store.collectDragData().end(),null!=this.scaleIcons.enlarge&&(this.store.setCursorIcon(Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG,{cursor:"url",url:this.scaleIcons.enlarge}),this.updateCursor())):(this.zoomStatusMap.isShiftPressed&&(this.scaleRatio=-Math.abs(this.scaleRatio)),this.focusScale(r,this.scaleRatio))):"custom-graph"===t&&this.store.collectCustomGraph().end(u,p);else if(1===this.selectToolType){if(!g)return;this.store.collectSelectData().end(a,l,u,p)}else this.store.collectPointSelectData(u,p);else if(1===this.selectToolType&&0===Math.abs(this.dragStartX-f)&&0===Math.abs(this.dragStartY-T)&&(this.selectToolType=0),1===this.selectToolType){if(!g)return;this.store.collectSelectData().end(a,l,u,p)}else this.store.collectPointSelectData(u,p);this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo()),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.store.canRedo())}else P.sendMouseEvent(this.iframeDOM,{type:r.type,x:n.x,y:n.y,touch:h.extractTouch(r)})}}}function S(t){if(y(t),this.isDrawEnable()){var i=this.getFileInfo(this.getCurrentFile());if(i&&!h.isDisableDrawFileType(i.type)){var r=this.store.getType(),o=this.getEventLocation(t);if(-1e6!=o.x||-1e6!=o.y)if("mouse"!=r){var n=o.x,f=o.y;if(g=!1,1==s){var _;if("line"==r)if(_=this.store.getThin(),n=h.getEffectivePoint(n,_),f=h.getEffectivePoint(f,_),this.store.isHandwritingEnable())this.hasOptimizeEnd=!1,b.apply(this,[n,f]);else{if(u>=0&&p>=0){var T=(u+n)/2,v=(p+f)/2;m.beginPath(),m.moveTo(d/1e4*this.width,c/1e4*this.height),m.quadraticCurveTo(u/1e4*this.width,p/1e4*this.height,T/1e4*this.width,v/1e4*this.height),m.strokeStyle=e,m.lineWidth=Math.max(_/1e4*this.height,this.minLineWidth),m.lineCap="round",m.stroke(),d=T,c=v}u=n,p=f,m.beginPath(),m.moveTo(d/1e4*this.width,c/1e4*this.height),m.lineTo(n/1e4*this.width,f/1e4*this.height),m.strokeStyle=e,m.lineWidth=Math.max(_/1e4*this.height,this.minLineWidth),m.lineCap="round",m.stroke(),this.store.collectLineData().over(n,f,_)}else"raser"==r||("select"==r&&!this.isMoving||"pointselect"==r&&!this.isMoving?this.store.collectSelectData().end(a,l,n,f):r.indexOf("graph-")>-1?(_=this.store.getThin(),n=h.getEffectivePoint(n,_),f=h.getEffectivePoint(f,_),this.store.collectGraphData().over(n,f)):"zoom"===r&&(h.isMobile()||this.store.collectDragData().over()));this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),"line"==r&&(s=!1),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo()),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.store.canRedo())}else"line"==r&&this.updateCursor();"raser"!=r&&"line"!=r||(function(){}.apply(this),this.store.collectRaserData().over(this.getToolType()))}else P.sendMouseEvent(this.iframeDOM,{type:t.type,x:o.x,y:o.y,touch:h.extractTouch(t)})}}}function b(t,r){var o=h.getTimeStamp();this.pointCount++;var n=Math.sqrt(Math.pow(this.preLinePoint.x-t,2)+Math.pow(this.preLinePoint.y-r,2)),s=o-this.preLineTimestamp;if((s<20||n<5)&&this.hasOptimizeEnd)this.ignorePointCount++;else{var a=.1*n,l=n/s,f=i;if(0!=this.preSpeed&&(f=Math.min(this.preSpeed/l*i,i),Math.abs(this.preWidth-f)>a&&(f=this.preWidth<f?this.preWidth+a:this.preWidth-a)),f=Math.floor(f),this.hasOptimizeEnd||(t=t<d?Math.floor(t+Math.max(t-d,-50)*f/i*2):Math.floor(t+Math.min(t-d,50)*f/i*2),r=r<c?Math.floor(r+Math.max(r-c,-50)*f/i*2):Math.floor(r+Math.min(r-c,50)*f/i*2),(isNaN(t)||isNaN(r))&&(t=Math.floor(d),r=Math.floor(c))),u>=0&&p>=0){for(var g=(u+t)/2,_=(p+r)/2,y=d,T=c,v=.05;v<1.05;v+=.05){var E=Math.pow(1-v,2)*d+2*v*(1-v)*u+Math.pow(v,2)*g,S=Math.pow(1-v,2)*c+2*v*(1-v)*p+Math.pow(v,2)*_,b=this.preWidth+(f-this.preWidth)*v;this.hasOptimizeStart||(b=Math.min(f/3+f*v,f)),this.hasOptimizeEnd||(b=this.preWidth-this.preWidth*v),m.beginPath(),m.moveTo(y/1e4*this.width,T/1e4*this.height),m.lineTo(E/1e4*this.width,S/1e4*this.height),m.strokeStyle=e,m.lineWidth=Math.max(b/1e4*this.height,this.minLineWidth),m.lineCap="round",m.stroke(),y=E,T=S}d=g,c=_,this.hasOptimizeStart||(this.hasOptimizeStart=!0)}u=t,p=r,this.preLineTimestamp=o,this.preLinePoint={x:t,y:r},this.preSpeed=l,this.preWidth=f,this.hasOptimizeEnd?this.store.collectLineData().draw(t,r,f):(this.hasOptimizeEnd=!0,this.store.collectLineData().end(t,r,f,this.store.isHandwritingEnable()))}}fe.prototype.moveBoard=function(t,e,i){"number"!=typeof this.dragStartX&&(this.dragStartX=0,this.dragStartY=0);var r=this.dragStartX+t,o=this.dragStartY+e;h.isMobile()&&this.pinchScale.length?this.store.collectDragData().scaleDraw(this.beforePinchScale,this.pinchScale):(this.store.collectDragData().draw(i,r,o,this.dragStartX,this.dragStartY),this.dragStartX=r,this.dragStartY=o,this.draw())},fe.prototype.focusScale=function(t,e){var i=t.currentTarget,r=this.container.clientWidth,o=0,n=0,s=parseInt(i.style.width),a=parseInt(i.style.height),l=r*a/s;s<=r?(o=t.offsetX,n=t.offsetY):(o=t.offsetX+(s-r)/2,n=t.offsetY+(a-l)/2);var d=o-s/2,c=n-a/2,u=o/s,p=n/a,f=this.getBoardScale();this.setBoardScale(f+e);var g,_,m=parseInt(i.style.width),y=parseInt(i.style.height);g=d-(m*u-m/2),_=c-(y*p-y/2),this.moveBoard(g,_,t),h.isMobile()?this.store.collectDragData().touchEnd(this.pinchScale):this.store.collectDragData().end()}},fe.prototype.render=function(){try{this.store.getNeedDraw()||this.store.getIncreasingDraw()||this.store.getPartDraw()||this.store.getLaserDraw()?(this.draw(),this.store.setIncreasingDraw(!1),this.store.setPartDraw(!1),this.store.setNeedDraw(!1),this.store.setLaserDraw(!1)):Number(this.container.dataset.beforeClientWidth||0)===this.container.clientWidth&&Number(this.container.dataset.beforeClientHeight||0)===this.container.clientHeight||(this.store.setNeedDraw(!0),this.container.dataset.beforeClientWidth=this.container.clientWidth,this.container.dataset.beforeClientHeight=this.container.clientHeight)}catch(i){var t=i.stack,e=i.message;this.store.machineNotify("markdown",'白板渲染错误\n              \n>version：<font color="#ff0000">'.concat(o.VERSION,'</font>\n              \n>sdkAppId：<font color="#ff0000">').concat(this.option.sdkAppId,'</font>\n              \n>userId：<font color="#ff0000">').concat(this.option.userId,'</font>\n              \n>classId：<font color="#ff0000">').concat(this.option.classId,'</font>\n              \n>信息：<font color="#ff0000">').concat(e,'</font>\n              \n>堆栈：<font color="#ff0000">').concat(t,"</font>")),this.elkLog.report("drawerror",{boardid:this.store.getCurrentBoard(),extra_info:JSON.stringify({stack:t,message:e})})}},fe.prototype.getDrawWidth=function(t,e,i,r,o,n){var s=Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))/o;return n*((2-(s=s>2?2:s))/2)},fe.prototype.reportContainerSize=function(){this.container&&this.elkLog.report("resize",{extra_info:JSON.stringify({width:this.container.clientWidth,height:this.container.clientHeight})})},fe.prototype.windowResizeListener=function(){var t=this,e=null;clearTimeout(e),e=setTimeout((function(){t.resize()}),200),this.reportContainerSize()},fe.prototype.windowMessageListener=function(t){if(t.data){var e,i=t.data.module,r=t.data.cmd,o=t.data.data;if(Q===i)switch(r){case"init":try{var n=JSON.parse(o),s=n.title,a=n.count,l=n.url,d=n.width,u=n.height,p=n.slideStepData,f=h.parseQueryString(decodeURIComponent(l)).fid;1==this.checkH5PPTStatus.status&&this.checkH5PPTStatus.fid==f&&(this.checkH5PPTStatus.status=2,this.event.fire(this,c.TEB_H5PPT_STATUS_CHANGED,Vt.TEDU_BOARD_H5_PPT_STATUS_LOADED,{fid:f,message:""}));var g=f.replace("#","");s=this.taskIdTitleMap[g]||s;var _=document.querySelector("#preiframe-"+g);if(_&&_.remove(),(e=this.store.getFileInfo(f))&&e.fid?P.setFid(this.iframeDOM,e.fid):(this.isRenderFace||(l&&l.indexOf("?")>-1&&(l=l.substring(0,l.indexOf("?"))),this.store.addH5PPTFile(f,l,s,a,d,u,!0,this.addFileNeedSwitchMap[f])),P.setFid(this.iframeDOM,f),e=this.store.getFileInfo(f)),e)e.slideStepData=p;else{var m=JSON.parse(JSON.stringify(this.getGroup()));m.forEach((function(t){delete t.boardInfoList})),this.elkLog.report("iframe_cmd_init",{action_result:-2,boardid:this.getCurrentBoard(),file_id:f,extra_info:JSON.stringify({title:s,count:a,url:l,width:d,height:u,slideStepData:p,fileList:m})})}this.elkLog.report("iframe_cmd_init",{boardid:this.getCurrentBoard(),file_id:f,extra_info:JSON.stringify({title:s,count:a,url:l,width:d,height:u,slideStepData:p})}),e&&e.slideStepData&&this.event.fire(this,"TEB_GOTOSTEP",e.currentPageStep,e.slideStepData[e.currentPageIndex])}catch(t){this.elkLog.report("iframe_cmd_init",{boardid:this.getCurrentBoard(),action_result:-1,extra_info:JSON.stringify({stack:t.stack,message:t.message})})}break;case"slideStepChangeEvent":this.store.switchH5Board(o),(e=this.getFileInfo(o.fid))&&e.slideStepData&&this.event.fire(this,"TEB_GOTOSTEP",o.stepIndex,e.slideStepData[o.slideIndex+""]);break;case"assets_loading_error":this.elkLog.report("assets_loading_error",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify(o)}),1!=this.checkH5PPTStatus.status&&2!=this.checkH5PPTStatus.status||this.checkH5PPTStatus.fid!=o.fid||(this.event.fire(this,c.TEB_H5PPT_STATUS_CHANGED,Vt.TEDU_BOARD_H5_PPT_STATUS_RESOURCES_LOADING_ERROR,o),this.checkH5PPTStatus.status=5,this.resetPPTIframe());break;case"assets_loading_timeout":this.elkLog.report("assets_loading_timeout",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify(o)}),1!=this.checkH5PPTStatus.status&&2!=this.checkH5PPTStatus.status||this.checkH5PPTStatus.fid!=o.fid||(this.event.fire(this,c.TEB_H5PPT_STATUS_CHANGED,Vt.TEDU_BOARD_H5_PPT_STATUS_TIMEOUT,o),this.checkH5PPTStatus.status=4,this.resetPPTIframe());break;case"runtime_error":this.elkLog.report("runtime_error",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify(o)}),1!=this.checkH5PPTStatus.status&&2!=this.checkH5PPTStatus.status||this.checkH5PPTStatus.fid!=o.fid||(this.event.fire(this,c.TEB_H5PPT_STATUS_CHANGED,Vt.TEDU_BOARD_H5_PPT_STATUS_RUNTIME_ERROR,o),this.checkH5PPTStatus.status=6);break;case"ppt_action":this.elkLog.report("ppt_action",{boardid:this.getCurrentBoard(),extra_info:JSON.stringify(o)}),this.store.pptAction(o)}else if(Z===i){var y=t.data.id;switch(r){case K.TIW_H5WEB_DATA:this.store.h5WebAction(y,o)}}}},fe.prototype.setColor=function(t){this.store.setColor(t)},fe.prototype.setThin=function(t){this.store.setThin(t)},fe.prototype.setTextSize=function(t){var e=this.textAreaFocusBlurStatus.focus;if(this.store.setTextSize(t),this.textAreaFocusBlurStatus.focus){e.textItem.textSize=this.getTextSize();var i=this.getTextSize()/1e4*this.height/12;e.setFontScale(i),e.smartPaintText(),this.store.collectTextInputData().draw(e,e.textItem,e.textItem.text,e.dom.clientWidth+12,e.dom.clientHeight)}},fe.prototype.getTextSize=function(){return this.store.getTextSize()},fe.prototype.setTextColor=function(t){var e=this.textAreaFocusBlurStatus.focus;this.store.setTextColor(t),this.textAreaFocusBlurStatus.focus&&(e.textItem.color=this.getTextColor(),e.setTextStyle(),this.store.collectTextInputData().draw(e,e.textItem,e.textItem.text,e.dom.clientWidth+12,e.dom.clientHeight))},fe.prototype.getTextColor=function(){return this.store.getTextColor()},fe.prototype.setType=function(t){this.inputBlur();var e=["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM","GRAPH-SQUARE","GRAPH-SQUARE-SOLID","GRAPH-CIRCLE","GRAPH-CIRCLE-SOLID","CUSTOM-GRAPH"];this.store.setType(f.BOARD_ACTION_TYPE[e[t]]),"inputtext"===f.BOARD_ACTION_TYPE[e[t]]?this.textAreaBox.style.zIndex=100:this.textAreaBox.style.zIndex=9,this.updateCursor(),this.store.setNeedDraw(!0)},fe.prototype.setNextTextInput=function(t,e){this.store.nextInputObj.text=t,this.store.nextInputObj.keepFocus=e},fe.prototype.undo=function(){this.inputBlur(),this.store.undo()},fe.prototype.canUndo=function(){return this.store.canUndo()},fe.prototype.redo=function(){this.inputBlur(),this.store.redo()},fe.prototype.canRedo=function(){return this.store.canRedo()},fe.prototype.clear=function(t,e){this.inputBlur(),this.store.clear(t,e)},fe.prototype.clearAll=function(){this.inputBlur(),this.store.clearAll(),this.videoDiv.style.display="none",this.resetVideoStatus(),this.textAreaBox.innerHTML="",this.imageElementWrap.innerHTML="",this.webviewWrap.innerHTML=""},fe.prototype.addBackgroundPic=function(t,e,i){this.store.addBackgroundPic(t,e,i)},fe.prototype._setBackgroundImage=function(t,e){this.store._setBackgroundImage(t,e)},fe.prototype.setBackgroundPic=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER;this.store.setBackgroundPic(t,e,i)},fe.prototype.setBackgroundH5=function(t){this.store.setBackgroundH5(t)},fe.prototype.updateCurrentFillMode=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.TEDU_BOARD_IMAGE_FIT_MODE_CENTER;this.store.updateCurrentFillMode(t)},fe.prototype.deleteBackgroundPic=function(t){this.store.deleteBackgroundPic(t)},fe.prototype.cancelBackgroundPic=function(){this.store.cancelBackgroundPic()},fe.prototype.clearGlobalBgColor=function(){this.store.clearGlobalBgColor()},fe.prototype.cancelSelect=function(){this.store.cancelSelect()},fe.prototype.setDrawEnable=function(t){this.store.setDrawEnable(t),this.teduBoardScroll&&t?this.teduBoardScroll.enableScroll():this.teduBoardScroll.disableScroll(),this.updateCursor()},fe.prototype.setHandwritingEnable=function(t){this.store.setHandwritingEnable(t)},fe.prototype.isHandwritingEnable=function(){return this.store.isHandwritingEnable()},fe.prototype.addFile=function(t,e,i,r,n,s){return this.logger.info(this.loggerModuleName,"addFile",{param:{fid:t,downloadUrl:r,needSwitch:s}}),this.inputBlur(),this.store.addFile(t,e,i,r,n,!0,o.FILE_TYPE.IMG,s)},fe.prototype.addImagesFile=function(t,e,i){var r=this;this.logger.info(this.loggerModuleName,"addImagesFile",{param:{title:e,needSwitch:i}}),this.inputBlur();var n="#".concat(h.getTimeStamp());e=e||"imagesfile_".concat(n);var s=JSON.stringify(t),a=(new Date).getTime(),l=h.compress(s),d=(new Date).getTime(),c=100*l.length/s.length,u=d-a;if(l&&l.length>o.IMAGESFILE_MAX_URL_LENGTH)return setTimeout((function(){r.event.fire(r,"TEB_ERROR",k.TEDU_BOARD_ERROR_DATA_TOO_LARGE,"please try to split into two or more files, or try to use shorter url."),r.elkLog.report("images_file_url_too_large",{extra_info:JSON.stringify({urls:s,urls_len:s.length,compress_len:l.length,compress_ratio:c,elapse:u})})}),0),"";var p=l;if(this.store.isFileUrlExist(p)){var f=this.store.getFileInfoByUrl(p);return n=f.fid,setTimeout((function(){r.event.fire(r,"TEB_WARNING",dt.TEDU_BOARD_WARNING_IMAGESFILE_ALREADY_EXISTS,n),r.elkLog.report("images_file_already_exists",{boardid:r.getCurrentBoard(),file_id:n,extra_info:""})}),0),n}var g=this.store.addFile(n,t,e,p,null,!1,o.FILE_TYPE.IMAGESFILE,i);return this.elkLog.report("add_images_file_start",{file_id:g,extra_info:JSON.stringify({urls:s,urls_len:s.length,compress_len:l.length,compress_ratio:c,elapse:u})}),g},fe.prototype.addH5PPTFile=function(t,e,i){var r=this;this.logger.info(this.loggerModuleName,"addH5PPTFile",{param:{url:t,title:e,needSwitch:i}}),this.inputBlur();var n="#".concat(h.getTimeStamp());if(this.addFileNeedSwitchMap[n]=i,this.store.isFileUrlExist(t)){t&&t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var s=this.store.getFileInfoByUrl(t);return n=s.fid,setTimeout((function(){r.event.fire(r,"TEB_WARNING",dt.TEDU_BOARD_WARNING_H5PPT_ALREADY_EXISTS,n),r.elkLog.report("h5ppt_already_exists",{boardid:r.getCurrentBoard(),file_id:n,extra_info:t})}),0),n}var a,l=n.replace("#","");this.taskIdTitleMap[l]=e,t.indexOf("?")>-1?t+="&page=0&step=0&fid="+encodeURIComponent(n):t+="?page=0&step=0&fid="+encodeURIComponent(n),(a=document.createElement("iframe")).id="preiframe-".concat(l),a.setAttribute("class","tx_board_pre_iframe"),a.setAttribute("style","position:fixed;visibility:hidden;width:0px;height:0px;border:none;"),document.body.appendChild(a),this.isRenderFace=!1,this.elkLog.report("iframe_pre_start_load",{file_id:n,extra_info:t});var d=this;return a.onload=function(){this.src==o.ABOUTBLANK||this.src&&(P.init(a,{isFirstLoad:!0}),d.elkLog.report("iframe_pre_load_done",{file_id:n,extra_info:this.src}))},a.setAttribute("src",t),n},fe.prototype.addVideoFile=function(t){var e=this;this.inputBlur();var i="#".concat(h.getTimeStamp());if(this.store.isFileUrlExist(t)){var r=this.store.getFileInfoByUrl(t);return i=r.fid,setTimeout((function(){e.event.fire(e,"TEB_WARNING",dt.TEDU_BOARD_WARNING_VIDEO_ALREADY_EXISTS,i),e.elkLog.report("video_already_exists",{file_id:i,extra_info:t})}),0),i}return this.resetVideoStatus(),this.stopSyncVideoStatus(),this.videoStatus.fid=i,this.videoStatus.url=t,this.videoStatus.format=this.getVideoFormat(t),this.videoStatus.type=this.getVideoType(t),this.videoStatus.actions.create=o.VIDEO_ACTION.API,this.store.addVideoFile(i,t,this.boardBaseWidth,this.boardBaseHeight,this.videoStatus.type),this.createVideo(i,t),i},fe.prototype.addVODFile=function(t,e,i){var r=this;this.inputBlur();var n="#".concat(h.getTimeStamp()),s="".concat(t,"_").concat(e,"_").concat(null!=i?"true":"false");if(this.store.isFileUrlExist(s)){var a=this.store.getFileInfoByUrl(s);return n=a.fid,setTimeout((function(){r.event.fire(r,"TEB_WARNING",dt.TEDU_BOARD_WARNING_VIDEO_ALREADY_EXISTS,n),r.elkLog.report("video_already_exists",{file_id:n,extra_info:s})}),0),n}return this.resetVideoStatus(),this.stopSyncVideoStatus(),this.videoStatus.fid=n,this.videoStatus.url=s,this.videoStatus.type=o.FILE_TYPE.VODFILE,this.videoStatus.extParam=i,this.videoStatus.actions.create=o.VIDEO_ACTION.API,this.store.addVideoFile(n,s,this.boardBaseWidth,this.boardBaseHeight,this.videoStatus.type),this.createVodVideo(n,s,i),n},fe.prototype.addH5File=function(t){var e=this;this.logger.info(this.loggerModuleName,"addH5File",{param:{url:t}}),this.inputBlur();var i="#".concat(h.getTimeStamp());if(this.store.isFileUrlExist(t)){var r=this.store.getFileInfoByUrl(t);return i=r.fid,setTimeout((function(){e.event.fire(e,"TEB_WARNING",dt.TEDU_BOARD_WARNING_H5FILE_ALREADY_EXISTS,i),e.elkLog.report("h5file_already_exists",{file_id:i,extra_info:t})}),0),i}var o=this.boardWrap.clientWidth,n=this.boardWrap.clientHeight;return this.store.addH5File(i,t,o,n),i},fe.prototype.deleteFile=function(t){return this.logger.info(this.loggerModuleName,"deleteFile",{param:{fid:t}}),this.inputBlur(),this.store.deleteFile(t)},fe.prototype.switchFile=function(t,e,i){var r=this;this.logger.info(this.loggerModuleName,"switchFile",{param:{fid:t,boardId:e,setpIndex:i}}),t&&t!=this.store.getCurrentFile()&&(clearTimeout(this.pptH5LoadTask),this.resetPPTIframe(),this.backgroundIFrameManager.remove(this.boardBox),this.pptH5LoadTask=setTimeout((function(){r.store.switchFile(t,e,i)}),50),this.videoPlayer&&this.videoPlayer.pause())},fe.prototype.getFileInfoList=function(){return this.store.getFileInfoList()},fe.prototype.getGroup=function(){return this.store.getGroup()},fe.prototype.getFileInfo=function(t){return this.store.getFileInfo(t)},fe.prototype.getBoardInfoList=function(t){return this.store.getBoardInfoList(t)},fe.prototype.getBoardByGroup=function(t){return this.store.getBoardByGroup(t)},fe.prototype.clearFileDraws=function(t){return this.inputBlur(),this.store.clearFileDraws(t)},fe.prototype.needLayout=function(t,e,i,r,o,n){return t=Math.ceil(t),e=Math.ceil(e),r=Math.ceil(r),i=Math.ceil(i),o=Math.ceil(o),(t!=this.preLayout.width||e!=this.preLayout.height||r!=this.preLayout.left||i!=this.preLayout.top||o!=this.preLayout.scale||n!=this.preLayout.ratio)&&(this.preLayout.width=t,this.preLayout.height=e,this.preLayout.left=r,this.preLayout.top=i,this.preLayout.scale=o,this.preLayout.ratio=n,!0)},fe.prototype.layout=function(t){var e=this.container.clientWidth,i=this.container.clientHeight;if(0==e||0==i)return!1;var r=o.SCALE,n=o.LEFT,s=o.TOP,a=o.RATIO,l=new he(e,i,this.option.ratio,r,s,n);this.boardBaseHeight=l.height,this.boardBaseWidth=l.width,r=this.store.getBoardScale();var h=this.store.getDragData();h&&(n=h.xOffset,s=h.yOffset,r=h.scale),a=t&&t.ratio||this.store.getBoardRatio();var d,c,u,p,f=new he(e,i,a,r,s,n),g=f.width,_=f.height,m=f.ratioWidth,y=f.ratioHeight;this.width=Math.ceil(g*r/100),this.height=Math.ceil(_*r/100),this.width%2==1&&(this.width+=1),this.height%2==1&&(this.height+=1),this.store.setContainerSize(e,i),this.store.setBoardSize(this.width,this.height),this.width/this.height>e/i?(this.height>i?(u=50+(this.height-i)/2/this.height*100,p=50-(this.height-i)/2/this.height*100):(u=50,p=50),d=50+(this.width-e)/2/this.width*100,c=50-(this.width-e)/2/this.width*100):(u=50+(this.height-i)/2/this.height*100,p=50-(this.height-i)/2/this.height*100,this.width>e?(d=50+(this.width-e)/2/this.width*100,c=50-(this.width-e)/2/this.width*100):(d=50,c=50)),this.moveDragArea={minLeft:c,maxLeft:d,minTop:p,maxTop:u},n=Math.min(d,Math.max(c,n)),s=Math.min(u,Math.max(p,s)),h&&this.store.dragDataList.updateDragData(this.getCurrentBoard(),{xOffset:n,yOffset:s});var T,v,E=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||1;e/i>this.width/this.height?e>this.width?(T=this.width,v=this.width*y/m):e<this.width?(T=e,v=e*y/m):(T=this.width,v=this.height):i>this.height?(T=this.height*m/y,v=this.height):i<this.height?(T=i*m/y,v=i):(T=this.width,v=this.height);var S=this.width*(n-50)/100,b=this.height*(s-50)/100,O="position:relative !important;left: ".concat(this.container.clientWidth/2,"px !important;top: ").concat(this.container.clientHeight/2,"px !important;-webkit-transform: translateX(-50%) translateY(-50%) !important;transform: translateX(-50%) translateY(-50%) !important;overflow:hidden !important;width:").concat(this.width,"px !important;height:").concat(this.height,"px !important"),D="position:absolute !important;left: ".concat(n,"% !important;top:").concat(s,"% !important;-webkit-transform: translateX(-50%) translateY(-50%) !important;transform: translateX(-50%) translateY(-50%) !important;width:").concat(this.width,"px !important;height:").concat(this.height,"px !important;cursor:").concat(this.boardBox.style.cursor,";"),A="z-index:10 !important;position:absolute !important;left:0 !important;top:0 !important;margin-left:".concat((this.width-T)/2,"px !important;margin-top:").concat((this.height-v)/2,"px !important;line-height:1 !important;width:").concat(T,"px !important;height:").concat(v,"px !important;");this.boardWrap&&this.boardWrap.setAttribute("style",O),this.boardBox&&this.boardBox.setAttribute("style",D),this.laserWrap&&this.laserWrap.setAttribute("style","left: ".concat(n,"% !important;top:").concat(s,"% !important;")),this.audioWrap&&this.audioWrap.setAttribute("style","left: ".concat(n,"% !important;top:").concat(s,"% !important;")),this.webviewWrap&&this.webviewWrap.setAttribute("style",D),this.imageElementWrap&&this.imageElementWrap.setAttribute("style",D+"z-index:7;"),this.cursorLayerWrap&&this.cursorLayerWrap.setAttribute("style",D+"z-index:0;user-select:none;-webkit-user-select:none;"),11===this.getToolType()?this.textAreaBox&&this.textAreaBox.setAttribute("style",D+"z-index:100;overflow:hidden;"):this.textAreaBox&&this.textAreaBox.setAttribute("style",D+"z-index:9;overflow:hidden;");var I="z-index:200 !important; display:".concat(this.progress.style.display,"; position:absolute !important;left: 50% !important;top: 50% !important;-webkit-transform: translateX(-50%) translateY(-50%) !important;transform: translateX(-50%) translateY(-50%) !important;overflow:hidden !important;");if(this.progress&&this.progress.setAttribute("style",I),this.bgDiv&&this.bgDiv.setAttribute("width",this.width),this.bgDiv&&this.bgDiv.setAttribute("height",this.height),this.iframeDOM&&this.iframeDOM.setAttribute("style","position: absolute !important;top: 0 !important;left: 0 !important;width:".concat(this.width,"px !important;height:").concat(this.height,"px !important;border:none !important;z-index:8 !important;")),this.videoStatus.isCreated&&this.videoDiv.setAttribute("style","z-index:20; position:absolute; top:0; left:0; height:".concat(this.height,"px; width:").concat(this.width,"px; display:block")),this.h5Iframe&&this.h5Iframe.layout(T,v),r===o.SCALE?this.teduBoardScroll.setScrollBarSize(this.container.clientWidth,this.container.clientHeight):this.teduBoardScroll.setScrollBarSize(this.width,this.height),u!=p){var x=(this.height-this.container.clientHeight)*(1-(s-p)/(u-p)),w=(this.width-this.container.clientWidth)*(1-(n-c)/(d-c)),R=Math.floor(x),C=Math.floor(w);this.teduBoardScroll.scrollToScrollBar(C,R)}this.updateCursor();var B=this.needLayout(e,i,s,n,r,a);if(this.laserCanvas&&B){this.laserCanvas.setAttribute("width",T*E),this.laserCanvas.setAttribute("height",v*E);var L="z-index:15 !important;position:absolute !important;left:0 !important;top:0 !important;margin-left:".concat((this.width-T)/2,"px !important;margin-top:").concat((this.height-v)/2,"px !important;line-height:1 !important;width:").concat(T,"px !important;height:").concat(v,"px !important;cursor:").concat(this.laserCanvas.style.cursor);this.laserCanvas.setAttribute("style",L);var P=this.laserCanvas.getContext("2d");P.translate(((T-g)/2-(r/100-1)*g/2+S)*E,((v-_)/2-(r/100-1)*_/2+b)*E),P.scale(E,E)}if(this.el&&B){this.el.setAttribute("style",A),this.el.setAttribute("width",T*E),this.el.setAttribute("height",v*E);var N=this.el.getContext("2d");N.translate(((T-g)/2-(r/100-1)*g/2+S)*E,((v-_)/2-(r/100-1)*_/2+b)*E),N.scale(E,E)}return B},fe.prototype.drawLaser=function(t){this.maxLaserSeq=t.seq,(this.laserCanvas&&this.laserCanvas.getContext("2d")).clearRect(-5,-5,this.width+10,this.height+10);var e=0,i=0,r=1,n=this.laserCursorMap.get(t.user);if("url"!=this.store.getCursorIcons()[t.toolType>3||t.toolType<1?1:t.toolType].cursor)return this.laserCursorMap.delete(t.user),void(n&&n.remove());if(t.action==o.PROTOCOL_ACTION.RASER_SHOW_ACTION&&t.location.x>=0&&t.location.y>=0){var s,a;s=(a=3==t.toolType?this.remoteLaserIcon:this.remotePenIcon).src,n||(n=new pe(this.laserWrap,t),this.laserCursorMap.set(t.user,n));try{var l=this.store.getSystemCursorEnable(),h=t.user===this.option.userId;h&&l?(e=Math.min(o.ICONS[String(t.toolType)].offsetX,a.naturalWidth),i=Math.min(o.ICONS[String(t.toolType)].offsetY,a.naturalHeight)):(r=this.boardBaseWidth*a.naturalWidth/800/a.naturalWidth,e=this.boardBaseWidth*(o.ICONS[String(t.toolType)].offsetX||0)/800+a.naturalWidth*(1-r)/2,i=this.boardBaseWidth*(o.ICONS[String(t.toolType)].offsetY||0)/800+a.naturalHeight*(1-r)/2);var d=t.location.x/1e4*this.width,c=t.location.y/1e4*this.height;n.move(l,h,s,t.title,t.style,d-e,c-i,r)}catch(t){}}else this.laserCursorMap.delete(t.user),n&&n.remove()},fe.prototype.drawLine=function(t,e){var i=this,r=null;if(e.lines[0].timestamp&&this.fpsOptimization&&!this.store.getNeedDraw()){var n=e.drawIndex;if(this.store.getPartDraw()){(r=new m("",e)).lines=[];for(var s=0;s<n;s++)r.lines.push(e.lines[s])}else{if(n==e.lines.length)return;(r=new m("",e)).lines=[],n-2>=0&&r.lines.push(e.lines[n-2]),n-1>=0&&r.lines.push(e.lines[n-1])}if(n<e.lines.length){for(var a=Math.ceil((this.preRenderCost+1)/(.75*o.RENDER_INTERVAL));a>0&&n<e.lines.length;){var l=e.lines[n];r.lines.push(l),e.drawIndex=++n,a--}n<e.lines.length&&setTimeout((function(){i.store.setIncreasingDraw(!0)}),0)}}else e.drawIndex=e.lines.length,r=e;if(0!=r.lines.length)if(r.writing){if(1==r.lines.length)return;if(2==r.lines.length){if(r.lines[0].x==r.lines[1].x&&r.lines[0].y==r.lines[1].y)return;if(r.lines[1].action==o.PROTOCOL_ACTION.LINE_MOVE_ACTION)return}var h=!0,d=!0,c=r.thin,u=r.color,p=0,f=0;r.lines[0].action==o.PROTOCOL_ACTION.LINE_START_ACTION?(p=r.lines[0].x,f=r.lines[0].y):(p=(r.lines[0].x+r.lines[1].x)/2,f=(r.lines[0].y+r.lines[1].y)/2);for(var g=1;g<r.lines.length-1;g++){var _=r.lines[g],y=_.x,T=_.y,v=r.lines[g+1],E=v.x,S=v.y,b=v.w,O=_.w;if(r.lines[g-1].action==o.PROTOCOL_ACTION.LINE_START_ACTION&&(d=!1),v.action==o.PROTOCOL_ACTION.LINE_END_ACTION&&(h=!1),h||(E=E<p?Math.floor(E+Math.max(E-p,-50)*b/c*2):Math.floor(E+Math.min(E-p,50)*b/c*2),S=S<f?Math.floor(S+Math.max(S-f,-50)*b/c*2):Math.floor(S+Math.min(S-f,50)*b/c*2),(isNaN(E)||isNaN(S))&&(E=p,S=f)),y>=0&&T>=0){for(var D=(y+E)/2,A=(T+S)/2,I=p,x=f,w=.05;w<1.05;w+=.05){var R=Math.pow(1-w,2)*p+2*w*(1-w)*y+Math.pow(w,2)*D,C=Math.pow(1-w,2)*f+2*w*(1-w)*T+Math.pow(w,2)*A,B=O+(b-O)*w;d||(B=Math.min(b/3+b*w,b)),h||(B=O-O*w),t.beginPath(),t.moveTo(I/1e4*this.width,x/1e4*this.height),t.lineTo(R/1e4*this.width,C/1e4*this.height),t.strokeStyle=u,t.lineWidth=Math.max(B/1e4*this.height,this.minLineWidth),t.lineCap="round",t.stroke(),I=R,x=C}p=D,f=A}d||(d=!0),h||(h=!0)}}else{var L=Math.max(r.thin/1e4*this.height,this.minLineWidth);if(t.lineWidth=L,t.lineCap="round",t.strokeStyle=r.color,t.fillStyle=r.color,t.beginPath(),1==r.lines.length)return void(r.lines[0].action==o.PROTOCOL_ACTION.LINE_START_ACTION&&(t.arc(r.lines[0].x/1e4*this.width,r.lines[0].y/1e4*this.height,t.lineWidth/2,0,2*Math.PI,!0),t.fill(),t.closePath()));if(2==r.lines.length){if(r.lines[0].x==r.lines[1].x&&r.lines[0].y==r.lines[1].y)return t.arc(r.lines[0].x/1e4*this.width,r.lines[0].y/1e4*this.height,t.lineWidth/2,0,2*Math.PI,!0),t.fill(),void t.closePath();if(1==r.lines[0].action&&3==r.lines[1].action)t.moveTo(r.lines[0].x/1e4*this.width,r.lines[0].y/1e4*this.height),t.lineTo(r.lines[1].x/1e4*this.width,r.lines[1].y/1e4*this.height);else if(2==r.lines[1].action)return}if(r.lines[0].action==o.PROTOCOL_ACTION.LINE_START_ACTION){var P=r.lines[0].x,N=r.lines[0].y;t.moveTo(P/1e4*this.width,N/1e4*this.height)}else{var M=(r.lines[0].x+r.lines[1].x)/2,k=(r.lines[0].y+r.lines[1].y)/2;t.moveTo(M/1e4*this.width,k/1e4*this.height)}for(var q=1;q<r.lines.length-1;q++){var U=r.lines[q],F=r.lines[q+1],H=(U.x+F.x)/2/1e4*this.width,G=(U.y+F.y)/2/1e4*this.height;t.quadraticCurveTo(U.x/1e4*this.width,U.y/1e4*this.height,H,G)}var W=r.lines[r.lines.length-1];W.action==o.PROTOCOL_ACTION.LINE_END_ACTION&&t.lineTo(W.x/1e4*this.width,W.y/1e4*this.height),t.stroke()}},fe.prototype.isDrawEnable=function(){return this.store.isDrawEnable()},fe.prototype.getGlobalBackgroundColor=function(){return this.store.getGlobalBackgroundColor()},fe.prototype.getBackgroundColor=function(){return this.store.getBackgroundColor()},fe.prototype.getToolType=function(){var t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t,e){return t===e};return Object.keys(f.BOARD_ACTION_TYPE).find((function(i){return e(f.BOARD_ACTION_TYPE[i],t)}))}(this.store.getType());return["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM","GRAPH-SQUARE","GRAPH-SQUARE-SOLID","GRAPH-CIRCLE","GRAPH-CIRCLE-SOLID","CUSTOM-GRAPH"].indexOf(t)},fe.prototype.getBrushColor=function(){return this.store.getColor()},fe.prototype.getBrushThin=function(){return this.store.getThin()},fe.prototype.setDataSyncEnable=function(t){this.store.setDataSyncEnable(t)},fe.prototype.isDataSyncEnable=function(){return this.store.isDataSyncEnable()},fe.prototype.setAccessibleUsers=function(t){this.store.setAccessibleUsers(t)},fe.prototype.setTextFontFamily=function(t){this.store.setTextFontFamily(t)},fe.prototype.getTextFontFamily=function(){return this.store.getTextFontFamily()},fe.prototype.setTextFontStyle=function(t){this.store.setTextFontStyle(t)},fe.prototype.getTextFontStyle=function(){return this.store.getTextFontStyle()},fe.prototype.setBoardRatio=function(t){h.validateRatio(t)&&(this.inputBlur(),this.store.setBoardRatio(this.store.getCurrentBoard(),t),this.draw())},fe.prototype.getBoardRatio=function(){return this.store.getBoardRatio()||this.option.ratio},fe.prototype.setBoardScale=function(t){this.inputBlur(),this.store.setBoardScale(t),this.draw()},fe.prototype.getBoardScale=function(){return this.store.getBoardScale()},fe.prototype.setBoardContentFitMode=function(t){this.store.setBoardContentFitMode(t)},fe.prototype.getBoardContentFitMode=function(){return this.store.getBoardContentFitMode()},fe.prototype.setLineStyle=function(t){this.store.setLineStyle(t)},fe.prototype.getLineStyle=function(){return this.store.getLineStyle()},fe.prototype.setOvalDrawMode=function(t){this.store.setOvalDrawMode(t)},fe.prototype.getOvalDrawMode=function(){return this.store.getOvalDrawMode()},fe.prototype.syncRemoteTime=function(t,e){this.elkLog.report("call_method",{extra_info:JSON.stringify({method:"syncRemoteTime",data:{userId:t,timestamp:e}})}),this.checkUserTime(t),this.userTime[t].avTimeOffset=h.getTimeStamp()-e},fe.prototype.checkUserTime=function(t){this.userTime[t]||(this.userTime[t]={avTimeOffset:0,imTimeOffset:0})},fe.prototype.getSyncTime=function(){return h.getTimeStamp()},fe.prototype.updateCursor=function(){if(this.boardBox){var t=this.getToolType(),e=this.store.getCursorIcons()[t];if(e){var i="";e.hasOwnProperty("cursor")&&(i=this.store.getSystemCursorEnable()||1!==t&&3!==t?"url"==e.cursor?"url(".concat(e.url,") ").concat(e.offsetX||0," ").concat(e.offsetY||0,", auto"):e.cursor:"url"===e.cursor&&e.url?this.isDrawEnable()?"url(https://res.qcloudtiw.com/board/icons/none.png) 0 0, none":"default":e.cursor),i&&(this.boardBox.style.cursor&&this.boardBox.style.cursor.replace(/"/g,"")===i.replace(/"/g,"")||(this.boardBox.style.cursor="none",this.boardBox.style.cursor=i,this.boardBox.style.webkitTransform="translateX(-50%) translateY(-50%) !important",this.laserCanvas.style.cursor="none",this.laserCanvas.style.cursor=i,this.textAreaBox.style.cursor="none",this.textAreaBox.style.cursor=i))}else this.boardBox.style.cursor="none",this.laserCanvas.style.cursor="none",this.textAreaBox.style.cursor="none",this.boardBox.style.cursor="auto",this.laserCanvas.style.cursor="auto",this.textAreaBox.style.cursor="auto"}},fe.prototype.pptIframeOnLoad=function(){var t=this.iframeDOM.src;if(t==o.ABOUTBLANK);else if(t){var e=h.parseQueryString(decodeURIComponent(t)).fid;this.elkLog.report("iframe_load_done",{boardid:this.getCurrentBoard(),file_id:e,extra_info:t}),this.store.setNeedDraw(!0),P.init(this.iframeDOM,{isFirstLoad:!0})}this.store.preloadBoard()},fe.prototype.inputBlur=function(){if(1===this.textInputStatus){var t=this.textAreaFocusBlurStatus.focus;t&&t.dom&&t.dom.blur()}},fe.prototype.getThumbnailImages=function(t){var e=this.getFileInfo(t),i=[];if(e){if(e.fid===o.COMMON_GROUP)return i;var r=e.downloadURL;if(!r)return i;if(e.type==o.FILE_TYPE.H5FILE||e.type==o.FILE_TYPE.VOD||e.type==o.FILE_TYPE.LIVE)return i;if(e.type===o.FILE_TYPE.H5PPT){var n="",s=r.match(".*/([0-9a-zA-Z-]+)_tiw/h5/.*");if(s&&s.length>1)n=r.substring(0,r.indexOf("_tiw/h5"))+"_tiw/thumbnail";else{var a=h.extractTaskId(r);n="https://thumbnail.qcloudtiw.com/".concat(a)}for(var l=0;l<e.pageCount;l++)i.push("".concat(n,"/").concat(l+1,".jpg"))}else if(r.endsWith("/")){var d="",c=r.match(".*/([0-9a-zA-Z-]+)_tiw/(picutre|picture)/.*");d=c&&c.length>2?r.indexOf("_tiw/picutre")>-1?r.substring(0,r.indexOf("_tiw/picutre"))+"_tiw/thumbnail/":r.substring(0,r.indexOf("_tiw/picture"))+"_tiw/thumbnail/":r;for(var u=0;u<e.pageCount;u++)i.push("".concat(d).concat(u+1,".jpg"))}else if(h.isCosUrl(r))for(var p=h.fileDownLoadUrlToPreviewUrl(r),f=0;f<e.pageCount;f++)i.push("".concat(p).concat(f+1));return i}return[]},fe.prototype.createTranscode=function(t){return this.store.createTranscode(t)},fe.prototype.describeTranscode=function(t){return this.store.describeTranscode(t)},fe.prototype.setCursorIcon=function(t,e){t==Yt.TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG&&(this.scaleIcons.enlarge=e.url),this.store.setCursorIcon(t,e),this.updateCursorIcons(),this.initRemoteCursorIcon()},fe.prototype.setZoomCursorIcon=function(t,e){this.store.setZoomCursorIcon(t,e),this.scaleIcons.enlarge=t.url,this.scaleIcons.shrink=e.url,this.updateCursorIcons()},fe.prototype.addImageElement=function(t){this.store.addImageElement(t)},fe.prototype.addAckData=function(t){this.store.addSendAckData(t)},fe.prototype.syncAndReload=function(){this.store.syncAndReload()},fe.prototype.refresh=function(){this.resetPPTIframe(),this.resetBackgroundImage(),this.resetBackgroundH5(),this.resetH5IFrame(),this.resetVideoStatus(),this.removeImageElement(!0),this._removeRenderedElement(!0),this.store.setNeedDraw(!0),this.event.fire(this,"TEB_REFRESH"),this.elkLog.report("call_method",{extra_info:JSON.stringify({method:"refresh"})})},fe.prototype.snapshot=function(t){var e=this;window.html2canvas?this.innerSnapshot(t):h.loadJS("https://res.qcloudtiw.com/board/third/html2canvas/html2canvas.min.js",(function(){e.innerSnapshot(t)}))},fe.prototype.innerSnapshot=function(t){var e=this;if(window.html2canvas){var i=[],r=[],o=[];window.html2canvas(this.container,{allowTaint:!0,useCORS:!0,ignoreElements:function(t){var n=t.tagName.toLocaleLowerCase();return"video"===n?("none"!==e.videoDiv.style.display&&"none"!==t.style.display&&t.src&&r.push(t),!0):"canvas"===n?("none"!==t.style.display&&o.push(t),!0):"iframe"===n&&("none"!==t.style.display&&t.src&&i.push(t),!0)}}).then((function(o){var n=window.devicePixelRatio,s=0,a=0,l=0,h=0,d=0,c=0,u=0,p=0,f=e.container.clientWidth*n,g=e.container.clientHeight*n,_=document.createElement("canvas");_.width=f,_.height=g;var m=_.getContext("2d");m.drawImage(o,0,0,f,g),r.forEach((function(t){m.drawImage(t,0,0,f,g)}));var y=[];i.forEach((function(t){var e=new Promise((function(e,i){var r={ack:!1},o=function i(o){if(o.data.data&&o.data.data.src===t.src)if(o.data.cmd===K.TIW_H5WEB_ACK)r.ack=!0,t.contentWindow.postMessage({module:Z,cmd:K.TIW_H5WEB_SNAPSHOT,data:{src:t.src}},"*");else if(o.data.cmd===K.TIW_H5WEB_SNAPSHOT){window.removeEventListener("message",i);var n=o.data.data.dataUrl;if(t&&n){var s=new Image;s.onload=function(){e({iframe:t,image:s})},s.src=n}else e({iframe:t,image:null})}};window.addEventListener("message",o),t.contentWindow.postMessage({module:Z,cmd:K.TIW_H5WEB_SYNC,data:{src:t.src}},"*"),setTimeout((function(){r.ack||(e({iframe:t,image:null}),window.removeEventListener("message",o))}),200)}));y.push(e)})),Promise.all(y).then((function(i){i.forEach((function(t){var i=t.iframe,r=t.image;i&&r&&(s=(e.boardBox.clientWidth-e.container.clientWidth)/2*n-(e.boardBox.offsetLeft-e.boardBox.clientWidth/2)*n,d=s<0?-s:0,s=s<0?0:s,a=(e.boardBox.clientHeight-e.container.clientHeight)/2*n-(e.boardBox.offsetTop-e.boardBox.clientHeight/2)*n,c=a<0?-a:0,a=a<0?0:a,l=e.boardBox.clientWidth>e.container.clientWidth?e.container.clientWidth:e.boardBox.clientWidth,l*=n,h=e.boardBox.clientHeight>e.container.clientHeight?e.container.clientHeight:e.boardBox.clientHeight,u=l,p=h*=n,m.drawImage(r,s,a,l,h,d,c,u,p))})),s=(e.el.clientWidth-e.container.clientWidth)/2*n,d=s<0?-s:0,s=s<0?0:s,a=(e.el.clientHeight-e.container.clientHeight)/2*n,c=a<0?-a:0,a=a<0?0:a,l=e.el.clientWidth>e.container.clientWidth?e.container.clientWidth:e.el.clientWidth,l*=n,h=e.el.clientHeight>e.container.clientHeight?e.container.clientHeight:e.el.clientHeight,u=l,p=h*=n,m.drawImage(e.el,s,a,l,h,d,c,u,p);var r=_.toDataURL();e.event.fire(e,"TEB_SNAPSHOT",{image:r,userData:t?t.userData:""})}))}))}},fe.prototype.resetPPTIframe=function(){this.iframeDOM&&this.iframeDOM.remove(),this.iframeDOM=ee.createElement({sdkAppId:this.option.sdkAppId,userId:this.option.userId,progressBarUrl:this.progressBarUrl}),this.store.setIframeDom(this.iframeDOM),this.iframeDOM.onload=this.pptIframeOnLoad.bind(this),this.boardBox.appendChild(this.iframeDOM)},fe.prototype.resetH5IFrame=function(){this.h5Iframe&&(this.h5Iframe.src="")},fe.prototype.resetBackgroundImage=function(){this.img&&(this.img.src="")},fe.prototype.resetBackgroundH5=function(){this.backgroundIFrameManager.remove(this.boardBox)},fe.prototype.destroy=function(){this.elkLog.report("destroy"),this.videoPlayer&&this.videoPlayer.reset(),this.videoPlayer=null,this.store.destroy(),this.store=null,this.drawTimer&&clearInterval(this.drawTimer),this.pregressTask&&clearTimeout(this.pregressTask),this.syncVideoStatusTimer&&clearInterval(this.syncVideoStatusTimer),window.removeEventListener("message",this.windowMessageListenerBind,!1),window.removeEventListener("resize",this.windowResizeListenerBind,!1),document.body.removeEventListener("mouseup",this.mouseupUpdateCursor,!1),window.removeEventListener("mouseup",this.mouseupUpdateCursor,!1),document.body.removeEventListener("keydown",this.keydownBodyEvent,!1),this.container&&(this.container.innerHTML=""),document.removeEventListener(this.visibilityChangeName,this.visibilityChangeBind)},fe.prototype.addH5Element=function(t){this.store.addH5Element(t)},fe.prototype.renderH5WebElement=function(t){this.store.elementMap.get(String(t.belongSeq))&&t.show?(t.setBoardSize(this.width,this.height),t.setElementSize(),t.renderTo(this.webviewWrap,"mouse"===this.store.getType())):t.remove()},fe.prototype.removeH5WebElement=function(){for(var t=this.webviewWrap.querySelectorAll(':not([data-bid="'.concat(this.getCurrentBoard(),'"])')),e=0;e<t.length;e++)t[e].remove();for(var i=this.webviewWrap.querySelectorAll('[data-bid="'.concat(this.getCurrentBoard(),'"]')),r=0;r<i.length;r++)this.store.elementMap.get(String(i[r].dataset.belongSeq))||i[r].remove();(i=this.webviewWrap.querySelectorAll('[data-bid="'.concat(this.getCurrentBoard(),'"]'))).length?this.webviewWrap.style.zIndex=200:delete this.webviewWrap.style.zIndex},fe.prototype.renderCustomGraph=function(t){this.store.elementMap.get(String(t.belongSeq))&&t.show?(t.setBoardSizeScale(this.width,this.height,this.getBoardScale()),t.renderTo(this.imageElementWrap)):t.remove()},fe.prototype.renderAudio=function(t){this.store.elementMap.get(String(t.belongSeq))&&(t.setBoardSize(this.width,this.height),t.renderTo(this.audioWrap))},fe.prototype.addElement=function(t,e,i){return this.store.addElement(t,e,i)},fe.prototype.removeElement=function(t){var e=this.imageElementMapData[String(t)],i=!1;return e?(e.show=!1,this.store.updateElements([e]),this.store.addRealtimeData(e.getRealTimeData()),this.store.setNeedDraw(!0),this.store.isElementInSelectList(e.belongSeq)&&this.cancelSelect(),i=!0,!0):((i=this.store.removeElement(t))&&this.event.fire(this,c.TEB_REMOVEELEMENT,[String(t)]),i)},fe.prototype.applyFileTranscode=function(t,e){this.store.applyFileTranscode(t,e)},fe.prototype.addTranscodeFile=function(t,e){this.elkLog.report("addTranscodeFile",{extra_info:JSON.stringify({result:t,needSwitch:e})});var i="#".concat(h.getTimeStamp());if(t.pages&&0!=t.pages)if(t.url.endsWith("/")){for(var r=[],o=0;o<t.pages;o++)r.push("".concat(t.url).concat(o+1,".jpg"));try{var n=t.resolution.split("x")[0],s=t.resolution.split("x")[1],a=h.maxCommonDivisor(n,s),l="".concat(n/a,":").concat(s/a);return this.addFile(i,r,t.title,t.url,l,e)}catch(o){return this.addFile(i,r,t.title,t.url,null,e)}}else if(t.url.endsWith(".html"))return this.addH5PPTFile(t.url,t.title,e)},fe.prototype.setFileScale=function(t,e){this.store.setFileScale(t,e)},fe.prototype.getFileScale=function(t){return this.store.getFileScale(t)},fe.prototype.webviewMouseExited=function(){this.boardBox.style.cursor="none",this.laserCanvas.style.cursor="none",this.textAreaBox.style.cursor="none",this.boardBox.style.cursor="auto",this.laserCanvas.style.cursor="auto",this.textAreaBox.style.cursor="auto",this.store.collectRaserData().over(this.getToolType())},fe.prototype.webviewMouseEntered=function(){this.updateCursor()},fe.prototype.setSystemCursorEnable=function(t){this.store.setSystemCursorEnable(t)},fe.prototype.setToolTypeTitle=function(t,e){this.store.setToolTypeTitle(t,e)},fe.prototype.enableAudioControl=function(t){this.store.enableAudioControl(t)},fe.prototype.getBoardElementList=function(t){t=t||this.getCurrentBoard();var e=this.store.getBoardElementList(t);for(var i in this.imageElementMapData){var r=this.imageElementMapData[i];e.push({boardId:r.boardId,elementId:String(r.belongSeq),type:$.TEDU_BOARD_ELEMENT_IMAGE,url:r.url})}return e},fe.prototype.setScaleToolRatio=function(t){var e=t;h.isNumber(e)||(e=10),this.scaleRatio=e};var ge=fe;function _e(){}_e.prototype.on=function(t,e){return this._cbs=this._cbs||{},(this._cbs[t]||(this._cbs[t]=[])).unshift(e),this},_e.prototype.off=function(t,e){if(this._cbs=this._cbs||{},!t)return this._cbs={};if(!e)return delete this._cbs[t];for(var i,r=this._cbs[t]||[];r&&~(i=r.indexOf(e));)r.splice(i,1);return this},_e.prototype.fire=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=arguments.length>1?arguments[1]:void 0;this._cbs=this._cbs||{};var i=this._cbs[e];if(i){for(var r=i.length,o=arguments.length,n=new Array(o>2?o-2:0),s=2;s<o;s++)n[s-2]=arguments[s];for(;r--;)i[r].apply(t,[].concat(n))}return this};var me=_e;function ye(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Te=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._params=JSON.parse(JSON.stringify(e)),this._task=null,this._loopTimer=0,this._cacheData=[],this._createLoggerTask(),this._createLogger()}var e,i;return e=t,(i=[{key:"_createLogger",value:function(){if(window.TIWLogger&&window.TIWLogger.TLogger&&window.TIWLogger.TLoggerConfig){var t=window.TIWLogger.TLogger,e=new(0,window.TIWLogger.TLoggerConfig);e.nativeSdkVersion=this._params.nativeVersion,e.webSdkVersion=this.version,e.business="tiw_sdk",e.sdkAppId=Number(this._params.sdkAppId),e.roomId=this._params.classId,e.userId=this._params.userId,this._logger=t.getInstance("TIW_".concat(this._params.sdkAppId,"_").concat(this._params.userId)),this._logger.setConfig(e),clearInterval(this._task),this._reportCacheContent()}}},{key:"_createLoggerTask",value:function(){var t=this;this._task=setInterval((function(){t._loopTimer++,t._createLogger(),t._loopTimer>20&&clearInterval(t._task)}),500)}},{key:"debug",value:function(){var t=Array.prototype.slice.call(arguments);t.unshift("debug"),this._report.apply(this,t)}},{key:"info",value:function(){var t=Array.prototype.slice.call(arguments);t.unshift("info"),this._report.apply(this,t)}},{key:"warn",value:function(){var t=Array.prototype.slice.call(arguments);t.unshift("warn"),this._report.apply(this,t)}},{key:"error",value:function(){var t=Array.prototype.slice.call(arguments);t.unshift("error"),this._report.apply(this,t)}},{key:"_cacheReportContent",value:function(t){this._cacheData.push(t)}},{key:"_reportCacheContent",value:function(){var t=this;this._cacheData.forEach((function(e){var i=e.method,r=e.data;try{t._logger&&t._logger[i](r)}catch(t){}}))}},{key:"_report",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{var n={};h.isString(r)?n.param=r:n=r;var s=Object.assign(n,{module:e,action:i,report:o});this._logger?this._logger[t](s):this._cacheReportContent({method:t,data:s})}catch(t){}}}])&&ye(e.prototype,i),t}();function ve(t){var e=this;o.setNativeVersion(t.nativeVersion),o.setPlatform(t.platform||o.PLATFORM),t.tlsData={sdkAppId:t.sdkAppId,identifier:t.userId+"",userSig:t.userSig},this.version=o.VERSION;var i=new Te(t);t.logger=i,this.event=new me,t.event=this.event;var r=new p;r.setEvent(this.event),r.setSdkAppid(t.sdkAppId),r.setRoomId(t.classId),r.setUserId(t.userId),t.elkLog=r,this.board=new ge(t),t.syncHistroyEnable?this.historySyncDone=!1:this.historySyncDone=!0,this.event.on(ve.EVENT.TEB_HISTROYDATA_SYNCCOMPLETED,(function(){e.historySyncDone=!0}))}ve.EVENT=c,ve.TOOL_TYPE=Yt,ve.CONTENT_FIT_MODE=q,ve.ARROW_TYPE=l,ve.LINE_TYPE=U,ve.OVAL_DRAW_MODE=Y,ve.VIDEO_STATUS=oe,ve.MEDIA_STATUS=Mt,ve.H5FILE_STATUS=Wt,ve.TEduBoardErrorCode=k,ve.TEduBoardWarningCode=dt,ve.TEduBoardToolType=Yt,ve.TEduBoardImageFitMode=C,ve.TEduBoardTextStyle=F,ve.TEduBoardUploadStatus=ct,ve.TEduBoardBackgroundH5Status=Gt,ve.TEduBoardContentFitMode=q,ve.TEduBoardLineType=U,ve.TEduBoardArrowType=l,ve.TEduBoardOvalDrawMode=Y,ve.TEduBoardH5FileStatus=Wt,ve.TEduBoardVideoStatus=oe,ve.TEduBoardAudioStatus=Mt,ve.TEduBoardImageStatus=Ht,ve.TEduBoardElementType=$,ve.TEduBoardH5PPTStatus=Vt,ve.TEduBoardTranscodeFileStatus={TEDU_BOARD_TRANSCODEFILE_STATUS_ERROR:"ERROR",TEDU_BOARD_TRANSCODEFILE_STATUS_UPLOADING:"UPLOADING",TEDU_BOARD_TRANSCODEFILE_STATUS_CREATED:"CREATED",TEDU_BOARD_TRANSCODEFILE_STATUS_QUEUED:"QUEUED",TEDU_BOARD_TRANSCODEFILE_STATUS_PROCESSING:"PROCESSING",TEDU_BOARD_TRANSCODEFILE_STATUS_FINISHED:"FINISHED"},ve.TEduBoardPosition=kt,ve.prototype.destroy=function(){this.off(),this.event=null,this.board&&this.board.destroy(),this.board=null,this.historySyncDone=!1},ve.prototype.on=function(t,e){this.event.on(t,e)},ve.prototype.off=function(t,e){this.event&&this.event.off(t,e)},ve.prototype.addSyncData=function(t){this.board&&this.board.addData(t)},ve.getVersion=function(){return o.VERSION},ve.prototype.getVersion=function(){return this.version},ve.prototype.setDataSyncEnable=function(t){this.board.setDataSyncEnable(t)},ve.prototype.isDataSyncEnable=function(){return this.board.isDataSyncEnable()},ve.prototype.reset=function(){this.historySyncDone?this.board.clearAll():this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"reset invalid while load history")},ve.prototype.getSyncTime=function(){return this.board.getSyncTime()},ve.prototype.syncRemoteTime=function(t,e){this.board.syncRemoteTime(t,e)},ve.prototype.generateFid=function(){return"#".concat(h.getTimeStamp())},ve.prototype.setDrawEnable=function(t){this.board.setDrawEnable(t)},ve.prototype.isDrawEnable=function(){return this.board.isDrawEnable()},ve.prototype.setAccessibleUsers=function(t){this.board.setAccessibleUsers(t)},ve.prototype.setGlobalBackgroundColor=function(t){this.board.setGlobalBackgroundColor(t)},ve.prototype.getGlobalBackgroundColor=function(){return this.board.getGlobalBackgroundColor()},ve.prototype.setBackgroundColor=function(t){this.board.setBackgroundColor(t)},ve.prototype.getBackgroundColor=function(){return this.board.getBackgroundColor()},ve.prototype.setToolType=function(t){this.board.setType(t)},ve.prototype.setNextTextInput=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.board.setNextTextInput(t,e)},ve.prototype.getToolType=function(){return this.board.getToolType()},ve.prototype.setCursorIcon=function(t,e){this.board.setCursorIcon(t,e)},ve.prototype.setZoomCursorIcon=function(t,e){this.board.setZoomCursorIcon(t,e)},ve.prototype.setBrushColor=function(t){this.board.setColor(t)},ve.prototype.getBrushColor=function(){return this.board.getBrushColor()},ve.prototype.setBrushThin=function(t){this.board.setThin(t)},ve.prototype.getBrushThin=function(){return this.board.getBrushThin()},ve.prototype.setTextColor=function(t){this.board.setTextColor(t)},ve.prototype.getTextColor=function(){return this.board.getTextColor()},ve.prototype.setTextSize=function(t){this.board.setTextSize(t)},ve.prototype.getTextSize=function(){return this.board.getTextSize()},ve.prototype.setTextStyle=function(t){this.board.setTextFontStyle(t)},ve.prototype.getTextStyle=function(){return this.board.getTextFontStyle()},ve.prototype.setLineStyle=function(t){this.board.setLineStyle(t)},ve.prototype.getLineStyle=function(){return this.board.getLineStyle()},ve.prototype.setOvalDrawMode=function(t){this.board.setOvalDrawMode(t)},ve.prototype.getOvalDrawMode=function(){return this.board.getOvalDrawMode()},ve.prototype.clear=function(t,e){this.historySyncDone?this.board.clear(t,e):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"clear invalid while load history")},ve.prototype.setBackgroundImage=function(t,e){this.historySyncDone?this.board._setBackgroundImage(t,e):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"setBackgroundImage invalid while load history")},ve.prototype.setBackgroundH5=function(t){this.historySyncDone?this.board.setBackgroundH5(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"setBackgroundH5 invalid while load history")},ve.prototype.undo=function(){this.historySyncDone?this.board.undo():this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"undo invalid while load history")},ve.prototype.redo=function(){this.historySyncDone?this.board.redo():this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"redo invalid while load history")},ve.prototype.resize=function(){this.board.resize()},ve.prototype.addBoard=function(t,e){if(this.historySyncDone){var i=this.board.addBoard();return this.board.setBackgroundPic(i,t,e),i}this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"addBoard invalid while load history")},ve.prototype.deleteBoard=function(t){this.historySyncDone?this.board.deleteBoard(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"deleteBoard invalid while load history")},ve.prototype.prevStep=function(){this.historySyncDone?this.board.prevStep():this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"prevStep invalid while load history")},ve.prototype.nextStep=function(){this.historySyncDone?this.board.nextStep():this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"nextStep invalid while load history")},ve.prototype.prevBoard=function(t){this.historySyncDone?this.board.prevBoard(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"prevBoard invalid while load history")},ve.prototype.nextBoard=function(t){this.historySyncDone?this.board.nextBoard(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"nextBoard invalid while load history")},ve.prototype.gotoBoard=function(t,e){this.historySyncDone?t&&this.board.switchBoard(t,e):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"gotoBoard invalid while load history")},ve.prototype.getCurrentBoard=function(){return this.board.getCurrentBoard()},ve.prototype.getBoardList=function(){return this.board.getBoardList()},ve.prototype.setBoardRatio=function(t){this.board.setBoardRatio(t)},ve.prototype.getBoardRatio=function(){return this.board.getBoardRatio()},ve.prototype.setBoardScale=function(t){this.board.setBoardScale(t)},ve.prototype.getBoardScale=function(){return this.board.getBoardScale()},ve.prototype.setBoardContentFitMode=function(t){this.board.setBoardContentFitMode(t)},ve.prototype.getBoardContentFitMode=function(){return this.board.getBoardContentFitMode()},ve.prototype.applyFileTranscode=function(t,e){this.historySyncDone?this.board.applyFileTranscode(t,e):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"applyFileTranscode invalid while load history")},ve.prototype.getFileTranscodeProgress=function(t){this.board.describeTranscode(t)},ve.prototype.addTranscodeFile=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.historySyncDone)return this.board.addTranscodeFile(t,e);this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"addTranscodeFile invalid while load history")},ve.prototype.addImagesFile=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Array.isArray(t)?0==t.length?"":this.historySyncDone?this.board.addImagesFile(t,null,e):(this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"addImagesFile invalid while load history"),""):""},ve.prototype.deleteFile=function(t){this.historySyncDone?this.board.deleteFile(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"deleteFile invalid while load history")},ve.prototype.switchFile=function(t,e,i){this.historySyncDone?this.board.switchFile(t,e,i):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"switchFile invalid while load history")},ve.prototype.getCurrentFile=function(){return this.board.getCurrentFile()},ve.prototype.getFileInfo=function(t){var e=this.board.getFileInfo(t);return e?Object.assign({},e,{boardInfoList:this.board.getBoardInfoList(t)}):e},ve.prototype.getFileInfoList=function(){return this.board.getFileInfoList()},ve.prototype.getFileBoardList=function(t){return this.board.getBoardByGroup(t)},ve.prototype.getThumbnailImages=function(t){return this.board.getThumbnailImages(t)},ve.prototype.clearFileDraws=function(t){this.historySyncDone?this.board.clearFileDraws(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"clearFileDraws invalid while load history")},ve.hasVideoPermission=function(){return ge.hasVideoPermission()},ve.applyVideoPermission=function(t){ge.applyVideoPermission(t,this.elkLog)},ve.prototype.addVideoFile=function(t){return this.historySyncDone?this.board.addVideoFile(t):(this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"addVideoFile invalid while load history"),"")},ve.prototype.addVODFile=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.historySyncDone?this.board.addVODFile(t,e,i):(this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"addVODFile invalid while load history"),"")},ve.prototype.setVODExtParam=function(t,e){this.board.setVODExtParam(t,e)},ve.prototype.showVideoControl=function(t){this.board.showVideoControl(t)},ve.prototype.playVideo=function(){this.board.playVideo()},ve.prototype.pauseVideo=function(){this.board.pauseVideo()},ve.prototype.seekVideo=function(t){this.board.seekVideo(t)},ve.prototype.muteVideo=function(t){this.board.muteVideo(t)},ve.prototype.playAudio=function(t){this.board.playAudio(t)},ve.prototype.pauseAudio=function(t){this.board.pauseAudio(t)},ve.prototype.seekAudio=function(t,e){this.board.seekAudio(t,e)},ve.prototype.muteAudio=function(t,e){this.board.muteAudio(t,e)},ve.prototype.setAudioVolume=function(t,e){this.board.setAudioVolume(t,e)},ve.prototype.getAudioVolume=function(t){return this.board.getAudioVolume(t)},ve.prototype.setSyncAudioStatusEnable=function(t){this.board.setSyncAudioStatusEnable(t)},ve.prototype.setSyncVideoStatusEnable=function(t){this.board.setSyncVideoStatusEnable(t)},ve.prototype.startSyncVideoStatus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.SYNC_VIDEO_STATUS_INTERVAL;this.board.startSyncVideoStatus(t)},ve.prototype.stopSyncVideoStatus=function(){this.board.stopSyncVideoStatus()},ve.prototype.addH5File=function(t){return this.historySyncDone?this.board.addH5File(t):(this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"addH5File invalid while load history"),"")},ve.prototype.addImageElement=function(t){this.historySyncDone?this.board.addImageElement(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"setBackgroundImage invalid while load history")},ve.prototype.setHandwritingEnable=function(t){return this.historySyncDone?this.board.setHandwritingEnable(t):(this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"enableHandwriting invalid while load history"),"")},ve.prototype.isHandwritingEnable=function(){return this.board.isHandwritingEnable()},ve.prototype.addElement=function(t,e,i){return this.board.addElement(t,e,i)},ve.prototype.generateElementId=function(){return String(a.getSeq())},ve.prototype.removeElement=function(t){return this.board.removeElement(t)},ve.prototype.refresh=function(){this.historySyncDone?this.board.refresh():this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"refresh invalid while load history")},ve.prototype.addAckData=function(t){this.board.addAckData(t)},ve.prototype.syncAndReload=function(){this.historySyncDone?(this.historySyncDone=!1,this.board.syncAndReload()):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"syncAndReload invalid while load history")},ve.prototype.snapshot=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.historySyncDone?this.board.snapshot(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"snapshot invalid while load history")},ve.prototype.setFileScale=function(t,e){this.board.setFileScale(t,e)},ve.prototype.getFileScale=function(t){return this.board.getFileScale(t)},ve.prototype.webviewMouseExited=function(){var t=this;setTimeout((function(){t.board.webviewMouseExited()}),10)},ve.prototype.webviewMouseEntered=function(){this.board.webviewMouseEntered()},ve.prototype.setSystemCursorEnable=function(t){this.historySyncDone?this.board.setSystemCursorEnable(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"setSystemCursorEnable invalid while load history")},ve.prototype.setToolTypeTitle=function(t,e){this.board.setToolTypeTitle(t,e)},ve.prototype.enableAudioControl=function(t){this.historySyncDone?this.board.enableAudioControl(t):this.event.fire(this,"TEB_WARNING",dt.TEDU_BOARD_WANNING_ILLEGAL_OPERATION,"enableAudioControl invalid while load history")},ve.prototype.getBoardElementList=function(t){return this.board.getBoardElementList(t)},ve.prototype.setScaleToolRatio=function(t){this.board.setScaleToolRatio(t)},e.default=ve}]).default}));